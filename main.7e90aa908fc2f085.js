(self.webpackChunkvideo_call=self.webpackChunkvideo_call||[]).push([[179],{581:(na,Xh,Vd)=>{"use strict";function M(e){return"function"==typeof e}function ra(e){const n=e(a=>{Error.call(a),a.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const Mo=ra(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((a,c)=>`${c+1}) ${a.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function Qt(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class Xn{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const l of n)l.remove(this);else n.remove(this);const{initialTeardown:a}=this;if(M(a))try{a()}catch(l){t=l instanceof Mo?l.errors:[l]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const l of c)try{ia(l)}catch(p){t=t??[],p instanceof Mo?t=[...t,...p.errors]:t.push(p)}}if(t)throw new Mo(t)}}add(t){var n;if(t&&t!==this)if(this.closed)ia(t);else{if(t instanceof Xn){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&Qt(n,t)}remove(t){const{_finalizers:n}=this;n&&Qt(n,t),t instanceof Xn&&t._removeParent(this)}}Xn.EMPTY=(()=>{const e=new Xn;return e.closed=!0,e})();const oa=Xn.EMPTY;function ws(e){return e instanceof Xn||e&&"closed"in e&&M(e.remove)&&M(e.add)&&M(e.unsubscribe)}function ia(e){M(e)?e():e.unsubscribe()}const Fr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},su={setTimeout(e,t,...n){const{delegate:a}=su;return a?.setTimeout?a.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=su;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Dn(e){su.setTimeout(()=>{const{onUnhandledError:t}=Fr;if(!t)throw e;t(e)})}function ho(){}const Qh=Zh("C",void 0,void 0);function Zh(e,t,n){return{kind:e,value:t,error:n}}let sa=null;function Fd(e){if(Fr.useDeprecatedSynchronousErrorHandling){const t=!sa;if(t&&(sa={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:a}=sa;if(sa=null,n)throw a}}else e()}class Qn extends Xn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,ws(t)&&t.add(this)):this.destination=tT}static create(t,n,a){return new aa(t,n,a)}next(t){this.isStopped?ep(function yw(e){return Zh("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?ep(function ot(e){return Zh("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?ep(Qh,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const jd=Function.prototype.bind;function Xo(e,t){return jd.call(e,t)}class Sw{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(a){po(a)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(a){po(a)}else po(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){po(n)}}}class aa extends Qn{constructor(t,n,a){let c;if(super(),M(t)||!t)c={next:t??void 0,error:n??void 0,complete:a??void 0};else{let l;this&&Fr.useDeprecatedNextContext?(l=Object.create(t),l.unsubscribe=()=>this.unsubscribe(),c={next:t.next&&Xo(t.next,l),error:t.error&&Xo(t.error,l),complete:t.complete&&Xo(t.complete,l)}):c=t}this.destination=new Sw(c)}}function po(e){Fr.useDeprecatedSynchronousErrorHandling?function Ig(e){Fr.useDeprecatedSynchronousErrorHandling&&sa&&(sa.errorThrown=!0,sa.error=e)}(e):Dn(e)}function ep(e,t){const{onStoppedNotification:n}=Fr;n&&su.setTimeout(()=>n(e,t))}const tT={closed:!0,next:ho,error:function Rg(e){throw e},complete:ho},bg="function"==typeof Symbol&&Symbol.observable||"@@observable";function Qr(e){return e}function ca(e){return 0===e.length?Qr:1===e.length?e[0]:function(n){return e.reduce((a,c)=>c(a),n)}}let Ln=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const a=new e;return a.source=this,a.operator=n,a}subscribe(n,a,c){const l=function Bd(e){return e&&e instanceof Qn||function Tw(e){return e&&M(e.next)&&M(e.error)&&M(e.complete)}(e)&&ws(e)}(n)?n:new aa(n,a,c);return Fd(()=>{const{operator:p,source:g}=this;l.add(p?p.call(l,g):g?this._subscribe(l):this._trySubscribe(l))}),l}_trySubscribe(n){try{return this._subscribe(n)}catch(a){n.error(a)}}forEach(n,a){return new(a=nT(a))((c,l)=>{const p=new aa({next:g=>{try{n(g)}catch(v){l(v),p.unsubscribe()}},error:l,complete:c});this.subscribe(p)})}_subscribe(n){var a;return null===(a=this.source)||void 0===a?void 0:a.subscribe(n)}[bg](){return this}pipe(...n){return ca(n)(this)}toPromise(n){return new(n=nT(n))((a,c)=>{let l;this.subscribe(p=>l=p,p=>c(p),()=>a(l))})}}return e.create=t=>new e(t),e})();function nT(e){var t;return null!==(t=e??Fr.Promise)&&void 0!==t?t:Promise}const Cw=ra(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Os=(()=>{class e extends Ln{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const a=new rT(this,this);return a.operator=n,a}_throwIfClosed(){if(this.closed)throw new Cw}next(n){Fd(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const a of this.currentObservers)a.next(n)}})}error(n){Fd(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:a}=this;for(;a.length;)a.shift().error(n)}})}complete(){Fd(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:a,isStopped:c,observers:l}=this;return a||c?oa:(this.currentObservers=null,l.push(n),new Xn(()=>{this.currentObservers=null,Qt(l,n)}))}_checkFinalizedStatuses(n){const{hasError:a,thrownError:c,isStopped:l}=this;a?n.error(c):l&&n.complete()}asObservable(){const n=new Ln;return n.source=this,n}}return e.create=(t,n)=>new rT(t,n),e})();class rT extends Os{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,a;null===(a=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===a||a.call(n,t)}error(t){var n,a;null===(a=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===a||a.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,a;return null!==(a=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==a?a:oa}}class fo extends Os{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:a}=this;if(t)throw n;return this._throwIfClosed(),a}next(t){super.next(this._value=t)}}function oT(e){return M(e?.lift)}function Zn(e){return t=>{if(oT(t))return t.lift(function(n){try{return e(n,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}function gr(e,t,n,a,c){return new np(e,t,n,a,c)}class np extends Qn{constructor(t,n,a,c,l,p){super(t),this.onFinalize=l,this.shouldUnsubscribe=p,this._next=n?function(g){try{n(g)}catch(v){t.error(v)}}:super._next,this._error=c?function(g){try{c(g)}catch(v){t.error(v)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(g){t.error(g)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Nt(e,t){return Zn((n,a)=>{let c=0;n.subscribe(gr(a,l=>{a.next(e.call(t,l,c++))}))})}function qi(e){return this instanceof qi?(this.v=e,this):new qi(e)}function cT(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function op(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],a=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n);function a(l){n[l]=e[l]&&function(p){return new Promise(function(g,v){!function c(l,p,g,v){Promise.resolve(v).then(function(I){l({value:I,done:g})},p)}(g,v,(p=e[l](p)).done,p.value)})}}}const uT=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function $i(e){return M(e?.then)}function dT(e){return M(e[bg])}function sp(e){return Symbol.asyncIterator&&M(e?.[Symbol.asyncIterator])}function ap(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const cp=function kg(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function lT(e){return M(e?.[cp])}function Hd(e){return function Mg(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,a=n.apply(e,t||[]),l=[];return c={},p("next"),p("throw"),p("return"),c[Symbol.asyncIterator]=function(){return this},c;function p(F){a[F]&&(c[F]=function(j){return new Promise(function(W,$){l.push([F,j,W,$])>1||g(F,j)})})}function g(F,j){try{!function v(F){F.value instanceof qi?Promise.resolve(F.value.v).then(I,A):O(l[0][2],F)}(a[F](j))}catch(W){O(l[0][3],W)}}function I(F){g("next",F)}function A(F){g("throw",F)}function O(F,j){F(j),l.shift(),l.length&&g(l[0][0],l[0][1])}}(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:a,done:c}=yield qi(n.read());if(c)return yield qi(void 0);yield yield qi(a)}}finally{n.releaseLock()}})}function xg(e){return M(e?.getReader)}function Zo(e){if(e instanceof Ln)return e;if(null!=e){if(dT(e))return function Pw(e){return new Ln(t=>{const n=e[bg]();if(M(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(uT(e))return function hT(e){return new Ln(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if($i(e))return function Ug(e){return new Ln(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Dn)})}(e);if(sp(e))return fT(e);if(lT(e))return function pT(e){return new Ln(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(xg(e))return function Mw(e){return fT(Hd(e))}(e)}throw ap(e)}function fT(e){return new Ln(t=>{(function la(e,t){var n,a,c,l;return function Og(e,t,n,a){return new(n||(n=Promise))(function(l,p){function g(A){try{I(a.next(A))}catch(O){p(O)}}function v(A){try{I(a.throw(A))}catch(O){p(O)}}function I(A){A.done?l(A.value):function c(l){return l instanceof n?l:new n(function(p){p(l)})}(A.value).then(g,v)}I((a=a.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=cT(e);!(a=yield n.next()).done;)if(t.next(a.value),t.closed)return}catch(p){c={error:p}}finally{try{a&&!a.done&&(l=n.return)&&(yield l.call(n))}finally{if(c)throw c.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function Ps(e,t,n,a=0,c=!1){const l=t.schedule(function(){n(),c?e.add(this.schedule(null,a)):this.unsubscribe()},a);if(e.add(l),!c)return l}function Pt(e,t,n=1/0){return M(t)?Pt((a,c)=>Nt((l,p)=>t(a,l,c,p))(Zo(e(a,c))),n):("number"==typeof t&&(n=t),Zn((a,c)=>function Lw(e,t,n,a,c,l,p,g){const v=[];let I=0,A=0,O=!1;const F=()=>{O&&!v.length&&!I&&t.complete()},j=$=>I<a?W($):v.push($),W=$=>{l&&t.next($),I++;let Q=!1;Zo(n($,A++)).subscribe(gr(t,ue=>{c?.(ue),l?j(ue):t.next(ue)},()=>{Q=!0},void 0,()=>{if(Q)try{for(I--;v.length&&I<a;){const ue=v.shift();p?Ps(t,p,()=>W(ue)):W(ue)}F()}catch(ue){t.error(ue)}}))};return e.subscribe(gr(t,j,()=>{O=!0,F()})),()=>{g?.()}}(a,c,e,n)))}function cu(e=1/0){return Pt(Qr,e)}const zi=new Ln(e=>e.complete());function Fg(e){return e[e.length-1]}function mT(e){return M(Fg(e))?e.pop():void 0}function uu(e){return function Vg(e){return e&&M(e.schedule)}(Fg(e))?e.pop():void 0}function jg(e,t=0){return Zn((n,a)=>{n.subscribe(gr(a,c=>Ps(a,e,()=>a.next(c),t),()=>Ps(a,e,()=>a.complete(),t),c=>Ps(a,e,()=>a.error(c),t)))})}function Bg(e,t=0){return Zn((n,a)=>{a.add(e.schedule(()=>n.subscribe(a),t))})}function Fn(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ln(n=>{Ps(n,t,()=>{const a=e[Symbol.asyncIterator]();Ps(n,t,()=>{a.next().then(c=>{c.done?n.complete():n.next(c.value)})},0,!0)})})}function er(e,t){return t?function _T(e,t){if(null!=e){if(dT(e))return function Gd(e,t){return Zo(e).pipe(Bg(t),jg(t))}(e,t);if(uT(e))return function gT(e,t){return new Ln(n=>{let a=0;return t.schedule(function(){a===e.length?n.complete():(n.next(e[a++]),n.closed||this.schedule())})})}(e,t);if($i(e))return function za(e,t){return Zo(e).pipe(Bg(t),jg(t))}(e,t);if(sp(e))return Fn(e,t);if(lT(e))return function Uw(e,t){return new Ln(n=>{let a;return Ps(n,t,()=>{a=e[cp](),Ps(n,t,()=>{let c,l;try{({value:c,done:l}=a.next())}catch(p){return void n.error(p)}l?n.complete():n.next(c)},0,!0)}),()=>M(a?.return)&&a.return()})}(e,t);if(xg(e))return function Vw(e,t){return Fn(Hd(e),t)}(e,t)}throw ap(e)}(e,t):Zo(e)}function Ke(...e){return er(e,uu(e))}function ET(e={}){const{connector:t=(()=>new Os),resetOnError:n=!0,resetOnComplete:a=!0,resetOnRefCountZero:c=!0}=e;return l=>{let p,g,v,I=0,A=!1,O=!1;const F=()=>{g?.unsubscribe(),g=void 0},j=()=>{F(),p=v=void 0,A=O=!1},W=()=>{const $=p;j(),$?.unsubscribe()};return Zn(($,Q)=>{I++,!O&&!A&&F();const ue=v=v??t();Q.add(()=>{I--,0===I&&!O&&!A&&(g=Hg(W,c))}),ue.subscribe(Q),!p&&I>0&&(p=new aa({next:J=>ue.next(J),error:J=>{O=!0,F(),g=Hg(j,n,J),ue.error(J)},complete:()=>{A=!0,F(),g=Hg(j,a),ue.complete()}}),Zo($).subscribe(p))})(l)}}function Hg(e,t,...n){if(!0===t)return void e();if(!1===t)return;const a=new aa({next:()=>{a.unsubscribe(),e()}});return Zo(t(...n)).subscribe(a)}function yi(e,t){return Zn((n,a)=>{let c=null,l=0,p=!1;const g=()=>p&&!c&&a.complete();n.subscribe(gr(a,v=>{c?.unsubscribe();let I=0;const A=l++;Zo(e(v,A)).subscribe(c=gr(a,O=>a.next(t?t(v,O,A,I++):O),()=>{c=null,g()}))},()=>{p=!0,g()}))})}function Bw(e,t){return e===t}function Ot(e){for(let t in e)if(e[t]===Ot)return t;throw Error("Could not find renamed property on target object.")}function Wd(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function jn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(jn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Gg(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Wg=Ot({__forward_ref__:Ot});function dn(e){return e.__forward_ref__=dn,e.toString=function(){return jn(this())},e}function ze(e){return Kg(e)?e():e}function Kg(e){return"function"==typeof e&&e.hasOwnProperty(Wg)&&e.__forward_ref__===dn}function qg(e){return e&&!!e.\u0275providers}class se extends Error{constructor(t,n){super(function up(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function Qe(e){return"string"==typeof e?e:null==e?"":String(e)}function dp(e,t){throw new se(-201,!1)}function ei(e,t){null==e&&function jt(e,t,n,a){throw new Error(`ASSERTION ERROR: ${e}`+(null==a?"":` [Expected=> ${n} ${a} ${t} <=Actual]`))}(t,e,null,"!=")}function Le(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function jr(e){return{providers:e.providers||[],imports:e.imports||[]}}function qd(e){return lp(e,hp)||lp(e,CT)}function lp(e,t){return e.hasOwnProperty(t)?e[t]:null}function TT(e){return e&&(e.hasOwnProperty($g)||e.hasOwnProperty(zw))?e[$g]:null}const hp=Ot({\u0275prov:Ot}),$g=Ot({\u0275inj:Ot}),CT=Ot({ngInjectableDef:Ot}),zw=Ot({ngInjectorDef:Ot});var Pe=(()=>((Pe=Pe||{})[Pe.Default=0]="Default",Pe[Pe.Host=1]="Host",Pe[Pe.Self=2]="Self",Pe[Pe.SkipSelf=4]="SkipSelf",Pe[Pe.Optional=8]="Optional",Pe))();let du;function mo(e){const t=du;return du=e,t}function RT(e,t,n){const a=qd(e);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:n&Pe.Optional?null:void 0!==t?t:void dp(jn(e))}const ln=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),lu={},zg="__NG_DI_FLAG__",tr="ngTempTokenPath",Jw=/\n/gm,bT="__source";let hu;function Zr(e){const t=hu;return hu=e,t}function Qw(e,t=Pe.Default){if(void 0===hu)throw new se(-203,!1);return null===hu?RT(e,void 0,t):hu.get(e,t&Pe.Optional?null:void 0,t)}function Ne(e,t=Pe.Default){return(function IT(){return du}()||Qw)(ze(e),t)}function ve(e,t=Pe.Default){return Ne(e,pp(t))}function pp(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function fp(e){const t=[];for(let n=0;n<e.length;n++){const a=ze(e[n]);if(Array.isArray(a)){if(0===a.length)throw new se(900,!1);let c,l=Pe.Default;for(let p=0;p<a.length;p++){const g=a[p],v=Zw(g);"number"==typeof v?-1===v?c=g.token:l|=v:c=g}t.push(Ne(c,l))}else t.push(Ne(a))}return t}function Yd(e,t){return e[zg]=t,e.prototype[zg]=t,e}function Zw(e){return e[zg]}function Ms(e){return{toString:e}.toString()}var Si=(()=>((Si=Si||{})[Si.OnPush=0]="OnPush",Si[Si.Default=1]="Default",Si))(),Lo=(()=>{return(e=Lo||(Lo={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",Lo;var e})();const Xi={},gt=[],gp=Ot({\u0275cmp:Ot}),Xg=Ot({\u0275dir:Ot}),Qg=Ot({\u0275pipe:Ot}),_p=Ot({\u0275mod:Ot}),Qi=Ot({\u0275fac:Ot}),ti=Ot({__NG_ELEMENT_ID__:Ot}),Zg=Ot({__NG_ENV_ID__:Ot});function e_(e,t,n){let a=e.length;for(;;){const c=e.indexOf(t,n);if(-1===c)return c;if(0===c||e.charCodeAt(c-1)<=32){const l=t.length;if(c+l===a||e.charCodeAt(c+l)<=32)return c}n=c+1}}function pu(e,t,n){let a=0;for(;a<n.length;){const c=n[a];if("number"==typeof c){if(0!==c)break;a++;const l=n[a++],p=n[a++],g=n[a++];e.setAttribute(t,p,g,l)}else{const l=c,p=n[++a];DT(l)?e.setProperty(t,l,p):e.setAttribute(t,l,p),a++}}return a}function pa(e){return 3===e||4===e||6===e}function DT(e){return 64===e.charCodeAt(0)}function Jd(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let a=0;a<t.length;a++){const c=t[a];"number"==typeof c?n=c:0===n||t_(e,n,c,null,-1===n||2===n?t[++a]:null)}}return e}function t_(e,t,n,a,c){let l=0,p=e.length;if(-1===t)p=-1;else for(;l<e.length;){const g=e[l++];if("number"==typeof g){if(g===t){p=-1;break}if(g>t){p=l-1;break}}}for(;l<e.length;){const g=e[l];if("number"==typeof g)break;if(g===n){if(null===a)return void(null!==c&&(e[l+1]=c));if(a===e[l+1])return void(e[l+2]=c)}l++,null!==a&&l++,null!==c&&l++}-1!==p&&(e.splice(p,0,t),l=p+1),e.splice(l++,0,n),null!==a&&e.splice(l++,0,a),null!==c&&e.splice(l++,0,c)}const Ep="ng-template";function eO(e,t,n){let a=0,c=!0;for(;a<e.length;){let l=e[a++];if("string"==typeof l&&c){const p=e[a++];if(n&&"class"===l&&-1!==e_(p.toLowerCase(),t,0))return!0}else{if(1===l){for(;a<e.length&&"string"==typeof(l=e[a++]);)if(l.toLowerCase()===t)return!0;return!1}"number"==typeof l&&(c=!1)}}return!1}function n_(e){return 4===e.type&&e.value!==Ep}function wT(e,t,n){return t===(4!==e.type||n?e.value:Ep)}function OT(e,t,n){let a=4;const c=e.attrs||[],l=function nO(e){for(let t=0;t<e.length;t++)if(pa(e[t]))return t;return e.length}(c);let p=!1;for(let g=0;g<t.length;g++){const v=t[g];if("number"!=typeof v){if(!p)if(4&a){if(a=2|1&a,""!==v&&!wT(e,v,n)||""===v&&1===t.length){if(Ti(a))return!1;p=!0}}else{const I=8&a?v:t[++g];if(8&a&&null!==e.attrs){if(!eO(e.attrs,I,n)){if(Ti(a))return!1;p=!0}continue}const O=tO(8&a?"class":v,c,n_(e),n);if(-1===O){if(Ti(a))return!1;p=!0;continue}if(""!==I){let F;F=O>l?"":c[O+1].toLowerCase();const j=8&a?F:null;if(j&&-1!==e_(j,I,0)||2&a&&I!==F){if(Ti(a))return!1;p=!0}}}}else{if(!p&&!Ti(a)&&!Ti(v))return!1;if(p&&Ti(v))continue;p=!1,a=v|1&a}}return Ti(a)||p}function Ti(e){return 0==(1&e)}function tO(e,t,n,a){if(null===t)return-1;let c=0;if(a||!n){let l=!1;for(;c<t.length;){const p=t[c];if(p===e)return c;if(3===p||6===p)l=!0;else{if(1===p||2===p){let g=t[++c];for(;"string"==typeof g;)g=t[++c];continue}if(4===p)break;if(0===p){c+=4;continue}}c+=l?1:2}return-1}return function rO(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const a=e[n];if("number"==typeof a)return-1;if(a===t)return n;n++}return-1}(t,e)}function r_(e,t,n=!1){for(let a=0;a<t.length;a++)if(OT(e,t[a],n))return!0;return!1}function NT(e,t){return e?":not("+t.trim()+")":t}function iO(e){let t=e[0],n=1,a=2,c="",l=!1;for(;n<e.length;){let p=e[n];if("string"==typeof p)if(2&a){const g=e[++n];c+="["+p+(g.length>0?'="'+g+'"':"")+"]"}else 8&a?c+="."+p:4&a&&(c+=" "+p);else""!==c&&!Ti(p)&&(t+=NT(l,c),c=""),a=p,l=l||!Ti(a);n++}return""!==c&&(t+=NT(l,c)),t}function Ya(e){return Ms(()=>{const t=kT(e),n={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Si.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Lo.Emulated,styles:e.styles||gt,_:null,schemas:e.schemas||null,tView:null,id:""};yp(n);const a=e.dependencies;return n.directiveDefs=Sp(a,!1),n.pipeDefs=Sp(a,!0),n.id=function dO(e){let t=0;const n=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const c of n)t=Math.imul(31,t)+c.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(n),n})}function o_(e){return Mt(e)||Br(e)}function MT(e){return null!==e}function ni(e){return Ms(()=>({type:e.type,bootstrap:e.bootstrap||gt,declarations:e.declarations||gt,imports:e.imports||gt,exports:e.exports||gt,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function LT(e,t){if(null==e)return Xi;const n={};for(const a in e)if(e.hasOwnProperty(a)){let c=e[a],l=c;Array.isArray(c)&&(l=c[1],c=c[0]),n[c]=a,t&&(t[c]=l)}return n}function Ye(e){return Ms(()=>{const t=kT(e);return yp(t),t})}function Mt(e){return e[gp]||null}function Br(e){return e[Xg]||null}function Or(e){return e[Qg]||null}function ko(e,t){const n=e[_p]||null;if(!n&&!0===t)throw new Error(`Type ${jn(e)} does not have '\u0275mod' property.`);return n}function kT(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||Xi,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||gt,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:LT(e.inputs,t),outputs:LT(e.outputs)}}function yp(e){e.features?.forEach(t=>t(e))}function Sp(e,t){if(!e)return null;const n=t?Or:o_;return()=>("function"==typeof e?e():e).map(a=>n(a)).filter(MT)}const nr=0,ye=1,Je=2,En=3,Ci=4,Xd=5,Hr=6,Ja=7,Bn=8,fa=9,Xa=10,et=11,Qa=12,xT=13,mu=14,rr=15,Qd=16,gu=17,Zi=18,_u=19,UT=20,ma=21,Ls=22,Eu=23,Tp=24,It=25,i_=1,FT=2,es=7,vu=9,_r=11;function xo(e){return Array.isArray(e)&&"object"==typeof e[i_]}function _o(e){return Array.isArray(e)&&!0===e[i_]}function Ip(e){return 0!=(4&e.flags)}function Za(e){return e.componentOffset>-1}function Rp(e){return 1==(1&e.flags)}function Ii(e){return!!e.template}function bp(e){return 0!=(512&e[Je])}function ec(e,t){return e.hasOwnProperty(Qi)?e[Qi]:null}let gO=ln.WeakRef??class mO{constructor(t){this.ref=t}deref(){return this.ref}},_O=0,ts=null,wp=!1;function Ir(e){const t=ts;return ts=e,t}class qT{constructor(){this.id=_O++,this.ref=function KT(e){return new gO(e)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[t,n]of this.producers){const a=n.producerNode.deref();if(void 0!==a&&n.atTrackingVersion===this.trackingVersion){if(a.producerPollStatus(n.seenValueVersion))return!0}else this.producers.delete(t),a?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const t=wp;wp=!0;try{for(const[n,a]of this.consumers){const c=a.consumerNode.deref();void 0!==c&&c.trackingVersion===a.atTrackingVersion?c.onConsumerDependencyMayHaveChanged():(this.consumers.delete(n),c?.producers.delete(this.id))}}finally{wp=t}}producerAccessed(){if(wp)throw new Error("");if(null===ts)return;let t=ts.producers.get(this.id);void 0===t?(t={consumerNode:ts.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:ts.trackingVersion},ts.producers.set(this.id,t),this.consumers.set(ts.id,t)):(t.seenValueVersion=this.valueVersion,t.atTrackingVersion=ts.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==ts?.consumerAllowSignalWrites}producerPollStatus(t){return this.valueVersion!==t||(this.onProducerUpdateValueVersion(),this.valueVersion!==t)}}let $T=null;const nl=()=>{};class YT extends qT{constructor(t,n,a){super(),this.watch=t,this.schedule=n,this.dirty=!1,this.cleanupFn=nl,this.registerOnCleanup=c=>{this.cleanupFn=c},this.consumerAllowSignalWrites=a}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const t=Ir(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=nl,this.watch(this.registerOnCleanup)}finally{Ir(t)}}cleanup(){this.cleanupFn()}}class Pp{constructor(t,n,a){this.previousValue=t,this.currentValue=n,this.firstChange=a}isFirstChange(){return this.firstChange}}function ri(){return JT}function JT(e){return e.type.prototype.ngOnChanges&&(e.setInput=TO),yu}function yu(){const e=QT(this),t=e?.current;if(t){const n=e.previous;if(n===Xi)e.previous=t;else for(let a in t)n[a]=t[a];e.current=null,this.ngOnChanges(t)}}function TO(e,t,n,a){const c=this.declaredInputs[n],l=QT(e)||function CO(e,t){return e[XT]=t}(e,{previous:Xi,current:null}),p=l.current||(l.current={}),g=l.previous,v=g[c];p[c]=new Pp(v&&v.currentValue,t,g===Xi),e[a]=t}ri.ngInherit=!0;const XT="__ngSimpleChanges__";function QT(e){return e[XT]||null}const ns=function(e,t,n){};function hn(e){for(;Array.isArray(e);)e=e[nr];return e}function Su(e,t){return hn(t[e])}function Eo(e,t){return hn(t[e.index])}function eC(e,t){return e.data[t]}function Uo(e,t){const n=t[e];return xo(n)?n:n[nr]}function oi(e,t){return null==t?null:e[t]}function kp(e){e[gu]=0}function DO(e){1024&e[Je]||(e[Je]|=1024,tC(e,1))}function xp(e){1024&e[Je]&&(e[Je]&=-1025,tC(e,-1))}function tC(e,t){let n=e[En];if(null===n)return;n[Xd]+=t;let a=n;for(n=n[En];null!==n&&(1===t&&1===a[Xd]||-1===t&&0===a[Xd]);)n[Xd]+=t,a=n,n=n[En]}const xe={lFrame:cC(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function p_(){return xe.bindingsEnabled}function re(){return xe.lFrame.lView}function bt(){return xe.lFrame.tView}function wn(){let e=oC();for(;null!==e&&64===e.type;)e=e.parent;return e}function oC(){return xe.lFrame.currentTNode}function rs(e,t){const n=xe.lFrame;n.currentTNode=e,n.isParent=t}function _a(){return xe.lFrame.isParent}function Iu(){return xe.lFrame.bindingIndex++}function Fp(e,t){const n=xe.lFrame;n.bindingIndex=n.bindingRootIndex=e,__(t)}function __(e){xe.lFrame.currentDirectiveIndex=e}function v_(){return xe.lFrame.currentQueryIndex}function y_(e){xe.lFrame.currentQueryIndex=e}function S_(e){const t=e[ye];return 2===t.type?t.declTNode:1===t.type?e[Hr]:null}function T_(e,t,n){if(n&Pe.SkipSelf){let c=t,l=e;for(;!(c=c.parent,null!==c||n&Pe.Host||(c=S_(l),null===c||(l=l[mu],10&c.type))););if(null===c)return!1;t=c,e=l}const a=xe.lFrame=I_();return a.currentTNode=t,a.lView=e,!0}function C_(e){const t=I_(),n=e[ye];xe.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function I_(){const e=xe.lFrame,t=null===e?null:e.child;return null===t?cC(e):t}function cC(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function uC(){const e=xe.lFrame;return xe.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const dC=uC;function R_(){const e=uC();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function eo(){return xe.lFrame.selectedIndex}function Ea(e){xe.lFrame.selectedIndex=e}let hC=!0;function jp(){return hC}function va(e){hC=e}function Bp(e,t){for(let n=t.directiveStart,a=t.directiveEnd;n<a;n++){const l=e.data[n].type.prototype,{ngAfterContentInit:p,ngAfterContentChecked:g,ngAfterViewInit:v,ngAfterViewChecked:I,ngOnDestroy:A}=l;p&&(e.contentHooks??=[]).push(-n,p),g&&((e.contentHooks??=[]).push(n,g),(e.contentCheckHooks??=[]).push(n,g)),v&&(e.viewHooks??=[]).push(-n,v),I&&((e.viewHooks??=[]).push(n,I),(e.viewCheckHooks??=[]).push(n,I)),null!=A&&(e.destroyHooks??=[]).push(n,A)}}function Hp(e,t,n){pC(e,t,3,n)}function al(e,t,n,a){(3&e[Je])===n&&pC(e,t,n,a)}function Gp(e,t){let n=e[Je];(3&n)===t&&(n&=8191,n+=1,e[Je]=n)}function pC(e,t,n,a){const l=a??-1,p=t.length-1;let g=0;for(let v=void 0!==a?65535&e[gu]:0;v<p;v++)if("number"==typeof t[v+1]){if(g=t[v],null!=a&&g>=a)break}else t[v]<0&&(e[gu]+=65536),(g<l||-1==l)&&(b_(e,n,t,v),e[gu]=(4294901760&e[gu])+v+2),v++}function cl(e,t){ns(4,e,t);const n=Ir(null);try{t.call(e)}finally{Ir(n),ns(5,e,t)}}function b_(e,t,n,a){const c=n[a]<0,l=n[a+1],g=e[c?-n[a]:n[a]];c?e[Je]>>13<e[gu]>>16&&(3&e[Je])===t&&(e[Je]+=8192,cl(g,l)):cl(g,l)}const nc=-1;class ya{constructor(t,n,a){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=a}}function _C(e){return e!==nc}function Kp(e){return 32767&e}function qp(e,t){let n=function EC(e){return e>>16}(e),a=t;for(;n>0;)a=a[mu],n--;return a}let A_=!0;function $p(e){const t=A_;return A_=e,t}const D_=255,vC=5;let WO=0;const bi={};function zp(e,t){const n=SC(e,t);if(-1!==n)return n;const a=t[ye];a.firstCreatePass&&(e.injectorIndex=t.length,Yp(a.data,e),Yp(t,null),Yp(a.blueprint,null));const c=w_(e,t),l=e.injectorIndex;if(_C(c)){const p=Kp(c),g=qp(c,t),v=g[ye].data;for(let I=0;I<8;I++)t[l+I]=g[p+I]|v[p+I]}return t[l+8]=c,l}function Yp(e,t){e.push(0,0,0,0,0,0,0,0,t)}function SC(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function w_(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,a=null,c=t;for(;null!==c;){if(a=RC(c),null===a)return nc;if(n++,c=c[mu],-1!==a.injectorIndex)return a.injectorIndex|n<<16}return nc}function Jp(e,t,n){!function yC(e,t,n){let a;"string"==typeof n?a=n.charCodeAt(0)||0:n.hasOwnProperty(ti)&&(a=n[ti]),null==a&&(a=n[ti]=WO++);const c=a&D_;t.data[e+(c>>vC)]|=1<<c}(e,t,n)}function TC(e,t,n){if(n&Pe.Optional||void 0!==e)return e;dp()}function O_(e,t,n,a){if(n&Pe.Optional&&void 0===a&&(a=null),!(n&(Pe.Self|Pe.Host))){const c=e[fa],l=mo(void 0);try{return c?c.get(t,a,n&Pe.Optional):RT(t,a,n&Pe.Optional)}finally{mo(l)}}return TC(a,0,n)}function CC(e,t,n,a=Pe.Default,c){if(null!==e){if(2048&t[Je]&&!(a&Pe.Self)){const p=function qO(e,t,n,a,c){let l=e,p=t;for(;null!==l&&null!==p&&2048&p[Je]&&!(512&p[Je]);){const g=N_(l,p,n,a|Pe.Self,bi);if(g!==bi)return g;let v=l.parent;if(!v){const I=p[UT];if(I){const A=I.get(n,bi,a);if(A!==bi)return A}v=RC(p),p=p[mu]}l=v}return c}(e,t,n,a,bi);if(p!==bi)return p}const l=N_(e,t,n,a,bi);if(l!==bi)return l}return O_(t,n,a,c)}function N_(e,t,n,a,c){const l=function ul(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ti)?e[ti]:void 0;return"number"==typeof t?t>=0?t&D_:IC:t}(n);if("function"==typeof l){if(!T_(t,e,a))return a&Pe.Host?TC(c,0,a):O_(t,n,a,c);try{const p=l(a);if(null!=p||a&Pe.Optional)return p;dp()}finally{dC()}}else if("number"==typeof l){let p=null,g=SC(e,t),v=nc,I=a&Pe.Host?t[rr][Hr]:null;for((-1===g||a&Pe.SkipSelf)&&(v=-1===g?w_(e,t):t[g+8],v!==nc&&Ru(a,!1)?(p=t[ye],g=Kp(v),t=qp(v,t)):g=-1);-1!==g;){const A=t[ye];if(M_(l,g,A.data)){const O=P_(g,t,n,p,a,I);if(O!==bi)return O}v=t[g+8],v!==nc&&Ru(a,t[ye].data[g+8]===I)&&M_(l,g,t)?(p=A,g=Kp(v),t=qp(v,t)):g=-1}}return c}function P_(e,t,n,a,c,l){const p=t[ye],g=p.data[e+8],A=Xp(g,p,n,null==a?Za(g)&&A_:a!=p&&0!=(3&g.type),c&Pe.Host&&l===g);return null!==A?rc(t,p,A,g):bi}function Xp(e,t,n,a,c){const l=e.providerIndexes,p=t.data,g=1048575&l,v=e.directiveStart,A=l>>20,F=c?g+A:e.directiveEnd;for(let j=a?g:g+A;j<F;j++){const W=p[j];if(j<v&&n===W||j>=v&&W.type===n)return j}if(c){const j=p[v];if(j&&Ii(j)&&j.type===n)return v}return null}function rc(e,t,n,a){let c=e[n];const l=t.data;if(function fC(e){return e instanceof ya}(c)){const p=c;p.resolving&&function yT(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new se(-200,`Circular dependency in DI detected for ${e}${n}`)}(function Ft(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Qe(e)}(l[n]));const g=$p(p.canSeeViewProviders);p.resolving=!0;const v=p.injectImpl?mo(p.injectImpl):null;T_(e,a,Pe.Default);try{c=e[n]=p.factory(void 0,l,e,a),t.firstCreatePass&&n>=a.directiveStart&&function HO(e,t,n){const{ngOnChanges:a,ngOnInit:c,ngDoCheck:l}=t.type.prototype;if(a){const p=JT(t);(n.preOrderHooks??=[]).push(e,p),(n.preOrderCheckHooks??=[]).push(e,p)}c&&(n.preOrderHooks??=[]).push(0-e,c),l&&((n.preOrderHooks??=[]).push(e,l),(n.preOrderCheckHooks??=[]).push(e,l))}(n,l[n],t)}finally{null!==v&&mo(v),$p(g),p.resolving=!1,dC()}}return c}function M_(e,t,n){return!!(n[t+(e>>vC)]&1<<e)}function Ru(e,t){return!(e&Pe.Self||e&Pe.Host&&t)}class Ai{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,a){return CC(this._tNode,this._lView,t,pp(a),n)}}function IC(){return new Ai(wn(),re())}function Er(e){return Ms(()=>{const t=e.prototype.constructor,n=t[Qi]||dl(t),a=Object.prototype;let c=Object.getPrototypeOf(e.prototype).constructor;for(;c&&c!==a;){const l=c[Qi]||dl(c);if(l&&l!==n)return l;c=Object.getPrototypeOf(c)}return l=>new l})}function dl(e){return Kg(e)?()=>{const t=dl(ze(e));return t&&t()}:ec(e)}function RC(e){const t=e[ye],n=t.type;return 2===n?t.declTNode:1===n?e[Hr]:null}const bu="__parameters__";function ic(e,t,n){return Ms(()=>{const a=function ll(e){return function(...n){if(e){const a=e(...n);for(const c in a)this[c]=a[c]}}}(t);function c(...l){if(this instanceof c)return a.apply(this,l),this;const p=new c(...l);return g.annotation=p,g;function g(v,I,A){const O=v.hasOwnProperty(bu)?v[bu]:Object.defineProperty(v,bu,{value:[]})[bu];for(;O.length<=A;)O.push(null);return(O[A]=O[A]||[]).push(p),v}}return n&&(c.prototype=Object.create(n.prototype)),c.prototype.ngMetadataName=e,c.annotationCls=c,c})}function wu(e,t){e.forEach(n=>Array.isArray(n)?wu(n,t):t(n))}function bC(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Ou(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function vo(e,t,n){let a=ai(e,t);return a>=0?e[1|a]=n:(a=~a,function U_(e,t,n,a){let c=e.length;if(c==t)e.push(n,a);else if(1===c)e.push(a,e[0]),e[0]=n;else{for(c--,e.push(e[c-1],e[c]);c>t;)e[c]=e[c-2],c--;e[t]=n,e[t+1]=a}}(e,a,t,n)),a}function sc(e,t){const n=ai(e,t);if(n>=0)return e[1|n]}function ai(e,t){return function ac(e,t,n){let a=0,c=e.length>>n;for(;c!==a;){const l=a+(c-a>>1),p=e[l<<n];if(t===p)return l<<n;p>t?c=l:a=l+1}return~(c<<n)}(e,t,1)}const pl=Yd(ic("Optional"),8),Nu=Yd(ic("SkipSelf"),4);function af(e){return 128==(128&e.flags)}var Gr=(()=>((Gr=Gr||{})[Gr.Important=1]="Important",Gr[Gr.DashCase=2]="DashCase",Gr))();const Lu=new Map;let GC=0;const cf="__ngContext__";function Rr(e,t){xo(t)?(e[cf]=t[_u],function os(e){Lu.set(e[_u],e)}(t)):e[cf]=t}let uf;function Z_(e,t){return uf(e,t)}function vl(e){const t=e[En];return _o(t)?t[En]:t}function df(e){return JC(e[Qa])}function YC(e){return JC(e[Ci])}function JC(e){for(;null!==e&&!_o(e);)e=e[Ci];return e}function Uu(e,t,n,a,c){if(null!=a){let l,p=!1;_o(a)?l=a:xo(a)&&(p=!0,a=a[nr]);const g=hn(a);0===e&&null!==n?null==c?oE(t,n,g):fc(t,n,g,c||null,!0):1===e&&null!==n?fc(t,n,g,c||null,!0):2===e?function Sl(e,t,n){const a=ff(e,t);a&&function oI(e,t,n,a){e.removeChild(t,n,a)}(e,a,t,n)}(t,g,p):3===e&&t.destroyNode(g),null!=l&&function ie(e,t,n,a,c){const l=n[es];l!==hn(n)&&Uu(t,e,a,l,c);for(let g=_r;g<n.length;g++){const v=n[g];Vu(v[ye],v,e,t,a,l)}}(t,e,l,n,c)}}function hf(e,t,n){return e.createElement(t,n)}function eI(e,t){const n=e[vu],a=n.indexOf(t);xp(t),n.splice(a,1)}function tE(e,t){if(e.length<=_r)return;const n=_r+t,a=e[n];if(a){const c=a[Qd];null!==c&&c!==e&&eI(c,a),t>0&&(e[n-1][Ci]=a[Ci]);const l=Ou(e,_r+t);!function pN(e,t){Vu(e,t,t[et],2,null,null),t[nr]=null,t[Hr]=null}(a[ye],a);const p=l[Zi];null!==p&&p.detachView(l[ye]),a[En]=null,a[Ci]=null,a[Je]&=-129}return a}function tI(e,t){if(!(256&t[Je])){const n=t[et];t[Eu]?.destroy(),t[Tp]?.destroy(),n.destroyNode&&Vu(e,t,n,3,null,null),function gN(e){let t=e[Qa];if(!t)return pf(e[ye],e);for(;t;){let n=null;if(xo(t))n=t[Qa];else{const a=t[_r];a&&(n=a)}if(!n){for(;t&&!t[Ci]&&t!==e;)xo(t)&&pf(t[ye],t),t=t[En];null===t&&(t=e),xo(t)&&pf(t[ye],t),n=t&&t[Ci]}t=n}}(t)}}function pf(e,t){if(!(256&t[Je])){t[Je]&=-129,t[Je]|=256,function _N(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let a=0;a<n.length;a+=2){const c=t[n[a]];if(!(c instanceof ya)){const l=n[a+1];if(Array.isArray(l))for(let p=0;p<l.length;p+=2){const g=c[l[p]],v=l[p+1];ns(4,g,v);try{v.call(g)}finally{ns(5,g,v)}}else{ns(4,c,l);try{l.call(c)}finally{ns(5,c,l)}}}}}(e,t),function nE(e,t){const n=e.cleanup,a=t[Ja];if(null!==n)for(let l=0;l<n.length-1;l+=2)if("string"==typeof n[l]){const p=n[l+3];p>=0?a[p]():a[-p].unsubscribe(),l+=2}else n[l].call(a[n[l+1]]);null!==a&&(t[Ja]=null);const c=t[ma];if(null!==c){t[ma]=null;for(let l=0;l<c.length;l++)(0,c[l])()}}(e,t),1===t[ye].type&&t[et].destroy();const n=t[Qd];if(null!==n&&_o(t[En])){n!==t[En]&&eI(n,t);const a=t[Zi];null!==a&&a.detachView(e)}!function uN(e){Lu.delete(e[_u])}(t)}}function rE(e,t,n){return function nI(e,t,n){let a=t;for(;null!==a&&40&a.type;)a=(t=a).parent;if(null===a)return n[nr];{const{componentOffset:c}=a;if(c>-1){const{encapsulation:l}=e.data[a.directiveStart+c];if(l===Lo.None||l===Lo.Emulated)return null}return Eo(a,n)}}(e,t.parent,n)}function fc(e,t,n,a,c){e.insertBefore(t,n,a,c)}function oE(e,t,n){e.appendChild(t,n)}function rI(e,t,n,a,c){null!==a?fc(e,t,n,a,c):oE(e,t,n)}function ff(e,t){return e.parentNode(t)}let sE,_f,aI=function iE(e,t,n){return 40&e.type?Eo(e,n):null};function mf(e,t,n,a){const c=rE(e,a,t),l=t[et],g=function sI(e,t,n){return aI(e,t,n)}(a.parent||t[Hr],a,t);if(null!=c)if(Array.isArray(n))for(let v=0;v<n.length;v++)rI(l,c,n[v],g,!1);else rI(l,c,n,g,!1);void 0!==sE&&sE(l,a,t,n,c)}function yl(e,t){if(null!==t){const n=t.type;if(3&n)return Eo(t,e);if(4&n)return aE(-1,e[t.index]);if(8&n){const a=t.child;if(null!==a)return yl(e,a);{const c=e[t.index];return _o(c)?aE(-1,c):hn(c)}}if(32&n)return Z_(t,e)()||hn(e[t.index]);{const a=uI(e,t);return null!==a?Array.isArray(a)?a[0]:yl(vl(e[rr]),a):yl(e,t.next)}}return null}function uI(e,t){return null!==t?e[rr][Hr].projection[t.projection]:null}function aE(e,t){const n=_r+e+1;if(n<t.length){const a=t[n],c=a[ye].firstChild;if(null!==c)return yl(a,c)}return t[es]}function Tl(e,t,n,a,c,l,p){for(;null!=n;){const g=a[n.index],v=n.type;if(p&&0===t&&(g&&Rr(hn(g),a),n.flags|=2),32!=(32&n.flags))if(8&v)Tl(e,t,n.child,a,c,l,!1),Uu(t,e,c,g,l);else if(32&v){const I=Z_(n,a);let A;for(;A=I();)Uu(t,e,c,A,l);Uu(t,e,c,g,l)}else 16&v?dE(e,t,a,n,c,l):Uu(t,e,c,g,l);n=p?n.projectionNext:n.next}}function Vu(e,t,n,a,c,l){Tl(n,a,e.firstChild,t,c,l,!1)}function dE(e,t,n,a,c,l){const p=n[rr],v=p[Hr].projection[a.projection];if(Array.isArray(v))for(let I=0;I<v.length;I++)Uu(t,e,c,v[I],l);else{let I=v;const A=p[En];af(a)&&(I.flags|=128),Tl(e,t,I,A,c,l,!0)}}function lE(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function hE(e,t,n){const{mergedAttrs:a,classes:c,styles:l}=n;null!==a&&pu(e,t,a),null!==c&&lE(e,t,c),null!==l&&function lI(e,t,n){e.setAttribute(t,"style",n)}(e,t,l)}class gE{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Se{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Le({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Sa=new Se("ENVIRONMENT_INITIALIZER"),DI=new Se("INJECTOR",-1),wI=new Se("INJECTOR_DEF_TYPES");class If{get(t,n=lu){if(n===lu){const a=new Error(`NullInjectorError: No provider for ${jn(t)}!`);throw a.name="NullInjectorError",a}return n}}function Bt(...e){return{\u0275providers:vr(0,e),\u0275fromNgModule:!0}}function vr(e,...t){const n=[],a=new Set;let c;return wu(t,l=>{const p=l;bf(p,n,[],a)&&(c||=[],c.push(p))}),void 0!==c&&Rf(c,n),n}function Rf(e,t){for(let n=0;n<e.length;n++){const{providers:c}=e[n];Af(c,l=>{t.push(l)})}}function bf(e,t,n,a){if(!(e=ze(e)))return!1;let c=null,l=TT(e);const p=!l&&Mt(e);if(l||p){if(p&&!p.standalone)return!1;c=e}else{const v=e.ngModule;if(l=TT(v),!l)return!1;c=v}const g=a.has(c);if(p){if(g)return!1;if(a.add(c),p.dependencies){const v="function"==typeof p.dependencies?p.dependencies():p.dependencies;for(const I of v)bf(I,t,n,a)}}else{if(!l)return!1;{if(null!=l.imports&&!g){let I;a.add(c);try{wu(l.imports,A=>{bf(A,t,n,a)&&(I||=[],I.push(A))})}finally{}void 0!==I&&Rf(I,t)}if(!g){const I=ec(c)||(()=>new c);t.push({provide:c,useFactory:I,deps:gt},{provide:wI,useValue:c,multi:!0},{provide:Sa,useValue:()=>Ne(c),multi:!0})}const v=l.providers;null==v||g||Af(v,A=>{t.push(A)})}}return c!==e&&void 0!==e.providers}function Af(e,t){for(let n of e)qg(n)&&(n=n.\u0275providers),Array.isArray(n)?Af(n,t):t(n)}const OI=Ot({provide:String,useValue:Ot});function Ta(e){return null!==e&&"object"==typeof e&&OI in e}function Wr(e){return"function"==typeof e}const wf=new Se("Set Injector scope."),as={},Of={};let _c;function bl(){return void 0===_c&&(_c=new If),_c}class cs{}class bE extends cs{get destroyed(){return this._destroyed}constructor(t,n,a,c){super(),this.parent=n,this.source=a,this.scopes=c,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,OE(t,p=>this.processProvider(p)),this.records.set(DI,S(void 0,this)),c.has("environment")&&this.records.set(cs,S(void 0,this));const l=this.records.get(wf);null!=l&&"string"==typeof l.value&&this.scopes.add(l.value),this.injectorDefTypes=new Set(this.get(wI.multi,gt,Pe.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const n of t)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const n=Zr(this),a=mo(void 0);try{return t()}finally{Zr(n),mo(a)}}get(t,n=lu,a=Pe.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(Zg))return t[Zg](this);a=pp(a);const c=Zr(this),l=mo(void 0);try{if(!(a&Pe.SkipSelf)){let g=this.records.get(t);if(void 0===g){const v=function MI(e){return"function"==typeof e||"object"==typeof e&&e instanceof Se}(t)&&qd(t);g=v&&this.injectableDefInScope(v)?S(Nf(t),as):null,this.records.set(t,g)}if(null!=g)return this.hydrate(t,g)}return(a&Pe.Self?bl():this.parent).get(t,n=a&Pe.Optional&&n===lu?null:n)}catch(p){if("NullInjectorError"===p.name){if((p[tr]=p[tr]||[]).unshift(jn(t)),c)throw p;return function Jg(e,t,n,a){const c=e[tr];throw t[bT]&&c.unshift(t[bT]),e.message=function mp(e,t,n,a=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let c=jn(t);if(Array.isArray(t))c=t.map(jn).join(" -> ");else if("object"==typeof t){let l=[];for(let p in t)if(t.hasOwnProperty(p)){let g=t[p];l.push(p+":"+("string"==typeof g?JSON.stringify(g):jn(g)))}c=`{${l.join(", ")}}`}return`${n}${a?"("+a+")":""}[${c}]: ${e.replace(Jw,"\n  ")}`}("\n"+e.message,c,n,a),e.ngTokenPath=c,e[tr]=null,e}(p,t,"R3InjectorError",this.source)}throw p}finally{mo(l),Zr(c)}}resolveInjectorInitializers(){const t=Zr(this),n=mo(void 0);try{const a=this.get(Sa.multi,gt,Pe.Self);for(const c of a)c()}finally{Zr(t),mo(n)}}toString(){const t=[],n=this.records;for(const a of n.keys())t.push(jn(a));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new se(205,!1)}processProvider(t){let n=Wr(t=ze(t))?t:ze(t&&t.provide);const a=function ON(e){return Ta(e)?S(void 0,e.useValue):S(AE(e),as)}(t);if(Wr(t)||!0!==t.multi)this.records.get(n);else{let c=this.records.get(n);c||(c=S(void 0,as,!0),c.factory=()=>fp(c.multi),this.records.set(n,c)),n=t,c.multi.push(t)}this.records.set(n,a)}hydrate(t,n){return n.value===as&&(n.value=Of,n.value=n.factory()),"object"==typeof n.value&&n.value&&function wE(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=ze(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(t){const n=this._onDestroyHooks.indexOf(t);-1!==n&&this._onDestroyHooks.splice(n,1)}}function Nf(e){const t=qd(e),n=null!==t?t.factory:ec(e);if(null!==n)return n;if(e instanceof Se)throw new se(204,!1);if(e instanceof Function)return function PI(e){const t=e.length;if(t>0)throw function Us(e,t){const n=[];for(let a=0;a<e;a++)n.push(t);return n}(t,"?"),new se(204,!1);const n=function $w(e){return e&&(e[hp]||e[CT])||null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new se(204,!1)}function AE(e,t,n){let a;if(Wr(e)){const c=ze(e);return ec(c)||Nf(c)}if(Ta(e))a=()=>ze(e.useValue);else if(function RE(e){return!(!e||!e.useFactory)}(e))a=()=>e.useFactory(...fp(e.deps||[]));else if(function Df(e){return!(!e||!e.useExisting)}(e))a=()=>Ne(ze(e.useExisting));else{const c=ze(e&&(e.useClass||e.provide));if(!function DE(e){return!!e.deps}(e))return ec(c)||Nf(c);a=()=>new c(...fp(e.deps))}return a}function S(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function OE(e,t){for(const n of e)Array.isArray(n)?OE(n,t):n&&qg(n)?OE(n.\u0275providers,t):t(n)}const Ku=new Se("AppId",{providedIn:"root",factory:()=>NE}),NE="ng",Ca=new Se("Platform Initializer"),Bs=new Se("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),ME=new Se("CSP nonce",{providedIn:"root",factory:()=>function Fu(){if(void 0!==_f)return _f;if(typeof document<"u")return document;throw new se(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let yc=(e,t)=>null;function Sc(e,t){return yc(e,t)}class VI{}class FI{}class Ol{resolveComponentFactory(t){throw function GE(e){const t=Error(`No component factory found for ${jn(e)}.`);return t.ngComponent=e,t}(t)}}let Uf=(()=>{class e{}return e.NULL=new Ol,e})();function LN(){return $u(wn(),re())}function $u(e,t){return new Vo(Eo(e,t))}let Vo=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=LN,e})();function kN(e){return e instanceof Vo?e.nativeElement:e}class jI{}let Gs=(()=>{class e{constructor(){this.destroyNode=null}}return e.__NG_ELEMENT_ID__=()=>function Ws(){const e=re(),n=Uo(wn().index,e);return(xo(n)?n:e)[et]}(),e})(),xN=(()=>{class e{}return e.\u0275prov=Le({token:e,providedIn:"root",factory:()=>null}),e})();class Nl{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const UN=new Nl("16.1.1"),ir={};function zu(e){for(;e;){e[Je]|=64;const t=vl(e);if(bp(e)&&!t)return e;e=t}return null}function $E(e){return e.ngOriginalError}class Ia{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&$E(t);for(;n&&$E(n);)n=$E(n);return n||null}}const Vf=new Se("",{providedIn:"root",factory:()=>!1});function Oi(e){return e instanceof Function?e():e}class KI extends qT{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(t){this._lView=t}onConsumerDependencyMayHaveChanged(){zu(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(t,n,a){const c=Ir(this);this.trackingVersion++;try{t(n,a)}finally{Ir(c)}}destroy(){this.trackingVersion++}}let Ll=null;function JE(){return Ll??=new KI,Ll}function kl(e,t){return e[t]??JE()}function qI(e,t){const n=JE();n.hasReadASignal&&(e[t]=Ll,n.lView=e,Ll=new KI)}const Ze={};function us(e){Cc(bt(),re(),eo()+e,!1)}function Cc(e,t,n,a){if(!a)if(3==(3&t[Je])){const l=e.preOrderCheckHooks;null!==l&&Hp(t,l,n)}else{const l=e.preOrderHooks;null!==l&&al(t,l,0,n)}Ea(n)}function $I(e,t=null,n=null,a){const c=Lt(e,t,n,a);return c.resolveInjectorInitializers(),c}function Lt(e,t=null,n=null,a,c=new Set){const l=[n||gt,Bt(e)];return a=a||("object"==typeof e?void 0:jn(e)),new bE(l,t||bl(),a||null,c)}let Fo=(()=>{class e{static create(n,a){if(Array.isArray(n))return $I({name:""},a,n,"");{const c=n.name??"";return $I({name:c},n.parent,n.providers,c)}}}return e.THROW_IF_NOT_FOUND=lu,e.NULL=new If,e.\u0275prov=Le({token:e,providedIn:"any",factory:()=>Ne(DI)}),e.__NG_ELEMENT_ID__=-1,e})();function D(e,t=Pe.Default){const n=re();return null===n?Ne(e,t):CC(wn(),n,ze(e),t)}function Ju(e,t,n,a,c,l,p,g,v,I,A){const O=t.blueprint.slice();return O[nr]=c,O[Je]=140|a,(null!==I||e&&2048&e[Je])&&(O[Je]|=2048),kp(O),O[En]=O[mu]=e,O[Bn]=n,O[Xa]=p||e&&e[Xa],O[et]=g||e&&e[et],O[fa]=v||e&&e[fa]||null,O[Hr]=l,O[_u]=function cN(){return GC++}(),O[Ls]=A,O[UT]=I,O[rr]=2==t.type?e[rr]:O,O}function to(e,t,n,a,c){let l=e.data[t];if(null===l)l=function Ul(e,t,n,a,c){const l=oC(),p=_a(),v=e.data[t]=function ZE(e,t,n,a,c,l){let p=t?t.injectorIndex:-1,g=0;return function ga(){return null!==xe.skipHydrationRootTNode}()&&(g|=128),{type:n,index:a,insertBeforeIndex:null,injectorIndex:p,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:g,providerIndexes:0,value:c,attrs:l,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,p?l:l&&l.parent,n,t,a,c);return null===e.firstChild&&(e.firstChild=v),null!==l&&(p?null==l.child&&null!==v.parent&&(l.child=v):null===l.next&&(l.next=v,v.prev=l)),v}(e,t,n,a,c),function sC(){return xe.lFrame.inI18n}()&&(l.flags|=32);else if(64&l.type){l.type=n,l.value=a,l.attrs=c;const p=function Cu(){const e=xe.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();l.injectorIndex=null===p?-1:p.injectorIndex}return rs(l,!0),l}function Xu(e,t,n,a){if(0===n)return-1;const c=t.length;for(let l=0;l<n;l++)t.push(a),e.blueprint.push(a),e.data.push(null);return c}function Io(e,t,n,a,c){const l=kl(t,Eu),p=eo(),g=2&a;try{if(Ea(-1),g&&t.length>It&&Cc(e,t,It,!1),ns(g?2:0,c),g)l.runInContext(n,a,c);else{const I=Ir(null);try{n(a,c)}finally{Ir(I)}}}finally{g&&null===t[Eu]&&qI(t,Eu),Ea(p),ns(g?3:1,c)}}function Qu(e,t,n){if(Ip(t)){const a=Ir(null);try{const l=t.directiveEnd;for(let p=t.directiveStart;p<l;p++){const g=e.data[p];g.contentQueries&&g.contentQueries(1,n[p],p)}}finally{Ir(a)}}}function Rc(e,t,n){p_()&&(function Dc(e,t,n,a){const c=n.directiveStart,l=n.directiveEnd;Za(n)&&function e0(e,t,n){const a=Eo(t,e),c=jf(n);let p=16;n.signals?p=4096:n.onPush&&(p=64);const g=Gf(e,Ju(e,c,null,p,a,t,null,e[Xa].rendererFactory.createRenderer(a,n),null,null,null));e[t.index]=g}(t,n,e.data[c+n.componentOffset]),e.firstCreatePass||zp(n,t),Rr(a,t);const p=n.initialInputs;for(let g=c;g<l;g++){const v=e.data[g],I=rc(t,e,g,n);Rr(I,t),null!==p&&QI(0,g-c,I,v,0,p),Ii(v)&&(Uo(n.index,t)[Bn]=rc(t,e,g,n))}}(e,t,n,Eo(n,t)),64==(64&n.flags)&&Zu(e,t,n))}function R(e,t,n=Eo){const a=t.localNames;if(null!==a){let c=t.index+1;for(let l=0;l<a.length;l+=2){const p=a[l+1],g=-1===p?n(t,e):e[p];e[c++]=g}}}function jf(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=no(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function no(e,t,n,a,c,l,p,g,v,I,A){const O=It+a,F=O+c,j=function QE(e,t){const n=[];for(let a=0;a<t;a++)n.push(a<e?null:Ze);return n}(O,F),W="function"==typeof I?I():I;return j[ye]={type:e,blueprint:j,template:n,queries:null,viewQuery:g,declTNode:t,data:j.slice().fill(null,O),bindingStartIndex:O,expandoStartIndex:F,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof l?l():l,pipeRegistry:"function"==typeof p?p():p,firstChild:null,schemas:v,consts:W,incompleteFirstPass:!1,ssrId:A}}let YI=e=>null;function Vl(e,t,n,a){for(let c in e)if(e.hasOwnProperty(c)){n=null===n?{}:n;const l=e[c];null===a?JI(n,t,c,l):a.hasOwnProperty(c)&&JI(n,t,a[c],l)}return n}function JI(e,t,n,a){e.hasOwnProperty(n)?e[n].push(t,a):e[n]=[t,a]}function ke(e,t,n,a){if(p_()){const c=null===a?null:{"":-1},l=function XN(e,t){const n=e.directiveRegistry;let a=null,c=null;if(n)for(let l=0;l<n.length;l++){const p=n[l];if(r_(t,p.selectors,!1))if(a||(a=[]),Ii(p))if(null!==p.findHostDirectiveDefs){const g=[];c=c||new Map,p.findHostDirectiveDefs(p,g,c),a.unshift(...g,p),tv(e,t,g.length)}else a.unshift(p),tv(e,t,0);else c=c||new Map,p.findHostDirectiveDefs?.(p,a,c),a.push(p)}return null===a?null:[a,c]}(e,n);let p,g;null===l?p=g=null:[p,g]=l,null!==p&&jo(e,t,n,p,c,g),c&&function QN(e,t,n){if(t){const a=e.localNames=[];for(let c=0;c<t.length;c+=2){const l=n[t[c+1]];if(null==l)throw new se(-301,!1);a.push(t[c],l)}}}(n,a,c)}n.mergedAttrs=Jd(n.mergedAttrs,n.attrs)}function jo(e,t,n,a,c,l){for(let I=0;I<a.length;I++)Jp(zp(n,t),e,a[I].type);!function XI(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,a.length);for(let I=0;I<a.length;I++){const A=a[I];A.providersResolver&&A.providersResolver(A)}let p=!1,g=!1,v=Xu(e,t,a.length,null);for(let I=0;I<a.length;I++){const A=a[I];n.mergedAttrs=Jd(n.mergedAttrs,A.hostAttrs),ZN(e,n,t,v,A),nv(v,A,c),null!==A.contentQueries&&(n.flags|=4),(null!==A.hostBindings||null!==A.hostAttrs||0!==A.hostVars)&&(n.flags|=64);const O=A.type.prototype;!p&&(O.ngOnChanges||O.ngOnInit||O.ngDoCheck)&&((e.preOrderHooks??=[]).push(n.index),p=!0),!g&&(O.ngOnChanges||O.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(n.index),g=!0),v++}!function Bf(e,t,n){const c=t.directiveEnd,l=e.data,p=t.attrs,g=[];let v=null,I=null;for(let A=t.directiveStart;A<c;A++){const O=l[A],F=n?n.get(O):null,W=F?F.outputs:null;v=Vl(O.inputs,A,v,F?F.inputs:null),I=Vl(O.outputs,A,I,W);const $=null===v||null===p||n_(t)?null:t0(v,A,p);g.push($)}null!==v&&(v.hasOwnProperty("class")&&(t.flags|=8),v.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=g,t.inputs=v,t.outputs=I}(e,n,l)}function Zu(e,t,n){const a=n.directiveStart,c=n.directiveEnd,l=n.index,p=function kO(){return xe.lFrame.currentDirectiveIndex}();try{Ea(l);for(let g=a;g<c;g++){const v=e.data[g],I=t[g];__(g),(null!==v.hostBindings||0!==v.hostVars||null!==v.hostAttrs)&&wc(v,I)}}finally{Ea(-1),__(p)}}function wc(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function tv(e,t,n){t.componentOffset=n,(e.components??=[]).push(t.index)}function nv(e,t,n){if(n){if(t.exportAs)for(let a=0;a<t.exportAs.length;a++)n[t.exportAs[a]]=e;Ii(t)&&(n[""]=e)}}function ZN(e,t,n,a,c){e.data[a]=c;const l=c.factory||(c.factory=ec(c.type)),p=new ya(l,Ii(c),D);e.blueprint[a]=p,n[a]=p,function ev(e,t,n,a,c){const l=c.hostBindings;if(l){let p=e.hostBindingOpCodes;null===p&&(p=e.hostBindingOpCodes=[]);const g=~t.index;(function JN(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(p)!=g&&p.push(g),p.push(n,a,l)}}(e,t,a,Xu(e,n,c.hostVars,Ze),c)}function QI(e,t,n,a,c,l){const p=l[t];if(null!==p)for(let g=0;g<p.length;)ov(a,n,p[g++],p[g++],p[g++])}function ov(e,t,n,a,c){const l=Ir(null);try{const p=e.inputTransforms;null!==p&&p.hasOwnProperty(a)&&(c=p[a].call(t,c)),null!==e.setInput?e.setInput(t,c,n,a):t[a]=c}finally{Ir(l)}}function t0(e,t,n){let a=null,c=0;for(;c<n.length;){const l=n[c];if(0!==l)if(5!==l){if("number"==typeof l)break;if(e.hasOwnProperty(l)){null===a&&(a=[]);const p=e[l];for(let g=0;g<p.length;g+=2)if(p[g]===t){a.push(l,p[g+1],n[c+1]);break}}c+=2}else c+=2;else c+=4}return a}function Hf(e,t,n,a){return[e,!0,!1,t,null,0,a,n,null,null,null]}function ZI(e,t){const n=e.contentQueries;if(null!==n)for(let a=0;a<n.length;a+=2){const l=n[a+1];if(-1!==l){const p=e.data[l];y_(n[a]),p.contentQueries(2,t[l],l)}}}function Gf(e,t){return e[Qa]?e[xT][Ci]=t:e[Qa]=t,e[xT]=t,t}function iv(e,t,n){y_(0);const a=Ir(null);try{t(e,n)}finally{Ir(a)}}function eR(e){return e[Ja]||(e[Ja]=[])}function tR(e){return e.cleanup||(e.cleanup=[])}function nR(e,t){const n=e[fa],a=n?n.get(Ia,null):null;a&&a.handleError(t)}function av(e,t,n,a,c){for(let l=0;l<n.length;){const p=n[l++],g=n[l++];ov(e.data[p],t[p],a,g,c)}}function r0(e,t){const n=Uo(t,e),a=n[ye];!function o0(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(a,n);const c=n[nr];null!==c&&null===n[Ls]&&(n[Ls]=Sc(c,n[fa])),cv(a,n,n[Bn])}function cv(e,t,n){C_(t);try{const a=e.viewQuery;null!==a&&iv(1,a,n);const c=e.template;null!==c&&Io(e,t,c,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&ZI(e,t),e.staticViewQueries&&iv(2,e.viewQuery,n);const l=e.components;null!==l&&function rR(e,t){for(let n=0;n<t.length;n++)r0(e,t[n])}(t,l)}catch(a){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),a}finally{t[Je]&=-5,R_()}}let dv=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(n,a,c){const l=typeof Zone>"u"?null:Zone.current,p=new YT(n,I=>{this.all.has(I)&&this.queue.set(I,l)},c);let g;this.all.add(p),p.notify();const v=()=>{p.cleanup(),g?.(),this.all.delete(p),this.queue.delete(p)};return g=a?.onDestroy(v),{destroy:v}}flush(){if(0!==this.queue.size)for(const[n,a]of this.queue)this.queue.delete(n),a?a.run(()=>n.run()):n.run()}get isQueueEmpty(){return 0===this.queue.size}}return e.\u0275prov=Le({token:e,providedIn:"root",factory:()=>new e}),e})();function jl(e,t,n){let a=n?e.styles:null,c=n?e.classes:null,l=0;if(null!==t)for(let p=0;p<t.length;p++){const g=t[p];"number"==typeof g?l=g:1==l?c=Gg(c,g):2==l&&(a=Gg(a,g+": "+t[++p]+";"))}n?e.styles=a:e.stylesWithoutHost=a,n?e.classes=c:e.classesWithoutHost=c}function ed(e,t,n,a,c=!1){for(;null!==n;){const l=t[n.index];if(null!==l&&a.push(hn(l)),_o(l)){for(let g=_r;g<l.length;g++){const v=l[g],I=v[ye].firstChild;null!==I&&ed(v[ye],v,I,a)}l[es]!==l[nr]&&a.push(l[es])}const p=n.type;if(8&p)ed(e,t,n.child,a);else if(32&p){const g=Z_(n,t);let v;for(;v=g();)a.push(v)}else if(16&p){const g=uI(t,n);if(Array.isArray(g))a.push(...g);else{const v=vl(t[rr]);ed(v[ye],v,g,a,!0)}}n=c?n.projectionNext:n.next}return a}function Pi(e,t,n,a=!0){const c=t[Xa].rendererFactory;c.begin&&c.begin();try{oR(e,t,e.template,n)}catch(p){throw a&&nR(t,p),p}finally{c.end&&c.end(),t[Xa].effectManager?.flush()}}function oR(e,t,n,a){const c=t[Je];if(256!=(256&c)){t[Xa].effectManager?.flush(),C_(t);try{kp(t),function g_(e){return xe.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Io(e,t,n,2,a);const p=3==(3&c);if(p){const I=e.preOrderCheckHooks;null!==I&&Hp(t,I,null)}else{const I=e.preOrderHooks;null!==I&&al(t,I,0,null),Gp(t,0)}if(function d0(e){for(let t=df(e);null!==t;t=YC(t)){if(!t[FT])continue;const n=t[vu];for(let a=0;a<n.length;a++){DO(n[a])}}}(t),iR(t,2),null!==e.contentQueries&&ZI(e,t),p){const I=e.contentCheckHooks;null!==I&&Hp(t,I)}else{const I=e.contentHooks;null!==I&&al(t,I,1),Gp(t,1)}!function vn(e,t){const n=e.hostBindingOpCodes;if(null===n)return;const a=kl(t,Tp);try{for(let c=0;c<n.length;c++){const l=n[c];if(l<0)Ea(~l);else{const p=l,g=n[++c],v=n[++c];Fp(g,p),a.runInContext(v,2,t[p])}}}finally{null===t[Tp]&&qI(t,Tp),Ea(-1)}}(e,t);const g=e.components;null!==g&&cR(t,g,0);const v=e.viewQuery;if(null!==v&&iv(2,v,a),p){const I=e.viewCheckHooks;null!==I&&Hp(t,I)}else{const I=e.viewHooks;null!==I&&al(t,I,2),Gp(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[Je]&=-73,xp(t)}finally{R_()}}}function iR(e,t){for(let n=df(e);null!==n;n=YC(n))for(let a=_r;a<n.length;a++)aR(n[a],t)}function sR(e,t,n){aR(Uo(t,e),n)}function aR(e,t){if(!function Lp(e){return 128==(128&e[Je])}(e))return;const n=e[ye];if(80&e[Je]&&0===t||1024&e[Je]||2===t)oR(n,e,n.template,e[Bn]);else if(e[Xd]>0){iR(e,1);const c=e[ye].components;null!==c&&cR(e,c,1)}}function cR(e,t,n){for(let a=0;a<t.length;a++)sR(e,t[a],n)}class Bl{get rootNodes(){const t=this._lView,n=t[ye];return ed(n,t,n.firstChild,[])}constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Bn]}set context(t){this._lView[Bn]=t}get destroyed(){return 256==(256&this._lView[Je])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[En];if(_o(t)){const n=t[8],a=n?n.indexOf(this):-1;a>-1&&(tE(t,a),Ou(n,a))}this._attachedToViewContainer=!1}tI(this._lView[ye],this._lView)}onDestroy(t){!function ol(e,t){if(256==(256&e[Je]))throw new se(911,!1);null===e[ma]&&(e[ma]=[]),e[ma].push(t)}(this._lView,t)}markForCheck(){zu(this._cdRefInjectingView||this._lView)}detach(){this._lView[Je]&=-129}reattach(){this._lView[Je]|=128}detectChanges(){Pi(this._lView[ye],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new se(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function mN(e,t){Vu(e,t,t[et],2,null,null)}(this._lView[ye],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new se(902,!1);this._appRef=t}}class lv extends Bl{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;Pi(t[ye],t,t[Bn],!1)}checkNoChanges(){}get context(){return null}}class Wf extends Uf{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=Mt(t);return new Oc(n,this.ngModule)}}function td(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class Rt{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,a){a=pp(a);const c=this.injector.get(t,ir,a);return c!==ir||n===ir?c:this.parentInjector.get(t,n,a)}}class Oc extends FI{get inputs(){return td(this.componentDef.inputs)}get outputs(){return td(this.componentDef.outputs)}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function sO(e){return e.map(iO).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}create(t,n,a,c){let l=(c=c||this.ngModule)instanceof cs?c:c?.injector;l&&null!==this.componentDef.getStandaloneInjector&&(l=this.componentDef.getStandaloneInjector(l)||l);const p=l?new Rt(t,l):t,g=p.get(jI,null);if(null===g)throw new se(407,!1);const A={rendererFactory:g,sanitizer:p.get(xN,null),effectManager:p.get(dv,null)},O=g.createRenderer(null,this.componentDef),F=this.componentDef.selectors[0][0]||"div",j=a?function zI(e,t,n,a){const l=a.get(Vf,!1)||n===Lo.ShadowDom,p=e.selectRootElement(t,l);return function Ro(e){YI(e)}(p),p}(O,a,this.componentDef.encapsulation,p):hf(O,F,function Nn(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(F)),Q=this.componentDef.signals?4608:this.componentDef.onPush?576:528,ue=no(0,null,null,1,0,null,null,null,null,null,null),J=Ju(null,ue,null,Q,null,null,A,O,p,null,null);let Te,$e;C_(J);try{const rt=this.componentDef;let Vr,_w=null;rt.findHostDirectiveDefs?(Vr=[],_w=new Map,rt.findHostDirectiveDefs(rt,Vr,_w),Vr.push(rt)):Vr=[rt];const LB=function hv(e,t){const n=e[ye],a=It;return e[a]=t,to(n,a,2,"#host",null)}(J,j),kB=function pv(e,t,n,a,c,l,p){const g=c[ye];!function Dt(e,t,n,a){for(const c of e)t.mergedAttrs=Jd(t.mergedAttrs,c.hostAttrs);null!==t.mergedAttrs&&(jl(t,t.mergedAttrs,!0),null!==n&&hE(a,n,t))}(a,e,t,p);let v=null;null!==t&&(v=Sc(t,c[fa]));const I=l.rendererFactory.createRenderer(t,n);let A=16;n.signals?A=4096:n.onPush&&(A=64);const O=Ju(c,jf(n),null,A,c[e.index],e,l,I,null,null,v);return g.firstCreatePass&&tv(g,e,a.length-1),Gf(c,O),c[e.index]=O}(LB,j,rt,Vr,J,A,O);$e=eC(ue,It),j&&function l0(e,t,n,a){if(a)pu(e,n,["ng-version",UN.full]);else{const{attrs:c,classes:l}=function PT(e){const t=[],n=[];let a=1,c=2;for(;a<e.length;){let l=e[a];if("string"==typeof l)2===c?""!==l&&t.push(l,e[++a]):8===c&&n.push(l);else{if(!Ti(c))break;c=l}a++}return{attrs:t,classes:n}}(t.selectors[0]);c&&pu(e,n,c),l&&l.length>0&&lE(e,n,l.join(" "))}}(O,rt,j,a),void 0!==n&&function h0(e,t,n){const a=e.projection=[];for(let c=0;c<t.length;c++){const l=n[c];a.push(null!=l?Array.from(l):null)}}($e,this.ngContentSelectors,n),Te=function uR(e,t,n,a,c,l){const p=wn(),g=c[ye],v=Eo(p,c);jo(g,c,p,n,null,a);for(let A=0;A<n.length;A++)Rr(rc(c,g,p.directiveStart+A,p),c);Zu(g,c,p),v&&Rr(v,c);const I=rc(c,g,p.directiveStart+p.componentOffset,p);if(e[Bn]=c[Bn]=I,null!==l)for(const A of l)A(I,t);return Qu(g,p,e),I}(kB,rt,Vr,_w,J,[dR]),cv(ue,J,null)}finally{R_()}return new sr(this.componentType,Te,$u($e,J),J,$e)}}class sr extends VI{constructor(t,n,a,c,l){super(),this.location=a,this._rootLView=c,this._tNode=l,this.previousInputValues=null,this.instance=n,this.hostView=this.changeDetectorRef=new lv(c),this.componentType=t}setInput(t,n){const a=this._tNode.inputs;let c;if(null!==a&&(c=a[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),n))return;const l=this._rootLView;av(l[ye],l,c,t,n),this.previousInputValues.set(t,n),zu(Uo(this._tNode.index,l))}}get injector(){return new Ai(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function dR(){const e=wn();Bp(re()[ye],e)}function qe(e){let t=function fv(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const a=[e];for(;t;){let c;if(Ii(e))c=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new se(903,!1);c=t.\u0275dir}if(c){if(n){a.push(c);const p=e;p.inputs=Kf(e.inputs),p.inputTransforms=Kf(e.inputTransforms),p.declaredInputs=Kf(e.declaredInputs),p.outputs=Kf(e.outputs);const g=c.hostBindings;g&&kt(e,g);const v=c.viewQuery,I=c.contentQueries;if(v&&p0(e,v),I&&Kn(e,I),Wd(e.inputs,c.inputs),Wd(e.declaredInputs,c.declaredInputs),Wd(e.outputs,c.outputs),null!==c.inputTransforms&&(null===p.inputTransforms&&(p.inputTransforms={}),Wd(p.inputTransforms,c.inputTransforms)),Ii(c)&&c.data.animation){const A=e.data;A.animation=(A.animation||[]).concat(c.data.animation)}}const l=c.features;if(l)for(let p=0;p<l.length;p++){const g=l[p];g&&g.ngInherit&&g(e),g===qe&&(n=!1)}}t=Object.getPrototypeOf(t)}!function mv(e){let t=0,n=null;for(let a=e.length-1;a>=0;a--){const c=e[a];c.hostVars=t+=c.hostVars,c.hostAttrs=Jd(c.hostAttrs,n=Jd(n,c.hostAttrs))}}(a)}function Kf(e){return e===Xi?{}:e===gt?[]:e}function p0(e,t){const n=e.viewQuery;e.viewQuery=n?(a,c)=>{t(a,c),n(a,c)}:t}function Kn(e,t){const n=e.contentQueries;e.contentQueries=n?(a,c,l)=>{t(a,c,l),n(a,c,l)}:t}function kt(e,t){const n=e.hostBindings;e.hostBindings=n?(a,c)=>{t(a,c),n(a,c)}:t}function Ht(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}let oo=function io(e,t,n,a){return va(!0),t[et].createComment("")};function Vc(e,t,n){const a=re();return Ht(a,Iu(),t)&&function V(e,t,n,a,c,l,p,g){const v=Eo(t,n);let A,I=t.inputs;!g&&null!=I&&(A=I[a])?(av(e,n,A,a,c),Za(t)&&function Kr(e,t){const n=Uo(t,e);16&n[Je]||(n[Je]|=64)}(n,t.index)):3&t.type&&(a=function _t(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(a),c=null!=p?p(c,t.value||"",a):c,l.setProperty(v,a,c))}(bt(),function Zt(){const e=xe.lFrame;return eC(e.tView,e.selectedIndex)}(),a,e,t,a[et],n,!1),Vc}function $n(e,t,n,a,c){const p=c?"class":"style";av(e,n,t.inputs[p],p,a)}function At(e,t,n,a){const c=re(),l=bt(),p=It+e,g=c[et],v=l.firstCreatePass?function Yt(e,t,n,a,c,l){const p=t.consts,v=to(t,e,2,a,oi(p,c));return ke(t,n,v,oi(p,l)),null!==v.attrs&&jl(v,v.attrs,!1),null!==v.mergedAttrs&&jl(v,v.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,v),v}(p,l,c,t,n,a):l.data[p],I=gR(l,c,v,g,t,e);c[p]=I;const A=Rp(v);return rs(v,!0),hE(g,I,v),32!=(32&v.flags)&&jp()&&mf(l,c,I,v),0===function wO(){return xe.lFrame.elementDepthCount}()&&Rr(I,c),function nC(){xe.lFrame.elementDepthCount++}(),A&&(Rc(l,c,v),Qu(l,v,c)),null!==a&&R(c,v),At}function qs(){let e=wn();_a()?function ks(){xe.lFrame.isParent=!1}():(e=e.parent,rs(e,!1));const t=e;(function NO(e){return xe.skipHydrationRootTNode===e})(t)&&function MO(){xe.skipHydrationRootTNode=null}(),function OO(){xe.lFrame.elementDepthCount--}();const n=bt();return n.firstCreatePass&&(Bp(n,e),Ip(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function mC(e){return 0!=(8&e.flags)}(t)&&$n(n,t,re(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function gC(e){return 0!=(16&e.flags)}(t)&&$n(n,t,re(),t.stylesWithoutHost,!1),qs}function di(e,t,n,a){return At(e,t,n,a),qs(),di}let gR=(e,t,n,a,c,l)=>(va(!0),hf(a,c,function lC(){return xe.lFrame.currentNamespace}()));function Kl(e){return!!e&&"function"==typeof e.then}function yR(e){return!!e&&"function"==typeof e.subscribe}function Mr(e,t,n,a){const c=re(),l=bt(),p=wn();return function TR(e,t,n,a,c,l,p){const g=Rp(a),I=e.firstCreatePass&&tR(e),A=t[Bn],O=eR(t);let F=!0;if(3&a.type||p){const $=Eo(a,t),Q=p?p($):$,ue=O.length,J=p?$e=>p(hn($e[a.index])):a.index;let Te=null;if(!p&&g&&(Te=function SR(e,t,n,a){const c=e.cleanup;if(null!=c)for(let l=0;l<c.length-1;l+=2){const p=c[l];if(p===n&&c[l+1]===a){const g=t[Ja],v=c[l+2];return g.length>v?g[v]:null}"string"==typeof p&&(l+=2)}return null}(e,t,c,a.index)),null!==Te)(Te.__ngLastListenerFn__||Te).__ngNextListenerFn__=l,Te.__ngLastListenerFn__=l,F=!1;else{l=CR(a,t,A,l,!1);const $e=n.listen(Q,c,l);O.push(l,$e),I&&I.push(c,J,ue,ue+1)}}else l=CR(a,t,A,l,!1);const j=a.outputs;let W;if(F&&null!==j&&(W=j[c])){const $=W.length;if($)for(let Q=0;Q<$;Q+=2){const rt=t[W[Q]][W[Q+1]].subscribe(l),Vr=O.length;O.push(l,rt),I&&I.push(c,a.index,Vr,-(Vr+1))}}}(l,c,c[et],p,e,t,a),Mr}function vv(e,t,n,a){try{return ns(6,t,n),!1!==n(a)}catch(c){return nR(e,c),!1}finally{ns(7,t,n)}}function CR(e,t,n,a,c){return function l(p){if(p===Function)return a;zu(e.componentOffset>-1?Uo(e.index,t):t);let v=vv(t,n,a,p),I=l.__ngNextListenerFn__;for(;I;)v=vv(t,n,I,p)&&v,I=I.__ngNextListenerFn__;return c&&!1===v&&p.preventDefault(),v}}function yv(e=1){return function xO(e){return(xe.lFrame.contextLView=function UO(e,t){for(;e>0;)t=t[mu],e--;return t}(e,xe.lFrame.contextLView))[Bn]}(e)}function ql(e,t){return e<<17|t<<2}function Na(e){return e>>17&32767}function $l(e){return 2|e}function Fc(e){return(131068&e)>>2}function Cv(e,t){return-131069&e|t<<2}function Iv(e){return 1|e}function PR(e,t,n,a,c){const l=e[n+1],p=null===t;let g=a?Na(l):Fc(l),v=!1;for(;0!==g&&(!1===v||p);){const A=e[g+1];D0(e[g],t)&&(v=!0,e[g+1]=a?Iv(A):$l(A)),g=a?Na(A):Fc(A)}v&&(e[n+1]=a?$l(l):Iv(l))}function D0(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&ai(e,t)>=0}function em(e,t){return function Ho(e,t,n,a){const c=re(),l=bt(),p=function Ri(e){const t=xe.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}(2);l.firstUpdatePass&&function Rv(e,t,n,a){const c=e.data;if(null===c[n+1]){const l=c[eo()],p=function Ma(e,t){return t>=e.expandoStartIndex}(e,n);(function Ae(e,t){return 0!=(e.flags&(t?8:16))})(l,a)&&null===t&&!p&&(t=!1),t=function VR(e,t,n,a){const c=function E_(e){const t=xe.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let l=a?t.residualClasses:t.residualStyles;if(null===c)0===(a?t.classBindings:t.styleBindings)&&(n=jc(n=Av(null,e,t,n,a),t.attrs,a),l=null);else{const p=t.directiveStylingLast;if(-1===p||e[p]!==c)if(n=Av(c,e,t,n,a),null===l){let v=function tm(e,t,n){const a=n?t.classBindings:t.styleBindings;if(0!==Fc(a))return e[Na(a)]}(e,t,a);void 0!==v&&Array.isArray(v)&&(v=Av(null,e,t,v[1],a),v=jc(v,t.attrs,a),function bv(e,t,n,a){e[Na(n?t.classBindings:t.styleBindings)]=a}(e,t,a,v))}else l=function Vi(e,t,n){let a;const c=t.directiveEnd;for(let l=1+t.directiveStylingLast;l<c;l++)a=jc(a,e[l].hostAttrs,n);return jc(a,t.attrs,n)}(e,t,a)}return void 0!==l&&(a?t.residualClasses=l:t.residualStyles=l),n}(c,l,t,a),function A0(e,t,n,a,c,l){let p=l?t.classBindings:t.styleBindings,g=Na(p),v=Fc(p);e[a]=n;let A,I=!1;if(Array.isArray(n)?(A=n[1],(null===A||ai(n,A)>0)&&(I=!0)):A=n,c)if(0!==v){const F=Na(e[g+1]);e[a+1]=ql(F,g),0!==F&&(e[F+1]=Cv(e[F+1],a)),e[g+1]=function I0(e,t){return 131071&e|t<<17}(e[g+1],a)}else e[a+1]=ql(g,0),0!==g&&(e[g+1]=Cv(e[g+1],a)),g=a;else e[a+1]=ql(v,0),0===g?g=a:e[v+1]=Cv(e[v+1],a),v=a;I&&(e[a+1]=$l(e[a+1])),PR(e,A,a,!0),PR(e,A,a,!1),function NR(e,t,n,a,c){const l=c?e.residualClasses:e.residualStyles;null!=l&&"string"==typeof t&&ai(l,t)>=0&&(n[a+1]=Iv(n[a+1]))}(t,A,e,a,l),p=ql(g,v),l?t.classBindings=p:t.styleBindings=p}(c,l,t,n,p,a)}}(l,e,p,a),t!==Ze&&Ht(c,p,t)&&function rm(e,t,n,a,c,l,p,g){if(!(3&t.type))return;const v=e.data,I=v[g+1],A=function R0(e){return 1==(1&e)}(I)?Dv(v,t,n,c,Fc(I),p):void 0;om(A)||(om(l)||function C0(e){return 2==(2&e)}(I)&&(l=Dv(v,null,n,c,g,p)),function dI(e,t,n,a,c){if(t)c?e.addClass(n,a):e.removeClass(n,a);else{let l=-1===a.indexOf("-")?void 0:Gr.DashCase;null==c?e.removeStyle(n,a,l):("string"==typeof c&&c.endsWith("!important")&&(c=c.slice(0,-10),l|=Gr.Important),e.setStyle(n,a,c,l))}}(a,p,Su(eo(),n),c,l))}(l,l.data[eo()],c,c[et],e,c[p+1]=function jR(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=jn(function Fs(e){return e instanceof gE?e.changingThisBreaksApplicationSecurity:e}(e)))),e}(t,n),a,p)}(e,t,null,!0),em}function Av(e,t,n,a,c){let l=null;const p=n.directiveEnd;let g=n.directiveStylingLast;for(-1===g?g=n.directiveStart:g++;g<p&&(l=t[g],a=jc(a,l.hostAttrs,c),l!==e);)g++;return null!==e&&(n.directiveStylingLast=g),a}function jc(e,t,n){const a=n?1:2;let c=-1;if(null!==t)for(let l=0;l<t.length;l++){const p=t[l];"number"==typeof p?c=p:c===a&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),vo(e,p,!!n||t[++l]))}return void 0===e?null:e}function Dv(e,t,n,a,c,l){const p=null===t;let g;for(;c>0;){const v=e[c],I=Array.isArray(v),A=I?v[1]:v,O=null===A;let F=n[c+1];F===Ze&&(F=O?gt:void 0);let j=O?sc(F,a):A===a?F:void 0;if(I&&!om(j)&&(j=sc(v,a)),om(j)&&(g=j,p))return g;const W=e[c+1];c=p?Na(W):Fc(W)}if(null!==t){let v=l?t.residualClasses:t.residualStyles;null!=v&&(g=sc(v,a))}return g}function om(e){return void 0!==e}function pe(e,t=""){const n=re(),a=bt(),c=e+It,l=a.firstCreatePass?to(a,c,1,t,null):a.data[c],p=he(a,n,l,t,e);n[c]=p,jp()&&mf(a,n,p,l),rs(l,!1)}let he=(e,t,n,a,c)=>(va(!0),function lf(e,t){return e.createText(t)}(t[et],a));function Mn(e,t,n){const a=re(),c=function ps(e,t,n,a){return Ht(e,Iu(),n)?t+Qe(n)+a:Ze}(a,e,t,n);return c!==Ze&&function ls(e,t,n){const a=Su(t,e);!function XC(e,t,n){e.setValue(t,n)}(e[et],a,n)}(a,eo(),c),Mn}const La="en-US";let jv=La;function $t(e,t,n,a,c){if(e=ze(e),Array.isArray(e))for(let l=0;l<e.length;l++)$t(e[l],t,n,a,c);else{const l=bt(),p=re();let g=Wr(e)?e:ze(e.provide),v=AE(e);const I=wn(),A=1048575&I.providerIndexes,O=I.directiveStart,F=I.providerIndexes>>20;if(Wr(e)||!e.multi){const j=new ya(v,c,D),W=Ql(g,t,c?A:A+F,O);-1===W?(Jp(zp(I,p),l,g),pm(l,e,t.length),t.push(g),I.directiveStart++,I.directiveEnd++,c&&(I.providerIndexes+=1048576),n.push(j),p.push(j)):(n[W]=j,p[W]=j)}else{const j=Ql(g,t,A+F,O),W=Ql(g,t,A,A+F),Q=W>=0&&n[W];if(c&&!Q||!c&&!(j>=0&&n[j])){Jp(zp(I,p),l,g);const ue=function Zl(e,t,n,a,c){const l=new ya(e,n,D);return l.multi=[],l.index=t,l.componentProviders=0,gd(l,c,a&&!n),l}(c?bb:fm,n.length,c,a,v);!c&&Q&&(n[W].providerFactory=ue),pm(l,e,t.length,0),t.push(g),I.directiveStart++,I.directiveEnd++,c&&(I.providerIndexes+=1048576),n.push(ue),p.push(ue)}else pm(l,e,j>-1?j:W,gd(n[c?W:j],v,!c&&a));!c&&a&&Q&&n[W].componentProviders++}}}function pm(e,t,n,a){const c=Wr(t),l=function NI(e){return!!e.useClass}(t);if(c||l){const v=(l?ze(t.useClass):t).prototype.ngOnDestroy;if(v){const I=e.destroyHooks||(e.destroyHooks=[]);if(!c&&t.multi){const A=I.indexOf(n);-1===A?I.push(n,[a,v]):I[A+1].push(a,v)}else I.push(n,v)}}}function gd(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function Ql(e,t,n,a){for(let c=n;c<a;c++)if(t[c]===e)return c;return-1}function fm(e,t,n,a){return mm(this.multi,[])}function bb(e,t,n,a){const c=this.multi;let l;if(this.providerFactory){const p=this.providerFactory.componentProviders,g=rc(n,n[ye],this.providerFactory.index,a);l=g.slice(0,p),mm(c,l);for(let v=p;v<g.length;v++)l.push(g[v])}else l=[],mm(c,l);return l}function mm(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function yn(e,t=[]){return n=>{n.providersResolver=(a,c)=>function Hi(e,t,n){const a=bt();if(a.firstCreatePass){const c=Ii(e);$t(n,a.data,a.blueprint,c,!0),$t(t,a.data,a.blueprint,c,!1)}}(a,c?c(e):e,t)}}class _d{}class eh{}class _m extends _d{constructor(t,n,a){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Wf(this);const c=ko(t);this._bootstrapComponents=Oi(c.bootstrap),this._r3Injector=Lt(t,n,[{provide:_d,useValue:this},{provide:Uf,useValue:this.componentFactoryResolver},...a],jn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class Ua extends eh{constructor(t){super(),this.moduleType=t}create(t){return new _m(this.moduleType,t,[])}}class dy extends _d{constructor(t){super(),this.componentFactoryResolver=new Wf(this),this.instance=null;const n=new bE([...t.providers,{provide:_d,useValue:this},{provide:Uf,useValue:this.componentFactoryResolver}],t.parent||bl(),t.debugName,new Set(["environment"]));this.injector=n,t.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function Em(e,t,n=null){return new dy({providers:e,parent:t,debugName:n,runEnvironmentInitializers:!0}).injector}let J0=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const a=vr(0,n.type),c=a.length>0?Em([a],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,c)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=Le({token:e,providedIn:"environment",factory:()=>new e(Ne(cs))}),e})();function ly(e){e.getStandaloneInjector=t=>t.get(J0).getOrCreateStandaloneInjector(e)}function Iy(e){return t=>{setTimeout(e,void 0,t)}}const Cn=class Cy extends Os{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,a){let c=t,l=n||(()=>null),p=a;if(t&&"object"==typeof t){const v=t;c=v.next?.bind(v),l=v.error?.bind(v),p=v.complete?.bind(v)}this.__isAsync&&(l=Iy(l),c&&(c=Iy(c)),p&&(p=Iy(p)));const g=super.subscribe({next:c,error:l,complete:p});return t instanceof Xn&&t.add(g),g}};function oP(){return this._results[Symbol.iterator]()}class rh{get changes(){return this._changes||(this._changes=new Cn)}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=rh.prototype;n[Symbol.iterator]||(n[Symbol.iterator]=oP)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const a=this;a.dirty=!1;const c=function si(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function x_(e,t,n){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++){let c=e[a],l=t[a];if(n&&(c=n(c),l=n(l)),l!==c)return!1}return!0}(a._results,c,n))&&(a._results=c,a.length=c.length,a.last=c[this.length-1],a.first=c[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Ss=(()=>{class e{}return e.__NG_ELEMENT_ID__=Hb,e})();const Bb=Ss,iP=class extends Bb{constructor(t,n,a){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=a}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,n){return this.createEmbeddedViewImpl(t,n,null)}createEmbeddedViewImpl(t,n,a){const p=this._declarationTContainer.tView,g=Ju(this._declarationLView,p,t,4096&this._declarationLView[Je]?4096:16,null,p.declTNode,null,null,null,n||null,a||null);g[Qd]=this._declarationLView[this._declarationTContainer.index];const I=this._declarationLView[Zi];return null!==I&&(g[Zi]=I.createEmbeddedView(p)),cv(p,g,t),new Bl(g)}};function Hb(){return Va(wn(),re())}function Va(e,t){return 4&e.type?new iP(t,e,$u(e,t)):null}let li=(()=>{class e{}return e.__NG_ELEMENT_ID__=zb,e})();function zb(){return Yb(wn(),re())}const Dy=li,wy=class extends Dy{constructor(t,n,a){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=a}get element(){return $u(this._hostTNode,this._hostLView)}get injector(){return new Ai(this._hostTNode,this._hostLView)}get parentInjector(){const t=w_(this._hostTNode,this._hostLView);if(_C(t)){const n=qp(t,this._hostLView),a=Kp(t);return new Ai(n[ye].data[a+8],n)}return new Ai(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=Oy(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-_r}createEmbeddedView(t,n,a){let c,l;"number"==typeof a?c=a:null!=a&&(c=a.index,l=a.injector);const g=t.createEmbeddedViewImpl(n||{},l,null);return this.insertImpl(g,c,false),g}createComponent(t,n,a,c,l){const p=t&&!function hl(e){return"function"==typeof e}(t);let g;if(p)g=n;else{const $=n||{};g=$.index,a=$.injector,c=$.projectableNodes,l=$.environmentInjector||$.ngModuleRef}const v=p?t:new Oc(Mt(t)),I=a||this.parentInjector;if(!l&&null==v.ngModule){const Q=(p?I:this.parentInjector).get(cs,null);Q&&(l=Q)}Mt(v.componentType??{});const j=v.create(I,c,null,l);return this.insertImpl(j.hostView,g,false),j}insert(t,n){return this.insertImpl(t,n,!1)}insertImpl(t,n,a){const c=t._lView,l=c[ye];if(function AO(e){return _o(e[En])}(c)){const v=this.indexOf(t);if(-1!==v)this.detach(v);else{const I=c[En],A=new wy(I,I[Hr],I[En]);A.detach(A.indexOf(t))}}const p=this._adjustIndex(n),g=this._lContainer;if(function QC(e,t,n,a){const c=_r+a,l=n.length;a>0&&(n[c-1][Ci]=t),a<l-_r?(t[Ci]=n[c],bC(n,_r+a,t)):(n.push(t),t[Ci]=null),t[En]=n;const p=t[Qd];null!==p&&n!==p&&function ZC(e,t){const n=e[vu];t[rr]!==t[En][En][rr]&&(e[FT]=!0),null===n?e[vu]=[t]:n.push(t)}(p,t);const g=t[Zi];null!==g&&g.insertView(e),t[Je]|=128}(l,c,g,p),!a){const v=aE(p,g),I=c[et],A=ff(I,g[es]);null!==A&&function fN(e,t,n,a,c,l){a[nr]=c,a[Hr]=t,Vu(e,a,n,1,c,l)}(l,g[Hr],I,c,A,v)}return t.attachToViewContainerRef(),bC(vd(g),p,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=Oy(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),a=tE(this._lContainer,n);a&&(Ou(vd(this._lContainer),n),tI(a[ye],a))}detach(t){const n=this._adjustIndex(t,-1),a=tE(this._lContainer,n);return a&&null!=Ou(vd(this._lContainer),n)?new Bl(a):null}_adjustIndex(t,n=0){return t??this.length+n}};function Oy(e){return e[8]}function vd(e){return e[8]||(e[8]=[])}function Yb(e,t){let n;const a=t[e.index];return _o(a)?n=a:(n=Hf(a,t,null,e),t[e.index]=n,Gf(t,n)),Yc(n,t,e,a),new wy(n,e,t)}let Yc=function oh(e,t,n,a){if(e[es])return;let c;c=8&n.type?hn(a):function Jb(e,t){const n=e[et],a=n.createComment(""),c=Eo(t,e);return fc(n,ff(n,c),a,function iI(e,t){return e.nextSibling(t)}(n,c),!1),a}(t,n),e[es]=c};class Im{constructor(t){this.queryList=t,this.matches=null}clone(){return new Im(this.queryList)}setDirty(){this.queryList.setDirty()}}class Rm{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const a=null!==t.contentQueries?t.contentQueries[0]:n.length,c=[];for(let l=0;l<a;l++){const p=n.getByIndex(l);c.push(this.queries[p.indexInDeclarationView].clone())}return new Rm(c)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==xy(t,n).matches&&this.queries[n].setDirty()}}class Ny{constructor(t,n,a=null){this.predicate=t,this.flags=n,this.read=a}}class bm{constructor(t=[]){this.queries=t}elementStart(t,n){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let a=0;a<this.length;a++){const c=null!==n?n.length:0,l=this.getByIndex(a).embeddedTView(t,c);l&&(l.indexInDeclarationView=a,null!==n?n.push(l):n=[l])}return null!==n?new bm(n):null}template(t,n){for(let a=0;a<this.queries.length;a++)this.queries[a].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class Am{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new Am(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let a=t.parent;for(;null!==a&&8&a.type&&a.index!==n;)a=a.parent;return n===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const a=this.metadata.predicate;if(Array.isArray(a))for(let c=0;c<a.length;c++){const l=a[c];this.matchTNodeWithReadOption(t,n,Zb(n,l)),this.matchTNodeWithReadOption(t,n,Xp(n,t,l,!1,!1))}else a===Ss?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,Xp(n,t,a,!1,!1))}matchTNodeWithReadOption(t,n,a){if(null!==a){const c=this.metadata.read;if(null!==c)if(c===Vo||c===li||c===Ss&&4&n.type)this.addMatch(n.index,-2);else{const l=Xp(n,t,c,!1,!1);null!==l&&this.addMatch(n.index,l)}else this.addMatch(n.index,a)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function Zb(e,t){const n=e.localNames;if(null!==n)for(let a=0;a<n.length;a+=2)if(n[a]===t)return n[a+1];return null}function tA(e,t,n,a){return-1===n?function eA(e,t){return 11&e.type?$u(e,t):4&e.type?Va(e,t):null}(t,e):-2===n?function nA(e,t,n){return n===Vo?$u(t,e):n===Ss?Va(t,e):n===li?Yb(t,e):void 0}(e,t,a):rc(e,e[ye],n,t)}function Py(e,t,n,a){const c=t[Zi].queries[a];if(null===c.matches){const l=e.data,p=n.matches,g=[];for(let v=0;v<p.length;v+=2){const I=p[v];g.push(I<0?null:tA(t,l[I],p[v+1],n.metadata.read))}c.matches=g}return c.matches}function Dm(e,t,n,a){const c=e.queries.getByIndex(n),l=c.matches;if(null!==l){const p=Py(e,t,c,n);for(let g=0;g<l.length;g+=2){const v=l[g];if(v>0)a.push(p[g/2]);else{const I=l[g+1],A=t[-v];for(let O=_r;O<A.length;O++){const F=A[O];F[Qd]===F[En]&&Dm(F[ye],F,I,a)}if(null!==A[vu]){const O=A[vu];for(let F=0;F<O.length;F++){const j=O[F];Dm(j[ye],j,I,a)}}}}}return a}function ih(e){const t=re(),n=bt(),a=v_();y_(a+1);const c=xy(n,a);if(e.dirty&&function bO(e){return 4==(4&e[Je])}(t)===(2==(2&c.metadata.flags))){if(null===c.matches)e.reset([]);else{const l=c.crossesNgTemplate?Dm(n,t,a,[]):Py(n,t,c,a);e.reset(l,kN),e.notifyOnChanges()}return!0}return!1}function wm(e,t,n){const a=bt();a.firstCreatePass&&(function ky(e,t,n){null===e.queries&&(e.queries=new bm),e.queries.track(new Am(t,n))}(a,new Ny(e,t,n),-1),2==(2&t)&&(a.staticViewQueries=!0)),function Ly(e,t,n){const a=new rh(4==(4&n));(function bc(e,t,n,a){const c=eR(t);c.push(n),e.firstCreatePass&&tR(e).push(a,c.length-1)})(e,t,a,a.destroy),null===t[Zi]&&(t[Zi]=new Rm),t[Zi].queries.push(new Im(a))}(a,re(),t)}function sh(){return function rA(e,t){return e[Zi].queries[t].queryList}(re(),v_())}function xy(e,t){return e.queries.getByIndex(t)}const Un=new Se("Application Initializer");let Wy=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,a)=>{this.resolve=n,this.reject=a}),this.appInits=ve(Un,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const n=[];for(const c of this.appInits){const l=c();if(Kl(l))n.push(l);else if(yR(l)){const p=new Promise((g,v)=>{l.subscribe({complete:g,error:v})});n.push(p)}}const a=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{a()}).catch(c=>{this.reject(c)}),0===n.length&&a(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),CA=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Js=new Se("LocaleId",{providedIn:"root",factory:()=>ve(Js,Pe.Optional|Pe.SkipSelf)||function vP(){return typeof $localize<"u"&&$localize.locale||La}()});let Id=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new fo(!1)}add(){this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class RA{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let Lm=(()=>{class e{compileModuleSync(n){return new Ua(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const a=this.compileModuleSync(n),l=Oi(ko(n).declarations).reduce((p,g)=>{const v=Mt(g);return v&&p.push(new Oc(v)),p},[]);return new RA(a,l)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const CP=(()=>Promise.resolve(0))();function xm(e){typeof Zone>"u"?CP.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}function bA(...e){}class In{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Cn(!1),this.onMicrotaskEmpty=new Cn(!1),this.onStable=new Cn(!1),this.onError=new Cn(!1),typeof Zone>"u")throw new se(908,!1);Zone.assertZonePatched();const c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!a&&n,c.shouldCoalesceRunChangeDetection=a,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function zy(){let e=ln.requestAnimationFrame,t=ln.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const a=t[Zone.__symbol__("OriginalDelegate")];a&&(t=a)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function RP(e){const t=()=>{!function IP(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(ln,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Yy(e),e.isCheckStableRunning=!0,Vm(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Yy(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,a,c,l,p,g)=>{try{return Jy(e),n.invokeTask(c,l,p,g)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===l.type||e.shouldCoalesceRunChangeDetection)&&t(),ph(e)}},onInvoke:(n,a,c,l,p,g,v)=>{try{return Jy(e),n.invoke(c,l,p,g,v)}finally{e.shouldCoalesceRunChangeDetection&&t(),ph(e)}},onHasTask:(n,a,c,l)=>{n.hasTask(c,l),a===c&&("microTask"==l.change?(e._hasPendingMicrotasks=l.microTask,Yy(e),Vm(e)):"macroTask"==l.change&&(e.hasPendingMacrotasks=l.macroTask))},onHandleError:(n,a,c,l)=>(n.handleError(c,l),e.runOutsideAngular(()=>e.onError.emit(l)),!1)})}(c)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!In.isInAngularZone())throw new se(909,!1)}static assertNotInAngularZone(){if(In.isInAngularZone())throw new se(909,!1)}run(t,n,a){return this._inner.run(t,n,a)}runTask(t,n,a,c){const l=this._inner,p=l.scheduleEventTask("NgZoneEvent: "+c,t,AA,bA,bA);try{return l.runTask(p,n,a)}finally{l.cancelTask(p)}}runGuarded(t,n,a){return this._inner.runGuarded(t,n,a)}runOutsideAngular(t){return this._outer.run(t)}}const AA={};function Vm(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Yy(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function Jy(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function ph(e){e._nesting--,Vm(e)}class Do{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Cn,this.onMicrotaskEmpty=new Cn,this.onStable=new Cn,this.onError=new Cn}run(t,n,a){return t.apply(n,a)}runGuarded(t,n,a){return t.apply(n,a)}runOutsideAngular(t){return t()}runTask(t,n,a,c){return t.apply(n,a)}}const fh=new Se("",{providedIn:"root",factory:Xy});function Xy(){const e=ve(In);let t=!0;return function Fw(...e){const t=uu(e),n=function xw(e,t){return"number"==typeof Fg(e)?e.pop():t}(e,1/0),a=e;return a.length?1===a.length?Zo(a[0]):cu(n)(er(a,t)):zi}(new Ln(c=>{t=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{c.next(t),c.complete()})}),new Ln(c=>{let l;e.runOutsideAngular(()=>{l=e.onStable.subscribe(()=>{In.assertNotInAngularZone(),xm(()=>{!t&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(t=!0,c.next(!0))})})});const p=e.onUnstable.subscribe(()=>{In.assertInAngularZone(),t&&(t=!1,e.runOutsideAngular(()=>{c.next(!1)}))});return()=>{l.unsubscribe(),p.unsubscribe()}}).pipe(ET()))}const DA=new Se(""),mh=new Se("");let Fm,Wo=(()=>{class e{constructor(n,a,c){this._ngZone=n,this.registry=a,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Fm||(function Jc(e){Fm=e}(c),c.addToWindow(a)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{In.assertNotInAngularZone(),xm(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())xm(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(n)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,a,c){let l=-1;a&&a>0&&(l=setTimeout(()=>{this._callbacks=this._callbacks.filter(p=>p.timeoutId!==l),n(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:n,timeoutId:l,updateCb:c})}whenStable(n,a,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,a,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,a,c){return[]}}return e.\u0275fac=function(n){return new(n||e)(Ne(In),Ne(Ts),Ne(mh))},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})(),Ts=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,a){this._applications.set(n,a)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,a=!0){return Fm?.findTestabilityInTree(this,n,a)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),Cs=null;const Rd=new Se("AllowMultipleToken"),jm=new Se("PlatformDestroyListeners"),Is=new Se("appBootstrapListener");class bd{constructor(t,n){this.name=t,this.token=n}}function Bm(e,t,n=[]){const a=`Platform: ${t}`,c=new Se(a);return(l=[])=>{let p=Hm();if(!p||p.injector.get(Rd,!1)){const g=[...n,...l,{provide:c,useValue:!0}];e?e(g):function Zy(e){if(Cs&&!Cs.get(Rd,!1))throw new se(400,!1);(function Qy(){!function vO(e){$T=e}(()=>{throw new se(600,!1)})})(),Cs=e;const t=e.get(nS);(function OA(e){e.get(Ca,null)?.forEach(n=>n())})(e)}(function gh(e=[],t){return Fo.create({name:t,providers:[{provide:wf,useValue:"platform"},{provide:jm,useValue:new Set([()=>Cs=null])},...e]})}(g,a))}return function tS(e){const t=Hm();if(!t)throw new se(401,!1);return t}()}}function Hm(){return Cs?.get(nS)??null}let nS=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,a){const c=function oS(e="zone.js",t){return"noop"===e?new Do:"zone.js"===e?new In(t):e}(a?.ngZone,function rS(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:a?.ngZoneEventCoalescing,runCoalescing:a?.ngZoneRunCoalescing}));return c.run(()=>{const l=function Ab(e,t,n){return new _m(e,t,n)}(n.moduleType,this.injector,function xA(e){return[{provide:In,useFactory:e},{provide:Sa,multi:!0,useFactory:()=>{const t=ve(pi,{optional:!0});return()=>t.initialize()}},{provide:iS,useFactory:Eh},{provide:fh,useFactory:Xy}]}(()=>c)),p=l.injector.get(Ia,null);return c.runOutsideAngular(()=>{const g=c.onError.subscribe({next:v=>{p.handleError(v)}});l.onDestroy(()=>{_h(this._modules,l),g.unsubscribe()})}),function MA(e,t,n){try{const a=n();return Kl(a)?a.catch(c=>{throw t.runOutsideAngular(()=>e.handleError(c)),c}):a}catch(a){throw t.runOutsideAngular(()=>e.handleError(a)),a}}(p,c,()=>{const g=l.injector.get(Wy);return g.runInitializers(),g.donePromise.then(()=>(function Bv(e){ei(e,"Expected localeId to be defined"),"string"==typeof e&&(jv=e.toLowerCase().replace(/_/g,"-"))}(l.injector.get(Js,La)||La),this._moduleDoBootstrap(l),l))})})}bootstrapModule(n,a=[]){const c=LA({},a);return function wA(e,t,n){const a=new Ua(n);return Promise.resolve(a)}(0,0,n).then(l=>this.bootstrapModuleFactory(l,c))}_moduleDoBootstrap(n){const a=n.injector.get(Xc);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(c=>a.bootstrap(c));else{if(!n.instance.ngDoBootstrap)throw new se(-403,!1);n.instance.ngDoBootstrap(a)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new se(404,!1);this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a());const n=this._injector.get(jm,null);n&&(n.forEach(a=>a()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(Ne(Fo))},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function LA(e,t){return Array.isArray(t)?t.reduce(LA,e):{...e,...t}}let Xc=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=ve(iS),this.zoneIsStable=ve(fh),this.componentTypes=[],this.components=[],this.isStable=ve(Id).hasPendingTasks.pipe(yi(n=>n?Ke(!1):this.zoneIsStable),function jw(e,t=Qr){return e=e??Bw,Zn((n,a)=>{let c,l=!0;n.subscribe(gr(a,p=>{const g=t(p);(l||!e(c,g))&&(l=!1,c=g,a.next(p))}))})}(),ET()),this._injector=ve(cs)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,a){const c=n instanceof FI;if(!this._injector.get(Wy).done)throw!c&&function fu(e){const t=Mt(e)||Br(e)||Or(e);return null!==t&&t.standalone}(n),new se(405,!1);let p;p=c?n:this._injector.get(Uf).resolveComponentFactory(n),this.componentTypes.push(p.componentType);const g=function Xs(e){return e.isBoundToModule}(p)?void 0:this._injector.get(_d),I=p.create(Fo.NULL,[],a||p.selector,g),A=I.location.nativeElement,O=I.injector.get(DA,null);return O?.registerApplication(A),I.onDestroy(()=>{this.detachView(I.hostView),_h(this.components,I),O?.unregisterApplication(A)}),this._loadComponent(I),I}tick(){if(this._runningTick)throw new se(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this.internalErrorHandler(n)}finally{this._runningTick=!1}}attachView(n){const a=n;this._views.push(a),a.attachToAppRef(this)}detachView(n){const a=n;_h(this._views,a),a.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const a=this._injector.get(Is,[]);a.push(...this._bootstrapListeners),a.forEach(c=>c(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>_h(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new se(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function _h(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const iS=new Se("",{providedIn:"root",factory:()=>ve(Ia).handleError.bind(void 0)});function Eh(){const e=ve(In),t=ve(Ia);return n=>e.runOutsideAngular(()=>t.handleError(n))}let pi=(()=>{class e{constructor(){this.zone=ve(In),this.applicationRef=ve(Xc)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();let Rs=(()=>{class e{}return e.__NG_ELEMENT_ID__=UA,e})();function UA(e){return function VA(e,t,n){if(Za(e)&&!n){const a=Uo(e.index,t);return new Bl(a,a)}return 47&e.type?new Bl(t[rr],t):null}(wn(),re(),16==(16&e))}const Ih=Bm(null,"core",[]);let Ko=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(Ne(Xc))},e.\u0275mod=ni({type:e}),e.\u0275inj=jr({}),e})(),Ah=null;function Fa(){return Ah}class rD{}const zr=new Se("DocumentToken");let _S=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:function(){return ve(St)},providedIn:"platform"}),e})();const Oo=new Se("Location Initialized");let St=(()=>{class e extends _S{constructor(){super(),this._doc=ve(zr),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Fa().getBaseHref(this._doc)}onPopState(n){const a=Fa().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",n,!1),()=>a.removeEventListener("popstate",n)}onHashChange(n){const a=Fa().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",n,!1),()=>a.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,a,c){this._history.pushState(n,a,c)}replaceState(n,a,c){this._history.replaceState(n,a,c)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:function(){return new e},providedIn:"platform"}),e})();function eg(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function tg(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Yr(e){return e&&"?"!==e[0]?"?"+e:e}let Ar=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:function(){return ve(ES)},providedIn:"root"}),e})();const Xe=new Se("appBaseHref");let ES=(()=>{class e extends Ar{constructor(n,a){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=a??this._platformLocation.getBaseHrefFromDOM()??ve(zr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return eg(this._baseHref,n)}path(n=!1){const a=this._platformLocation.pathname+Yr(this._platformLocation.search),c=this._platformLocation.hash;return c&&n?`${a}${c}`:a}pushState(n,a,c,l){const p=this.prepareExternalUrl(c+Yr(l));this._platformLocation.pushState(n,a,p)}replaceState(n,a,c,l){const p=this.prepareExternalUrl(c+Yr(l));this._platformLocation.replaceState(n,a,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Ne(_S),Ne(Xe,8))},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),ja=(()=>{class e extends Ar{constructor(n,a){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=a&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let a=this._platformLocation.hash;return null==a&&(a="#"),a.length>0?a.substring(1):a}prepareExternalUrl(n){const a=eg(this._baseHref,n);return a.length>0?"#"+a:a}pushState(n,a,c,l){let p=this.prepareExternalUrl(c+Yr(l));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.pushState(n,a,p)}replaceState(n,a,c,l){let p=this.prepareExternalUrl(c+Yr(l));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.replaceState(n,a,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Ne(_S),Ne(Xe,8))},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})(),ng=(()=>{class e{constructor(n){this._subject=new Cn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const a=this._locationStrategy.getBaseHref();this._basePath=function oD(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(tg(Jr(a))),this._locationStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,a=""){return this.path()==this.normalize(n+Yr(a))}normalize(n){return e.stripTrailingSlash(function GP(e,t){if(!e||!t.startsWith(e))return t;const n=t.substring(e.length);return""===n||["/",";","?","#"].includes(n[0])?n:t}(this._basePath,Jr(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,a="",c=null){this._locationStrategy.pushState(c,"",n,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Yr(a)),c)}replaceState(n,a="",c=null){this._locationStrategy.replaceState(c,"",n,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Yr(a)),c)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)})),()=>{const a=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(a,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",a){this._urlChangeListeners.forEach(c=>c(n,a))}subscribe(n,a,c){return this._subject.subscribe({next:n,error:a,complete:c})}}return e.normalizeQueryParams=Yr,e.joinWithSlash=eg,e.stripTrailingSlash=tg,e.\u0275fac=function(n){return new(n||e)(Ne(Ar))},e.\u0275prov=Le({token:e,factory:function(){return function vS(){return new ng(Ne(Ar))}()},providedIn:"root"}),e})();function Jr(e){return e.replace(/\/index.html$/,"")}function ND(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const a=n.indexOf("="),[c,l]=-1==a?[n,""]:[n.slice(0,a),n.slice(a+1)];if(c.trim()===t)return decodeURIComponent(l)}return null}let _n=(()=>{class e{constructor(n,a){this._viewContainer=n,this._context=new o,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=a}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){r("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){r("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,a){return!0}}return e.\u0275fac=function(n){return new(n||e)(D(li),D(Ss))},e.\u0275dir=Ye({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),e})();class o{constructor(){this.$implicit=null,this.ngIf=null}}function r(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${jn(t)}'.`)}let N=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ni({type:e}),e.\u0275inj=jr({}),e})();function $o(e){return"server"===e}let Od=(()=>{class e{}return e.\u0275prov=Le({token:e,providedIn:"root",factory:()=>new Kt(Ne(zr),window)}),e})();class Kt{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function yt(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const a=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let c=a.currentNode;for(;c;){const l=c.shadowRoot;if(l){const p=l.getElementById(t)||l.querySelector(`[name="${t}"]`);if(p)return p}c=a.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),a=n.left+this.window.pageXOffset,c=n.top+this.window.pageYOffset,l=this.offset();this.window.scrollTo(a-l[0],c-l[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=Xt(this.window.history)||Xt(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Xt(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class Gi{}class qU extends rD{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class tM extends qU{static makeCurrent(){!function ct(e){Ah||(Ah=e)}(new tM)}onAndCancel(t,n,a){return t.addEventListener(n,a),()=>{t.removeEventListener(n,a)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function $U(){return wS=wS||document.querySelector("base"),wS?wS.getAttribute("href"):null}();return null==n?null:function zU(e){VD=VD||document.createElement("a"),VD.setAttribute("href",e);const t=VD.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){wS=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return ND(document.cookie,t)}}let VD,wS=null,JU=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();const nM=new Se("EventManagerPlugins");let Pk=(()=>{class e{constructor(n,a){this._zone=a,this._eventNameToPlugin=new Map,n.forEach(c=>{c.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,a,c){return this._findPluginFor(a).addEventListener(n,a,c)}getZone(){return this._zone}_findPluginFor(n){let a=this._eventNameToPlugin.get(n);if(a)return a;if(a=this._plugins.find(l=>l.supports(n)),!a)throw new se(5101,!1);return this._eventNameToPlugin.set(n,a),a}}return e.\u0275fac=function(n){return new(n||e)(Ne(nM),Ne(In))},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();class Mk{constructor(t){this._doc=t}}const rM="ng-app-id";let Lk=(()=>{class e{constructor(n,a,c,l={}){this.doc=n,this.appId=a,this.nonce=c,this.platformId=l,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=$o(l),this.resetHostNodes()}addStyles(n){for(const a of n)1===this.changeUsageCount(a,1)&&this.onStyleAdded(a)}removeStyles(n){for(const a of n)this.changeUsageCount(a,-1)<=0&&this.onStyleRemoved(a)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(a=>a.remove()),n.clear());for(const a of this.getAllStyles())this.onStyleRemoved(a);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const a of this.getAllStyles())this.addStyleToHost(n,a)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const a of this.hostNodes)this.addStyleToHost(a,n)}onStyleRemoved(n){const a=this.styleRef;a.get(n)?.elements?.forEach(c=>c.remove()),a.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${rM}="${this.appId}"]`);if(n?.length){const a=new Map;return n.forEach(c=>{null!=c.textContent&&a.set(c.textContent,c)}),a}return null}changeUsageCount(n,a){const c=this.styleRef;if(c.has(n)){const l=c.get(n);return l.usage+=a,l.usage}return c.set(n,{usage:a,elements:[]}),a}getStyleElement(n,a){const c=this.styleNodesInDOM,l=c?.get(a);if(l?.parentNode===n)return c.delete(a),l.removeAttribute(rM),l;{const p=this.doc.createElement("style");return this.nonce&&p.setAttribute("nonce",this.nonce),p.textContent=a,this.platformIsServer&&p.setAttribute(rM,this.appId),p}}addStyleToHost(n,a){const c=this.getStyleElement(n,a);n.appendChild(c);const l=this.styleRef,p=l.get(a)?.elements;p?p.push(c):l.set(a,{elements:[c],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}}return e.\u0275fac=function(n){return new(n||e)(Ne(zr),Ne(Ku),Ne(ME,8),Ne(Bs))},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();const oM={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},iM=/%COMP%/g,eV=new Se("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function xk(e,t){return t.map(n=>n.replace(iM,e))}let Uk=(()=>{class e{constructor(n,a,c,l,p,g,v,I=null){this.eventManager=n,this.sharedStylesHost=a,this.appId=c,this.removeStylesOnCompDestory=l,this.doc=p,this.platformId=g,this.ngZone=v,this.nonce=I,this.rendererByCompId=new Map,this.platformIsServer=$o(g),this.defaultRenderer=new sM(n,p,v,this.platformIsServer)}createRenderer(n,a){if(!n||!a)return this.defaultRenderer;this.platformIsServer&&a.encapsulation===Lo.ShadowDom&&(a={...a,encapsulation:Lo.Emulated});const c=this.getOrCreateRenderer(n,a);return c instanceof Fk?c.applyToHost(n):c instanceof aM&&c.applyStyles(),c}getOrCreateRenderer(n,a){const c=this.rendererByCompId;let l=c.get(a.id);if(!l){const p=this.doc,g=this.ngZone,v=this.eventManager,I=this.sharedStylesHost,A=this.removeStylesOnCompDestory,O=this.platformIsServer;switch(a.encapsulation){case Lo.Emulated:l=new Fk(v,I,a,this.appId,A,p,g,O);break;case Lo.ShadowDom:return new oV(v,I,n,a,p,g,this.nonce,O);default:l=new aM(v,I,a,A,p,g,O)}l.onDestroy=()=>c.delete(a.id),c.set(a.id,l)}return l}ngOnDestroy(){this.rendererByCompId.clear()}}return e.\u0275fac=function(n){return new(n||e)(Ne(Pk),Ne(Lk),Ne(Ku),Ne(eV),Ne(zr),Ne(Bs),Ne(In),Ne(ME))},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();class sM{constructor(t,n,a,c){this.eventManager=t,this.doc=n,this.ngZone=a,this.platformIsServer=c,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?this.doc.createElementNS(oM[n]||n,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,n){(Vk(t)?t.content:t).appendChild(n)}insertBefore(t,n,a){t&&(Vk(t)?t.content:t).insertBefore(n,a)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let a="string"==typeof t?this.doc.querySelector(t):t;if(!a)throw new se(5104,!1);return n||(a.textContent=""),a}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,a,c){if(c){n=c+":"+n;const l=oM[c];l?t.setAttributeNS(l,n,a):t.setAttribute(n,a)}else t.setAttribute(n,a)}removeAttribute(t,n,a){if(a){const c=oM[a];c?t.removeAttributeNS(c,n):t.removeAttribute(`${a}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,a,c){c&(Gr.DashCase|Gr.Important)?t.style.setProperty(n,a,c&Gr.Important?"important":""):t.style[n]=a}removeStyle(t,n,a){a&Gr.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,a){t[n]=a}setValue(t,n){t.nodeValue=n}listen(t,n,a){if("string"==typeof t&&!(t=Fa().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${n}`);return this.eventManager.addEventListener(t,n,this.decoratePreventDefault(a))}decoratePreventDefault(t){return n=>{if("__ngUnwrap__"===n)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(n)):t(n))&&n.preventDefault()}}}function Vk(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class oV extends sM{constructor(t,n,a,c,l,p,g,v){super(t,l,p,v),this.sharedStylesHost=n,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const I=xk(c.id,c.styles);for(const A of I){const O=document.createElement("style");g&&O.setAttribute("nonce",g),O.textContent=A,this.shadowRoot.appendChild(O)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,a){return super.insertBefore(this.nodeOrShadowRoot(t),n,a)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class aM extends sM{constructor(t,n,a,c,l,p,g,v){super(t,l,p,g),this.sharedStylesHost=n,this.removeStylesOnCompDestory=c,this.rendererUsageCount=0,this.styles=v?xk(v,a.styles):a.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class Fk extends aM{constructor(t,n,a,c,l,p,g,v){const I=c+"-"+a.id;super(t,n,a,l,p,g,v,I),this.contentAttr=function tV(e){return"_ngcontent-%COMP%".replace(iM,e)}(I),this.hostAttr=function nV(e){return"_nghost-%COMP%".replace(iM,e)}(I)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){const a=super.createElement(t,n);return super.setAttribute(a,this.contentAttr,""),a}}let iV=(()=>{class e extends Mk{constructor(n){super(n)}supports(n){return!0}addEventListener(n,a,c){return n.addEventListener(a,c,!1),()=>this.removeEventListener(n,a,c)}removeEventListener(n,a,c){return n.removeEventListener(a,c)}}return e.\u0275fac=function(n){return new(n||e)(Ne(zr))},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();const jk=["alt","control","meta","shift"],sV={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},aV={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let cV=(()=>{class e extends Mk{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,a,c){const l=e.parseEventName(a),p=e.eventCallback(l.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Fa().onAndCancel(n,l.domEventName,p))}static parseEventName(n){const a=n.toLowerCase().split("."),c=a.shift();if(0===a.length||"keydown"!==c&&"keyup"!==c)return null;const l=e._normalizeKey(a.pop());let p="",g=a.indexOf("code");if(g>-1&&(a.splice(g,1),p="code."),jk.forEach(I=>{const A=a.indexOf(I);A>-1&&(a.splice(A,1),p+=I+".")}),p+=l,0!=a.length||0===l.length)return null;const v={};return v.domEventName=c,v.fullKey=p,v}static matchEventFullKeyCode(n,a){let c=sV[n.key]||n.key,l="";return a.indexOf("code.")>-1&&(c=n.code,l="code."),!(null==c||!c)&&(c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),jk.forEach(p=>{p!==c&&(0,aV[p])(n)&&(l+=p+".")}),l+=c,l===a)}static eventCallback(n,a,c){return l=>{e.matchEventFullKeyCode(l,n)&&c.runGuarded(()=>a(l))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(Ne(zr))},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();const hV=Bm(Ih,"browser",[{provide:Bs,useValue:"browser"},{provide:Ca,useValue:function uV(){tM.makeCurrent()},multi:!0},{provide:zr,useFactory:function lV(){return function gI(e){_f=e}(document),document},deps:[]}]),pV=new Se(""),Gk=[{provide:mh,useClass:class YU{addToWindow(t){ln.getAngularTestability=(a,c=!0)=>{const l=t.findTestabilityInTree(a,c);if(null==l)throw new se(5103,!1);return l},ln.getAllAngularTestabilities=()=>t.getAllTestabilities(),ln.getAllAngularRootElements=()=>t.getAllRootElements(),ln.frameworkStabilizers||(ln.frameworkStabilizers=[]),ln.frameworkStabilizers.push(a=>{const c=ln.getAllAngularTestabilities();let l=c.length,p=!1;const g=function(v){p=p||v,l--,0==l&&a(p)};c.forEach(function(v){v.whenStable(g)})})}findTestabilityInTree(t,n,a){return null==n?null:t.getTestability(n)??(a?Fa().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:DA,useClass:Wo,deps:[In,Ts,mh]},{provide:Wo,useClass:Wo,deps:[In,Ts,mh]}],Wk=[{provide:wf,useValue:"root"},{provide:Ia,useFactory:function dV(){return new Ia},deps:[]},{provide:nM,useClass:iV,multi:!0,deps:[zr,In,Bs]},{provide:nM,useClass:cV,multi:!0,deps:[zr]},Uk,Lk,Pk,{provide:jI,useExisting:Uk},{provide:Gi,useClass:JU,deps:[]},[]];let fV=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:Ku,useValue:n.appId}]}}}return e.\u0275fac=function(n){return new(n||e)(Ne(pV,12))},e.\u0275mod=ni({type:e}),e.\u0275inj=jr({providers:[...Wk,...Gk],imports:[N,Ko]}),e})(),Kk=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(Ne(zr))},e.\u0275prov=Le({token:e,factory:function(n){let a=null;return a=n?new n:function gV(){return new Kk(Ne(zr))}(),a},providedIn:"root"}),e})();typeof window<"u"&&window;const{isArray:SV}=Array,{getPrototypeOf:TV,prototype:CV,keys:IV}=Object;function Yk(e){if(1===e.length){const t=e[0];if(SV(t))return{args:t,keys:null};if(function RV(e){return e&&"object"==typeof e&&TV(e)===CV}(t)){const n=IV(t);return{args:n.map(a=>t[a]),keys:n}}}return{args:e,keys:null}}const{isArray:bV}=Array;function Jk(e){return Nt(t=>function AV(e,t){return bV(t)?e(...t):e(t)}(e,t))}function Xk(e,t){return e.reduce((n,a,c)=>(n[a]=t[c],n),{})}let Qk=(()=>{class e{constructor(n,a){this._renderer=n,this._elementRef=a,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(n,a){this._renderer.setProperty(this._elementRef.nativeElement,n,a)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return e.\u0275fac=function(n){return new(n||e)(D(Gs),D(Vo))},e.\u0275dir=Ye({type:e}),e})(),Hh=(()=>{class e extends Qk{}return e.\u0275fac=function(){let t;return function(a){return(t||(t=Er(e)))(a||e)}}(),e.\u0275dir=Ye({type:e,features:[qe]}),e})();const Ga=new Se("NgValueAccessor"),OV={provide:Ga,useExisting:dn(()=>FD),multi:!0},PV=new Se("CompositionEventMode");let FD=(()=>{class e extends Qk{constructor(n,a,c){super(n,a),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function NV(){const e=Fa()?Fa().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(n){this.setProperty("value",n??"")}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}}return e.\u0275fac=function(n){return new(n||e)(D(Gs),D(Vo),D(PV,8))},e.\u0275dir=Ye({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,a){1&n&&Mr("input",function(l){return a._handleInput(l.target.value)})("blur",function(){return a.onTouched()})("compositionstart",function(){return a._compositionStart()})("compositionend",function(l){return a._compositionEnd(l.target.value)})},features:[yn([OV]),qe]}),e})();function Pd(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function e1(e){return null!=e&&"number"==typeof e.length}const Po=new Se("NgValidators"),Md=new Se("NgAsyncValidators"),MV=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class LV{static min(t){return function t1(e){return t=>{if(Pd(t.value)||Pd(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n<e?{min:{min:e,actual:t.value}}:null}}(t)}static max(t){return function n1(e){return t=>{if(Pd(t.value)||Pd(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n>e?{max:{max:e,actual:t.value}}:null}}(t)}static required(t){return function r1(e){return Pd(e.value)?{required:!0}:null}(t)}static requiredTrue(t){return function o1(e){return!0===e.value?null:{required:!0}}(t)}static email(t){return function i1(e){return Pd(e.value)||MV.test(e.value)?null:{email:!0}}(t)}static minLength(t){return function s1(e){return t=>Pd(t.value)||!e1(t.value)?null:t.value.length<e?{minlength:{requiredLength:e,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function a1(e){return t=>e1(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}(t)}static pattern(t){return function c1(e){if(!e)return jD;let t,n;return"string"==typeof e?(n="","^"!==e.charAt(0)&&(n+="^"),n+=e,"$"!==e.charAt(e.length-1)&&(n+="$"),t=new RegExp(n)):(n=e.toString(),t=e),a=>{if(Pd(a.value))return null;const c=a.value;return t.test(c)?null:{pattern:{requiredPattern:n,actualValue:c}}}}(t)}static nullValidator(t){return null}static compose(t){return f1(t)}static composeAsync(t){return m1(t)}}function jD(e){return null}function u1(e){return null!=e}function d1(e){return Kl(e)?er(e):e}function l1(e){let t={};return e.forEach(n=>{t=null!=n?{...t,...n}:t}),0===Object.keys(t).length?null:t}function h1(e,t){return t.map(n=>n(e))}function p1(e){return e.map(t=>function kV(e){return!e.validate}(t)?t:n=>t.validate(n))}function f1(e){if(!e)return null;const t=e.filter(u1);return 0==t.length?null:function(n){return l1(h1(n,t))}}function uM(e){return null!=e?f1(p1(e)):null}function m1(e){if(!e)return null;const t=e.filter(u1);return 0==t.length?null:function(n){return function DV(...e){const t=mT(e),{args:n,keys:a}=Yk(e),c=new Ln(l=>{const{length:p}=n;if(!p)return void l.complete();const g=new Array(p);let v=p,I=p;for(let A=0;A<p;A++){let O=!1;Zo(n[A]).subscribe(gr(l,F=>{O||(O=!0,I--),g[A]=F},()=>v--,void 0,()=>{(!v||!O)&&(I||l.next(a?Xk(a,g):g),l.complete())}))}});return t?c.pipe(Jk(t)):c}(h1(n,t).map(d1)).pipe(Nt(l1))}}function dM(e){return null!=e?m1(p1(e)):null}function g1(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function _1(e){return e._rawValidators}function E1(e){return e._rawAsyncValidators}function lM(e){return e?Array.isArray(e)?e:[e]:[]}function BD(e,t){return Array.isArray(e)?e.includes(t):e===t}function v1(e,t){const n=lM(t);return lM(e).forEach(c=>{BD(n,c)||n.push(c)}),n}function y1(e,t){return lM(t).filter(n=>!BD(e,n))}class S1{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=uM(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=dM(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,n){return!!this.control&&this.control.hasError(t,n)}getError(t,n){return this.control?this.control.getError(t,n):null}}class zo extends S1{get formDirective(){return null}get path(){return null}}class Ld extends S1{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class T1{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let C1=(()=>{class e extends T1{constructor(n){super(n)}}return e.\u0275fac=function(n){return new(n||e)(D(Ld,2))},e.\u0275dir=Ye({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,a){2&n&&em("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)},features:[qe]}),e})(),I1=(()=>{class e extends T1{constructor(n){super(n)}}return e.\u0275fac=function(n){return new(n||e)(D(zo,10))},e.\u0275dir=Ye({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,a){2&n&&em("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)("ng-submitted",a.isSubmitted)},features:[qe]}),e})();const OS="VALID",GD="INVALID",lg="PENDING",NS="DISABLED";function fM(e){return(WD(e)?e.validators:e)||null}function mM(e,t){return(WD(t)?t.asyncValidators:e)||null}function WD(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class D1{constructor(t,n){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(n)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===OS}get invalid(){return this.status===GD}get pending(){return this.status==lg}get disabled(){return this.status===NS}get enabled(){return this.status!==NS}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(v1(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(v1(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(y1(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(y1(t,this._rawAsyncValidators))}hasValidator(t){return BD(this._rawValidators,t)}hasAsyncValidator(t){return BD(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=lg,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=NS,this.errors=null,this._forEachChild(a=>{a.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:n}),this._onDisabledChange.forEach(a=>a(!0))}enable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=OS,this._forEachChild(a=>{a.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:n}),this._onDisabledChange.forEach(a=>a(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===OS||this.status===lg)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?NS:OS}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=lg,this._hasOwnPendingAsyncValidator=!0;const n=d1(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(a=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(a,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,n={}){this.errors=t,this._updateControlsErrors(!1!==n.emitEvent)}get(t){let n=t;return null==n||(Array.isArray(n)||(n=n.split(".")),0===n.length)?null:n.reduce((a,c)=>a&&a._find(c),this)}getError(t,n){const a=n?this.get(n):this;return a&&a.errors?a.errors[t]:null}hasError(t,n){return!!this.getError(t,n)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Cn,this.statusChanges=new Cn}_calculateStatus(){return this._allControlsDisabled()?NS:this.errors?GD:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(lg)?lg:this._anyControlsHaveStatus(GD)?GD:OS}_anyControlsHaveStatus(t){return this._anyControls(n=>n.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){WD(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function FV(e){return Array.isArray(e)?uM(e):e||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function jV(e){return Array.isArray(e)?dM(e):e||null}(this._rawAsyncValidators)}}class gM extends D1{constructor(t,n,a){super(fM(n),mM(a,n)),this.controls=t,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,n){return this.controls[t]?this.controls[t]:(this.controls[t]=n,n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange),n)}addControl(t,n,a={}){this.registerControl(t,n),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}removeControl(t,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}setControl(t,n,a={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],n&&this.registerControl(t,n),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,n={}){(function A1(e,t,n){e._forEachChild((a,c)=>{if(void 0===n[c])throw new se(1002,"")})})(this,0,t),Object.keys(t).forEach(a=>{(function b1(e,t,n){const a=e.controls;if(!(t?Object.keys(a):a).length)throw new se(1e3,"");if(!a[n])throw new se(1001,"")})(this,!0,a),this.controls[a].setValue(t[a],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(t,n={}){null!=t&&(Object.keys(t).forEach(a=>{const c=this.controls[a];c&&c.patchValue(t[a],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(t={},n={}){this._forEachChild((a,c)=>{a.reset(t[c],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this._reduceChildren({},(t,n,a)=>(t[a]=n.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(n,a)=>!!a._syncPendingControls()||n);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(n=>{const a=this.controls[n];a&&t(a,n)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[n,a]of Object.entries(this.controls))if(this.contains(n)&&t(a))return!0;return!1}_reduceValue(){return this._reduceChildren({},(n,a,c)=>((a.enabled||this.disabled)&&(n[c]=a.value),n))}_reduceChildren(t,n){let a=t;return this._forEachChild((c,l)=>{a=n(a,c,l)}),a}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}const Gh=new Se("CallSetDisabledState",{providedIn:"root",factory:()=>PS}),PS="always";function MS(e,t,n=PS){_M(e,t),t.valueAccessor.writeValue(e.value),(e.disabled||"always"===n)&&t.valueAccessor.setDisabledState?.(e.disabled),function GV(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&w1(e,t)})}(e,t),function KV(e,t){const n=(a,c)=>{t.valueAccessor.writeValue(a),c&&t.viewToModelUpdate(a)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function WV(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&w1(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function HV(e,t){if(t.valueAccessor.setDisabledState){const n=a=>{t.valueAccessor.setDisabledState(a)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function qD(e,t,n=!0){const a=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(a),t.valueAccessor.registerOnTouched(a)),function zD(e,t){let n=!1;if(null!==e){if(null!==t.validator){const c=_1(e);if(Array.isArray(c)&&c.length>0){const l=c.filter(p=>p!==t.validator);l.length!==c.length&&(n=!0,e.setValidators(l))}}if(null!==t.asyncValidator){const c=E1(e);if(Array.isArray(c)&&c.length>0){const l=c.filter(p=>p!==t.asyncValidator);l.length!==c.length&&(n=!0,e.setAsyncValidators(l))}}}const a=()=>{};return $D(t._rawValidators,a),$D(t._rawAsyncValidators,a),n}(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function $D(e,t){e.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(t)})}function _M(e,t){const n=_1(e);null!==t.validator?e.setValidators(g1(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const a=E1(e);null!==t.asyncValidator?e.setAsyncValidators(g1(a,t.asyncValidator)):"function"==typeof a&&e.setAsyncValidators([a]);const c=()=>e.updateValueAndValidity();$D(t._rawValidators,c),$D(t._rawAsyncValidators,c)}function w1(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}const JV={provide:zo,useExisting:dn(()=>YD)},LS=(()=>Promise.resolve())();let YD=(()=>{class e extends zo{constructor(n,a,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Cn,this.form=new gM({},uM(n),dM(a))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){LS.then(()=>{const a=this._findContainer(n.path);n.control=a.registerControl(n.name,n.control),MS(n.control,n,this.callSetDisabledState),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){LS.then(()=>{const a=this._findContainer(n.path);a&&a.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){LS.then(()=>{const a=this._findContainer(n.path),c=new gM({});(function O1(e,t){_M(e,t)})(c,n),a.registerControl(n.name,c),c.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){LS.then(()=>{const a=this._findContainer(n.path);a&&a.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,a){LS.then(()=>{this.form.get(n.path).setValue(a)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submitted=!0,function N1(e,t){e._syncPendingControls(),t.forEach(n=>{const a=n.control;"submit"===a.updateOn&&a._pendingChange&&(n.viewToModelUpdate(a._pendingValue),a._pendingChange=!1)})}(this.form,this._directives),this.ngSubmit.emit(n),"dialog"===n?.target?.method}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}}return e.\u0275fac=function(n){return new(n||e)(D(Po,10),D(Md,10),D(Gh,8))},e.\u0275dir=Ye({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(n,a){1&n&&Mr("submit",function(l){return a.onSubmit(l)})("reset",function(){return a.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[yn([JV]),qe]}),e})();function P1(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function M1(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const SM=class extends D1{constructor(t=null,n,a){super(fM(n),mM(a,n)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),WD(n)&&(n.nonNullable||n.initialValueIsDefault)&&(this.defaultValue=M1(t)?t.value:t)}setValue(t,n={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(a=>a(this.value,!1!==n.emitViewToModelChange)),this.updateValueAndValidity(n)}patchValue(t,n={}){this.setValue(t,n)}reset(t=this.defaultValue,n={}){this._applyFormState(t),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){P1(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){P1(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){M1(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};let V1=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Ye({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),e})(),j1=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ni({type:e}),e.\u0275inj=jr({}),e})();const TM=new Se("NgModelWithFormControlWarning"),oF={provide:Ld,useExisting:dn(()=>CM)};let CM=(()=>{class e extends Ld{set isDisabled(n){}constructor(n,a,c,l,p){super(),this._ngModelWarningConfig=l,this.callSetDisabledState=p,this.update=new Cn,this._ngModelWarningSent=!1,this._setValidators(n),this._setAsyncValidators(a),this.valueAccessor=function yM(e,t){if(!t)return null;let n,a,c;return Array.isArray(t),t.forEach(l=>{l.constructor===FD?n=l:function zV(e){return Object.getPrototypeOf(e.constructor)===Hh}(l)?a=l:c=l}),c||a||n||null}(0,c)}ngOnChanges(n){if(this._isControlChanged(n)){const a=n.form.previousValue;a&&qD(a,this,!1),MS(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}(function vM(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)})(n,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&qD(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_isControlChanged(n){return n.hasOwnProperty("form")}}return e._ngModelWarningSentOnce=!1,e.\u0275fac=function(n){return new(n||e)(D(Po,10),D(Md,10),D(Ga,10),D(TM,8),D(Gh,8))},e.\u0275dir=Ye({type:e,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[yn([oF]),qe,ri]}),e})(),nx=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ni({type:e}),e.\u0275inj=jr({imports:[j1]}),e})(),IF=(()=>{class e{static withConfig(n){return{ngModule:e,providers:[{provide:Gh,useValue:n.callSetDisabledState??PS}]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ni({type:e}),e.\u0275inj=jr({imports:[nx]}),e})(),RF=(()=>{class e{static withConfig(n){return{ngModule:e,providers:[{provide:TM,useValue:n.warnOnNgModelWithFormControl??"always"},{provide:Gh,useValue:n.callSetDisabledState??PS}]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ni({type:e}),e.\u0275inj=jr({imports:[nx]}),e})();function OM(...e){const t=uu(e),n=mT(e),{args:a,keys:c}=Yk(e);if(0===a.length)return er([],t);const l=new Ln(function AF(e,t,n=Qr){return a=>{rx(t,()=>{const{length:c}=e,l=new Array(c);let p=c,g=c;for(let v=0;v<c;v++)rx(t,()=>{const I=er(e[v],t);let A=!1;I.subscribe(gr(a,O=>{l[v]=O,A||(A=!0,g--),g||a.next(n(l.slice()))},()=>{--p||a.complete()}))},a)},a)}}(a,t,c?p=>Xk(c,p):Qr));return n?l.pipe(Jk(n)):l}function rx(e,t,n){e?Ps(n,e,t):t()}const JD=ra(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function NM(...e){return function DF(){return cu(1)}()(er(e,uu(e)))}function ox(e){return new Ln(t=>{Zo(e()).subscribe(t)})}function hg(e,t){const n=M(e)?e:()=>e,a=c=>c.error(n());return new Ln(t?c=>t.schedule(a,0,c):a)}function PM(){return Zn((e,t)=>{let n=null;e._refCount++;const a=gr(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const c=e._connection,l=n;n=null,c&&(!l||c===l)&&c.unsubscribe(),t.unsubscribe()});e.subscribe(a),a.closed||(n=e.connect())})}class ix extends Ln{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,oT(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Xn;const n=this.getSubject();t.add(this.source.subscribe(gr(n,void 0,()=>{this._teardown(),n.complete()},a=>{this._teardown(),n.error(a)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Xn.EMPTY)}return t}refCount(){return PM()(this)}}function pg(e){return e<=0?()=>zi:Zn((t,n)=>{let a=0;t.subscribe(gr(n,c=>{++a<=e&&(n.next(c),e<=a&&n.complete())}))})}function ru(e,t){return Zn((n,a)=>{let c=0;n.subscribe(gr(a,l=>e.call(t,l,c++)&&a.next(l)))})}function XD(e){return Zn((t,n)=>{let a=!1;t.subscribe(gr(n,c=>{a=!0,n.next(c)},()=>{a||n.next(e),n.complete()}))})}function sx(e=OF){return Zn((t,n)=>{let a=!1;t.subscribe(gr(n,c=>{a=!0,n.next(c)},()=>a?n.complete():n.error(e())))})}function OF(){return new JD}function Kh(e,t){const n=arguments.length>=2;return a=>a.pipe(e?ru((c,l)=>e(c,l,a)):Qr,pg(1),n?XD(t):sx(()=>new JD))}function fg(e,t){return M(t)?Pt(e,t,1):Pt(e,1)}function Yo(e,t,n){const a=M(e)||t||n?{next:e,error:t,complete:n}:e;return a?Zn((c,l)=>{var p;null===(p=a.subscribe)||void 0===p||p.call(a);let g=!0;c.subscribe(gr(l,v=>{var I;null===(I=a.next)||void 0===I||I.call(a,v),l.next(v)},()=>{var v;g=!1,null===(v=a.complete)||void 0===v||v.call(a),l.complete()},v=>{var I;g=!1,null===(I=a.error)||void 0===I||I.call(a,v),l.error(v)},()=>{var v,I;g&&(null===(v=a.unsubscribe)||void 0===v||v.call(a)),null===(I=a.finalize)||void 0===I||I.call(a)}))}):Qr}function kd(e){return Zn((t,n)=>{let l,a=null,c=!1;a=t.subscribe(gr(n,void 0,void 0,p=>{l=Zo(e(p,kd(e)(t))),a?(a.unsubscribe(),a=null,l.subscribe(n)):c=!0})),c&&(a.unsubscribe(),a=null,l.subscribe(n))})}function MM(e){return e<=0?()=>zi:Zn((t,n)=>{let a=[];t.subscribe(gr(n,c=>{a.push(c),e<a.length&&a.shift()},()=>{for(const c of a)n.next(c);n.complete()},void 0,()=>{a=null}))})}function kS(e){return Zn((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const mt="primary",xS=Symbol("RouteTitle");class kF{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function mg(e){return new kF(e)}function xF(e,t,n){const a=n.path.split("/");if(a.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||a.length<e.length))return null;const c={};for(let l=0;l<a.length;l++){const p=a[l],g=e[l];if(p.startsWith(":"))c[p.substring(1)]=g;else if(p!==g.path)return null}return{consumed:e.slice(0,a.length),posParams:c}}function Wa(e,t){const n=e?Object.keys(e):void 0,a=t?Object.keys(t):void 0;if(!n||!a||n.length!=a.length)return!1;let c;for(let l=0;l<n.length;l++)if(c=n[l],!ax(e[c],t[c]))return!1;return!0}function ax(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),a=[...t].sort();return n.every((c,l)=>a[l]===c)}return e===t}function cx(e){return e.length>0?e[e.length-1]:null}function xd(e){return function bF(e){return!!e&&(e instanceof Ln||M(e.lift)&&M(e.subscribe))}(e)?e:Kl(e)?er(Promise.resolve(e)):Ke(e)}const VF={exact:function lx(e,t,n){if(!qh(e.segments,t.segments)||!QD(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const a in t.children)if(!e.children[a]||!lx(e.children[a],t.children[a],n))return!1;return!0},subset:hx},ux={exact:function FF(e,t){return Wa(e,t)},subset:function jF(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>ax(e[n],t[n]))},ignored:()=>!0};function dx(e,t,n){return VF[n.paths](e.root,t.root,n.matrixParams)&&ux[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function hx(e,t,n){return px(e,t,t.segments,n)}function px(e,t,n,a){if(e.segments.length>n.length){const c=e.segments.slice(0,n.length);return!(!qh(c,n)||t.hasChildren()||!QD(c,n,a))}if(e.segments.length===n.length){if(!qh(e.segments,n)||!QD(e.segments,n,a))return!1;for(const c in t.children)if(!e.children[c]||!hx(e.children[c],t.children[c],a))return!1;return!0}{const c=n.slice(0,e.segments.length),l=n.slice(e.segments.length);return!!(qh(e.segments,c)&&QD(e.segments,c,a)&&e.children[mt])&&px(e.children[mt],t,l,a)}}function QD(e,t,n){return t.every((a,c)=>ux[n](e[c].parameters,a.parameters))}class gg{constructor(t=new un([],{}),n={},a=null){this.root=t,this.queryParams=n,this.fragment=a}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=mg(this.queryParams)),this._queryParamMap}toString(){return GF.serialize(this)}}class un{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Object.values(n).forEach(a=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ZD(this)}}class US{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=mg(this.parameters)),this._parameterMap}toString(){return gx(this)}}function qh(e,t){return e.length===t.length&&e.every((n,a)=>n.path===t[a].path)}let VS=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:function(){return new LM},providedIn:"root"}),e})();class LM{parse(t){const n=new e2(t);return new gg(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${FS(t.root,!0)}`,a=function qF(e){const t=Object.keys(e).map(n=>{const a=e[n];return Array.isArray(a)?a.map(c=>`${ew(n)}=${ew(c)}`).join("&"):`${ew(n)}=${ew(a)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${a}${"string"==typeof t.fragment?`#${function WF(e){return encodeURI(e)}(t.fragment)}`:""}`}}const GF=new LM;function ZD(e){return e.segments.map(t=>gx(t)).join("/")}function FS(e,t){if(!e.hasChildren())return ZD(e);if(t){const n=e.children[mt]?FS(e.children[mt],!1):"",a=[];return Object.entries(e.children).forEach(([c,l])=>{c!==mt&&a.push(`${c}:${FS(l,!1)}`)}),a.length>0?`${n}(${a.join("//")})`:n}{const n=function HF(e,t){let n=[];return Object.entries(e.children).forEach(([a,c])=>{a===mt&&(n=n.concat(t(c,a)))}),Object.entries(e.children).forEach(([a,c])=>{a!==mt&&(n=n.concat(t(c,a)))}),n}(e,(a,c)=>c===mt?[FS(e.children[mt],!1)]:[`${c}:${FS(a,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[mt]?`${ZD(e)}/${n[0]}`:`${ZD(e)}/(${n.join("//")})`}}function fx(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ew(e){return fx(e).replace(/%3B/gi,";")}function kM(e){return fx(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function tw(e){return decodeURIComponent(e)}function mx(e){return tw(e.replace(/\+/g,"%20"))}function gx(e){return`${kM(e.path)}${function KF(e){return Object.keys(e).map(t=>`;${kM(t)}=${kM(e[t])}`).join("")}(e.parameters)}`}const $F=/^[^\/()?;#]+/;function xM(e){const t=e.match($F);return t?t[0]:""}const zF=/^[^\/()?;=#]+/,JF=/^[^=?&#]+/,QF=/^[^&#]+/;class e2{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new un([],{}):new un([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(a[mt]=new un(t,n)),a}parseSegment(){const t=xM(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new se(4009,!1);return this.capture(t),new US(tw(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=function YF(e){const t=e.match(zF);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let a="";if(this.consumeOptional("=")){const c=xM(this.remaining);c&&(a=c,this.capture(a))}t[tw(n)]=tw(a)}parseQueryParam(t){const n=function XF(e){const t=e.match(JF);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let a="";if(this.consumeOptional("=")){const p=function ZF(e){const t=e.match(QF);return t?t[0]:""}(this.remaining);p&&(a=p,this.capture(a))}const c=mx(n),l=mx(a);if(t.hasOwnProperty(c)){let p=t[c];Array.isArray(p)||(p=[p],t[c]=p),p.push(l)}else t[c]=l}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const a=xM(this.remaining),c=this.remaining[a.length];if("/"!==c&&")"!==c&&";"!==c)throw new se(4010,!1);let l;a.indexOf(":")>-1?(l=a.slice(0,a.indexOf(":")),this.capture(l),this.capture(":")):t&&(l=mt);const p=this.parseChildren();n[l]=1===Object.keys(p).length?p[mt]:new un([],p),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new se(4011,!1)}}function _x(e){return e.segments.length>0?new un([],{[mt]:e}):e}function Ex(e){const t={};for(const a of Object.keys(e.children)){const l=Ex(e.children[a]);if(a===mt&&0===l.segments.length&&l.hasChildren())for(const[p,g]of Object.entries(l.children))t[p]=g;else(l.segments.length>0||l.hasChildren())&&(t[a]=l)}return function t2(e){if(1===e.numberOfChildren&&e.children[mt]){const t=e.children[mt];return new un(e.segments.concat(t.segments),t.children)}return e}(new un(e.segments,t))}function $h(e){return e instanceof gg}function vx(e){let t;const c=_x(function n(l){const p={};for(const v of l.children){const I=n(v);p[v.outlet]=I}const g=new un(l.url,p);return l===e&&(t=g),g}(e.root));return t??c}function yx(e,t,n,a){let c=e;for(;c.parent;)c=c.parent;if(0===t.length)return UM(c,c,c,n,a);const l=function r2(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new Tx(!0,0,e);let t=0,n=!1;const a=e.reduce((c,l,p)=>{if("object"==typeof l&&null!=l){if(l.outlets){const g={};return Object.entries(l.outlets).forEach(([v,I])=>{g[v]="string"==typeof I?I.split("/"):I}),[...c,{outlets:g}]}if(l.segmentPath)return[...c,l.segmentPath]}return"string"!=typeof l?[...c,l]:0===p?(l.split("/").forEach((g,v)=>{0==v&&"."===g||(0==v&&""===g?n=!0:".."===g?t++:""!=g&&c.push(g))}),c):[...c,l]},[]);return new Tx(n,t,a)}(t);if(l.toRoot())return UM(c,c,new un([],{}),n,a);const p=function o2(e,t,n){if(e.isAbsolute)return new rw(t,!0,0);if(!n)return new rw(t,!1,NaN);if(null===n.parent)return new rw(n,!0,0);const a=nw(e.commands[0])?0:1;return function i2(e,t,n){let a=e,c=t,l=n;for(;l>c;){if(l-=c,a=a.parent,!a)throw new se(4005,!1);c=a.segments.length}return new rw(a,!1,c-l)}(n,n.segments.length-1+a,e.numberOfDoubleDots)}(l,c,e),g=p.processChildren?BS(p.segmentGroup,p.index,l.commands):Cx(p.segmentGroup,p.index,l.commands);return UM(c,p.segmentGroup,g,n,a)}function nw(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function jS(e){return"object"==typeof e&&null!=e&&e.outlets}function UM(e,t,n,a,c){let p,l={};a&&Object.entries(a).forEach(([v,I])=>{l[v]=Array.isArray(I)?I.map(A=>`${A}`):`${I}`}),p=e===t?n:Sx(e,t,n);const g=_x(Ex(p));return new gg(g,l,c)}function Sx(e,t,n){const a={};return Object.entries(e.children).forEach(([c,l])=>{a[c]=l===t?n:Sx(l,t,n)}),new un(e.segments,a)}class Tx{constructor(t,n,a){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=a,t&&a.length>0&&nw(a[0]))throw new se(4003,!1);const c=a.find(jS);if(c&&c!==cx(a))throw new se(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class rw{constructor(t,n,a){this.segmentGroup=t,this.processChildren=n,this.index=a}}function Cx(e,t,n){if(e||(e=new un([],{})),0===e.segments.length&&e.hasChildren())return BS(e,t,n);const a=function a2(e,t,n){let a=0,c=t;const l={match:!1,pathIndex:0,commandIndex:0};for(;c<e.segments.length;){if(a>=n.length)return l;const p=e.segments[c],g=n[a];if(jS(g))break;const v=`${g}`,I=a<n.length-1?n[a+1]:null;if(c>0&&void 0===v)break;if(v&&I&&"object"==typeof I&&void 0===I.outlets){if(!Rx(v,I,p))return l;a+=2}else{if(!Rx(v,{},p))return l;a++}c++}return{match:!0,pathIndex:c,commandIndex:a}}(e,t,n),c=n.slice(a.commandIndex);if(a.match&&a.pathIndex<e.segments.length){const l=new un(e.segments.slice(0,a.pathIndex),{});return l.children[mt]=new un(e.segments.slice(a.pathIndex),e.children),BS(l,0,c)}return a.match&&0===c.length?new un(e.segments,{}):a.match&&!e.hasChildren()?VM(e,t,n):a.match?BS(e,0,c):VM(e,t,n)}function BS(e,t,n){if(0===n.length)return new un(e.segments,{});{const a=function s2(e){return jS(e[0])?e[0].outlets:{[mt]:e}}(n),c={};if(!a[mt]&&e.children[mt]&&1===e.numberOfChildren&&0===e.children[mt].segments.length){const l=BS(e.children[mt],t,n);return new un(e.segments,l.children)}return Object.entries(a).forEach(([l,p])=>{"string"==typeof p&&(p=[p]),null!==p&&(c[l]=Cx(e.children[l],t,p))}),Object.entries(e.children).forEach(([l,p])=>{void 0===a[l]&&(c[l]=p)}),new un(e.segments,c)}}function VM(e,t,n){const a=e.segments.slice(0,t);let c=0;for(;c<n.length;){const l=n[c];if(jS(l)){const v=c2(l.outlets);return new un(a,v)}if(0===c&&nw(n[0])){a.push(new US(e.segments[t].path,Ix(n[0]))),c++;continue}const p=jS(l)?l.outlets[mt]:`${l}`,g=c<n.length-1?n[c+1]:null;p&&g&&nw(g)?(a.push(new US(p,Ix(g))),c+=2):(a.push(new US(p,{})),c++)}return new un(a,{})}function c2(e){const t={};return Object.entries(e).forEach(([n,a])=>{"string"==typeof a&&(a=[a]),null!==a&&(t[n]=VM(new un([],{}),0,a))}),t}function Ix(e){const t={};return Object.entries(e).forEach(([n,a])=>t[n]=`${a}`),t}function Rx(e,t,n){return e==n.path&&Wa(t,n.parameters)}const HS="imperative";class Ka{constructor(t,n){this.id=t,this.url=n}}class FM extends Ka{constructor(t,n,a="imperative",c=null){super(t,n),this.type=0,this.navigationTrigger=a,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class zh extends Ka{constructor(t,n,a){super(t,n),this.urlAfterRedirects=a,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ow extends Ka{constructor(t,n,a,c){super(t,n),this.reason=a,this.code=c,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class GS extends Ka{constructor(t,n,a,c){super(t,n),this.reason=a,this.code=c,this.type=16}}class jM extends Ka{constructor(t,n,a,c){super(t,n),this.error=a,this.target=c,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class u2 extends Ka{constructor(t,n,a,c){super(t,n),this.urlAfterRedirects=a,this.state=c,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class d2 extends Ka{constructor(t,n,a,c){super(t,n),this.urlAfterRedirects=a,this.state=c,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class l2 extends Ka{constructor(t,n,a,c,l){super(t,n),this.urlAfterRedirects=a,this.state=c,this.shouldActivate=l,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class h2 extends Ka{constructor(t,n,a,c){super(t,n),this.urlAfterRedirects=a,this.state=c,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class p2 extends Ka{constructor(t,n,a,c){super(t,n),this.urlAfterRedirects=a,this.state=c,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class f2{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class m2{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class g2{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class _2{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class E2{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class v2{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bx{constructor(t,n,a){this.routerEvent=t,this.position=n,this.anchor=a,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class y2{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new WS,this.attachRef=null}}let WS=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,a){const c=this.getOrCreateContext(n);c.outlet=a,this.contexts.set(n,c)}onChildOutletDestroyed(n){const a=this.getContext(n);a&&(a.outlet=null,a.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let a=this.getContext(n);return a||(a=new y2,this.contexts.set(n,a)),a}getContext(n){return this.contexts.get(n)||null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class Ax{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=BM(t,this._root);return n?n.children.map(a=>a.value):[]}firstChild(t){const n=BM(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=HM(t,this._root);return n.length<2?[]:n[n.length-2].children.map(c=>c.value).filter(c=>c!==t)}pathFromRoot(t){return HM(t,this._root).map(n=>n.value)}}function BM(e,t){if(e===t.value)return t;for(const n of t.children){const a=BM(e,n);if(a)return a}return null}function HM(e,t){if(e===t.value)return[t];for(const n of t.children){const a=HM(e,n);if(a.length)return a.unshift(t),a}return[]}class ou{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function _g(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class Dx extends Ax{constructor(t,n){super(t),this.snapshot=n,GM(this,t)}toString(){return this.snapshot.toString()}}function wx(e,t){const n=function S2(e,t){const p=new iw([],{},{},"",{},mt,t,null,{});return new Nx("",new ou(p,[]))}(0,t),a=new fo([new US("",{})]),c=new fo({}),l=new fo({}),p=new fo({}),g=new fo(""),v=new Yh(a,c,p,g,l,mt,t,n.root);return v.snapshot=n.root,new Dx(new ou(v,[]),n)}class Yh{constructor(t,n,a,c,l,p,g,v){this.urlSubject=t,this.paramsSubject=n,this.queryParamsSubject=a,this.fragmentSubject=c,this.dataSubject=l,this.outlet=p,this.component=g,this._futureSnapshot=v,this.title=this.dataSubject?.pipe(Nt(I=>I[xS]))??Ke(void 0),this.url=t,this.params=n,this.queryParams=a,this.fragment=c,this.data=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Nt(t=>mg(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Nt(t=>mg(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Ox(e,t="emptyOnly"){const n=e.pathFromRoot;let a=0;if("always"!==t)for(a=n.length-1;a>=1;){const c=n[a],l=n[a-1];if(c.routeConfig&&""===c.routeConfig.path)a--;else{if(l.component)break;a--}}return function T2(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(a))}class iw{get title(){return this.data?.[xS]}constructor(t,n,a,c,l,p,g,v,I){this.url=t,this.params=n,this.queryParams=a,this.fragment=c,this.data=l,this.outlet=p,this.component=g,this.routeConfig=v,this._resolve=I}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=mg(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=mg(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(a=>a.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Nx extends Ax{constructor(t,n){super(n),this.url=t,GM(this,n)}toString(){return Px(this._root)}}function GM(e,t){t.value._routerState=e,t.children.forEach(n=>GM(e,n))}function Px(e){const t=e.children.length>0?` { ${e.children.map(Px).join(", ")} } `:"";return`${e.value}${t}`}function WM(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Wa(t.queryParams,n.queryParams)||e.queryParamsSubject.next(n.queryParams),t.fragment!==n.fragment&&e.fragmentSubject.next(n.fragment),Wa(t.params,n.params)||e.paramsSubject.next(n.params),function UF(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Wa(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.urlSubject.next(n.url),Wa(t.data,n.data)||e.dataSubject.next(n.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function KM(e,t){const n=Wa(e.params,t.params)&&function BF(e,t){return qh(e,t)&&e.every((n,a)=>Wa(n.parameters,t[a].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||KM(e.parent,t.parent))}let qM=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=mt,this.activateEvents=new Cn,this.deactivateEvents=new Cn,this.attachEvents=new Cn,this.detachEvents=new Cn,this.parentContexts=ve(WS),this.location=ve(li),this.changeDetector=ve(Rs),this.environmentInjector=ve(cs),this.inputBinder=ve(sw,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){const{firstChange:a,previousValue:c}=n.name;if(a)return;this.isTrackedInParentContexts(c)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(c)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new se(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new se(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new se(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,a){this.activated=n,this._activatedRoute=a,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,a){if(this.isActivated)throw new se(4013,!1);this._activatedRoute=n;const c=this.location,p=n.snapshot.component,g=this.parentContexts.getOrCreateContext(this.name).children,v=new C2(n,g,c.injector);this.activated=c.createComponent(p,{index:c.length,injector:v,environmentInjector:a??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Ye({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[ri]}),e})();class C2{constructor(t,n,a){this.route=t,this.childContexts=n,this.parent=a}get(t,n){return t===Yh?this.route:t===WS?this.childContexts:this.parent.get(t,n)}}const sw=new Se("");let Mx=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){const{activatedRoute:a}=n,c=OM([a.queryParams,a.params,a.data]).pipe(yi(([l,p,g],v)=>(g={...l,...p,...g},0===v?Ke(g):Promise.resolve(g)))).subscribe(l=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==a||null===a.component)return void this.unsubscribeFromRouteData(n);const p=function Zm(e){const t=Mt(e);if(!t)return null;const n=new Oc(t);return{get selector(){return n.selector},get type(){return n.componentType},get inputs(){return n.inputs},get outputs(){return n.outputs},get ngContentSelectors(){return n.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}(a.component);if(p)for(const{templateName:g}of p.inputs)n.activatedComponentRef.setInput(g,l[g]);else this.unsubscribeFromRouteData(n)});this.outletDataSubscriptions.set(n,c)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();function KS(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const a=n.value;a._futureSnapshot=t.value;const c=function R2(e,t,n){return t.children.map(a=>{for(const c of n.children)if(e.shouldReuseRoute(a.value,c.value.snapshot))return KS(e,a,c);return KS(e,a)})}(e,t,n);return new ou(a,c)}{if(e.shouldAttach(t.value)){const l=e.retrieve(t.value);if(null!==l){const p=l.route;return p.value._futureSnapshot=t.value,p.children=t.children.map(g=>KS(e,g)),p}}const a=function b2(e){return new Yh(new fo(e.url),new fo(e.params),new fo(e.queryParams),new fo(e.fragment),new fo(e.data),e.outlet,e.component,e)}(t.value),c=t.children.map(l=>KS(e,l));return new ou(a,c)}}const $M="ngNavigationCancelingError";function Lx(e,t){const{redirectTo:n,navigationBehaviorOptions:a}=$h(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,c=kx(!1,0,t);return c.url=n,c.navigationBehaviorOptions=a,c}function kx(e,t,n){const a=new Error("NavigationCancelingError: "+(e||""));return a[$M]=!0,a.cancellationCode=t,n&&(a.url=n),a}function xx(e){return Ux(e)&&$h(e.url)}function Ux(e){return e&&e[$M]}let Vx=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ya({type:e,selectors:[["ng-component"]],standalone:!0,features:[ly],decls:1,vars:0,template:function(n,a){1&n&&di(0,"router-outlet")},dependencies:[qM],encapsulation:2}),e})();function zM(e){const t=e.children&&e.children.map(zM),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==mt&&(n.component=Vx),n}function ta(e){return e.outlet||mt}function qS(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class M2{constructor(t,n,a,c,l){this.routeReuseStrategy=t,this.futureState=n,this.currState=a,this.forwardEvent=c,this.inputBindingEnabled=l}activate(t){const n=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,a,t),WM(this.futureState.root),this.activateChildRoutes(n,a,t)}deactivateChildRoutes(t,n,a){const c=_g(n);t.children.forEach(l=>{const p=l.value.outlet;this.deactivateRoutes(l,c[p],a),delete c[p]}),Object.values(c).forEach(l=>{this.deactivateRouteAndItsChildren(l,a)})}deactivateRoutes(t,n,a){const c=t.value,l=n?n.value:null;if(c===l)if(c.component){const p=a.getContext(c.outlet);p&&this.deactivateChildRoutes(t,n,p.children)}else this.deactivateChildRoutes(t,n,a);else l&&this.deactivateRouteAndItsChildren(n,a)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const a=n.getContext(t.value.outlet),c=a&&t.value.component?a.children:n,l=_g(t);for(const p of Object.keys(l))this.deactivateRouteAndItsChildren(l[p],c);if(a&&a.outlet){const p=a.outlet.detach(),g=a.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:p,route:t,contexts:g})}}deactivateRouteAndOutlet(t,n){const a=n.getContext(t.value.outlet),c=a&&t.value.component?a.children:n,l=_g(t);for(const p of Object.keys(l))this.deactivateRouteAndItsChildren(l[p],c);a&&(a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated()),a.attachRef=null,a.route=null)}activateChildRoutes(t,n,a){const c=_g(n);t.children.forEach(l=>{this.activateRoutes(l,c[l.value.outlet],a),this.forwardEvent(new v2(l.value.snapshot))}),t.children.length&&this.forwardEvent(new _2(t.value.snapshot))}activateRoutes(t,n,a){const c=t.value,l=n?n.value:null;if(WM(c),c===l)if(c.component){const p=a.getOrCreateContext(c.outlet);this.activateChildRoutes(t,n,p.children)}else this.activateChildRoutes(t,n,a);else if(c.component){const p=a.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const g=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),p.children.onOutletReAttached(g.contexts),p.attachRef=g.componentRef,p.route=g.route.value,p.outlet&&p.outlet.attach(g.componentRef,g.route.value),WM(g.route.value),this.activateChildRoutes(t,null,p.children)}else{const g=qS(c.snapshot);p.attachRef=null,p.route=c,p.injector=g,p.outlet&&p.outlet.activateWith(c,p.injector),this.activateChildRoutes(t,null,p.children)}}else this.activateChildRoutes(t,null,a)}}class Fx{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class aw{constructor(t,n){this.component=t,this.route=n}}function L2(e,t,n){const a=e._root;return $S(a,t?t._root:null,n,[a.value])}function Eg(e,t){const n=Symbol(),a=t.get(e,n);return a===n?"function"!=typeof e||function qw(e){return null!==qd(e)}(e)?t.get(e):e:a}function $S(e,t,n,a,c={canDeactivateChecks:[],canActivateChecks:[]}){const l=_g(t);return e.children.forEach(p=>{(function x2(e,t,n,a,c={canDeactivateChecks:[],canActivateChecks:[]}){const l=e.value,p=t?t.value:null,g=n?n.getContext(e.value.outlet):null;if(p&&l.routeConfig===p.routeConfig){const v=function U2(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!qh(e.url,t.url);case"pathParamsOrQueryParamsChange":return!qh(e.url,t.url)||!Wa(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!KM(e,t)||!Wa(e.queryParams,t.queryParams);default:return!KM(e,t)}}(p,l,l.routeConfig.runGuardsAndResolvers);v?c.canActivateChecks.push(new Fx(a)):(l.data=p.data,l._resolvedData=p._resolvedData),$S(e,t,l.component?g?g.children:null:n,a,c),v&&g&&g.outlet&&g.outlet.isActivated&&c.canDeactivateChecks.push(new aw(g.outlet.component,p))}else p&&zS(t,g,c),c.canActivateChecks.push(new Fx(a)),$S(e,null,l.component?g?g.children:null:n,a,c)})(p,l[p.value.outlet],n,a.concat([p.value]),c),delete l[p.value.outlet]}),Object.entries(l).forEach(([p,g])=>zS(g,n.getContext(p),c)),c}function zS(e,t,n){const a=_g(e),c=e.value;Object.entries(a).forEach(([l,p])=>{zS(p,c.component?t?t.children.getContext(l):null:t,n)}),n.canDeactivateChecks.push(new aw(c.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,c))}function YS(e){return"function"==typeof e}function jx(e){return e instanceof JD||"EmptyError"===e?.name}const cw=Symbol("INITIAL_VALUE");function vg(){return yi(e=>OM(e.map(t=>t.pipe(pg(1),function wF(...e){const t=uu(e);return Zn((n,a)=>{(t?NM(e,n,t):NM(e,n)).subscribe(a)})}(cw)))).pipe(Nt(t=>{for(const n of t)if(!0!==n){if(n===cw)return cw;if(!1===n||n instanceof gg)return n}return!0}),ru(t=>t!==cw),pg(1)))}function Bx(e){return function tp(...e){return ca(e)}(Yo(t=>{if($h(t))throw Lx(0,t)}),Nt(t=>!0===t))}class uw{constructor(t){this.segmentGroup=t||null}}class Hx{constructor(t){this.urlTree=t}}function yg(e){return hg(new uw(e))}function Gx(e){return hg(new Hx(e))}class rj{constructor(t,n){this.urlSerializer=t,this.urlTree=n}noMatchError(t){return new se(4002,!1)}lineralizeSegments(t,n){let a=[],c=n.root;for(;;){if(a=a.concat(c.segments),0===c.numberOfChildren)return Ke(a);if(c.numberOfChildren>1||!c.children[mt])return hg(new se(4e3,!1));c=c.children[mt]}}applyRedirectCommands(t,n,a){return this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,a)}applyRedirectCreateUrlTree(t,n,a,c){const l=this.createSegmentGroup(t,n.root,a,c);return new gg(l,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const a={};return Object.entries(t).forEach(([c,l])=>{if("string"==typeof l&&l.startsWith(":")){const g=l.substring(1);a[c]=n[g]}else a[c]=l}),a}createSegmentGroup(t,n,a,c){const l=this.createSegments(t,n.segments,a,c);let p={};return Object.entries(n.children).forEach(([g,v])=>{p[g]=this.createSegmentGroup(t,v,a,c)}),new un(l,p)}createSegments(t,n,a,c){return n.map(l=>l.path.startsWith(":")?this.findPosParam(t,l,c):this.findOrReturn(l,a))}findPosParam(t,n,a){const c=a[n.path.substring(1)];if(!c)throw new se(4001,!1);return c}findOrReturn(t,n){let a=0;for(const c of n){if(c.path===t.path)return n.splice(a),c;a++}return t}}const YM={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function oj(e,t,n,a,c){const l=JM(e,t,n);return l.matched?(a=function A2(e,t){return e.providers&&!e._injector&&(e._injector=Em(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,a),function ej(e,t,n,a){const c=t.canMatch;return c&&0!==c.length?Ke(c.map(p=>{const g=Eg(p,e);return xd(function G2(e){return e&&YS(e.canMatch)}(g)?g.canMatch(t,n):e.runInContext(()=>g(t,n)))})).pipe(vg(),Bx()):Ke(!0)}(a,t,n).pipe(Nt(p=>!0===p?l:{...YM}))):Ke(l)}function JM(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...YM}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const c=(t.matcher||xF)(n,e,t);if(!c)return{...YM};const l={};Object.entries(c.posParams??{}).forEach(([g,v])=>{l[g]=v.path});const p=c.consumed.length>0?{...l,...c.consumed[c.consumed.length-1].parameters}:l;return{matched:!0,consumedSegments:c.consumed,remainingSegments:n.slice(c.consumed.length),parameters:p,positionalParamSegments:c.posParams??{}}}function Wx(e,t,n,a){return n.length>0&&function aj(e,t,n){return n.some(a=>dw(e,t,a)&&ta(a)!==mt)}(e,n,a)?{segmentGroup:new un(t,sj(a,new un(n,e.children))),slicedSegments:[]}:0===n.length&&function cj(e,t,n){return n.some(a=>dw(e,t,a))}(e,n,a)?{segmentGroup:new un(e.segments,ij(e,0,n,a,e.children)),slicedSegments:n}:{segmentGroup:new un(e.segments,e.children),slicedSegments:n}}function ij(e,t,n,a,c){const l={};for(const p of a)if(dw(e,n,p)&&!c[ta(p)]){const g=new un([],{});l[ta(p)]=g}return{...c,...l}}function sj(e,t){const n={};n[mt]=t;for(const a of e)if(""===a.path&&ta(a)!==mt){const c=new un([],{});n[ta(a)]=c}return n}function dw(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}class hj{constructor(t,n,a,c,l,p,g){this.injector=t,this.configLoader=n,this.rootComponentType=a,this.config=c,this.urlTree=l,this.paramsInheritanceStrategy=p,this.urlSerializer=g,this.allowRedirects=!0,this.applyRedirects=new rj(this.urlSerializer,this.urlTree)}noMatchError(t){return new se(4002,!1)}recognize(){const t=Wx(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,mt).pipe(kd(n=>{if(n instanceof Hx)return this.allowRedirects=!1,this.urlTree=n.urlTree,this.match(n.urlTree);throw n instanceof uw?this.noMatchError(n):n}),Nt(n=>{const a=new iw([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},mt,this.rootComponentType,null,{}),c=new ou(a,n),l=new Nx("",c),p=function n2(e,t,n=null,a=null){return yx(vx(e),t,n,a)}(a,[],this.urlTree.queryParams,this.urlTree.fragment);return p.queryParams=this.urlTree.queryParams,l.url=this.urlSerializer.serialize(p),this.inheritParamsAndData(l._root),{state:l,tree:p}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t.root,mt).pipe(kd(a=>{throw a instanceof uw?this.noMatchError(a):a}))}inheritParamsAndData(t){const n=t.value,a=Ox(n,this.paramsInheritanceStrategy);n.params=Object.freeze(a.params),n.data=Object.freeze(a.data),t.children.forEach(c=>this.inheritParamsAndData(c))}processSegmentGroup(t,n,a,c){return 0===a.segments.length&&a.hasChildren()?this.processChildren(t,n,a):this.processSegment(t,n,a,a.segments,c,!0)}processChildren(t,n,a){const c=[];for(const l of Object.keys(a.children))"primary"===l?c.unshift(l):c.push(l);return er(c).pipe(fg(l=>{const p=a.children[l],g=function N2(e,t){const n=e.filter(a=>ta(a)===t);return n.push(...e.filter(a=>ta(a)!==t)),n}(n,l);return this.processSegmentGroup(t,g,p,l)}),function PF(e,t){return Zn(function NF(e,t,n,a,c){return(l,p)=>{let g=n,v=t,I=0;l.subscribe(gr(p,A=>{const O=I++;v=g?e(v,A,O):(g=!0,A),a&&p.next(v)},c&&(()=>{g&&p.next(v),p.complete()})))}}(e,t,arguments.length>=2,!0))}((l,p)=>(l.push(...p),l)),XD(null),function MF(e,t){const n=arguments.length>=2;return a=>a.pipe(e?ru((c,l)=>e(c,l,a)):Qr,MM(1),n?XD(t):sx(()=>new JD))}(),Pt(l=>{if(null===l)return yg(a);const p=Kx(l);return function pj(e){e.sort((t,n)=>t.value.outlet===mt?-1:n.value.outlet===mt?1:t.value.outlet.localeCompare(n.value.outlet))}(p),Ke(p)}))}processSegment(t,n,a,c,l,p){return er(n).pipe(fg(g=>this.processSegmentAgainstRoute(g._injector??t,n,g,a,c,l,p).pipe(kd(v=>{if(v instanceof uw)return Ke(null);throw v}))),Kh(g=>!!g),kd(g=>{if(jx(g))return function dj(e,t,n){return 0===t.length&&!e.children[n]}(a,c,l)?Ke([]):yg(a);throw g}))}processSegmentAgainstRoute(t,n,a,c,l,p,g){return function uj(e,t,n,a){return!!(ta(e)===a||a!==mt&&dw(t,n,e))&&("**"===e.path||JM(t,e,n).matched)}(a,c,l,p)?void 0===a.redirectTo?this.matchSegmentAgainstRoute(t,c,a,l,p,g):g&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,c,n,a,l,p):yg(c):yg(c)}expandSegmentAgainstRouteUsingRedirect(t,n,a,c,l,p){return"**"===c.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,a,c,p):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,a,c,l,p)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,a,c){const l=this.applyRedirects.applyRedirectCommands([],a.redirectTo,{});return a.redirectTo.startsWith("/")?Gx(l):this.applyRedirects.lineralizeSegments(a,l).pipe(Pt(p=>{const g=new un(p,{});return this.processSegment(t,n,g,p,c,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,a,c,l,p){const{matched:g,consumedSegments:v,remainingSegments:I,positionalParamSegments:A}=JM(n,c,l);if(!g)return yg(n);const O=this.applyRedirects.applyRedirectCommands(v,c.redirectTo,A);return c.redirectTo.startsWith("/")?Gx(O):this.applyRedirects.lineralizeSegments(c,O).pipe(Pt(F=>this.processSegment(t,a,n,F.concat(I),p,!1)))}matchSegmentAgainstRoute(t,n,a,c,l,p){let g;if("**"===a.path){const v=c.length>0?cx(c).parameters:{};g=Ke({snapshot:new iw(c,v,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,qx(a),ta(a),a.component??a._loadedComponent??null,a,$x(a)),consumedSegments:[],remainingSegments:[]}),n.children={}}else g=oj(n,a,c,t).pipe(Nt(({matched:v,consumedSegments:I,remainingSegments:A,parameters:O})=>v?{snapshot:new iw(I,O,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,qx(a),ta(a),a.component??a._loadedComponent??null,a,$x(a)),consumedSegments:I,remainingSegments:A}:null));return g.pipe(yi(v=>null===v?yg(n):this.getChildConfig(t=a._injector??t,a,c).pipe(yi(({routes:I})=>{const A=a._loadedInjector??t,{snapshot:O,consumedSegments:F,remainingSegments:j}=v,{segmentGroup:W,slicedSegments:$}=Wx(n,F,j,I);if(0===$.length&&W.hasChildren())return this.processChildren(A,I,W).pipe(Nt(ue=>null===ue?null:[new ou(O,ue)]));if(0===I.length&&0===$.length)return Ke([new ou(O,[])]);const Q=ta(a)===l;return this.processSegment(A,I,W,$,Q?mt:l,!0).pipe(Nt(ue=>[new ou(O,ue)]))}))))}getChildConfig(t,n,a){return n.children?Ke({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?Ke({routes:n._loadedRoutes,injector:n._loadedInjector}):function Z2(e,t,n,a){const c=t.canLoad;return void 0===c||0===c.length?Ke(!0):Ke(c.map(p=>{const g=Eg(p,e);return xd(function F2(e){return e&&YS(e.canLoad)}(g)?g.canLoad(t,n):e.runInContext(()=>g(t,n)))})).pipe(vg(),Bx())}(t,n,a).pipe(Pt(c=>c?this.configLoader.loadChildren(t,n).pipe(Yo(l=>{n._loadedRoutes=l.routes,n._loadedInjector=l.injector})):function nj(e){return hg(kx(!1,3))}())):Ke({routes:[],injector:t})}}function fj(e){const t=e.value.routeConfig;return t&&""===t.path}function Kx(e){const t=[],n=new Set;for(const a of e){if(!fj(a)){t.push(a);continue}const c=t.find(l=>a.value.routeConfig===l.value.routeConfig);void 0!==c?(c.children.push(...a.children),n.add(c)):t.push(a)}for(const a of n){const c=Kx(a.children);t.push(new ou(a.value,c))}return t.filter(a=>!n.has(a))}function qx(e){return e.data||{}}function $x(e){return e.resolve||{}}function zx(e){return"string"==typeof e.title||null===e.title}function XM(e){return yi(t=>{const n=e(t);return n?er(n).pipe(Nt(()=>t)):Ke(t)})}const Sg=new Se("ROUTES");let QM=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ve(Lm)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Ke(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const a=xd(n.loadComponent()).pipe(Nt(Yx),Yo(l=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=l}),kS(()=>{this.componentLoaders.delete(n)})),c=new ix(a,()=>new Os).pipe(PM());return this.componentLoaders.set(n,c),c}loadChildren(n,a){if(this.childrenLoaders.get(a))return this.childrenLoaders.get(a);if(a._loadedRoutes)return Ke({routes:a._loadedRoutes,injector:a._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(a);const l=this.loadModuleFactoryOrRoutes(a.loadChildren).pipe(Nt(g=>{this.onLoadEndListener&&this.onLoadEndListener(a);let v,I;return Array.isArray(g)?I=g:(v=g.create(n).injector,I=v.get(Sg,[],Pe.Self|Pe.Optional).flat()),{routes:I.map(zM),injector:v}}),kS(()=>{this.childrenLoaders.delete(a)})),p=new ix(l,()=>new Os).pipe(PM());return this.childrenLoaders.set(a,p),p}loadModuleFactoryOrRoutes(n){return xd(n()).pipe(Nt(Yx),Pt(a=>a instanceof eh||Array.isArray(a)?Ke(a):er(this.compiler.compileModuleAsync(a))))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Yx(e){return function Sj(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let lw=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Os,this.configLoader=ve(QM),this.environmentInjector=ve(cs),this.urlSerializer=ve(VS),this.rootContexts=ve(WS),this.inputBindingEnabled=null!==ve(sw,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Ke(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=c=>this.events.next(new m2(c)),this.configLoader.onLoadStartListener=c=>this.events.next(new f2(c))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const a=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:a})}setupNavigations(n){return this.transitions=new fo({id:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:HS,restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(ru(a=>0!==a.id),Nt(a=>({...a,extractedUrl:n.urlHandlingStrategy.extract(a.rawUrl)})),yi(a=>{let c=!1,l=!1;return Ke(a).pipe(Yo(p=>{this.currentNavigation={id:p.id,initialUrl:p.rawUrl,extractedUrl:p.extractedUrl,trigger:p.source,extras:p.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),yi(p=>{const g=n.browserUrlTree.toString(),v=!n.navigated||p.extractedUrl.toString()!==g||g!==n.currentUrlTree.toString();if(!v&&"reload"!==(p.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const A="";return this.events.next(new GS(p.id,n.serializeUrl(a.rawUrl),A,0)),n.rawUrlTree=p.rawUrl,p.resolve(null),zi}if(n.urlHandlingStrategy.shouldProcessUrl(p.rawUrl))return Jx(p.source)&&(n.browserUrlTree=p.extractedUrl),Ke(p).pipe(yi(A=>{const O=this.transitions?.getValue();return this.events.next(new FM(A.id,this.urlSerializer.serialize(A.extractedUrl),A.source,A.restoredState)),O!==this.transitions?.getValue()?zi:Promise.resolve(A)}),function mj(e,t,n,a,c,l){return Pt(p=>function lj(e,t,n,a,c,l,p="emptyOnly"){return new hj(e,t,n,a,c,p,l).recognize()}(e,t,n,a,p.extractedUrl,c,l).pipe(Nt(({state:g,tree:v})=>({...p,targetSnapshot:g,urlAfterRedirects:v}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),Yo(A=>{if(a.targetSnapshot=A.targetSnapshot,a.urlAfterRedirects=A.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:A.urlAfterRedirects},"eager"===n.urlUpdateStrategy){if(!A.extras.skipLocationChange){const F=n.urlHandlingStrategy.merge(A.urlAfterRedirects,A.rawUrl);n.setBrowserUrl(F,A)}n.browserUrlTree=A.urlAfterRedirects}const O=new u2(A.id,this.urlSerializer.serialize(A.extractedUrl),this.urlSerializer.serialize(A.urlAfterRedirects),A.targetSnapshot);this.events.next(O)}));if(v&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:A,extractedUrl:O,source:F,restoredState:j,extras:W}=p,$=new FM(A,this.urlSerializer.serialize(O),F,j);this.events.next($);const Q=wx(0,this.rootComponentType).snapshot;return Ke(a={...p,targetSnapshot:Q,urlAfterRedirects:O,extras:{...W,skipLocationChange:!1,replaceUrl:!1}})}{const A="";return this.events.next(new GS(p.id,n.serializeUrl(a.extractedUrl),A,1)),n.rawUrlTree=p.rawUrl,p.resolve(null),zi}}),Yo(p=>{const g=new d2(p.id,this.urlSerializer.serialize(p.extractedUrl),this.urlSerializer.serialize(p.urlAfterRedirects),p.targetSnapshot);this.events.next(g)}),Nt(p=>a={...p,guards:L2(p.targetSnapshot,p.currentSnapshot,this.rootContexts)}),function K2(e,t){return Pt(n=>{const{targetSnapshot:a,currentSnapshot:c,guards:{canActivateChecks:l,canDeactivateChecks:p}}=n;return 0===p.length&&0===l.length?Ke({...n,guardsResult:!0}):function q2(e,t,n,a){return er(e).pipe(Pt(c=>function Q2(e,t,n,a,c){const l=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return l&&0!==l.length?Ke(l.map(g=>{const v=qS(t)??c,I=Eg(g,v);return xd(function H2(e){return e&&YS(e.canDeactivate)}(I)?I.canDeactivate(e,t,n,a):v.runInContext(()=>I(e,t,n,a))).pipe(Kh())})).pipe(vg()):Ke(!0)}(c.component,c.route,n,t,a)),Kh(c=>!0!==c,!0))}(p,a,c,e).pipe(Pt(g=>g&&function V2(e){return"boolean"==typeof e}(g)?function $2(e,t,n,a){return er(t).pipe(fg(c=>NM(function Y2(e,t){return null!==e&&t&&t(new g2(e)),Ke(!0)}(c.route.parent,a),function z2(e,t){return null!==e&&t&&t(new E2(e)),Ke(!0)}(c.route,a),function X2(e,t,n){const a=t[t.length-1],l=t.slice(0,t.length-1).reverse().map(p=>function k2(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(p)).filter(p=>null!==p).map(p=>ox(()=>Ke(p.guards.map(v=>{const I=qS(p.node)??n,A=Eg(v,I);return xd(function B2(e){return e&&YS(e.canActivateChild)}(A)?A.canActivateChild(a,e):I.runInContext(()=>A(a,e))).pipe(Kh())})).pipe(vg())));return Ke(l).pipe(vg())}(e,c.path,n),function J2(e,t,n){const a=t.routeConfig?t.routeConfig.canActivate:null;if(!a||0===a.length)return Ke(!0);const c=a.map(l=>ox(()=>{const p=qS(t)??n,g=Eg(l,p);return xd(function j2(e){return e&&YS(e.canActivate)}(g)?g.canActivate(t,e):p.runInContext(()=>g(t,e))).pipe(Kh())}));return Ke(c).pipe(vg())}(e,c.route,n))),Kh(c=>!0!==c,!0))}(a,l,e,t):Ke(g)),Nt(g=>({...n,guardsResult:g})))})}(this.environmentInjector,p=>this.events.next(p)),Yo(p=>{if(a.guardsResult=p.guardsResult,$h(p.guardsResult))throw Lx(0,p.guardsResult);const g=new l2(p.id,this.urlSerializer.serialize(p.extractedUrl),this.urlSerializer.serialize(p.urlAfterRedirects),p.targetSnapshot,!!p.guardsResult);this.events.next(g)}),ru(p=>!!p.guardsResult||(n.restoreHistory(p),this.cancelNavigationTransition(p,"",3),!1)),XM(p=>{if(p.guards.canActivateChecks.length)return Ke(p).pipe(Yo(g=>{const v=new h2(g.id,this.urlSerializer.serialize(g.extractedUrl),this.urlSerializer.serialize(g.urlAfterRedirects),g.targetSnapshot);this.events.next(v)}),yi(g=>{let v=!1;return Ke(g).pipe(function gj(e,t){return Pt(n=>{const{targetSnapshot:a,guards:{canActivateChecks:c}}=n;if(!c.length)return Ke(n);let l=0;return er(c).pipe(fg(p=>function _j(e,t,n,a){const c=e.routeConfig,l=e._resolve;return void 0!==c?.title&&!zx(c)&&(l[xS]=c.title),function Ej(e,t,n,a){const c=function vj(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===c.length)return Ke({});const l={};return er(c).pipe(Pt(p=>function yj(e,t,n,a){const c=qS(t)??a,l=Eg(e,c);return xd(l.resolve?l.resolve(t,n):c.runInContext(()=>l(t,n)))}(e[p],t,n,a).pipe(Kh(),Yo(g=>{l[p]=g}))),MM(1),function LF(e){return Nt(()=>e)}(l),kd(p=>jx(p)?zi:hg(p)))}(l,e,t,a).pipe(Nt(p=>(e._resolvedData=p,e.data=Ox(e,n).resolve,c&&zx(c)&&(e.data[xS]=c.title),null)))}(p.route,a,e,t)),Yo(()=>l++),MM(1),Pt(p=>l===c.length?Ke(n):zi))})}(n.paramsInheritanceStrategy,this.environmentInjector),Yo({next:()=>v=!0,complete:()=>{v||(n.restoreHistory(g),this.cancelNavigationTransition(g,"",2))}}))}),Yo(g=>{const v=new p2(g.id,this.urlSerializer.serialize(g.extractedUrl),this.urlSerializer.serialize(g.urlAfterRedirects),g.targetSnapshot);this.events.next(v)}))}),XM(p=>{const g=v=>{const I=[];v.routeConfig?.loadComponent&&!v.routeConfig._loadedComponent&&I.push(this.configLoader.loadComponent(v.routeConfig).pipe(Yo(A=>{v.component=A}),Nt(()=>{})));for(const A of v.children)I.push(...g(A));return I};return OM(g(p.targetSnapshot.root)).pipe(XD(),pg(1))}),XM(()=>this.afterPreactivation()),Nt(p=>{const g=function I2(e,t,n){const a=KS(e,t._root,n?n._root:void 0);return new Dx(a,t)}(n.routeReuseStrategy,p.targetSnapshot,p.currentRouterState);return a={...p,targetRouterState:g}}),Yo(p=>{n.currentUrlTree=p.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(p.urlAfterRedirects,p.rawUrl),n.routerState=p.targetRouterState,"deferred"===n.urlUpdateStrategy&&(p.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,p),n.browserUrlTree=p.urlAfterRedirects)}),((e,t,n,a)=>Nt(c=>(new M2(t,c.targetRouterState,c.currentRouterState,n,a).activate(e),c)))(this.rootContexts,n.routeReuseStrategy,p=>this.events.next(p),this.inputBindingEnabled),pg(1),Yo({next:p=>{c=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new zh(p.id,this.urlSerializer.serialize(p.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(p.targetRouterState.snapshot),p.resolve(!0)},complete:()=>{c=!0}}),kS(()=>{c||l||this.cancelNavigationTransition(a,"",1),this.currentNavigation?.id===a.id&&(this.currentNavigation=null)}),kd(p=>{if(l=!0,Ux(p)){xx(p)||(n.navigated=!0,n.restoreHistory(a,!0));const g=new ow(a.id,this.urlSerializer.serialize(a.extractedUrl),p.message,p.cancellationCode);if(this.events.next(g),xx(p)){const v=n.urlHandlingStrategy.merge(p.url,n.rawUrlTree),I={skipLocationChange:a.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||Jx(a.source)};n.scheduleNavigation(v,HS,null,I,{resolve:a.resolve,reject:a.reject,promise:a.promise})}else a.resolve(!1)}else{n.restoreHistory(a,!0);const g=new jM(a.id,this.urlSerializer.serialize(a.extractedUrl),p,a.targetSnapshot??void 0);this.events.next(g);try{a.resolve(n.errorHandler(p))}catch(v){a.reject(v)}}return zi}))}))}cancelNavigationTransition(n,a,c){const l=new ow(n.id,this.urlSerializer.serialize(n.extractedUrl),a,c);this.events.next(l),n.resolve(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Jx(e){return e!==HS}let Xx=(()=>{class e{buildTitle(n){let a,c=n.root;for(;void 0!==c;)a=this.getResolvedTitleForRoute(c)??a,c=c.children.find(l=>l.outlet===mt);return a}getResolvedTitleForRoute(n){return n.data[xS]}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:function(){return ve(Tj)},providedIn:"root"}),e})(),Tj=(()=>{class e extends Xx{constructor(n){super(),this.title=n}updateTitle(n){const a=this.buildTitle(n);void 0!==a&&this.title.setTitle(a)}}return e.\u0275fac=function(n){return new(n||e)(Ne(Kk))},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Cj=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:function(){return ve(Rj)},providedIn:"root"}),e})();class Ij{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let Rj=(()=>{class e extends Ij{}return e.\u0275fac=function(){let t;return function(a){return(t||(t=Er(e)))(a||e)}}(),e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const hw=new Se("",{providedIn:"root",factory:()=>({})});let bj=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:function(){return ve(Aj)},providedIn:"root"}),e})(),Aj=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,a){return n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Ki=(()=>((Ki=Ki||{})[Ki.COMPLETE=0]="COMPLETE",Ki[Ki.FAILED=1]="FAILED",Ki[Ki.REDIRECTING=2]="REDIRECTING",Ki))();function Qx(e,t){e.events.pipe(ru(n=>n instanceof zh||n instanceof ow||n instanceof jM||n instanceof GS),Nt(n=>n instanceof zh||n instanceof GS?Ki.COMPLETE:n instanceof ow&&(0===n.code||1===n.code)?Ki.REDIRECTING:Ki.FAILED),ru(n=>n!==Ki.REDIRECTING),pg(1)).subscribe(()=>{t()})}function Dj(e){throw e}function wj(e,t,n){return t.parse("/")}const Oj={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Nj={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Jo=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=ve(CA),this.isNgZoneEnabled=!1,this.options=ve(hw,{optional:!0})||{},this.pendingTasks=ve(Id),this.errorHandler=this.options.errorHandler||Dj,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||wj,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=ve(bj),this.routeReuseStrategy=ve(Cj),this.titleStrategy=ve(Xx),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=ve(Sg,{optional:!0})?.flat()??[],this.navigationTransitions=ve(lw),this.urlSerializer=ve(VS),this.location=ve(ng),this.componentInputBindingEnabled=!!ve(sw,{optional:!0}),this.isNgZoneEnabled=ve(In)instanceof In&&In.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new gg,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=wx(0,null),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId??0},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const n=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),HS,n)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const a="popstate"===n.type?"popstate":"hashchange";"popstate"===a&&setTimeout(()=>{this.navigateToSyncWithBrowser(n.url,a,n.state)},0)}))}navigateToSyncWithBrowser(n,a,c){const l={replaceUrl:!0},p=c?.navigationId?c:null;if(c){const v={...c};delete v.navigationId,delete v.\u0275routerPageId,0!==Object.keys(v).length&&(l.state=v)}const g=this.parseUrl(n);this.scheduleNavigation(g,a,p,l)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(zM),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,a={}){const{relativeTo:c,queryParams:l,fragment:p,queryParamsHandling:g,preserveFragment:v}=a,I=v?this.currentUrlTree.fragment:p;let O,A=null;switch(g){case"merge":A={...this.currentUrlTree.queryParams,...l};break;case"preserve":A=this.currentUrlTree.queryParams;break;default:A=l||null}null!==A&&(A=this.removeEmptyProps(A));try{O=vx(c?c.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||!n[0].startsWith("/"))&&(n=[]),O=this.currentUrlTree.root}return yx(O,n,A,I??null)}navigateByUrl(n,a={skipLocationChange:!1}){const c=$h(n)?n:this.parseUrl(n),l=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(l,HS,null,a)}navigate(n,a={skipLocationChange:!1}){return function Pj(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new se(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,a),a)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let a;try{a=this.urlSerializer.parse(n)}catch(c){a=this.malformedUriErrorHandler(c,this.urlSerializer,n)}return a}isActive(n,a){let c;if(c=!0===a?{...Oj}:!1===a?{...Nj}:a,$h(n))return dx(this.currentUrlTree,n,c);const l=this.parseUrl(n);return dx(this.currentUrlTree,l,c)}removeEmptyProps(n){return Object.keys(n).reduce((a,c)=>{const l=n[c];return null!=l&&(a[c]=l),a},{})}scheduleNavigation(n,a,c,l,p){if(this.disposed)return Promise.resolve(!1);let g,v,I;p?(g=p.resolve,v=p.reject,I=p.promise):I=new Promise((O,F)=>{g=O,v=F});const A=this.pendingTasks.add();return Qx(this,()=>{Promise.resolve().then(()=>this.pendingTasks.remove(A))}),this.navigationTransitions.handleNavigationRequest({source:a,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:l,resolve:g,reject:v,promise:I,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),I.catch(O=>Promise.reject(O))}setBrowserUrl(n,a){const c=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(c)||a.extras.replaceUrl){const p={...a.extras.state,...this.generateNgRouterState(a.id,this.browserPageId)};this.location.replaceState(c,"",p)}else{const l={...a.extras.state,...this.generateNgRouterState(a.id,(this.browserPageId??0)+1)};this.location.go(c,"",l)}}restoreHistory(n,a=!1){if("computed"===this.canceledNavigationResolution){const l=this.currentPageId-(this.browserPageId??this.currentPageId);0!==l?this.location.historyGo(l):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===l&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(a&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,a){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:a}:{navigationId:n}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class Zx{}let kj=(()=>{class e{constructor(n,a,c,l,p){this.router=n,this.injector=c,this.preloadingStrategy=l,this.loader=p}setUpPreloading(){this.subscription=this.router.events.pipe(ru(n=>n instanceof zh),fg(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,a){const c=[];for(const l of a){l.providers&&!l._injector&&(l._injector=Em(l.providers,n,`Route: ${l.path}`));const p=l._injector??n,g=l._loadedInjector??p;(l.loadChildren&&!l._loadedRoutes&&void 0===l.canLoad||l.loadComponent&&!l._loadedComponent)&&c.push(this.preloadConfig(p,l)),(l.children||l._loadedRoutes)&&c.push(this.processRoutes(g,l.children??l._loadedRoutes))}return er(c).pipe(cu())}preloadConfig(n,a){return this.preloadingStrategy.preload(a,()=>{let c;c=a.loadChildren&&void 0===a.canLoad?this.loader.loadChildren(n,a):Ke(null);const l=c.pipe(Pt(p=>null===p?Ke(void 0):(a._loadedRoutes=p.routes,a._loadedInjector=p.injector,this.processRoutes(p.injector??n,p.routes))));return a.loadComponent&&!a._loadedComponent?er([l,this.loader.loadComponent(a)]).pipe(cu()):l})}}return e.\u0275fac=function(n){return new(n||e)(Ne(Jo),Ne(Lm),Ne(cs),Ne(Zx),Ne(QM))},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const eL=new Se("");let eU=(()=>{class e{constructor(n,a,c,l,p={}){this.urlSerializer=n,this.transitions=a,this.viewportScroller=c,this.zone=l,this.options=p,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},p.scrollPositionRestoration=p.scrollPositionRestoration||"disabled",p.anchorScrolling=p.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof FM?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof zh?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof GS&&0===n.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof bx&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,a){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new bx(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,a))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return e.\u0275fac=function(n){!function L(){throw new Error("invalid")}()},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();function iu(e,t){return{\u0275kind:e,\u0275providers:t}}function nU(){const e=ve(Fo);return t=>{const n=e.get(Xc);if(t!==n.components[0])return;const a=e.get(Jo),c=e.get(rU);1===e.get(tL)&&a.initialNavigation(),e.get(oU,null,Pe.Optional)?.setUpPreloading(),e.get(eL,null,Pe.Optional)?.init(),a.resetRootComponentType(n.componentTypes[0]),c.closed||(c.next(),c.complete(),c.unsubscribe())}}const rU=new Se("",{factory:()=>new Os}),tL=new Se("",{providedIn:"root",factory:()=>1}),oU=new Se("");function Fj(e){return iu(0,[{provide:oU,useExisting:kj},{provide:Zx,useExisting:e}])}const iU=new Se("ROUTER_FORROOT_GUARD"),Bj=[ng,{provide:VS,useClass:LM},Jo,WS,{provide:Yh,useFactory:function tU(e){return e.routerState.root},deps:[Jo]},QM,[]];function Hj(){return new bd("Router",Jo)}let sU=(()=>{class e{constructor(n){}static forRoot(n,a){return{ngModule:e,providers:[Bj,[],{provide:Sg,multi:!0,useValue:n},{provide:iU,useFactory:qj,deps:[[Jo,new pl,new Nu]]},{provide:hw,useValue:a||{}},a?.useHash?{provide:Ar,useClass:ja}:{provide:Ar,useClass:ES},{provide:eL,useFactory:()=>{const e=ve(Od),t=ve(In),n=ve(hw),a=ve(lw),c=ve(VS);return n.scrollOffset&&e.setOffset(n.scrollOffset),new eU(c,a,e,t,n)}},a?.preloadingStrategy?Fj(a.preloadingStrategy).\u0275providers:[],{provide:bd,multi:!0,useFactory:Hj},a?.initialNavigation?$j(a):[],a?.bindToComponentInputs?iu(8,[Mx,{provide:sw,useExisting:Mx}]).\u0275providers:[],[{provide:aU,useFactory:nU},{provide:Is,multi:!0,useExisting:aU}]]}}static forChild(n){return{ngModule:e,providers:[{provide:Sg,multi:!0,useValue:n}]}}}return e.\u0275fac=function(n){return new(n||e)(Ne(iU,8))},e.\u0275mod=ni({type:e}),e.\u0275inj=jr({}),e})();function qj(e){return"guarded"}function $j(e){return["disabled"===e.initialNavigation?iu(3,[{provide:Un,multi:!0,useFactory:()=>{const t=ve(Jo);return()=>{t.setUpLocationChangeListener()}}},{provide:tL,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?iu(2,[{provide:tL,useValue:0},{provide:Un,multi:!0,deps:[Fo],useFactory:t=>{const n=t.get(Oo,Promise.resolve());return()=>n.then(()=>new Promise(a=>{const c=t.get(Jo),l=t.get(rU);Qx(c,()=>{a(!0)}),t.get(lw).afterPreactivation=()=>(a(!0),l.closed?Ke(void 0):l),c.initialNavigation()}))}}]).\u0275providers:[]]}const aU=new Se("");class pw{}class fw{}class qa{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?"string"==typeof t?this.lazyInit=()=>{this.headers=new Map,t.split("\n").forEach(n=>{const a=n.indexOf(":");if(a>0){const c=n.slice(0,a),l=c.toLowerCase(),p=n.slice(a+1).trim();this.maybeSetNormalizedName(c,l),this.headers.has(l)?this.headers.get(l).push(p):this.headers.set(l,[p])}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((n,a)=>{this.setHeaderEntries(a,n)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([n,a])=>{this.setHeaderEntries(n,a)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof qa?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new qa;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof qa?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let a=t.value;if("string"==typeof a&&(a=[a]),0===a.length)return;this.maybeSetNormalizedName(t.name,n);const c=("a"===t.op?this.headers.get(n):void 0)||[];c.push(...a),this.headers.set(n,c);break;case"d":const l=t.value;if(l){let p=this.headers.get(n);if(!p)return;p=p.filter(g=>-1===l.indexOf(g)),0===p.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,p)}else this.headers.delete(n),this.normalizedNames.delete(n)}}setHeaderEntries(t,n){const a=(Array.isArray(n)?n:[n]).map(l=>l.toString()),c=t.toLowerCase();this.headers.set(c,a),this.maybeSetNormalizedName(t,c)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class Jj{encodeKey(t){return cU(t)}encodeValue(t){return cU(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const Qj=/%(\d[a-f0-9])/gi,Zj={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function cU(e){return encodeURIComponent(e).replace(Qj,(t,n)=>Zj[n]??t)}function mw(e){return`${e}`}class Ud{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new Jj,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Xj(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(c=>{const l=c.indexOf("="),[p,g]=-1==l?[t.decodeKey(c),""]:[t.decodeKey(c.slice(0,l)),t.decodeValue(c.slice(l+1))],v=n.get(p)||[];v.push(g),n.set(p,v)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const a=t.fromObject[n],c=Array.isArray(a)?a.map(mw):[mw(a)];this.map.set(n,c)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(a=>{const c=t[a];Array.isArray(c)?c.forEach(l=>{n.push({param:a,value:l,op:"a"})}):n.push({param:a,value:c,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(a=>n+"="+this.encoder.encodeValue(a)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new Ud({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(mw(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let a=this.map.get(t.param)||[];const c=a.indexOf(mw(t.value));-1!==c&&a.splice(c,1),a.length>0?this.map.set(t.param,a):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class eB{constructor(){this.map=new Map}set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function uU(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function dU(e){return typeof Blob<"u"&&e instanceof Blob}function lU(e){return typeof FormData<"u"&&e instanceof FormData}class JS{constructor(t,n,a,c){let l;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function tB(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||c?(this.body=void 0!==a?a:null,l=c):l=a,l&&(this.reportProgress=!!l.reportProgress,this.withCredentials=!!l.withCredentials,l.responseType&&(this.responseType=l.responseType),l.headers&&(this.headers=l.headers),l.context&&(this.context=l.context),l.params&&(this.params=l.params)),this.headers||(this.headers=new qa),this.context||(this.context=new eB),this.params){const p=this.params.toString();if(0===p.length)this.urlWithParams=n;else{const g=n.indexOf("?");this.urlWithParams=n+(-1===g?"?":g<n.length-1?"&":"")+p}}else this.params=new Ud,this.urlWithParams=n}serializeBody(){return null===this.body?null:uU(this.body)||dU(this.body)||lU(this.body)||function nB(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Ud?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||lU(this.body)?null:dU(this.body)?this.body.type||null:uU(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Ud?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const n=t.method||this.method,a=t.url||this.url,c=t.responseType||this.responseType,l=void 0!==t.body?t.body:this.body,p=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,g=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let v=t.headers||this.headers,I=t.params||this.params;const A=t.context??this.context;return void 0!==t.setHeaders&&(v=Object.keys(t.setHeaders).reduce((O,F)=>O.set(F,t.setHeaders[F]),v)),t.setParams&&(I=Object.keys(t.setParams).reduce((O,F)=>O.set(F,t.setParams[F]),I)),new JS(n,a,l,{params:I,headers:v,context:A,reportProgress:g,responseType:c,withCredentials:p})}}var Dr=(()=>((Dr=Dr||{})[Dr.Sent=0]="Sent",Dr[Dr.UploadProgress=1]="UploadProgress",Dr[Dr.ResponseHeader=2]="ResponseHeader",Dr[Dr.DownloadProgress=3]="DownloadProgress",Dr[Dr.Response=4]="Response",Dr[Dr.User=5]="User",Dr))();class nL{constructor(t,n=200,a="OK"){this.headers=t.headers||new qa,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||a,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class rL extends nL{constructor(t={}){super(t),this.type=Dr.ResponseHeader}clone(t={}){return new rL({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Tg extends nL{constructor(t={}){super(t),this.type=Dr.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Tg({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class hU extends nL{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function oL(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let pU=(()=>{class e{constructor(n){this.handler=n}request(n,a,c={}){let l;if(n instanceof JS)l=n;else{let v,I;v=c.headers instanceof qa?c.headers:new qa(c.headers),c.params&&(I=c.params instanceof Ud?c.params:new Ud({fromObject:c.params})),l=new JS(n,a,void 0!==c.body?c.body:null,{headers:v,context:c.context,params:I,reportProgress:c.reportProgress,responseType:c.responseType||"json",withCredentials:c.withCredentials})}const p=Ke(l).pipe(fg(v=>this.handler.handle(v)));if(n instanceof JS||"events"===c.observe)return p;const g=p.pipe(ru(v=>v instanceof Tg));switch(c.observe||"body"){case"body":switch(l.responseType){case"arraybuffer":return g.pipe(Nt(v=>{if(null!==v.body&&!(v.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return v.body}));case"blob":return g.pipe(Nt(v=>{if(null!==v.body&&!(v.body instanceof Blob))throw new Error("Response is not a Blob.");return v.body}));case"text":return g.pipe(Nt(v=>{if(null!==v.body&&"string"!=typeof v.body)throw new Error("Response is not a string.");return v.body}));default:return g.pipe(Nt(v=>v.body))}case"response":return g;default:throw new Error(`Unreachable: unhandled observe type ${c.observe}}`)}}delete(n,a={}){return this.request("DELETE",n,a)}get(n,a={}){return this.request("GET",n,a)}head(n,a={}){return this.request("HEAD",n,a)}jsonp(n,a){return this.request("JSONP",n,{params:(new Ud).append(a,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,a={}){return this.request("OPTIONS",n,a)}patch(n,a,c={}){return this.request("PATCH",n,oL(c,a))}post(n,a,c={}){return this.request("POST",n,oL(c,a))}put(n,a,c={}){return this.request("PUT",n,oL(c,a))}}return e.\u0275fac=function(n){return new(n||e)(Ne(pw))},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();function gU(e,t){return t(e)}function oB(e,t){return(n,a)=>t.intercept(n,{handle:c=>e(c,a)})}const sB=new Se(""),XS=new Se(""),_U=new Se("");function aB(){let e=null;return(t,n)=>{null===e&&(e=(ve(sB,{optional:!0})??[]).reduceRight(oB,gU));const a=ve(Id),c=a.add();return e(t,n).pipe(kS(()=>a.remove(c)))}}let EU=(()=>{class e extends pw{constructor(n,a){super(),this.backend=n,this.injector=a,this.chain=null,this.pendingTasks=ve(Id)}handle(n){if(null===this.chain){const c=Array.from(new Set([...this.injector.get(XS),...this.injector.get(_U,[])]));this.chain=c.reduceRight((l,p)=>function iB(e,t,n){return(a,c)=>n.runInContext(()=>t(a,l=>e(l,c)))}(l,p,this.injector),gU)}const a=this.pendingTasks.add();return this.chain(n,c=>this.backend.handle(c)).pipe(kS(()=>this.pendingTasks.remove(a)))}}return e.\u0275fac=function(n){return new(n||e)(Ne(fw),Ne(cs))},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();const lB=/^\)\]\}',?\n/;let yU=(()=>{class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new se(-2800,!1);const a=this.xhrFactory;return(a.\u0275loadImpl?er(a.\u0275loadImpl()):Ke(null)).pipe(yi(()=>new Ln(l=>{const p=a.build();if(p.open(n.method,n.urlWithParams),n.withCredentials&&(p.withCredentials=!0),n.headers.forEach(($,Q)=>p.setRequestHeader($,Q.join(","))),n.headers.has("Accept")||p.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const $=n.detectContentTypeHeader();null!==$&&p.setRequestHeader("Content-Type",$)}if(n.responseType){const $=n.responseType.toLowerCase();p.responseType="json"!==$?$:"text"}const g=n.serializeBody();let v=null;const I=()=>{if(null!==v)return v;const $=p.statusText||"OK",Q=new qa(p.getAllResponseHeaders()),ue=function hB(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(p)||n.url;return v=new rL({headers:Q,status:p.status,statusText:$,url:ue}),v},A=()=>{let{headers:$,status:Q,statusText:ue,url:J}=I(),Te=null;204!==Q&&(Te=typeof p.response>"u"?p.responseText:p.response),0===Q&&(Q=Te?200:0);let $e=Q>=200&&Q<300;if("json"===n.responseType&&"string"==typeof Te){const rt=Te;Te=Te.replace(lB,"");try{Te=""!==Te?JSON.parse(Te):null}catch(Vr){Te=rt,$e&&($e=!1,Te={error:Vr,text:Te})}}$e?(l.next(new Tg({body:Te,headers:$,status:Q,statusText:ue,url:J||void 0})),l.complete()):l.error(new hU({error:Te,headers:$,status:Q,statusText:ue,url:J||void 0}))},O=$=>{const{url:Q}=I(),ue=new hU({error:$,status:p.status||0,statusText:p.statusText||"Unknown Error",url:Q||void 0});l.error(ue)};let F=!1;const j=$=>{F||(l.next(I()),F=!0);let Q={type:Dr.DownloadProgress,loaded:$.loaded};$.lengthComputable&&(Q.total=$.total),"text"===n.responseType&&p.responseText&&(Q.partialText=p.responseText),l.next(Q)},W=$=>{let Q={type:Dr.UploadProgress,loaded:$.loaded};$.lengthComputable&&(Q.total=$.total),l.next(Q)};return p.addEventListener("load",A),p.addEventListener("error",O),p.addEventListener("timeout",O),p.addEventListener("abort",O),n.reportProgress&&(p.addEventListener("progress",j),null!==g&&p.upload&&p.upload.addEventListener("progress",W)),p.send(g),l.next({type:Dr.Sent}),()=>{p.removeEventListener("error",O),p.removeEventListener("abort",O),p.removeEventListener("load",A),p.removeEventListener("timeout",O),n.reportProgress&&(p.removeEventListener("progress",j),null!==g&&p.upload&&p.upload.removeEventListener("progress",W)),p.readyState!==p.DONE&&p.abort()}})))}}return e.\u0275fac=function(n){return new(n||e)(Ne(Gi))},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();const iL=new Se("XSRF_ENABLED"),SU=new Se("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),TU=new Se("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class CU{}let mB=(()=>{class e{constructor(n,a,c){this.doc=n,this.platform=a,this.cookieName=c,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=ND(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return e.\u0275fac=function(n){return new(n||e)(Ne(zr),Ne(Bs),Ne(SU))},e.\u0275prov=Le({token:e,factory:e.\u0275fac}),e})();function gB(e,t){const n=e.url.toLowerCase();if(!ve(iL)||"GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t(e);const a=ve(CU).getToken(),c=ve(TU);return null!=a&&!e.headers.has(c)&&(e=e.clone({headers:e.headers.set(c,a)})),t(e)}var Vn=(()=>((Vn=Vn||{})[Vn.Interceptors=0]="Interceptors",Vn[Vn.LegacyInterceptors=1]="LegacyInterceptors",Vn[Vn.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",Vn[Vn.NoXsrfProtection=3]="NoXsrfProtection",Vn[Vn.JsonpSupport=4]="JsonpSupport",Vn[Vn.RequestsMadeViaParent=5]="RequestsMadeViaParent",Vn[Vn.Fetch=6]="Fetch",Vn))();function Jh(e,t){return{\u0275kind:e,\u0275providers:t}}function _B(...e){const t=[pU,yU,EU,{provide:pw,useExisting:EU},{provide:fw,useExisting:yU},{provide:XS,useValue:gB,multi:!0},{provide:iL,useValue:!0},{provide:CU,useClass:mB}];for(const n of e)t.push(...n.\u0275providers);return function or(e){return{\u0275providers:e}}(t)}const IU=new Se("LEGACY_INTERCEPTOR_FN");let vB=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ni({type:e}),e.\u0275inj=jr({providers:[_B(Jh(Vn.LegacyInterceptors,[{provide:IU,useFactory:aB},{provide:XS,useExisting:IU,multi:!0}]))]}),e})(),sL=(()=>{class e{constructor(n,a){this.http=n,this.router=a,this.token="",this.usersMap=[],this.uri="https://video-call-backend.onrender.com/access_token/rtc/?channelName="}onGetToken(n){return console.log("ongettoken called"),this.http.get(this.uri+n).pipe(kd(this.handleError))}handleError(n){let a="";return n.error instanceof ErrorEvent?a=n.error.message:(a=`Error Code: ${n.status}\nMessage: `,console.log(n.error.message)),hg(()=>new Error(n.error.message))}removeLocalToken(){sessionStorage.removeItem("rtc-token"),this.router.navigate(["/home"])}}return e.\u0275fac=function(n){return new(n||e)(Ne(pU),Ne(Jo))},e.\u0275prov=Le({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function RB(e,t){if(1&e){const n=function vR(){return re()}();At(0,"form",1),Mr("submit",function(c){return function Vp(e){return xe.lFrame.contextLView=e,e[Bn]}(n),function rC(e){return xe.lFrame.contextLView=null,e}(yv().submitForm(c))}),di(1,"input",2)(2,"input",3),qs()}if(2&e){const n=yv();us(1),Vc("formControl",n.channelName)}}let bB=(()=>{class e{constructor(n,a){this.token=n,this.router=a,this.channelName=new SM("",LV.required),this.tokenVal="",this.submitForm=c=>{c.preventDefault(),console.log(this.channelName.value),this.TokenSubscription=this.token.onGetToken(this.channelName.value).subscribe(l=>{sessionStorage.setItem("rtc-token",l.rtctoken),this.tokenVal=sessionStorage.getItem("rtc-token"),console.log(l.token),this.router.navigate([`/video-call/${this.channelName.value}`])})}}ngOnDestroy(){this.TokenSubscription?.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)(D(sL),D(Jo))},e.\u0275cmp=Ya({type:e,selectors:[["app-main"]],decls:2,vars:2,consts:[[3,"submit",4,"ngIf"],[3,"submit"],["type","text",3,"formControl"],["type","submit","value","Join Call"]],template:function(n,a){1&n&&(function Pr(e,t,n,a,c,l,p,g){const v=re(),I=bt(),A=e+It,O=I.firstCreatePass?function ur(e,t,n,a,c,l,p,g,v){const I=t.consts,A=to(t,e,4,p||null,oi(I,g));ke(t,n,A,oi(I,v)),Bp(t,A);const O=A.tView=no(2,A,a,c,l,t.directiveRegistry,t.pipeRegistry,null,t.schemas,I,null);return null!==t.queries&&(t.queries.template(t,A),O.queries=t.queries.embeddedTView(A)),A}(A,I,v,t,n,a,c,l,p):I.data[A];rs(O,!1);const F=oo(I,v,O,e);jp()&&mf(I,v,F,O),Rr(F,v),Gf(v,v[A]=Hf(F,v,F,O)),Rp(O)&&Rc(I,v,O),null!=p&&R(v,O,g)}(0,RB,3,1,"form",0),pe(1)),2&n&&(Vc("ngIf",!a.tokenVal),us(1),Mn("\n",a.tokenVal,"\n"))},dependencies:[_n,V1,FD,C1,I1,YD,CM]}),e})();function RU(e,t,n,a,c,l,p){try{var g=e[l](p),v=g.value}catch(I){return void n(I)}g.done?t(v):Promise.resolve(v).then(a,c)}function Cg(e){return function(){var t=this,n=arguments;return new Promise(function(a,c){var l=e.apply(t,n);function p(v){RU(l,a,c,p,g,"next",v)}function g(v){RU(l,a,c,p,g,"throw",v)}p(void 0)})}}var AB=Vd(291),QS=Vd.n(AB);const DB=["localVideoContainer"],wB=["remoteVideoContainer"],OB=[{path:"home",component:bB},{path:"video-call/:channel",component:(()=>{class e{constructor(n,a){var c=this;this.route=n,this.token=a,this.channelName="",this.channelParams={localAudioTrack:void 0,localVideoTrack:void 0,remoteAudioTrack:void 0,remoteVideoTrack:void 0,uid:void 0,remoteUid:void 0},this.localStreamState={audio:!0,video:!0},this.remoteStreamState={audio:!0,video:!0},this.options={appId:"494af307ab284247920739893e3f627c",channel:""},this.handleUserPublished=function(){var l=Cg(function*(p,g){yield c.agoraEngine?.subscribe(p,g),console.log("subscribe success"),"video"==g&&(c.channelParams.remoteVideoTrack=p.videoTrack,c.channelParams.remoteAudioTrack=p.audioTrack,c.channelParams.remoteUid=p.uid.toString(),c.remoteVideo.id=p.uid.toString(),c.channelParams.remoteUid=p.uid.toString(),c.remoteVideo.classList.add("video-div"),c.channelParams.remoteVideoTrack?.play(c.remoteVideo)),"audio"==g&&(c.channelParams.remoteAudioTrack=p.audioTrack,c.channelParams.remoteAudioTrack?.play())});return function(p,g){return l.apply(this,arguments)}}(),this.handleUserUnpublished=function(){var l=Cg(function*(p,g){"audio"===g?(c.channelParams.remoteAudioTrack?.stop(),c.channelParams.remoteAudioTrack=void 0,c.agoraEngine.unsubscribe(p,"audio")):"video"===g&&(c.channelParams.remoteVideoTrack?.stop(),c.channelParams.remoteVideoTrack=void 0,c.remoteVideo.innerHTML="",c.remoteVideo.classList.add("remote-video-stopped"),c.agoraEngine.unsubscribe(p,"video")),c.channelParams.remoteUid=void 0});return function(p,g){return l.apply(this,arguments)}}(),this.handleUserLeft=Cg(function*(){c.remoteVideo.remove()}),this.handleJoin=Cg(function*(){console.log("handle join called"),yield c.agoraEngine.join(c.options.appId,c.options.channel,sessionStorage.getItem("rtc-token"),null).then(l=>{c.channelParams.uid=l}),c.channelParams.localAudioTrack=yield QS().createMicrophoneAudioTrack(),c.channelParams.localVideoTrack=yield QS().createCameraVideoTrack(),yield c.agoraEngine.publish([c.channelParams.localAudioTrack,c.channelParams.localVideoTrack]),c.localVideo.classList.add("video-div"),c.localVideo.id=c.channelParams.uid,c.channelParams.localVideoTrack.play(c.localVideo),console.log("publish success!")}),this.handleLeave=Cg(function*(){c.channelParams.localAudioTrack?.close(),c.channelParams.localVideoTrack?.close(),c.token.removeLocalToken(),c.remoteVideo.remove()}),this.mute=function(){var l=Cg(function*(p){console.log("mute-called"),console.log(c.agoraEngine.remoteUsers),c.agoraEngine.getLocalAudioStats(),c.agoraEngine.getLocalVideoStats(),"audio"===p?(c.localStreamState.audio?(c.channelParams.localAudioTrack?.stop(),c.channelParams.localAudioTrack?.close(),yield c.agoraEngine.unpublish(c.channelParams.localAudioTrack)):(c.channelParams.localAudioTrack=yield QS().createMicrophoneAudioTrack(),yield c.agoraEngine.publish([c.channelParams.localAudioTrack]),c.channelParams.localAudioTrack?.play()),c.localStreamState.audio=!c.localStreamState.audio):(p="video")&&(c.localStreamState.video?(c.channelParams.localVideoTrack?.stop(),c.channelParams.localVideoTrack?.close(),c.agoraEngine.unpublish(c.channelParams.localVideoTrack),c.localVideo.classList.add("remote-video-stopped")):(c.channelParams.localVideoTrack=yield QS().createCameraVideoTrack(),yield c.agoraEngine.publish([c.channelParams.localVideoTrack]),c.channelParams.localVideoTrack?.play(c.localVideo)),c.localStreamState.video=!c.localStreamState.video)});return function(p){return l.apply(this,arguments)}}()}ngOnInit(){this.route.params.subscribe(n=>{this.options.channel=n.channel}),this.agoraEngine=QS().createClient({mode:"rtc",codec:"vp8"})}ngAfterViewInit(){this.localVideo=this.localVideoRef?.nativeElement,this.remoteVideo=this.remoteVideoRef?.nativeElement,this.handleJoin(),this.agoraEngine.on("user-published",this.handleUserPublished),this.agoraEngine.on("user-unpublished",this.handleUserUnpublished),this.agoraEngine.on("user-left",this.handleUserLeft)}ngOnDestroy(){this.agoraEngine.removeAllListeners()}}return e.\u0275fac=function(n){return new(n||e)(D(Yh),D(sL))},e.\u0275cmp=Ya({type:e,selectors:[["app-video-call"]],viewQuery:function(n,a){if(1&n&&(wm(DB,5),wm(wB,5)),2&n){let c;ih(c=sh())&&(a.localVideoRef=c.first),ih(c=sh())&&(a.remoteVideoRef=c.first)}},decls:18,vars:2,consts:[[1,"video-wrapper"],["videoWrapper",""],[1,"video-player"],["localVideoContainer",""],["remoteVideoContainer",""],[1,"controls"],[1,"spacer"],["type","button","id","leave-btn",3,"click"],[1,"material-symbols-outlined"],[3,"click"]],template:function(n,a){1&n&&(At(0,"div",0,1),di(2,"div",2,3)(4,"div",2,4),qs(),At(6,"div",5),di(7,"span",6),At(8,"button",7),Mr("click",function(){return a.handleLeave()}),At(9,"span",8),pe(10," exit_to_app "),qs()(),At(11,"button",9),Mr("click",function(){return a.mute("audio")}),At(12,"span",8),pe(13),qs()(),At(14,"button",9),Mr("click",function(){return a.mute("video")}),At(15,"span",8),pe(16),qs()(),di(17,"span",6),qs()),2&n&&(us(13),Mn(" ",a.localStreamState.audio?"mic":"mic_off"," "),us(3),Mn(" ",a.localStreamState.video?"videocam":"videocam_off"," "))},styles:[".video-wrapper[_ngcontent-%COMP%]{display:grid;max-width:100vw;gap:1rem;margin:0 auto;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));height:90vh}.d-none[_ngcontent-%COMP%]{display:none}.video-div[_ngcontent-%COMP%]{display:flex;width:100%;min-height:50%;border:5px solid rgba(1,158,255,.851);border-radius:15px;overflow:hidden}.remote-video-stopped[_ngcontent-%COMP%]{background:url(user-image.f58c622c4d8597ee.jpg);background-repeat:no-repeat;background-size:cover;background-position:center;object-fit:cover}.stopped-remote-video[_ngcontent-%COMP%]{width:640px;height:480px;border:5px solid rgba(1,158,255,.851);border-radius:15px;overflow:hidden}@media (orientation: portrait){.video-wrapper[_ngcontent-%COMP%]{grid-template-rows:repeat(auto-fit,minmax(40vh,1fr))}}.controls[_ngcontent-%COMP%]{margin:1vh 1vw;border-radius:12px;height:8vh;background:rgba(255,255,255,.0745098039);display:flex;text-align:center;justify-content:center;align-items:center}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;text-align:center;justify-content:center;align-items:center;margin-inline:20px;width:50px;height:50px;border-radius:50%;border:none;outline:none;background-color:transparent;border:3px solid rgba(255,255,255,.6);color:#fff9;font-weight:600px}.spacer[_ngcontent-%COMP%]{flex:1}"]}),e})(),canActivate:[(e,t)=>{const n=ve(Jo);return!!sessionStorage.getItem("rtc-token")||(n.navigate(["/home"]),!1)}]},{path:"",redirectTo:"/home",pathMatch:"full"},{path:"**",redirectTo:"/home"}];let NB=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ni({type:e}),e.\u0275inj=jr({imports:[sU.forRoot(OB,{useHash:!0}),sU]}),e})(),PB=(()=>{class e{constructor(){this.title="video-call"}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ya({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(n,a){1&n&&di(0,"router-outlet")},dependencies:[qM]}),e})(),MB=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ni({type:e,bootstrap:[PB]}),e.\u0275inj=jr({providers:[sL],imports:[fV,NB,vB,IF,RF]}),e})();hV().bootstrapModule(MB).catch(e=>console.error(e))},291:function(na,Xh,Vd){var M=Vd(156).default;na.exports=function(){"use strict";var Mo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Qt=function(o){try{return!!o()}catch{return!0}},Xn=!Qt(function(){var o=function(){}.bind();return"function"!=typeof o||o.hasOwnProperty("prototype")}),oa=Xn,ws=Function.prototype,Fr=ws.call,su=oa&&ws.bind.bind(Fr,Fr),Dn=oa?function(o){return o&&su(o)}:function(o){return o&&function(){return Fr.apply(o,arguments)}},ho=Dn({}.isPrototypeOf),Qh=function(o){return o&&o.Math==Math&&o},ot=Qh("object"==typeof globalThis&&globalThis)||Qh("object"==typeof window&&window)||Qh("object"==typeof self&&self)||Qh("object"==typeof Mo&&Mo)||function(){return this}()||Function("return this")(),Zh=Function.prototype,sa=Zh.apply,Fd=Zh.call,Ig="object"==typeof Reflect&&Reflect.apply||(Xn?Fd.bind(sa):function(){return Fd.apply(sa,arguments)}),Qn=function(o){return"function"==typeof o},jd={},Xo=!Qt(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),aa=Function.prototype.call,po=Xn?aa.bind(aa):function(){return aa.apply(aa,arguments)},Rg={},ep={}.propertyIsEnumerable,tT=Object.getOwnPropertyDescriptor,bg=tT&&!ep.call({1:2},1);Rg.f=bg?function(o){var r=tT(this,o);return!!r&&r.enumerable}:ep;var Qr,tp,ca=function(o,r){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:r}},Ln=Dn,nT=Ln({}.toString),Tw=Ln("".slice),Bd=function(o){return Tw(nT(o),8,-1)},Os=Qt,rT=Bd,fo=ot.Object,oT=Dn("".split),Zn=Os(function(){return!fo("z").propertyIsEnumerable(0)})?function(o){return"String"==rT(o)?oT(o,""):fo(o)}:fo,gr=ot.TypeError,np=function(o){if(null==o)throw gr("Can't call method on "+o);return o},Nt=Zn,Ag=np,ua=function(o){return Nt(Ag(o))},Dg=Qn,Qo=function(o){return"object"==typeof o?null!==o:Dg(o)},da={},wg=da,iT=ot,aL=Qn,Iw=function(o){return aL(o)?o:void 0},Ns=function(o,r){return arguments.length<2?Iw(wg[o])||Iw(iT[o]):wg[o]&&wg[o][r]||iT[o]&&iT[o][r]},$a=Ns("navigator","userAgent")||"",Ng=$a,rp=ot.process,sT=ot.Deno,op=rp&&rp.versions||sT&&sT.version,Pg=op&&op.v8;Pg&&(tp=(Qr=Pg.split("."))[0]>0&&Qr[0]<4?1:+(Qr[0]+Qr[1])),!tp&&Ng&&(!(Qr=Ng.match(/Edge\/(\d+)/))||Qr[1]>=74)&&(Qr=Ng.match(/Chrome\/(\d+)/))&&(tp=+Qr[1]);var au=tp,aT=au,qi=!!Object.getOwnPropertySymbols&&!Qt(function(){var o=Symbol();return!String(o)||!(Object(o)instanceof Symbol)||!Symbol.sham&&aT&&aT<41}),Mg=qi&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,bw=Ns,cT=Qn,Aw=ho,ww=ot.Object,Lg=Mg?function(o){return"symbol"==typeof o}:function(o){var r=bw("Symbol");return cT(r)&&Aw(r.prototype,ww(o))},Ow=ot.String,ip=function(o){try{return Ow(o)}catch{return"Object"}},Nw=Qn,cL=ip,uT=ot.TypeError,$i=function(o){if(Nw(o))return o;throw uT(cL(o)+" is not a function")},dT=$i,sp=function(o,r){var i=o[r];return null==i?void 0:dT(i)},ap=po,kg=Qn,cp=Qo,lT=ot.TypeError,Hd={exports:{}},xg=ot,Zo=Object.defineProperty,hT="__core-js_shared__",Ug=ot[hT]||function(o,r){try{Zo(xg,o,{value:r,configurable:!0,writable:!0})}catch{xg[o]=r}return r}(hT,{}),pT=Ug;(Hd.exports=function(o,r){return pT[o]||(pT[o]=void 0!==r?r:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"\xa9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var fT=np,Mw=ot.Object,la=function(o){return Mw(fT(o))},Ps=la,Lw=Dn({}.hasOwnProperty),Pt=Object.hasOwn||function(o,r){return Lw(Ps(o),r)},cu=Dn,zi=0,uL=Math.random(),kw=cu(1..toString),Vg=function(o){return"Symbol("+(void 0===o?"":o)+")_"+kw(++zi+uL,36)},Fg=ot,uu=Pt,xw=Vg,jg=qi,Bg=Mg,Gd=(0,Hd.exports)("wks"),za=Fg.Symbol,gT=za&&za.for,Uw=Bg?za:za&&za.withoutSetter||xw,Fn=function(o){if(!uu(Gd,o)||!jg&&"string"!=typeof Gd[o]){var r="Symbol."+o;Gd[o]=jg&&uu(za,o)?za[o]:Bg&&gT?gT(r):Uw(r)}return Gd[o]},Vw=po,_T=Qo,er=Lg,Fw=sp,Hg=ot.TypeError,yi=Fn("toPrimitive"),jw=function(o,r){if(!_T(o)||er(o))return o;var i,s=Fw(o,yi);if(s){if(void 0===r&&(r="default"),i=Vw(s,o,r),!_T(i)||er(i))return i;throw Hg("Can't convert object to primitive value")}return void 0===r&&(r="number"),function(o,r){var i,s;if("string"===r&&kg(i=o.toString)&&!cp(s=ap(i,o))||kg(i=o.valueOf)&&!cp(s=ap(i,o))||"string"!==r&&kg(i=o.toString)&&!cp(s=ap(i,o)))return s;throw lT("Can't convert object to primitive value")}(o,r)},Bw=Lg,Ot=function(o){var r=jw(o,"string");return Bw(r)?r:r+""},Wd=Qo,jn=ot.document,Gg=Wd(jn)&&Wd(jn.createElement),Wg=function(o){return Gg?jn.createElement(o):{}},dn=Wg,ze=!Xo&&!Qt(function(){return 7!=Object.defineProperty(dn("div"),"a",{get:function(){return 7}}).a}),qg=po,dL=Rg,vT=ca,se=ua,up=Ot,Qe=Pt,Ft=ze,yT=Object.getOwnPropertyDescriptor;jd.f=Xo?yT:function(o,r){if(o=se(o),r=up(r),Ft)try{return yT(o,r)}catch{}if(Qe(o,r))return vT(!qg(dL.f,o,r),o[r])};var lL=Qt,Hw=Qn,dp=/#|\.prototype\./,wr=function(o,r){var i=Gw[hL(o)];return i==ha||i!=pL&&(Hw(r)?lL(r):!!r)},hL=wr.normalize=function(o){return String(o).replace(dp,".").toLowerCase()},Gw=wr.data={},pL=wr.NATIVE="N",ha=wr.POLYFILL="P",Ww=wr,fL=$i,mL=Xn,gL=Dn(Dn.bind),Kd=function(o,r){return fL(o),void 0===r?o:mL?gL(o,r):function(){return o.apply(r,arguments)}},Yi={},ST=Xo&&Qt(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),ei=Qo,jt=ot.String,_L=ot.TypeError,Ji=function(o){if(ei(o))return o;throw _L(jt(o)+" is not an object")},Le=ze,jr=Ji,qd=Ot,qw=ot.TypeError,lp=Object.defineProperty,$w=Object.getOwnPropertyDescriptor;Yi.f=Xo?ST?function(o,r,i){if(jr(o),r=qd(r),jr(i),"function"==typeof o&&"prototype"===r&&"value"in i&&"writable"in i&&!i.writable){var s=$w(o,r);s&&s.writable&&(o[r]=i.value,i={configurable:"configurable"in i?i.configurable:s.configurable,enumerable:"enumerable"in i?i.enumerable:s.enumerable,writable:!1})}return lp(o,r,i)}:lp:function(o,r,i){if(jr(o),r=qd(r),jr(i),Le)try{return lp(o,r,i)}catch{}if("get"in i||"set"in i)throw qw("Accessors not supported");return"value"in i&&(o[r]=i.value),o};var CT=Yi,zw=ca,Pe=Xo?function(o,r,i){return CT.f(o,r,zw(1,i))}:function(o,r,i){return o[r]=i,o},du=ot,IT=Ig,mo=Dn,RT=Qn,yL=jd.f,ln=Ww,$d=da,SL=Kd,zd=Pe,lu=Pt,zg=function(o){var r=function(i,s,u){if(this instanceof r){switch(arguments.length){case 0:return new o;case 1:return new o(i);case 2:return new o(i,s)}return new o(i,s,u)}return IT(o,this,arguments)};return r.prototype=o.prototype,r},tr=function(o,r){var i,s,u,d,h,f,m,_,E=o.target,y=o.global,T=o.stat,b=o.proto,w=y?du:T?du[E]:(du[E]||{}).prototype,P=y?$d:$d[E]||zd($d,E,{})[E],k=P.prototype;for(u in r)i=!ln(y?u:E+(T?".":"#")+u,o.forced)&&w&&lu(w,u),h=P[u],i&&(f=o.noTargetGet?(_=yL(w,u))&&_.value:w[u]),d=i&&f?f:r[u],i&&typeof h==typeof d||(m=o.bind&&i?SL(d,du):o.wrap&&i?zg(d):b&&RT(d)?mo(d):d,(o.sham||d&&d.sham||h&&h.sham)&&zd(m,"sham",!0),zd(P,u,m),b&&(lu($d,s=E+"Prototype")||zd($d,s,{}),zd($d[s],u,d),o.real&&k&&!k[u]&&zd(k,u,d)))},Yw=Math.ceil,Jw=Math.floor,Yg=function(o){var r=+o;return r!=r||0===r?0:(r>0?Jw:Yw)(r)},bT=Yg,hu=Math.min,Zr=function(o){return function(o){return o>0?hu(bT(o),9007199254740991):0}(o.length)},Qw=$i,Ne=la,AT=Zn,ve=Zr,pp=ot.TypeError,fp=function(o){return function(r,i,s,u){Qw(i);var d=Ne(r),h=AT(d),f=ve(d),m=o?f-1:0,_=o?-1:1;if(s<2)for(;;){if(m in h){u=h[m],m+=_;break}if(m+=_,o?m<0:f<=m)throw pp("Reduce of empty array with no initial value")}for(;o?m>=0:f>m;m+=_)m in h&&(u=i(u,h[m],m,d));return u}},Yd={left:fp(!1),right:fp(!0)},Zw=Qt,Jg=function(o,r){var i=[][o];return!!i&&Zw(function(){i.call(null,r||function(){throw 1},1)})},mp="process"==Bd(ot.process),Ms=Yd.left,Si=au,Lo=mp;tr({target:"Array",proto:!0,forced:!Jg("reduce")||!Lo&&Si>79&&Si<83},{reduce:function(o){var r=arguments.length;return Ms(this,o,r,r>1?arguments[1]:void 0)}});var Xi=da,gt=function(o){return Xi[o+"Prototype"]},gp=gt("Array").reduce,Xg=ho,Qg=gp,_p=Array.prototype,Qi=function(o){var r=o.reduce;return o===_p||Xg(_p,o)&&r===_p.reduce?Qg:r},ti=Qi;let Zg=!0,e_=!0;function pu(o,r,i){const s=o.match(r);return s&&s.length>=i&&parseInt(s[i],10)}function pa(o,r,i){if(!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype,u=s.addEventListener;s.addEventListener=function(h,f){if(h!==r)return u.apply(this,arguments);const m=_=>{const E=i(_);E&&(f.handleEvent?f.handleEvent(E):f(E))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(f,m),u.apply(this,[h,m])};const d=s.removeEventListener;s.removeEventListener=function(h,f){if(h!==r||!this._eventMap||!this._eventMap[r])return d.apply(this,arguments);if(!this._eventMap[r].has(f))return d.apply(this,arguments);const m=this._eventMap[r].get(f);return this._eventMap[r].delete(f),0===this._eventMap[r].size&&delete this._eventMap[r],0===Object.keys(this._eventMap).length&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(s,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function DT(o){return"boolean"!=typeof o?new Error("Argument type: "+typeof o+". Please use a boolean."):(Zg=o,o?"adapter.js logging disabled":"adapter.js logging enabled")}function Jd(o){return"boolean"!=typeof o?new Error("Argument type: "+typeof o+". Please use a boolean."):(e_=!o,"adapter.js deprecation warnings "+(o?"disabled":"enabled"))}function t_(){if("object"==typeof window){if(Zg)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Ep(o,r){e_&&console.warn(o+" is deprecated, please use "+r+" instead.")}function n_(o){return"[object Object]"===Object.prototype.toString.call(o)}function wT(o){var r;return n_(o)?ti(r=Object.keys(o)).call(r,function(i,s){const u=n_(o[s]),d=u?wT(o[s]):o[s],h=u&&!Object.keys(d).length;return void 0===d||h?i:Object.assign(i,{[s]:d})},{}):o}function OT(o,r,i){const s=i?"outbound-rtp":"inbound-rtp",u=new Map;if(null===r)return u;const d=[];return o.forEach(h=>{"track"===h.type&&h.trackIdentifier===r.id&&d.push(h)}),d.forEach(h=>{o.forEach(f=>{f.type===s&&f.trackId===h.id&&function m(_,E,y){E&&!y.has(E.id)&&(y.set(E.id,E),Object.keys(E).forEach(T=>{T.endsWith("Id")?m(_,_.get(E[T]),y):T.endsWith("Ids")&&E[T].forEach(b=>{m(_,_.get(b),y)})}))}(o,f,u)})}),u}var tO=Vg,r_=(0,Hd.exports)("keys"),vp=function(o){return r_[o]||(r_[o]=tO(o))},nO=!Qt(function(){function o(){}return o.prototype.constructor=null,Object.getPrototypeOf(new o)!==o.prototype}),rO=ot,oO=Pt,NT=Qn,iO=la,sO=nO,PT=vp("IE_PROTO"),Ya=rO.Object,aO=Ya.prototype,o_=sO?Ya.getPrototypeOf:function(o){var r=iO(o);if(oO(r,PT))return r[PT];var i=r.constructor;return NT(i)&&r instanceof i?i.prototype:r instanceof Ya?aO:null},ni=Qn,cO=ot.String,LT=ot.TypeError,Ye=Dn,go=Ji,Br=Object.setPrototypeOf||("__proto__"in{}?function(){var o,r=!1,i={};try{(o=Ye(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(i,[]),r=i instanceof Array}catch{}return function(s,u){return go(s),function(o){if("object"==typeof o||ni(o))return o;throw LT("Can't set "+cO(o)+" as a prototype")}(u),r?o(s,u):s.__proto__=u,s}}():void 0),Or={},fu=Yg,ko=Math.max,kT=Math.min,yp=function(o,r){var i=fu(o);return i<0?ko(i+r,0):kT(i,r)},Sp=ua,uO=yp,dO=Zr,nr=function(o){return function(r,i,s){var u,d=Sp(r),h=dO(d),f=uO(s,h);if(o&&i!=i){for(;h>f;)if((u=d[f++])!=u)return!0}else for(;h>f;f++)if((o||f in d)&&d[f]===i)return o||f||0;return!o&&-1}},ye={includes:nr(!0),indexOf:nr(!1)},Je={},En=Pt,Ci=ua,Xd=ye.indexOf,Hr=Je,Ja=Dn([].push),Bn=function(o,r){var i,s=Ci(o),u=0,d=[];for(i in s)!En(Hr,i)&&En(s,i)&&Ja(d,i);for(;r.length>u;)En(s,i=r[u++])&&(~Xd(d,i)||Ja(d,i));return d},fa=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Xa=Bn,et=fa.concat("length","prototype");Or.f=Object.getOwnPropertyNames||function(o){return Xa(o,et)};var Qa={};Qa.f=Object.getOwnPropertySymbols;var xT=Ns,mu=Or,rr=Qa,Qd=Ji,gu=Dn([].concat),Zi=xT("Reflect","ownKeys")||function(o){var r=mu.f(Qd(o)),i=rr.f;return i?gu(r,i(o)):r},_u=Pt,UT=Zi,ma=jd,Ls=Yi,Eu={},Tp=Bn,It=fa,VT=Object.keys||function(o){return Tp(o,It)},es=Yi,Cp=Ji,vu=ua,Zd=VT;Eu.f=Xo&&!ST?Object.defineProperties:function(o,r){Cp(o);for(var i,s=vu(r),u=Zd(r),d=u.length,h=0;d>h;)es.f(o,i=u[h++],s[i]);return o};var _r,lO=Ns("document","documentElement"),xo=Ji,_o=Eu,Ip=fa,Za=Je,Rp=lO,Ii=Wg,bp=vp("IE_PROTO"),s_=function(){},jT=function(o){return"<script>"+o+"<\/script>"},hO=function(o){o.write(jT("")),o.close();var r=o.parentWindow.Object;return o=null,r},Ap=function(){try{_r=new ActiveXObject("htmlfile")}catch{}var o,r;Ap=typeof document<"u"?document.domain&&_r?hO(_r):((r=Ii("iframe")).style.display="none",Rp.appendChild(r),r.src="javascript:",(o=r.contentWindow.document).open(),o.write(jT("document.F=Object")),o.close(),o.F):hO(_r);for(var i=Ip.length;i--;)delete Ap.prototype[Ip[i]];return Ap()};Za[bp]=!0;var Dp=Object.create||function(o,r){var i;return null!==o?(s_.prototype=xo(o),i=new s_,s_.prototype=null,i[bp]=o):i=Ap(),void 0===r?i:_o.f(i,r)},TL=Dn("".replace),CL=String(Error("zxcasd").stack),pO=/\n\s*at [^:]*:[^\n]*/,IL=pO.test(CL),RL=Qo,bL=Pe,el={},AL=el,DL=Fn("iterator"),wL=Array.prototype,fO={};fO[Fn("toStringTag")]="z";var BT="[object z]"===String(fO),HT=ot,GT=BT,OL=Qn,a_=Bd,NL=Fn("toStringTag"),ec=HT.Object,WT="Arguments"==a_(function(){return arguments}()),tc=GT?a_:function(o){var r,i,s;return void 0===o?"Undefined":null===o?"Null":"string"==typeof(i=function(u,d){try{return u[d]}catch{}}(r=ec(o),NL))?i:WT?a_(r):"Object"==(s=a_(r))&&OL(r.callee)?"Arguments":s},c_=tc,u_=sp,mO=el,gO=Fn("iterator"),KT=function(o){if(null!=o)return u_(o,gO)||u_(o,"@@iterator")||mO[c_(o)]},PL=po,_O=$i,ts=Ji,wp=ip,Ir=KT,qT=ot.TypeError,ML=po,Op=Ji,d_=sp,Np=Kd,EO=po,LL=Ji,$T=ip,vO=Zr,tl=ho,kL=KT,SO=function(o,r,i){var s,u;Op(o);try{if(!(s=d_(o,"return"))){if("throw"===r)throw i;return i}s=ML(s,o)}catch(d){u=!0,s=d}if("throw"===r)throw i;if(u)throw s;return Op(s),i},zT=ot.TypeError,nl=function(o,r){this.stopped=o,this.result=r},YT=nl.prototype,Pp=function(o,r,i){var s,u,d,h,f,m,_,y=!(!i||!i.AS_ENTRIES),T=!(!i||!i.IS_ITERATOR),b=!(!i||!i.INTERRUPTED),w=Np(r,i&&i.that),P=function(x){return s&&SO(s,"normal",x),new nl(!0,x)},k=function(x){return y?(LL(x),b?w(x[0],x[1],P):w(x[0],x[1])):b?w(x,P):w(x)};if(T)s=o;else{if(!(u=kL(o)))throw zT($T(o)+" is not iterable");if(function(o){return void 0!==o&&(AL.Array===o||wL[DL]===o)}(u)){for(d=0,h=vO(o);h>d;d++)if((f=k(o[d]))&&tl(YT,f))return f;return new nl(!1)}s=function(o,r){var i=arguments.length<2?Ir(o):r;if(_O(i))return ts(PL(i,o));throw qT(wp(o)+" is not iterable")}(o,u)}for(m=s.next;!(_=EO(m,s)).done;){try{f=k(_.value)}catch(x){SO(s,"throw",x)}if("object"==typeof f&&f&&tl(YT,f))return f}return new nl(!1)},ri=tc,JT=ot.String,yu=function(o){if("Symbol"===ri(o))throw TypeError("Cannot convert a Symbol value to a string");return JT(o)},TO=yu,XT=ca,QT=!Qt(function(){var o=Error("a");return!("stack"in o)||(Object.defineProperty(o,"stack",XT(1,7)),7!==o.stack)}),CO=tr,h_=ot,IO=ho,ns=o_,rl=Br,hn=Dp,Mp=Pe,Su=ca,eC=Pp,Uo=QT,bO=Fn("toStringTag"),Lp=h_.Error,AO=[].push,oi=function(o,r){var i,s=arguments.length>2?arguments[2]:void 0,u=IO(kp,this);rl?i=rl(new Lp,u?ns(this):kp):(i=u?this:hn(kp),Mp(i,bO,"Error")),void 0!==r&&Mp(i,"message",function(o,r){return void 0===o?arguments.length<2?"":r:TO(o)}(r)),Uo&&Mp(i,"stack",function(o,r){if(IL&&"string"==typeof o)for(;r--;)o=TL(o,pO,"");return o}(i.stack,1)),function(o,r){RL(r)&&"cause"in r&&bL(o,"cause",r.cause)}(i,s);var d=[];return eC(o,AO,{that:d}),Mp(i,"errors",d),i};rl?rl(oi,Lp):function(o,r,i){for(var s=UT(r),u=Ls.f,d=ma.f,h=0;h<s.length;h++){var f=s[h];_u(o,f)||i&&_u(i,f)||u(o,f,d(r,f))}}(oi,Lp,{name:!0});var kp=oi.prototype=hn(Lp.prototype,{constructor:Su(1,oi),message:Su(1,""),name:Su(1,"AggregateError")});CO({global:!0},{AggregateError:oi});var DO=Qn,xp=Ug,tC=Dn(Function.toString);DO(xp.inspectSource)||(xp.inspectSource=function(o){return tC(o)});var ol,il,xe,Up=xp.inspectSource,wO=Up,nC=ot.WeakMap,OO=Qn(nC)&&/native code/.test(wO(nC)),ga=Dn,NO=Qo,PO=Pe,f_=Pt,MO=vp,re=Je,bt="Object already initialized",Vp=ot.TypeError;if(OO||Ug.state){var wn=Ug.state||(Ug.state=new(0,ot.WeakMap)),oC=ga(wn.get),Cu=ga(wn.has),rs=ga(wn.set);ol=function(o,r){if(Cu(wn,o))throw new Vp(bt);return r.facade=o,rs(wn,o,r),r},il=function(o){return oC(wn,o)||{}},xe=function(o){return Cu(wn,o)}}else{var _a=MO("state");re[_a]=!0,ol=function(o,r){if(f_(o,_a))throw new Vp(bt);return r.facade=o,PO(o,_a,r),r},il=function(o){return f_(o,_a)?o[_a]:{}},xe=function(o){return f_(o,_a)}}var ks,iC,LO,sl={set:ol,get:il,has:xe,enforce:function(o){return xe(o)?il(o):ol(o,{})},getterFor:function(o){return function(r){var i;if(!NO(r)||(i=il(r)).type!==o)throw Vp("Incompatible receiver, "+o+" required");return i}}},Nr=Xo,g_=Function.prototype,Iu=Nr&&Object.getOwnPropertyDescriptor,Ri=Pt(g_,"name"),sC={EXISTS:Ri,PROPER:Ri&&"something"===function(){}.name,CONFIGURABLE:Ri&&(!Nr||Nr&&Iu(g_,"name").configurable)},aC=Pe,Fp=function(o,r,i,s){s&&s.enumerable?o[r]=i:aC(o,r,i)},kO=Qt,__=Qn,E_=Dp,v_=o_,y_=Fp,S_=Fn("iterator"),T_=!1;[].keys&&("next"in(LO=[].keys())?(iC=v_(v_(LO)))!==Object.prototype&&(ks=iC):T_=!0);var C_=null==ks||kO(function(){var o={};return ks[S_].call(o)!==o});__((ks=C_?{}:E_(ks))[S_])||y_(ks,S_,function(){return this});var I_={IteratorPrototype:ks,BUGGY_SAFARI_ITERATORS:T_},cC=tc,dC=BT,R_=Yi.f,xO=Pe,UO=Pt,eo=BT?{}.toString:function(){return"[object "+cC(this)+"]"},Ea=Fn("toStringTag"),Zt=function(o,r,i,s){if(o){var u=i?o:o.prototype;UO(u,Ea)||R_(u,Ea,{configurable:!0,value:r}),s&&!dC&&xO(u,"toString",eo)}},VO=I_.IteratorPrototype,FO=Dp,jO=ca,BO=Zt,lC=el,hC=function(){return this},jp=tr,va=po,Bp=o_,Hp=Zt,al=Fp,Gp=el,pC=sC.PROPER,cl=I_.BUGGY_SAFARI_ITERATORS,b_=Fn("iterator"),ya="values",fC="entries",UL=function(){return this},Wp=function(o,r,i,s,u,d,h){!function(o,r,i,s){var u=r+" Iterator";o.prototype=FO(VO,{next:jO(+!s,i)}),BO(o,u,!1,!0),lC[u]=hC}(i,r,s);var f,m,_,E=function(x){if(x===u&&P)return P;if(!cl&&x in b)return b[x];switch(x){case"keys":case ya:case fC:return function(){return new i(this,x)}}return function(){return new i(this)}},y=r+" Iterator",T=!1,b=o.prototype,w=b[b_]||b["@@iterator"]||u&&b[u],P=!cl&&w||E(u),k="Array"==r&&b.entries||w;if(k&&(f=Bp(k.call(new o)))!==Object.prototype&&f.next&&(Hp(f,y,!0,!0),Gp[y]=UL),pC&&u==ya&&w&&w.name!==ya&&(T=!0,P=function(){return va(w,this)}),u)if(m={values:E(ya),keys:d?P:E("keys"),entries:E(fC)},h)for(_ in m)(cl||T||!(_ in b))&&al(b,_,m[_]);else jp({target:r,proto:!0,forced:cl||T},m);return h&&b[b_]!==P&&al(b,b_,P,{name:u}),Gp[r]=P,m},VL=ua,mC=el,FL=Wp,GO="Array Iterator",_C=sl.set,Kp=sl.getterFor(GO);FL(Array,"Array",function(o,r){_C(this,{type:GO,target:VL(o),index:0,kind:r})},function(){var o=Kp(this),r=o.target,i=o.kind,s=o.index++;return!r||s>=r.length?(o.target=void 0,{value:void 0,done:!0}):"keys"==i?{value:s,done:!1}:"values"==i?{value:r[s],done:!1}:{value:[s,r[s]],done:!1}},"values"),mC.Arguments=mC.Array;var EC=ot.Promise,qp=Fp,A_=Ns,$p=Yi,jL=Xo,D_=Fn("species"),vC=ho,WO=ot.TypeError,bi=Fn("iterator"),yC=!1;try{var zp=0,Yp={next:function(){return{done:!!zp++}},return:function(){yC=!0}};Yp[bi]=function(){return this},Array.from(Yp,function(){throw 2})}catch{}var SC=Dn,w_=Qt,Jp=Qn,KO=tc,TC=Up,O_=function(){},CC=[],N_=Ns("Reflect","construct"),P_=/^\s*(?:class|function)\b/,Xp=SC(P_.exec),rc=!P_.exec(O_),ul=function(o){if(!Jp(o))return!1;try{return N_(O_,CC,o),!0}catch{return!1}},M_=function(o){if(!Jp(o))return!1;switch(KO(o)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return rc||!!Xp(P_,TC(o))}catch{return!0}};M_.sham=!0;var Ru,Ai,IC,Er,dl=!N_||w_(function(){var o;return ul(ul.call)||!ul(Object)||!ul(function(){o=!0})||o})?M_:ul,qO=dl,RC=ip,Qp=ot.TypeError,oc=Ji,Au=Fn("species"),L_=function(o,r){var i,s=oc(o).constructor;return void 0===s||null==(i=oc(s)[Au])?r:function(o){if(qO(o))return o;throw Qp(RC(o)+" is not a constructor")}(i)},ll=Dn([].slice),ic=/(?:ipad|iphone|ipod).*applewebkit/i.test($a),ii=ot,$O=Ig,BL=Kd,zO=Qn,HL=Pt,GL=Qt,YO=lO,WL=ll,Du=Wg,KL=ic,qL=mp,Hn=ii.setImmediate,k_=ii.clearImmediate,hl=ii.process,x_=ii.Dispatch,si=ii.Function,wu=ii.MessageChannel,bC=ii.String,Ou=0,Us={};try{Ru=ii.location}catch{}var AC=function(o){if(HL(Us,o)){var r=Us[o];delete Us[o],r()}},U_=function(o){return function(){AC(o)}},XO=function(o){AC(o.data)},vo=function(o){ii.postMessage(bC(o),Ru.protocol+"//"+Ru.host)};Hn&&k_||(Hn=function(o){var r=WL(arguments,1);return Us[++Ou]=function(){$O(zO(o)?o:si(o),void 0,r)},Ai(Ou),Ou},k_=function(o){delete Us[o]},qL?Ai=function(o){hl.nextTick(U_(o))}:x_&&x_.now?Ai=function(o){x_.now(U_(o))}:wu&&!KL?(Er=(IC=new wu).port2,IC.port1.onmessage=XO,Ai=BL(Er.postMessage,Er)):ii.addEventListener&&zO(ii.postMessage)&&!ii.importScripts&&Ru&&"file:"!==Ru.protocol&&!GL(vo)?(Ai=vo,ii.addEventListener("message",XO,!1)):Ai="onreadystatechange"in Du("script")?function(o){YO.appendChild(Du("script")).onreadystatechange=function(){YO.removeChild(this),AC(o)}}:function(o){setTimeout(U_(o),0)});var sc,ai,Zp,ac,V_,F_,j_,DC,wC={set:Hn,clear:k_},QO=ot,B_=/ipad|iphone|ipod/i.test($a)&&void 0!==QO.Pebble,ef=/web0s(?!.*chrome)/i.test($a),cc=ot,pl=Kd,Nu=wC.set,eN=ic,OC=B_,H_=ef,Pu=mp,G_=cc.MutationObserver||cc.WebKitMutationObserver,NC=cc.document,PC=cc.process,Vs=cc.Promise,Mu=(0,jd.f)(cc,"queueMicrotask"),MC=Mu&&Mu.value;MC||(sc=function(){var o,r;for(Pu&&(o=PC.domain)&&o.exit();ai;){r=ai.fn,ai=ai.next;try{r()}catch(i){throw ai?ac():Zp=void 0,i}}Zp=void 0,o&&o.enter()},eN||Pu||H_||!G_||!NC?!OC&&Vs&&Vs.resolve?((j_=Vs.resolve(void 0)).constructor=Vs,DC=pl(j_.then,j_),ac=function(){DC(sc)}):Pu?ac=function(){PC.nextTick(sc)}:(Nu=pl(Nu,cc),ac=function(){Nu(sc)}):(V_=!0,F_=NC.createTextNode(""),new G_(sc).observe(F_,{characterData:!0}),ac=function(){F_.data=V_=!V_}));var $L=MC||function(o){var r={fn:o,next:void 0};Zp&&(Zp.next=r),ai||(ai=r,ac()),Zp=r},uc={},LC=$i,zL=function(o){var r,i;this.promise=new o(function(s,u){if(void 0!==r||void 0!==i)throw TypeError("Bad Promise constructor");r=s,i=u}),this.resolve=LC(r),this.reject=LC(i)};uc.f=function(o){return new zL(o)};var tN=Ji,nN=Qo,rN=uc,fl=function(o,r){if(tN(o),nN(r)&&r.constructor===o)return r;var i=rN.f(o);return(0,i.resolve)(r),i.promise},kC=ot,tf=function(o){try{return{error:!1,value:o()}}catch(r){return{error:!0,value:r}}},W_=function(){this.head=null,this.tail=null};W_.prototype={add:function(o){var r={item:o,next:null};this.head?this.tail.next=r:this.head=r,this.tail=r},get:function(){var o=this.head;if(o)return this.head=o.next,this.tail===o&&(this.tail=null),o.item}};var xC,K_,UC,oN="object"==typeof window,nf=tr,Di=ot,YL=Ns,dc=po,ml=EC,XL=Zt,VC=$i,q_=Qn,iN=Qo,$_=Up,z_=Pp,jC=L_,lc=wC.set,sf=$L,BC=fl,gl=uc,Gr=tf,sN=W_,Y_=sl,aN=Ww,HC=oN,Lu=mp,GC=au,cN=Fn("species"),os="Promise",J_=Y_.getterFor(os),uN=Y_.set,dN=Y_.getterFor(os),ci=ml,_l=ml&&ml.prototype,cf=Di.TypeError,Rr=Di.document,hc=Di.process,pc=gl.f,WC=pc,lN=!!(Rr&&Rr.createEvent&&Di.dispatchEvent),X_=q_(Di.PromiseRejectionEvent),KC="unhandledrejection",El=aN(os,function(){var o=$_(ci),r=o!==String(ci);if(!r&&66===GC||!_l.finally)return!0;if(GC>=51&&/native code/.test(o))return!1;var i=new ci(function(u){u(1)}),s=function(u){u(function(){},function(){})};return(i.constructor={})[cN]=s,!(i.then(function(){})instanceof s)||!r&&HC&&!X_}),hN=El||!function(o,r){if(!r&&!yC)return!1;var i=!1;try{var s={};s[bi]=function(){return{next:function(){return{done:i=!0}}}},o(s)}catch{}return i}(function(o){ci.all(o).catch(function(){})}),Q_=function(o){var r;return!(!iN(o)||!q_(r=o.then))&&r},qC=function(o,r){var i,s,u,d=r.value,h=1==r.state,f=h?o.ok:o.fail,m=o.resolve,_=o.reject,E=o.domain;try{f?(h||(2===r.rejection&&vl(r),r.rejection=1),!0===f?i=d:(E&&E.enter(),i=f(d),E&&(E.exit(),u=!0)),i===o.promise?_(cf("Promise-chain cycle")):(s=Q_(i))?dc(s,i,m,_):m(i)):_(d)}catch(y){E&&!u&&E.exit(),_(y)}},$C=function(o,r){o.notified||(o.notified=!0,sf(function(){for(var i,s=o.reactions;i=s.get();)qC(i,o);o.notified=!1,r&&!o.rejection&&Z_(o)}))},uf=function(o,r,i){var s,u;lN?((s=Rr.createEvent("Event")).promise=r,s.reason=i,s.initEvent(o,!1,!0),Di.dispatchEvent(s)):s={promise:r,reason:i},!X_&&(u=Di["on"+o])?u(s):o===KC&&function(o,r){var i=kC.console;i&&i.error&&(1==arguments.length?i.error(o):i.error(o,r))}("Unhandled promise rejection",i)},Z_=function(o){dc(lc,Di,function(){var r,i=o.facade,s=o.value;if(zC(o)&&(r=Gr(function(){Lu?hc.emit("unhandledRejection",s,i):uf(KC,i,s)}),o.rejection=Lu||zC(o)?2:1,r.error))throw r.value})},zC=function(o){return 1!==o.rejection&&!o.parent},vl=function(o){dc(lc,Di,function(){var r=o.facade;Lu?hc.emit("rejectionHandled",r):uf("rejectionhandled",r,o.value)})},ku=function(o,r,i){return function(s){o(r,s,i)}},xu=function(o,r,i){o.done||(o.done=!0,i&&(o=i),o.value=r,o.state=2,$C(o,!0))},df=function(o,r,i){if(!o.done){o.done=!0,i&&(o=i);try{if(o.facade===r)throw cf("Promise can't be resolved itself");var s=Q_(r);s?sf(function(){var u={done:!1};try{dc(s,r,ku(df,u,o),ku(xu,u,o))}catch(d){xu(u,d,o)}}):(o.value=r,o.state=1,$C(o,!1))}catch(u){xu({done:!1},u,o)}}};El&&(_l=(ci=function(o){(function(o,r){if(vC(r,o))return o;throw WO("Incorrect invocation")})(this,_l),VC(o),dc(xC,this);var r=J_(this);try{o(ku(df,r),ku(xu,r))}catch(i){xu(r,i)}}).prototype,(xC=function(o){uN(this,{type:os,done:!1,notified:!1,parent:!1,reactions:new sN,rejection:!1,state:0,value:void 0})}).prototype=function(o,r,i){for(var s in r)i&&i.unsafe&&o[s]?o[s]=r[s]:qp(o,s,r[s],i);return o}(_l,{then:function(o,r){var i=dN(this),s=pc(jC(this,ci));return i.parent=!0,s.ok=!q_(o)||o,s.fail=q_(r)&&r,s.domain=Lu?hc.domain:void 0,0==i.state?i.reactions.add(s):sf(function(){qC(s,i)}),s.promise},catch:function(o){return this.then(void 0,o)}}),K_=function(){var o=new xC,r=J_(o);this.promise=o,this.resolve=ku(df,r),this.reject=ku(xu,r)},gl.f=pc=function(o){return o===ci||o===UC?new K_(o):WC(o)}),nf({global:!0,wrap:!0,forced:El},{Promise:ci}),XL(ci,os,!1,!0),function(o){var r=A_(o);jL&&r&&!r[D_]&&(0,$p.f)(r,D_,{configurable:!0,get:function(){return this}})}(os),UC=YL(os),nf({target:os,stat:!0,forced:El},{reject:function(o){var r=pc(this);return dc(r.reject,void 0,o),r.promise}}),nf({target:os,stat:!0,forced:!0},{resolve:function(o){return BC(this===UC?ci:this,o)}}),nf({target:os,stat:!0,forced:hN},{all:function(o){var r=this,i=pc(r),s=i.resolve,u=i.reject,d=Gr(function(){var h=VC(r.resolve),f=[],m=0,_=1;z_(o,function(E){var y=m++,T=!1;_++,dc(h,r,E).then(function(b){T||(T=!0,f[y]=b,--_||s(f))},u)}),--_||s(f)});return d.error&&u(d.value),i.promise},race:function(o){var r=this,i=pc(r),s=i.reject,u=Gr(function(){var d=VC(r.resolve);z_(o,function(h){dc(d,r,h).then(i.resolve,s)})});return u.error&&s(u.value),i.promise}});var YC=po,JC=$i,Uu=uc,lf=tf,XC=Pp;tr({target:"Promise",stat:!0},{allSettled:function(o){var r=this,i=Uu.f(r),s=i.resolve,u=i.reject,d=lf(function(){var h=JC(r.resolve),f=[],m=0,_=1;XC(o,function(E){var y=m++,T=!1;_++,YC(h,r,E).then(function(b){T||(T=!0,f[y]={status:"fulfilled",value:b},--_||s(f))},function(b){T||(T=!0,f[y]={status:"rejected",reason:b},--_||s(f))})}),--_||s(f)});return d.error&&u(d.value),i.promise}});var eE=$i,hf=Ns,pN=po,fN=uc,mN=tf,gN=Pp,QC="No one promise resolved";tr({target:"Promise",stat:!0},{any:function(o){var r=this,i=hf("AggregateError"),s=fN.f(r),u=s.resolve,d=s.reject,h=mN(function(){var f=eE(r.resolve),m=[],_=0,E=1,y=!1;gN(o,function(T){var b=_++,w=!1;E++,pN(f,r,T).then(function(P){w||y||(y=!0,u(P))},function(P){w||y||(w=!0,m[b]=P,--E||d(new i(m,QC)))})}),--E||d(new i(m,QC))});return h.error&&d(h.value),s.promise}});var ZC=EC,eI=Ns,tE=Qn,tI=L_,pf=fl;tr({target:"Promise",proto:!0,real:!0,forced:!!ZC&&Qt(function(){ZC.prototype.finally.call({then:function(){}},function(){})})},{finally:function(o){var r=tI(this,eI("Promise")),i=tE(o);return this.then(i?function(s){return pf(r,o()).then(function(){return s})}:o,i?function(s){return pf(r,o()).then(function(){throw s})}:o)}});var nE=Dn,_N=Yg,rE=yu,nI=np,fc=nE("".charAt),oE=nE("".charCodeAt),rI=nE("".slice),oI=function(o){return function(r,i){var s,u,d=rE(nI(r)),h=_N(i),f=d.length;return h<0||h>=f?o?"":void 0:(s=oE(d,h))<55296||s>56319||h+1===f||(u=oE(d,h+1))<56320||u>57343?o?fc(d,h):s:o?rI(d,h,h+2):u-56320+(s-55296<<10)+65536}},ZL=(oI(!1),oI(!0)),ff=yu,sI=Wp,iE="String Iterator",aI=sl.set,sE=sl.getterFor(iE);sI(String,"String",function(o){aI(this,{type:iE,string:ff(o),index:0})},function(){var o,r=sE(this),i=r.string,s=r.index;return s>=i.length?{value:void 0,done:!0}:(o=ZL(i,s),r.index+=o.length,{value:o,done:!1})});var cI=da.Promise,yl=ot,uI=tc,aE=Pe,Sl=el,cE=Fn("toStringTag");for(var Tl in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Vu=yl[Tl],uE=Vu&&Vu.prototype;uE&&uI(uE)!==cE&&aE(uE,cE,Tl),Sl[Tl]=Sl.Array}var dE=cI,ie=dE;const dI=t_;function lI(o,r){const i=o&&o.navigator;if(!i.mediaDevices)return;const s=function(h){if("object"!=typeof h||h.mandatory||h.optional)return h;const f={};return Object.keys(h).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const _="object"==typeof h[m]?h[m]:{ideal:h[m]};void 0!==_.exact&&"number"==typeof _.exact&&(_.min=_.max=_.exact);const E=function(y,T){return y?y+T.charAt(0).toUpperCase()+T.slice(1):"deviceId"===T?"sourceId":T};if(void 0!==_.ideal){f.optional=f.optional||[];let y={};"number"==typeof _.ideal?(y[E("min",m)]=_.ideal,f.optional.push(y),y={},y[E("max",m)]=_.ideal,f.optional.push(y)):(y[E("",m)]=_.ideal,f.optional.push(y))}void 0!==_.exact&&"number"!=typeof _.exact?(f.mandatory=f.mandatory||{},f.mandatory[E("",m)]=_.exact):["min","max"].forEach(y=>{void 0!==_[y]&&(f.mandatory=f.mandatory||{},f.mandatory[E(y,m)]=_[y])})}),h.advanced&&(f.optional=(f.optional||[]).concat(h.advanced)),f},u=function(h,f){if(r.version>=61)return f(h);if((h=JSON.parse(JSON.stringify(h)))&&"object"==typeof h.audio){const m=function(_,E,y){E in _&&!(y in _)&&(_[y]=_[E],delete _[E])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=s(h.audio)}if(h&&"object"==typeof h.video){let m=h.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const _=r.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||_)){let E;if(delete h.video.facingMode,"environment"===m.exact||"environment"===m.ideal?E=["back","rear"]:"user"!==m.exact&&"user"!==m.ideal||(E=["front"]),E)return i.mediaDevices.enumerateDevices().then(y=>{let T=(y=y.filter(b=>"videoinput"===b.kind)).find(b=>E.some(w=>b.label.toLowerCase().includes(w)));return!T&&y.length&&E.includes("back")&&(T=y[y.length-1]),T&&(h.video.deviceId=m.exact?{exact:T.deviceId}:{ideal:T.deviceId}),h.video=s(h.video),dI("chrome: "+JSON.stringify(h)),f(h)})}h.video=s(h.video)}return dI("chrome: "+JSON.stringify(h)),f(h)},d=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=function(h,f,m){u(h,_=>{i.webkitGetUserMedia(_,f,E=>{m&&m(d(E))})})}.bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(f){return u(f,m=>h(m).then(_=>{if(m.audio&&!_.getAudioTracks().length||m.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return _},_=>ie.reject(d(_))))}}}function lE(o){o.MediaStream=o.MediaStream||o.webkitMediaStream}function hE(o){if("object"==typeof o&&o.RTCPeerConnection&&!("ontrack"in o.RTCPeerConnection.prototype)){Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let u;u=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.track.id):{track:s.track};const d=new Event("track");d.track=s.track,d.receiver=u,d.transceiver={receiver:u},d.streams=[i.stream],this.dispatchEvent(d)}),i.stream.getTracks().forEach(s=>{let u;u=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.id):{track:s};const d=new Event("track");d.track=s,d.receiver=u,d.transceiver={receiver:u},d.streams=[i.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else pa(o,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function Cl(o){if("object"==typeof o&&o.RTCPeerConnection&&!("getSenders"in o.RTCPeerConnection.prototype)&&"createDTMFSender"in o.RTCPeerConnection.prototype){const r=function(u,d){return{track:d,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===d.kind?u.createDTMFSender(d):null),this._dtmf},_pc:u}};if(!o.RTCPeerConnection.prototype.getSenders){o.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const u=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(h,f){let m=u.apply(this,arguments);return m||(m=r(this,h),this._senders.push(m)),m};const d=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const f=this._senders.indexOf(h);-1!==f&&this._senders.splice(f,1)}}const i=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(u){this._senders=this._senders||[],i.apply(this,[u]),u.getTracks().forEach(d=>{this._senders.push(r(this,d))})};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(u){this._senders=this._senders||[],s.apply(this,[u]),u.getTracks().forEach(d=>{const h=this._senders.find(f=>f.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if("object"==typeof o&&o.RTCPeerConnection&&"getSenders"in o.RTCPeerConnection.prototype&&"createDTMFSender"in o.RTCPeerConnection.prototype&&o.RTCRtpSender&&!("dtmf"in o.RTCRtpSender.prototype)){const r=o.RTCPeerConnection.prototype.getSenders;o.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(o.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function gf(o){if(!o.RTCPeerConnection)return;const r=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[i,s,u]=arguments;if(arguments.length>0&&"function"==typeof i)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof i))return r.apply(this,[]);const d=function(f){const m={};return f.result().forEach(_=>{const E={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(y=>{E[y]=_.stat(y)}),m[E.id]=E}),m},h=function(f){return new Map(Object.keys(f).map(m=>[m,f[m]]))};return arguments.length>=2?r.apply(this,[function(m){s(h(d(m)))},i]):new ie((f,m)=>{r.apply(this,[function(_){f(h(d(_)))},m])}).then(s,u)}}function mc(o){if(!("object"==typeof o&&o.RTCPeerConnection&&o.RTCRtpSender&&o.RTCRtpReceiver))return;if(!("getStats"in o.RTCRtpSender.prototype)){const i=o.RTCPeerConnection.prototype.getSenders;i&&(o.RTCPeerConnection.prototype.getSenders=function(){const u=i.apply(this,[]);return u.forEach(d=>d._pc=this),u});const s=o.RTCPeerConnection.prototype.addTrack;s&&(o.RTCPeerConnection.prototype.addTrack=function(){const u=s.apply(this,arguments);return u._pc=this,u}),o.RTCRtpSender.prototype.getStats=function(){const u=this;return this._pc.getStats().then(d=>OT(d,u.track,!0))}}if(!("getStats"in o.RTCRtpReceiver.prototype)){const i=o.RTCPeerConnection.prototype.getReceivers;i&&(o.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(u=>u._pc=this),s}),pa(o,"track",s=>(s.receiver._pc=s.srcElement,s)),o.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(u=>OT(u,s.track,!1))}}if(!("getStats"in o.RTCRtpSender.prototype)||!("getStats"in o.RTCRtpReceiver.prototype))return;const r=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof o.MediaStreamTrack){const i=arguments[0];let s,u,d;return this.getSenders().forEach(h=>{h.track===i&&(s?d=!0:s=h)}),this.getReceivers().forEach(h=>(h.track===i&&(u?d=!0:u=h),h.track===i)),d||s&&u?ie.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():u?u.getStats():ie.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function hI(o){o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const r=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?-1===this._shimmedLocalStreams[h.id].indexOf(f)&&this._shimmedLocalStreams[h.id].push(f):this._shimmedLocalStreams[h.id]=[h,f],f};const i=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const f=this.getSenders().filter(m=>-1===h.indexOf(m));this._shimmedLocalStreams[d.id]=[d].concat(f)};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],s.apply(this,arguments)};const u=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const f=this._shimmedLocalStreams[h].indexOf(d);-1!==f&&this._shimmedLocalStreams[h].splice(f,1),1===this._shimmedLocalStreams[h].length&&delete this._shimmedLocalStreams[h]}),u.apply(this,arguments)}}function pI(o,r){if(!o.RTCPeerConnection)return;if(o.RTCPeerConnection.prototype.addTrack&&r.version>=65)return hI(o);const i=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(E=>this._reverseStreams[E.id])};const s=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(E=>{if(this.getSenders().find(y=>y.track===E))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const E=new o.MediaStream(_.getTracks());this._streams[_.id]=E,this._reverseStreams[E.id]=_,_=E}s.apply(this,[_])};const u=o.RTCPeerConnection.prototype.removeStream;function d(_,E){let y=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(T=>{const b=_._reverseStreams[T];y=y.replace(new RegExp(_._streams[b.id].id,"g"),b.id)}),new RTCSessionDescription({type:E.type,sdp:y})}o.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},o.RTCPeerConnection.prototype.addTrack=function(_,E){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const y=[].slice.call(arguments,1);if(1!==y.length||!y[0].getTracks().find(w=>w===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(w=>w.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[E.id];if(b)b.addTrack(_),ie.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const w=new o.MediaStream([_]);this._streams[E.id]=w,this._reverseStreams[w.id]=E,this.addStream(w)}return this.getSenders().find(w=>w.track===_)},["createOffer","createAnswer"].forEach(function(_){const E=o.RTCPeerConnection.prototype[_],y={[_](){const T=arguments;return arguments.length&&"function"==typeof arguments[0]?E.apply(this,[b=>{const w=d(this,b);T[0].apply(null,[w])},b=>{T[1]&&T[1].apply(null,b)},arguments[2]]):E.apply(this,arguments).then(b=>d(this,b))}};o.RTCPeerConnection.prototype[_]=y[_]});const f=o.RTCPeerConnection.prototype.setLocalDescription;o.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function h(_,E){let y=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(T=>{const b=_._reverseStreams[T],w=_._streams[b.id];y=y.replace(new RegExp(b.id,"g"),w.id)}),new RTCSessionDescription({type:E.type,sdp:y})}(this,arguments[0]),f.apply(this,arguments)):f.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(o.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return""===_.type?_:d(this,_)}}),o.RTCPeerConnection.prototype.removeTrack=function(_){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(T=>_.track===T)&&(E=this._streams[y])}),E&&(1===E.getTracks().length?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function fI(o,r){!o.RTCPeerConnection&&o.webkitRTCPeerConnection&&(o.RTCPeerConnection=o.webkitRTCPeerConnection),o.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=o.RTCPeerConnection.prototype[i],u={[i](){return arguments[0]=new("addIceCandidate"===i?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};o.RTCPeerConnection.prototype[i]=u[i]})}function mI(o,r){pa(o,"negotiationneeded",i=>{const s=i.target;if(!(r.version<72||s.getConfiguration&&"plan-b"===s.getConfiguration().sdpSemantics)||"stable"===s.signalingState)return i})}var _f=Object.freeze({__proto__:null,shimMediaStream:lE,shimOnTrack:hE,shimGetSendersWithDtmf:Cl,shimGetStats:gf,shimSenderReceiverGetStats:mc,shimAddTrackRemoveTrackWithNative:hI,shimAddTrackRemoveTrack:pI,shimPeerConnection:fI,fixNegotiationNeeded:mI,shimGetUserMedia:lI,shimGetDisplayMedia:function(o,r){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&("function"==typeof r?o.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(s=>{const u=i.video&&i.video.width,d=i.video&&i.video.height;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:i.video&&i.video.frameRate||3}},u&&(i.video.mandatory.maxWidth=u),d&&(i.video.mandatory.maxHeight=d),o.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function gI(o,r){const i=o&&o.navigator,s=o&&o.MediaStreamTrack;if(i.getUserMedia=function(u,d,h){Ep("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(u).then(d,h)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const u=function(h,f,m){f in h&&!(m in h)&&(h[m]=h[f],delete h[f])},d=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return"object"==typeof h&&"object"==typeof h.audio&&(h=JSON.parse(JSON.stringify(h)),u(h.audio,"autoGainControl","mozAutoGainControl"),u(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},s&&s.prototype.getSettings){const h=s.prototype.getSettings;s.prototype.getSettings=function(){const f=h.apply(this,arguments);return u(f,"mozAutoGainControl","autoGainControl"),u(f,"mozNoiseSuppression","noiseSuppression"),f}}if(s&&s.prototype.applyConstraints){const h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(f){return"audio"===this.kind&&"object"==typeof f&&(f=JSON.parse(JSON.stringify(f)),u(f,"autoGainControl","mozAutoGainControl"),u(f,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[f])}}}}function Fu(o){"object"==typeof o&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ju(o,r){if("object"!=typeof o||!o.RTCPeerConnection&&!o.mozRTCPeerConnection)return;!o.RTCPeerConnection&&o.mozRTCPeerConnection&&(o.RTCPeerConnection=o.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(u){const d=o.RTCPeerConnection.prototype[u],h={[u](){return arguments[0]=new("addIceCandidate"===u?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};o.RTCPeerConnection.prototype[u]=h[u]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[u,d,h]=arguments;return s.apply(this,[u||null]).then(f=>{if(r.version<53&&!d)try{f.forEach(m=>{m.type=i[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;f.forEach((_,E)=>{f.set(E,Object.assign({},_,{type:i[_.type]||_.type}))})}return f}).then(d,h)}}function Ef(o){if("object"!=typeof o||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpSender.prototype)return;const r=o.RTCPeerConnection.prototype.getSenders;r&&(o.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(u=>u._pc=this),s});const i=o.RTCPeerConnection.prototype.addTrack;i&&(o.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),o.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ie.resolve(new Map)}}function pE(o){if("object"!=typeof o||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpReceiver.prototype)return;const r=o.RTCPeerConnection.prototype.getReceivers;r&&(o.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i}),pa(o,"track",i=>(i.receiver._pc=i.srcElement,i)),o.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function fE(o){o.RTCPeerConnection&&!("removeStream"in o.RTCPeerConnection.prototype)&&(o.RTCPeerConnection.prototype.removeStream=function(r){Ep("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&r.getTracks().includes(i.track)&&this.removeTrack(i)})})}function mE(o){o.DataChannel&&!o.RTCDataChannel&&(o.RTCDataChannel=o.DataChannel)}function gE(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const r=o.RTCPeerConnection.prototype.addTransceiver;r&&(o.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;void 0===i&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const u=r.apply(this,arguments);if(s){const{sender:d}=u,h=d.getParameters();(!("encodings"in h)||1===h.encodings.length&&0===Object.keys(h.encodings[0]).length)&&(h.encodings=i,d.sendEncodings=i,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return u})}function _I(o){if("object"!=typeof o||!o.RTCRtpSender)return;const r=o.RTCRtpSender.prototype.getParameters;r&&(o.RTCRtpSender.prototype.getParameters=function(){const i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function EI(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const r=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ie.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function vI(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const r=o.RTCPeerConnection.prototype.createAnswer;o.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ie.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var yI=Object.freeze({__proto__:null,shimOnTrack:Fu,shimPeerConnection:ju,shimSenderGetStats:Ef,shimReceiverGetStats:pE,shimRemoveStream:fE,shimRTCDataChannel:mE,shimAddTransceiver:gE,shimGetParameters:_I,shimCreateOffer:EI,shimCreateAnswer:vI,shimGetUserMedia:gI,shimGetDisplayMedia:function(o,r){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(o.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,ie.reject(s)}return!0===i.video?i.video={mediaSource:r}:i.video.mediaSource=r,o.navigator.mediaDevices.getUserMedia(i)})}});function SI(o){if("object"==typeof o&&o.RTCPeerConnection){if("getLocalStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in o.RTCPeerConnection.prototype)){const r=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>r.call(this,s,i)),i.getVideoTracks().forEach(s=>r.call(this,s,i))},o.RTCPeerConnection.prototype.addTrack=function(i){for(var s=arguments.length,u=new Array(s>1?s-1:0),d=1;d<s;d++)u[d-1]=arguments[d];return u&&u.forEach(h=>{this._localStreams?this._localStreams.includes(h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(-1===i)return;this._localStreams.splice(i,1);const s=r.getTracks();this.getSenders().forEach(u=>{s.includes(u.track)&&this.removeTrack(u)})})}}function Fs(o){if("object"==typeof o&&o.RTCPeerConnection&&("getRemoteStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in o.RTCPeerConnection.prototype))){Object.defineProperty(o.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(u=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(u))return;this._remoteStreams.push(u);const d=new Event("addstream");d.stream=u,this.dispatchEvent(d)})})}});const r=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(u=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(u)>=0)return;i._remoteStreams.push(u);const d=new Event("addstream");d.stream=u,i.dispatchEvent(d)})}),r.apply(i,arguments)}}}function Bu(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const r=o.RTCPeerConnection.prototype,i=r.createOffer,s=r.createAnswer,u=r.setLocalDescription,d=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(m,_){const y=i.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(y.then(m,_),ie.resolve()):y},r.createAnswer=function(m,_){const y=s.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(y.then(m,_),ie.resolve()):y};let f=function(m,_,E){const y=u.apply(this,[m]);return E?(y.then(_,E),ie.resolve()):y};r.setLocalDescription=f,f=function(m,_,E){const y=d.apply(this,[m]);return E?(y.then(_,E),ie.resolve()):y},r.setRemoteDescription=f,f=function(m,_,E){const y=h.apply(this,[m]);return E?(y.then(_,E),ie.resolve()):y},r.addIceCandidate=f}function TI(o){const r=o&&o.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,s=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=u=>s(EN(u))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=function(i,s,u){r.mediaDevices.getUserMedia(i).then(s,u)}.bind(r))}function EN(o){return o&&void 0!==o.video?Object.assign({},o,{video:wT(o.video)}):o}function vN(o){if(!o.RTCPeerConnection)return;const r=o.RTCPeerConnection;o.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const u=[];for(let d=0;d<i.iceServers.length;d++){let h=i.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(Ep("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,u.push(h)):u.push(i.iceServers[d])}i.iceServers=u}return new r(i,s)},o.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(o.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function yN(o){"object"==typeof o&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function SN(o){const r=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(i){if(i){void 0!==i.offerToReceiveAudio&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(d=>"audio"===d.receiver.track.kind);!1===i.offerToReceiveAudio&&s?"sendrecv"===s.direction?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":"recvonly"===s.direction&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):!0!==i.offerToReceiveAudio||s||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==i.offerToReceiveVideo&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const u=this.getTransceivers().find(d=>"video"===d.receiver.track.kind);!1===i.offerToReceiveVideo&&u?"sendrecv"===u.direction?u.setDirection?u.setDirection("sendonly"):u.direction="sendonly":"recvonly"===u.direction&&(u.setDirection?u.setDirection("inactive"):u.direction="inactive"):!0!==i.offerToReceiveVideo||u||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function TN(o){"object"!=typeof o||o.AudioContext||(o.AudioContext=o.webkitAudioContext)}var o,_E=Object.freeze({__proto__:null,shimLocalStreamsAPI:SI,shimRemoteStreamsAPI:Fs,shimCallbacksAPI:Bu,shimGetUserMedia:TI,shimConstraints:EN,shimRTCIceServerUrls:vN,shimTrackEventTransceiver:yN,shimCreateOfferLegacy:SN,shimAudioContext:TN}),IN=np,RN=yu,CI=Dn("".replace),Hu="[\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]",js=RegExp("^"+Hu+Hu+"*"),Il=RegExp(Hu+Hu+"*$"),vf=function(o){return function(r){var i=RN(IN(r));return 1&o&&(i=CI(i,js,"")),2&o&&(i=CI(i,Il,"")),i}},II={start:vf(1),end:vf(2),trim:vf(3)},RI=sC.PROPER,bN="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",tk=II.trim;tr({target:"String",proto:!0,forced:(o="trim",Qt(function(){return!!bN[o]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[o]()||RI&&bN[o].name!==o}))},{trim:function(){return tk(this)}});var EE=gt("String").trim,vE=ho,nk=EE,bI=String.prototype,is=function(o){var r=o.trim;return"string"==typeof o||o===bI||vE(bI,o)&&r===bI.trim?nk:r},yE={exports:{}};!function(o){const r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return is(i).call(i).split("\n").map(s=>is(s).call(s))},r.splitSections=function(i){return i.split("\nm=").map((s,u)=>{var d;return is(d=u>0?"m="+s:s).call(d)+"\r\n"})},r.getDescription=function(i){const s=r.splitSections(i);return s&&s[0]},r.getMediaSections=function(i){const s=r.splitSections(i);return s.shift(),s},r.matchPrefix=function(i,s){return r.splitLines(i).filter(u=>0===u.indexOf(s))},r.parseCandidate=function(i){let s;s=0===i.indexOf("a=candidate:")?i.substring(12).split(" "):i.substring(10).split(" ");const u={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let d=8;d<s.length;d+=2)switch(s[d]){case"raddr":u.relatedAddress=s[d+1];break;case"rport":u.relatedPort=parseInt(s[d+1],10);break;case"tcptype":u.tcpType=s[d+1];break;case"ufrag":u.ufrag=s[d+1],u.usernameFragment=s[d+1];break;default:void 0===u[s[d]]&&(u[s[d]]=s[d+1])}return u},r.writeCandidate=function(i){const s=[];s.push(i.foundation);const u=i.component;s.push("rtp"===u?1:"rtcp"===u?2:u),s.push(i.protocol.toUpperCase()),s.push(i.priority),s.push(i.address||i.ip),s.push(i.port);const d=i.type;return s.push("typ"),s.push(d),"host"!==d&&i.relatedAddress&&i.relatedPort&&(s.push("raddr"),s.push(i.relatedAddress),s.push("rport"),s.push(i.relatedPort)),i.tcpType&&"tcp"===i.protocol.toLowerCase()&&(s.push("tcptype"),s.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(s.push("ufrag"),s.push(i.usernameFragment||i.ufrag)),"candidate:"+s.join(" ")},r.parseIceOptions=function(i){return i.substr(14).split(" ")},r.parseRtpMap=function(i){let s=i.substr(9).split(" ");const u={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),u.name=s[0],u.clockRate=parseInt(s[1],10),u.channels=3===s.length?parseInt(s[2],10):1,u.numChannels=u.channels,u},r.writeRtpMap=function(i){let s=i.payloadType;void 0!==i.preferredPayloadType&&(s=i.preferredPayloadType);const u=i.channels||i.numChannels||1;return"a=rtpmap:"+s+" "+i.name+"/"+i.clockRate+(1!==u?"/"+u:"")+"\r\n"},r.parseExtmap=function(i){const s=i.substr(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1]}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&"sendrecv"!==i.direction?"/"+i.direction:"")+" "+i.uri+"\r\n"},r.parseFmtp=function(i){const s={};let u;const d=i.substr(i.indexOf(" ")+1).split(";");for(let m=0;m<d.length;m++){var h,f;u=is(h=d[m]).call(h).split("="),s[is(f=u[0]).call(f)]=u[1]}return s},r.writeFmtp=function(i){let s="",u=i.payloadType;if(void 0!==i.preferredPayloadType&&(u=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const d=[];Object.keys(i.parameters).forEach(h=>{d.push(void 0!==i.parameters[h]?h+"="+i.parameters[h]:h)}),s+="a=fmtp:"+u+" "+d.join(";")+"\r\n"}return s},r.parseRtcpFb=function(i){const s=i.substr(i.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},r.writeRtcpFb=function(i){let s="",u=i.payloadType;return void 0!==i.preferredPayloadType&&(u=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(d=>{s+="a=rtcp-fb:"+u+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+"\r\n"}),s},r.parseSsrcMedia=function(i){const s=i.indexOf(" "),u={ssrc:parseInt(i.substr(7,s-7),10)},d=i.indexOf(":",s);return d>-1?(u.attribute=i.substr(s+1,d-s-1),u.value=i.substr(d+1)):u.attribute=i.substr(s+1),u},r.parseSsrcGroup=function(i){const s=i.substr(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(u=>parseInt(u,10))}},r.getMid=function(i){const s=r.matchPrefix(i,"a=mid:")[0];if(s)return s.substr(6)},r.parseFingerprint=function(i){const s=i.substr(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},r.getDtlsParameters=function(i,s){return{role:"auto",fingerprints:r.matchPrefix(i+s,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,s){let u="a=setup:"+s+"\r\n";return i.fingerprints.forEach(d=>{u+="a=fingerprint:"+d.algorithm+" "+d.value+"\r\n"}),u},r.parseCryptoLine=function(i){const s=i.substr(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+("object"==typeof i.keyParams?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(i){if(0!==i.indexOf("inline:"))return null;const s=i.substr(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,s){return r.matchPrefix(i+s,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,s){const u=r.matchPrefix(i+s,"a=ice-ufrag:")[0],d=r.matchPrefix(i+s,"a=ice-pwd:")[0];return u&&d?{usernameFragment:u.substr(12),password:d.substr(10)}:null},r.writeIceParameters=function(i){let s="a=ice-ufrag:"+i.usernameFragment+"\r\na=ice-pwd:"+i.password+"\r\n";return i.iceLite&&(s+="a=ice-lite\r\n"),s},r.parseRtpParameters=function(i){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=r.splitLines(i)[0].split(" ");for(let d=3;d<u.length;d++){const h=u[d],f=r.matchPrefix(i,"a=rtpmap:"+h+" ")[0];if(f){const m=r.parseRtpMap(f),_=r.matchPrefix(i,"a=fmtp:"+h+" ");switch(m.parameters=_.length?r.parseFmtp(_[0]):{},m.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+h+" ").map(r.parseRtcpFb),s.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(m.name.toUpperCase())}}}return r.matchPrefix(i,"a=extmap:").forEach(d=>{s.headerExtensions.push(r.parseExtmap(d))}),s},r.writeRtpDescription=function(i,s){let u="";u+="m="+i+" ",u+=s.codecs.length>0?"9":"0",u+=" UDP/TLS/RTP/SAVPF ",u+=s.codecs.map(h=>void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType).join(" ")+"\r\n",u+="c=IN IP4 0.0.0.0\r\n",u+="a=rtcp:9 IN IP4 0.0.0.0\r\n",s.codecs.forEach(h=>{u+=r.writeRtpMap(h),u+=r.writeFmtp(h),u+=r.writeRtcpFb(h)});let d=0;return s.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(u+="a=maxptime:"+d+"\r\n"),s.headerExtensions&&s.headerExtensions.forEach(h=>{u+=r.writeExtmap(h)}),u},r.parseRtpEncodingParameters=function(i){const s=[],u=r.parseRtpParameters(i),d=-1!==u.fecMechanisms.indexOf("RED"),h=-1!==u.fecMechanisms.indexOf("ULPFEC"),f=r.matchPrefix(i,"a=ssrc:").map(T=>r.parseSsrcMedia(T)).filter(T=>"cname"===T.attribute),m=f.length>0&&f[0].ssrc;let _;const E=r.matchPrefix(i,"a=ssrc-group:FID").map(T=>T.substr(17).split(" ").map(b=>parseInt(b,10)));E.length>0&&E[0].length>1&&E[0][0]===m&&(_=E[0][1]),u.codecs.forEach(T=>{if("RTX"===T.name.toUpperCase()&&T.parameters.apt){let b={ssrc:m,codecPayloadType:parseInt(T.parameters.apt,10)};m&&_&&(b.rtx={ssrc:_}),s.push(b),d&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},s.push(b))}}),0===s.length&&m&&s.push({ssrc:m});let y=r.matchPrefix(i,"b=");return y.length&&(y=0===y[0].indexOf("b=TIAS:")?parseInt(y[0].substr(7),10):0===y[0].indexOf("b=AS:")?1e3*parseInt(y[0].substr(5),10)*.95-16e3:void 0,s.forEach(T=>{T.maxBitrate=y})),s},r.parseRtcpParameters=function(i){const s={},u=r.matchPrefix(i,"a=ssrc:").map(f=>r.parseSsrcMedia(f)).filter(f=>"cname"===f.attribute)[0];u&&(s.cname=u.value,s.ssrc=u.ssrc);const d=r.matchPrefix(i,"a=rtcp-rsize");s.reducedSize=d.length>0,s.compound=0===d.length;const h=r.matchPrefix(i,"a=rtcp-mux");return s.mux=h.length>0,s},r.writeRtcpParameters=function(i){let s="";return i.reducedSize&&(s+="a=rtcp-rsize\r\n"),i.mux&&(s+="a=rtcp-mux\r\n"),void 0!==i.ssrc&&i.cname&&(s+="a=ssrc:"+i.ssrc+" cname:"+i.cname+"\r\n"),s},r.parseMsid=function(i){let s;const u=r.matchPrefix(i,"a=msid:");if(1===u.length)return s=u[0].substr(7).split(" "),{stream:s[0],track:s[1]};const d=r.matchPrefix(i,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>"msid"===h.attribute);return d.length>0?(s=d[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},r.parseSctpDescription=function(i){const s=r.parseMLine(i),u=r.matchPrefix(i,"a=max-message-size:");let d;u.length>0&&(d=parseInt(u[0].substr(19),10)),isNaN(d)&&(d=65536);const h=r.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substr(12),10),protocol:s.fmt,maxMessageSize:d};const f=r.matchPrefix(i,"a=sctpmap:");if(f.length>0){const m=f[0].substr(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},r.writeSctpDescription=function(i,s){let u=[];return u="DTLS/SCTP"!==i.protocol?["m="+i.kind+" 9 "+i.protocol+" "+s.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+s.port+"\r\n"]:["m="+i.kind+" 9 "+i.protocol+" "+s.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+s.port+" "+s.protocol+" 65535\r\n"],void 0!==s.maxMessageSize&&u.push("a=max-message-size:"+s.maxMessageSize+"\r\n"),u.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(i,s,u){let d;const h=void 0!==s?s:2;return d=i||r.generateSessionId(),"v=0\r\no="+(u||"thisisadapterortc")+" "+d+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.getDirection=function(i,s){const u=r.splitLines(i);for(let d=0;d<u.length;d++)switch(u[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[d].substr(2)}return s?r.getDirection(s):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substr(2)},r.isRejected=function(i){return"0"===i.split(" ",2)[1]},r.parseMLine=function(i){const s=r.splitLines(i)[0].substr(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},r.parseOLine=function(i){const s=r.matchPrefix(i,"o=")[0].substr(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},r.isValidSDP=function(i){if("string"!=typeof i||0===i.length)return!1;const s=r.splitLines(i);for(let u=0;u<s.length;u++)if(s[u].length<2||"="!==s[u].charAt(1))return!1;return!0},o.exports=r}(yE);var Gu=yE.exports,AN=Object.freeze(function ra(o,r){return r.forEach(function(i){i&&"string"!=typeof i&&!Array.isArray(i)&&Object.keys(i).forEach(function(s){if("default"!==s&&!(s in o)){var u=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(o,s,u.get?u:{enumerable:!0,get:function(){return i[s]}})}})}),Object.freeze(o)}({__proto__:null,default:Gu},[yE.exports]));function yf(o){if(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)return;const r=o.RTCIceCandidate;o.RTCIceCandidate=function(i){if("object"==typeof i&&i.candidate&&0===i.candidate.indexOf("a=")&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new r(i),u=Gu.parseCandidate(i.candidate),d=Object.assign(s,u);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(i)},o.RTCIceCandidate.prototype=r.prototype,pa(o,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new o.RTCIceCandidate(i.candidate),writable:"false"}),i))}function Sf(o){!o.RTCIceCandidate||o.RTCIceCandidate&&"relayProtocol"in o.RTCIceCandidate.prototype||pa(o,"icecandidate",r=>{if(r.candidate){const i=Gu.parseCandidate(r.candidate.candidate);"relay"===i.type&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function gc(o,r){if(!o.RTCPeerConnection)return;"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const h=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===r.browser&&r.version>=76){const{sdpSemantics:f}=this.getConfiguration();"plan-b"===f&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(f){if(!f||!f.sdp)return!1;const m=Gu.splitSections(f.sdp);return m.shift(),m.some(_=>{const E=Gu.parseMLine(_);return E&&"application"===E.kind&&-1!==E.protocol.indexOf("SCTP")})}(arguments[0])){const f=function(f){const m=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===m||m.length<2)return-1;const _=parseInt(m[1],10);return _!=_?-1:_}(arguments[0]),m=function(f){let m=65536;return"firefox"===r.browser&&(m=r.version<57?-1===f?16384:2147483637:r.version<60?57===r.version?65535:65536:2147483637),m}(f),_=function(f,m){let _=65536;"firefox"===r.browser&&57===r.version&&(_=65535);const E=Gu.matchPrefix(f.sdp,"a=max-message-size:");return E.length>0?_=parseInt(E[0].substr(19),10):"firefox"===r.browser&&-1!==m&&(_=2147483637),_}(arguments[0],f);let E;E=0===m&&0===_?Number.POSITIVE_INFINITY:0===m||0===_?Math.max(m,_):Math.min(m,_);const y={};Object.defineProperty(y,"maxMessageSize",{get:()=>E}),this._sctp=y}return h.apply(this,arguments)}}function Tf(o){if(!o.RTCPeerConnection||!("createDataChannel"in o.RTCPeerConnection.prototype))return;function r(s,u){const d=s.send;s.send=function(){const h=arguments[0];if("open"===s.readyState&&u.sctp&&(h.length||h.size||h.byteLength)>u.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+u.sctp.maxMessageSize+" bytes)");return d.apply(s,arguments)}}const i=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){const s=i.apply(this,arguments);return r(s,this),s},pa(o,"datachannel",s=>(r(s.channel,s.target),s))}function Rl(o){if(!o.RTCPeerConnection||"connectionState"in o.RTCPeerConnection.prototype)return;const r=o.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const s=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=u=>{const d=u.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",u);d.dispatchEvent(h)}return u},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function SE(o,r){if(!o.RTCPeerConnection||"chrome"===r.browser&&r.version>=71||"safari"===r.browser&&r.version>=605)return;const i=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&-1!==s.sdp.indexOf("\na=extmap-allow-mixed")){const u=s.sdp.split("\n").filter(d=>"a=extmap-allow-mixed"!==is(d).call(d)).join("\n");o.RTCSessionDescription&&s instanceof o.RTCSessionDescription?arguments[0]=new o.RTCSessionDescription({type:s.type,sdp:u}):s.sdp=u}return i.apply(this,arguments)}}function On(o,r){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const i=o.RTCPeerConnection.prototype.addIceCandidate;i&&0!==i.length&&(o.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===r.browser&&r.version<78||"firefox"===r.browser&&r.version<68||"safari"===r.browser)&&arguments[0]&&""===arguments[0].candidate?ie.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ie.resolve())})}function Cf(o,r){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const i=o.RTCPeerConnection.prototype.setLocalDescription;i&&0!==i.length&&(o.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if("object"!=typeof s||s.type&&s.sdp)return i.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||"offer"!==s.type&&"answer"!==s.type?i.apply(this,[s]):("offer"===s.type?this.createOffer:this.createAnswer).apply(this).then(d=>i.apply(this,[d]))})}var DN=Object.freeze({__proto__:null,shimRTCIceCandidate:yf,shimRTCIceCandidateRelayProtocol:Sf,shimMaxMessageSize:gc,shimSendThrowTypeError:Tf,shimConnectionState:Rl,removeExtmapAllowMixed:SE,shimAddIceCandidateNullOrEmpty:On,shimParameterlessSetLocalDescription:Cf});let Gn,it;(function(){let{window:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=t_,s=function eO(o){const r={browser:null,version:null};if(void 0===o||!o.navigator)return r.browser="Not a browser.",r;const{navigator:i}=o;if(i.mozGetUserMedia)r.browser="firefox",r.version=pu(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||!1===o.isSecureContext&&o.webkitRTCPeerConnection)r.browser="chrome",r.version=pu(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!i.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=pu(i.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return r}(o),u={browserDetails:s,commonShim:DN,extractVersion:pu,disableLog:DT,disableWarnings:Jd,sdp:AN};switch(s.browser){case"chrome":if(!_f||!fI||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),u;if(null===s.version)return i("Chrome shim can not determine version, not shimming."),u;i("adapter.js shimming chrome."),u.browserShim=_f,On(o,s),Cf(o),lI(o,s),lE(o),fI(o,s),hE(o),pI(o,s),Cl(o),gf(o),mc(o),mI(o,s),yf(o),Sf(o),Rl(o),gc(o,s),Tf(o),SE(o,s);break;case"firefox":if(!yI||!ju||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),u;i("adapter.js shimming firefox."),u.browserShim=yI,On(o,s),Cf(o),gI(o,s),ju(o,s),Fu(o),fE(o),Ef(o),pE(o),mE(o),gE(o),_I(o),EI(o),vI(o),yf(o),Rl(o),gc(o,s),Tf(o);break;case"safari":if(!_E||!r.shimSafari)return i("Safari shim is not included in this adapter release."),u;i("adapter.js shimming safari."),u.browserShim=_E,On(o,s),Cf(o),vN(o),SN(o),Bu(o),SI(o),Fs(o),yN(o),TI(o),TN(o),yf(o),Sf(o),gc(o,s),Tf(o),SE(o,s);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),function(o){o.WIN_10="Windows 10",o.WIN_81="Windows 8.1",o.WIN_8="Windows 8",o.WIN_7="Windows 7",o.WIN_VISTA="Windows Vista",o.WIN_SERVER_2003="Windows Server 2003",o.WIN_XP="Windows XP",o.WIN_2000="Windows 2000",o.ANDROID="Android",o.HARMONY_OS="HarmonyOS",o.OPEN_BSD="Open BSD",o.SUN_OS="Sun OS",o.LINUX="Linux",o.IOS="iOS",o.MAC_OS="Mac OS",o.QNX="QNX",o.UNIX="UNIX",o.BEOS="BeOS",o.OS_2="OS/2",o.SEARCH_BOT="Search Bot"}(Gn||(Gn={})),function(o){o.CHROME="Chrome",o.SAFARI="Safari",o.EDGE="Edge",o.FIREFOX="Firefox",o.OPERA="OPR",o.QQ="QQBrowser",o.WECHAT="MicroMessenger"}(it||(it={}));var TE={exports:{}};!function(o,r){!function(i,s){var u="function",d="undefined",h="object",f="string",_="model",E="name",y="type",T="vendor",b="version",w="architecture",P="console",k="mobile",x="tablet",B="smarttv",H="wearable",ce="embedded",Re="Amazon",Z="Apple",Y="ASUS",ee="BlackBerry",Et="Google",vt="Microsoft",Jn="Motorola",Sn="Samsung",G="Sharp",z="Sony",ne="Xiaomi",_e="Zebra",We="Facebook",X="Chromium OS",C="Mac OS",N=function(Kt){for(var Xt={},yt=0;yt<Kt.length;yt++)Xt[Kt[yt].toUpperCase()]=Kt[yt];return Xt},U=function(Kt,Xt){return typeof Kt===f&&-1!==K(Xt).indexOf(K(Kt))},K=function(Kt){return Kt.toLowerCase()},Ce=function(Kt,Xt){if(typeof Kt===f)return Kt=Kt.replace(/^\s\s*/,""),typeof Xt===d?Kt:Kt.substring(0,350)},Ct=function(Kt,Xt){for(var yt,Xr,Gi,zt,He,lo,Ha=0;Ha<Xt.length&&!He;){var Wi=Xt[Ha],kD=Xt[Ha+1];for(yt=Xr=0;yt<Wi.length&&!He&&Wi[yt];)if(He=Wi[yt++].exec(Kt))for(Gi=0;Gi<kD.length;Gi++)lo=He[++Xr],typeof(zt=kD[Gi])===h&&zt.length>0?2===zt.length?this[zt[0]]=typeof zt[1]==u?zt[1].call(this,lo):zt[1]:3===zt.length?this[zt[0]]=typeof zt[1]!==u||zt[1].exec&&zt[1].test?lo?lo.replace(zt[1],zt[2]):s:lo?zt[1].call(this,lo,zt[2]):s:4===zt.length&&(this[zt[0]]=lo?zt[3].call(this,lo.replace(zt[1],zt[2])):s):this[zt]=lo||s;Ha+=2}},mr=function(Kt,Xt){for(var yt in Xt)if(typeof Xt[yt]===h&&Xt[yt].length>0){for(var Xr=0;Xr<Xt[yt].length;Xr++)if(U(Xt[yt][Xr],Kt))return"?"===yt?s:yt}else if(U(Xt[yt],Kt))return"?"===yt?s:yt;return Kt},$o={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},tu={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[b,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[b,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,b],[/opios[\/ ]+([\w\.]+)/i],[b,[E,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[b,[E,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[E,b],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[b,[E,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[b,[E,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[b,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[b,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[b,[E,"IE"]],[/yabrowser\/([\w\.]+)/i],[b,[E,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure Browser"],b],[/\bfocus\/([\w\.]+)/i],[b,[E,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[b,[E,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[b,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[b,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[b,[E,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[b,[E,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[b,[E,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[E,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1 Browser"],b],[/(comodo_dragon)\/([\w\.]+)/i],[[E,/_/g," "],b],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[E,b],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,We],b],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[E,b],[/\bgsa\/([\w\.]+) .*safari\//i],[b,[E,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[b,[E,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,"Chrome WebView"],b],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[b,[E,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,b],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[b,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[b,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[b,mr,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,b],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],b],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[b,[E,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[E,b],[/(cobalt)\/([\w\.]+)/i],[E,[b,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[w,"amd64"]],[/(ia32(?=;))/i],[[w,K]],[/((?:i[346]|x)86)[;\)]/i],[[w,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[w,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[w,"armhf"]],[/windows (ce|mobile); ppc;/i],[[w,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[w,/ower/,"",K]],[/(sun4\w)[;\)]/i],[[w,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[w,K]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[T,Sn],[y,x]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[_,[T,Sn],[y,k]],[/\((ip(?:hone|od)[\w ]*);/i],[_,[T,Z],[y,k]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[T,Z],[y,x]],[/(macintosh);/i],[_,[T,Z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[T,G],[y,k]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[T,"Huawei"],[y,x]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[T,"Huawei"],[y,k]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[_,/_/g," "],[T,ne],[y,k]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[T,ne],[y,x]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[T,"OPPO"],[y,k]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[T,"Vivo"],[y,k]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[_,[T,"Realme"],[y,k]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[T,Jn],[y,k]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[T,Jn],[y,x]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[T,"LG"],[y,x]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[T,"LG"],[y,k]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[T,"Lenovo"],[y,x]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[T,"Nokia"],[y,k]],[/(pixel c)\b/i],[_,[T,Et],[y,x]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[T,Et],[y,k]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[T,z],[y,k]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[T,z],[y,x]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[T,"OnePlus"],[y,k]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[T,Re],[y,x]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[T,Re],[y,k]],[/(playbook);[-\w\),; ]+(rim)/i],[_,T,[y,x]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[T,ee],[y,k]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[T,Y],[y,x]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[T,Y],[y,k]],[/(nexus 9)/i],[_,[T,"HTC"],[y,x]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[T,[_,/_/g," "],[y,k]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[T,"Acer"],[y,x]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[T,"Meizu"],[y,k]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[T,_,[y,k]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[T,_,[y,x]],[/(surface duo)/i],[_,[T,vt],[y,x]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[T,"Fairphone"],[y,k]],[/(u304aa)/i],[_,[T,"AT&T"],[y,k]],[/\bsie-(\w*)/i],[_,[T,"Siemens"],[y,k]],[/\b(rct\w+) b/i],[_,[T,"RCA"],[y,x]],[/\b(venue[\d ]{2,7}) b/i],[_,[T,"Dell"],[y,x]],[/\b(q(?:mv|ta)\w+) b/i],[_,[T,"Verizon"],[y,x]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[T,"Barnes & Noble"],[y,x]],[/\b(tm\d{3}\w+) b/i],[_,[T,"NuVision"],[y,x]],[/\b(k88) b/i],[_,[T,"ZTE"],[y,x]],[/\b(nx\d{3}j) b/i],[_,[T,"ZTE"],[y,k]],[/\b(gen\d{3}) b.+49h/i],[_,[T,"Swiss"],[y,k]],[/\b(zur\d{3}) b/i],[_,[T,"Swiss"],[y,x]],[/\b((zeki)?tb.*\b) b/i],[_,[T,"Zeki"],[y,x]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[T,"Dragon Touch"],_,[y,x]],[/\b(ns-?\w{0,9}) b/i],[_,[T,"Insignia"],[y,x]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[T,"NextBook"],[y,x]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[T,"Voice"],_,[y,k]],[/\b(lvtel\-)?(v1[12]) b/i],[[T,"LvTel"],_,[y,k]],[/\b(ph-1) /i],[_,[T,"Essential"],[y,k]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[T,"Envizen"],[y,x]],[/\b(trio[-\w\. ]+) b/i],[_,[T,"MachSpeed"],[y,x]],[/\btu_(1491) b/i],[_,[T,"Rotor"],[y,x]],[/(shield[\w ]+) b/i],[_,[T,"Nvidia"],[y,x]],[/(sprint) (\w+)/i],[T,_,[y,k]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[T,vt],[y,k]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[T,_e],[y,x]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[T,_e],[y,k]],[/smart-tv.+(samsung)/i],[T,[y,B]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[T,Sn],[y,B]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[T,"LG"],[y,B]],[/(apple) ?tv/i],[T,[_,"Apple TV"],[y,B]],[/crkey/i],[[_,"Chromecast"],[T,Et],[y,B]],[/droid.+aft(\w)( bui|\))/i],[_,[T,Re],[y,B]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[T,G],[y,B]],[/(bravia[\w ]+)( bui|\))/i],[_,[T,z],[y,B]],[/(mitv-\w{5}) bui/i],[_,[T,ne],[y,B]],[/Hbbtv.*(technisat) (.*);/i],[T,_,[y,B]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[T,Ce],[_,Ce],[y,B]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[y,B]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[T,_,[y,P]],[/droid.+; (shield) bui/i],[_,[T,"Nvidia"],[y,P]],[/(playstation [345portablevi]+)/i],[_,[T,z],[y,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[T,vt],[y,P]],[/((pebble))app/i],[T,_,[y,H]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[T,Z],[y,H]],[/droid.+; (glass) \d/i],[_,[T,Et],[y,H]],[/droid.+; (wt63?0{2,3})\)/i],[_,[T,_e],[y,H]],[/(quest( 2| pro)?)/i],[_,[T,We],[y,H]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[T,[y,ce]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[_,[y,k]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[y,x]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[y,x]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[y,k]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[T,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[b,[E,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[b,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[E,b],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[b,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,b],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[E,[b,mr,$o]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[E,"Windows"],[b,mr,$o]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[b,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,C],[b,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[b,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,b],[/\(bb(10);/i],[b,[E,ee]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[b,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[b,[E,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[b,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[b,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[b,[E,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,X],b],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,b],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],b],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[E,b]]},vi=function(Kt,Xt){if(typeof Kt===h&&(Xt=Kt,Kt=s),!(this instanceof vi))return new vi(Kt,Xt).getResult();var yt=typeof i!==d&&i.navigator?i.navigator:s,Xr=Kt||(yt&&yt.userAgent?yt.userAgent:""),Gi=yt&&yt.userAgentData?yt.userAgentData:s,zt=Xt?function(He,lo){var Ha={};for(var Wi in He)Ha[Wi]=lo[Wi]&&lo[Wi].length%2==0?lo[Wi].concat(He[Wi]):He[Wi];return Ha}(tu,Xt):tu;return this.getBrowser=function(){var lo,He={};return He.name=s,He.version=s,Ct.call(He,Xr,zt.browser),He.major=typeof(lo=He.version)===f?lo.replace(/[^\d\.]/g,"").split(".")[0]:s,yt&&yt.brave&&typeof yt.brave.isBrave==u&&(He.name="Brave"),He},this.getCPU=function(){var He={};return He.architecture=s,Ct.call(He,Xr,zt.cpu),He},this.getDevice=function(){var He={};return He.vendor=s,He.model=s,He.type=s,Ct.call(He,Xr,zt.device),!He.type&&Gi&&Gi.mobile&&(He.type=k),"Macintosh"==He.model&&yt&&typeof yt.standalone!==d&&yt.maxTouchPoints&&yt.maxTouchPoints>2&&(He.model="iPad",He.type=x),He},this.getEngine=function(){var He={};return He.name=s,He.version=s,Ct.call(He,Xr,zt.engine),He},this.getOS=function(){var He={};return He.name=s,He.version=s,Ct.call(He,Xr,zt.os),!He.name&&Gi&&"Unknown"!=Gi.platform&&(He.name=Gi.platform.replace(/chrome os/i,X).replace(/macos/i,C)),He},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Xr},this.setUA=function(He){return Xr=typeof He===f&&He.length>350?Ce(He,350):He,this},this.setUA(Xr),this};vi.VERSION="0.7.34",vi.BROWSER=N([E,b,"major"]),vi.CPU=N([w]),vi.DEVICE=N([_,T,y,P,k,B,x,H,ce]),vi.ENGINE=vi.OS=N([E,b]),o.exports&&(r=o.exports=vi),r.UAParser=vi;var nu=typeof i!==d&&(i.jQuery||i.Zepto);if(nu&&!nu.ua){var Od=new vi;nu.ua=Od.getResult(),nu.ua.get=function(){return Od.getUA()},nu.ua.set=function(Kt){Od.setUA(Kt);var Xt=Od.getResult();for(var yt in Xt)nu.ua[yt]=Xt[yt]}}}("object"==typeof window?window:Mo)}(TE,TE.exports);const CE=new TE.exports;let IE,So,ss=CE.getResult(),AI=null;function ut(o){if(!AI){o&&CE.setUA(o),ss=CE.getResult();const r=function(d){if("Blink"===d.engine.name&&"WeChat"!==d.browser.name)return it.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return it.CHROME;case"Safari":case"Mobile Safari":return it.SAFARI;case"Edge":return it.EDGE;case"Firefox":return it.FIREFOX;case"QQBrowser":return it.QQ;case"Opera":return it.OPERA;case"WeChat":return it.WECHAT;default:return d.browser.name||""}}(ss),i=function(d){let h;return h="Blink"===d.engine.name?d.engine.version||"":d.browser.version||"",h.split(".")[0]}(ss),s="Windows"===(d=ss).os.name?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||"",u=ss.os.version;if(!(r&&i&&s&&u))return{name:r,version:i,os:s,osVersion:u};AI={name:r,version:i,os:s,osVersion:u}}var d;return AI}function Wu(){return ut().os}function Se(){const o=ut();return"".concat(o.os," ").concat(o.osVersion)}function Sa(){const o=ut();return!!("WebKit"===ss.engine.name&&o.os===Gn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&o.name!==it.SAFARI||vr()&&o.name!==it.SAFARI)}function If(){return ut().name===it.CHROME}function or(){return ut().name===it.SAFARI}function Bt(){return ut().name===it.FIREFOX}function vr(){return ut().os===Gn.IOS}function Rf(o){const r=ut();return!(r.name!==it.CHROME||!r.osVersion)&&Number(r.version)>=o}function bf(o){const r=ut();return!(r.name!==it.EDGE||!r.osVersion)&&Number(r.version)>=o}function wN(o){const r=ut();return!(r.name!==it.OPERA||!r.osVersion)&&Number(r.version)>=o}function Af(){const o=ut();return!(o.name!==it.CHROME||!o.osVersion)&&Number(o.version)<=90}function OI(){const o=ut();if(o.os!==Gn.IOS||!o.osVersion)return!1;const r=o.osVersion.split(".");return Number(r[0])<14||14===Number(r[0])&&Number(r[1])<=6}function Ta(){const o=ut();if(o.os!==Gn.IOS||!o.osVersion)return!1;const r=o.osVersion.split(".");return 15===Number(r[0])}function Df(){const o=ut();if(o.os!==Gn.IOS||!o.osVersion)return!1;const r=o.osVersion.split(".");return 16===Number(r[0])}function RE(){const o=ut();if(o.os!==Gn.IOS||!o.osVersion)return!1;const r=o.osVersion.split(".");return 15===Number(r[0])&&Number(r[1])>=1}function Wr(){return or()&&navigator.maxTouchPoints>0}function NI(){return ut().name===it.WECHAT}function wf(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function as(){const o=ut();return o.name!==it.EDGE&&o.name!==it.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Of(){return Wu()===Gn.ANDROID}function _c(){const o=ut();return Of()&&(o.name===it.CHROME||o.name===it.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}(function(o){o.L1T1="L1T1",o.L1T2="L1T2",o.L1T3="L1T3",o.L2T1_KEY="L2T1_KEY",o.L2T2_KEY="L2T2_KEY",o.L2T3_KEY="L2T3_KEY",o.L3T1_KEY="L3T1_KEY",o.L3T2_KEY="L3T2_KEY",o.L3T3_KEY="L3T3_KEY"})(IE||(IE={})),function(o){o.CERTIFICATE="certificate",o.CODEC="codec",o.CANDIDATE_PAIR="candidate-pair",o.LOCAL_CANDIDATE="local-candidate",o.REMOTE_CANDIDATE="remote-candidate",o.INBOUND="inbound-rtp",o.TRACK="track",o.OUTBOUND="outbound-rtp",o.PC="peer-connection",o.REMOTE_INBOUND="remote-inbound-rtp",o.REMOTE_OUTBOUND="remote-outbound-rtp",o.TRANSPORT="transport",o.CSRC="csrc",o.DATA_CHANNEL="data-channel",o.STREAM="stream",o.SENDER="sender",o.RECEIVER="receiver"}(So||(So={}));var bl={exports:{}},Nf=Yi.f;tr({target:"Object",stat:!0,forced:Object.defineProperty!==Nf,sham:!Xo},{defineProperty:Nf});var PI=da.Object,ON=bl.exports=function(o,r,i){return PI.defineProperty(o,r,i)};PI.defineProperty.sham&&(ON.sham=!0);var AE=bl.exports;function S(o,r,i){return r in o?AE(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,o}var DE,wE={exports:{}},MI=function(o,r){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return o.apply(r,i)}},OE=MI,Ku=Object.prototype.toString,NE=(DE=Object.create(null),function(o){var r=Ku.call(o);return DE[r]||(DE[r]=r.slice(8,-1).toLowerCase())});function Ca(o){return o=o.toLowerCase(),function(r){return NE(r)===o}}function Bs(o){return Array.isArray(o)}function PE(o){return void 0===o}var NN=Ca("ArrayBuffer");function ME(o){return null!==o&&"object"==typeof o}function Pf(o){if("object"!==NE(o))return!1;var r=Object.getPrototypeOf(o);return null===r||r===Object.prototype}var rk=Ca("Date"),ok=Ca("File"),Mf=Ca("Blob"),PN=Ca("FileList");function Al(o){return"[object Function]"===Ku.call(o)}var LE=Ca("URLSearchParams");function Ec(o,r){if(null!=o)if("object"!=typeof o&&(o=[o]),Bs(o))for(var i=0,s=o.length;i<s;i++)r.call(null,o[i],i,o);else for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&r.call(null,o[u],u,o)}var Dl,kE=(Dl=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(o){return Dl&&o instanceof Dl}),Wn={isArray:Bs,isArrayBuffer:NN,isBuffer:function(o){return null!==o&&!PE(o)&&null!==o.constructor&&!PE(o.constructor)&&"function"==typeof o.constructor.isBuffer&&o.constructor.isBuffer(o)},isFormData:function(o){var r="[object FormData]";return o&&("function"==typeof FormData&&o instanceof FormData||Ku.call(o)===r||Al(o.toString)&&o.toString()===r)},isArrayBufferView:function(o){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer&&NN(o.buffer)},isString:function(o){return"string"==typeof o},isNumber:function(o){return"number"==typeof o},isObject:ME,isPlainObject:Pf,isUndefined:PE,isDate:rk,isFile:ok,isBlob:Mf,isFunction:Al,isStream:function(o){return ME(o)&&Al(o.pipe)},isURLSearchParams:LE,isStandardBrowserEnv:function(){return(typeof navigator>"u"||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&typeof window<"u"&&typeof document<"u"},forEach:Ec,merge:function o(){var r={};function i(d,h){r[h]=Pf(r[h])&&Pf(d)?o(r[h],d):Pf(d)?o({},d):Bs(d)?d.slice():d}for(var s=0,u=arguments.length;s<u;s++)Ec(arguments[s],i);return r},extend:function(o,r,i){return Ec(r,function(s,u){o[u]=i&&"function"==typeof s?OE(s,i):s}),o},trim:function(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")},stripBOM:function(o){return 65279===o.charCodeAt(0)&&(o=o.slice(1)),o},inherits:function(o,r,i,s){o.prototype=Object.create(r.prototype,s),o.prototype.constructor=o,i&&Object.assign(o.prototype,i)},toFlatObject:function(o,r,i){var s,u,d,h={};r=r||{};do{for(u=(s=Object.getOwnPropertyNames(o)).length;u-- >0;)h[d=s[u]]||(r[d]=o[d],h[d]=!0);o=Object.getPrototypeOf(o)}while(o&&(!i||i(o,r))&&o!==Object.prototype);return r},kindOf:NE,kindOfTest:Ca,endsWith:function(o,r,i){o=String(o),(void 0===i||i>o.length)&&(i=o.length);var s=o.indexOf(r,i-=r.length);return-1!==s&&s===i},toArray:function(o){if(!o)return null;var r=o.length;if(PE(r))return null;for(var i=new Array(r);r-- >0;)i[r]=o[r];return i},isTypedArray:kE,isFileList:PN},Hs=Wn;function qu(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var xE=function(o,r,i){if(!r)return o;var s;if(i)s=i(r);else if(Hs.isURLSearchParams(r))s=r.toString();else{var u=[];Hs.forEach(r,function(h,f){null!=h&&(Hs.isArray(h)?f+="[]":h=[h],Hs.forEach(h,function(m){Hs.isDate(m)?m=m.toISOString():Hs.isObject(m)&&(m=JSON.stringify(m)),u.push(qu(f)+"="+qu(m))}))}),s=u.join("&")}if(s){var d=o.indexOf("#");-1!==d&&(o=o.slice(0,d)),o+=(-1===o.indexOf("?")?"?":"&")+s}return o},UE=Wn;function vc(){this.handlers=[]}vc.prototype.use=function(o,r,i){return this.handlers.push({fulfilled:o,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1},vc.prototype.eject=function(o){this.handlers[o]&&(this.handlers[o]=null)},vc.prototype.forEach=function(o){UE.forEach(this.handlers,function(r){null!==r&&o(r)})};var ik=vc,VE=Wn,Lf=Wn;function yc(o,r,i,s,u){Error.call(this),this.message=o,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),s&&(this.request=s),u&&(this.response=u)}Lf.inherits(yc,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var LI=yc.prototype,kI={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(o){kI[o]={value:o}}),Object.defineProperties(yc,kI),Object.defineProperty(LI,"isAxiosError",{value:!0}),yc.from=function(o,r,i,s,u,d){var h=Object.create(LI);return Lf.toFlatObject(o,h,function(f){return f!==Error.prototype}),yc.call(h,o.message,r,i,s,u),h.name=o.name,d&&Object.assign(h,d),h};var Sc=yc,FE={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wi=Wn,xI=function(o,r){r=r||new FormData;var i=[];function s(u){return null===u?"":wi.isDate(u)?u.toISOString():wi.isArrayBuffer(u)||wi.isTypedArray(u)?"function"==typeof Blob?new Blob([u]):Buffer.from(u):u}return function u(d,h){if(wi.isPlainObject(d)||wi.isArray(d)){if(-1!==i.indexOf(d))throw Error("Circular reference detected in "+h);i.push(d),wi.forEach(d,function(f,m){if(!wi.isUndefined(f)){var _,E=h?h+"."+m:m;if(f&&!h&&"object"==typeof f)if(wi.endsWith(m,"{}"))f=JSON.stringify(f);else if(wi.endsWith(m,"[]")&&(_=wi.toArray(f)))return void _.forEach(function(y){!wi.isUndefined(y)&&r.append(E,s(y))});u(f,E)}}),i.pop()}else r.append(h,s(d))}(o),r},UI=Sc,kf=Wn,jE=kf.isStandardBrowserEnv()?{write:function(o,r,i,s,u,d){var h=[];h.push(o+"="+encodeURIComponent(r)),kf.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),kf.isString(s)&&h.push("path="+s),kf.isString(u)&&h.push("domain="+u),!0===d&&h.push("secure"),document.cookie=h.join("; ")},read:function(o){var r=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(o){this.write(o,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},HE=function(o,r){return o&&!function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}(r)?function(o,r){return r?o.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):o}(o,r):r},wl=Wn,xf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],VI=Wn,FI=VI.isStandardBrowserEnv()?function(){var o,r=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function s(u){var d=u;return r&&(i.setAttribute("href",d),d=i.href),i.setAttribute("href",d),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return o=s(window.location.href),function(u){var d=VI.isString(u)?s(u):u;return d.protocol===o.protocol&&d.host===o.host}}():function(){return!0},GE=Sc;function WE(o){GE.call(this,o??"canceled",GE.ERR_CANCELED),this.name="CanceledError"}Wn.inherits(WE,GE,{__CANCEL__:!0});var KE=WE,Ol=Wn,LN=jE,$u=xE,Vo=HE,jI=FI,Gs=FE,Ws=Sc,xN=KE,ir=Wn,zu=function(o,r){VE.forEach(o,function(i,s){s!==r&&s.toUpperCase()===r.toUpperCase()&&(o[r]=i,delete o[s])})},qE=Sc,sk=xI,$E={"Content-Type":"application/x-www-form-urlencoded"};function Ia(o,r){!ir.isUndefined(o)&&ir.isUndefined(o["Content-Type"])&&(o["Content-Type"]=r)}var Pl,Ml={transitional:FE,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&"[object process]"===Object.prototype.toString.call(process))&&(Pl=function(o){return new Promise(function(r,i){var s,u=o.data,d=o.headers,h=o.responseType;function f(){o.cancelToken&&o.cancelToken.unsubscribe(s),o.signal&&o.signal.removeEventListener("abort",s)}Ol.isFormData(u)&&Ol.isStandardBrowserEnv()&&delete d["Content-Type"];var m=new XMLHttpRequest;if(o.auth){var _=o.auth.username||"",E=o.auth.password?unescape(encodeURIComponent(o.auth.password)):"";d.Authorization="Basic "+btoa(_+":"+E)}var y=Vo(o.baseURL,o.url);function T(){if(m){var P="getAllResponseHeaders"in m?function(o){var r,i,s,u={};return o&&wl.forEach(o.split("\n"),function(d){if(s=d.indexOf(":"),r=wl.trim(d.substr(0,s)).toLowerCase(),i=wl.trim(d.substr(s+1)),r){if(u[r]&&xf.indexOf(r)>=0)return;u[r]="set-cookie"===r?(u[r]?u[r]:[]).concat([i]):u[r]?u[r]+", "+i:i}}),u}(m.getAllResponseHeaders()):null;(function(o,r,i){var s=i.config.validateStatus;i.status&&s&&!s(i.status)?r(new UI("Request failed with status code "+i.status,[UI.ERR_BAD_REQUEST,UI.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):o(i)})(function(x){r(x),f()},function(x){i(x),f()},{data:h&&"text"!==h&&"json"!==h?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:P,config:o,request:m}),m=null}}if(m.open(o.method.toUpperCase(),$u(y,o.params,o.paramsSerializer),!0),m.timeout=o.timeout,"onloadend"in m?m.onloadend=T:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(T)},m.onabort=function(){m&&(i(new Ws("Request aborted",Ws.ECONNABORTED,o,m)),m=null)},m.onerror=function(){i(new Ws("Network Error",Ws.ERR_NETWORK,o,m,m)),m=null},m.ontimeout=function(){var P=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";o.timeoutErrorMessage&&(P=o.timeoutErrorMessage),i(new Ws(P,(o.transitional||Gs).clarifyTimeoutError?Ws.ETIMEDOUT:Ws.ECONNABORTED,o,m)),m=null},Ol.isStandardBrowserEnv()){var b=(o.withCredentials||jI(y))&&o.xsrfCookieName?LN.read(o.xsrfCookieName):void 0;b&&(d[o.xsrfHeaderName]=b)}"setRequestHeader"in m&&Ol.forEach(d,function(P,k){void 0===u&&"content-type"===k.toLowerCase()?delete d[k]:m.setRequestHeader(k,P)}),Ol.isUndefined(o.withCredentials)||(m.withCredentials=!!o.withCredentials),h&&"json"!==h&&(m.responseType=o.responseType),"function"==typeof o.onDownloadProgress&&m.addEventListener("progress",o.onDownloadProgress),"function"==typeof o.onUploadProgress&&m.upload&&m.upload.addEventListener("progress",o.onUploadProgress),(o.cancelToken||o.signal)&&(s=function(P){m&&(i(!P||P&&P.type?new xN:P),m.abort(),m=null)},o.cancelToken&&o.cancelToken.subscribe(s),o.signal&&(o.signal.aborted?s():o.signal.addEventListener("abort",s))),u||(u=null);var w=function(o){var r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return r&&r[1]||""}(y);w&&-1===["http","https","file"].indexOf(w)?i(new Ws("Unsupported protocol "+w+":",Ws.ERR_BAD_REQUEST,o)):m.send(u)})}),Pl),transformRequest:[function(o,r){if(zu(r,"Accept"),zu(r,"Content-Type"),ir.isFormData(o)||ir.isArrayBuffer(o)||ir.isBuffer(o)||ir.isStream(o)||ir.isFile(o)||ir.isBlob(o))return o;if(ir.isArrayBufferView(o))return o.buffer;if(ir.isURLSearchParams(o))return Ia(r,"application/x-www-form-urlencoded;charset=utf-8"),o.toString();var i,s=ir.isObject(o),u=r&&r["Content-Type"];if((i=ir.isFileList(o))||s&&"multipart/form-data"===u){var d=this.env&&this.env.FormData;return sk(i?{"files[]":o}:o,d&&new d)}return s||"application/json"===u?(Ia(r,"application/json"),function(h,f,m){if(ir.isString(h))try{return(0,JSON.parse)(h),ir.trim(h)}catch(_){if("SyntaxError"!==_.name)throw _}return(0,JSON.stringify)(h)}(o)):o}],transformResponse:[function(o){var r=this.transitional||Ml.transitional,u=!(r&&r.silentJSONParsing)&&"json"===this.responseType;if(u||r&&r.forcedJSONParsing&&ir.isString(o)&&o.length)try{return JSON.parse(o)}catch(d){if(u)throw"SyntaxError"===d.name?qE.from(d,qE.ERR_BAD_RESPONSE,this,null,this.response):d}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ir.forEach(["delete","get","head"],function(o){Ml.headers[o]={}}),ir.forEach(["post","put","patch"],function(o){Ml.headers[o]=ir.merge($E)});var Vf=Ml,VN=Wn,FN=Vf,BI=function(o){return!(!o||!o.__CANCEL__)},HI=Wn,zE=function(o,r,i){var s=this||FN;return VN.forEach(i,function(u){o=u.call(s,o,r)}),o},jN=BI,GI=Vf,Yu=KE;function Oi(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new Yu}var To=Wn,BN=function(o,r){r=r||{};var i={};function s(_,E){return To.isPlainObject(_)&&To.isPlainObject(E)?To.merge(_,E):To.isPlainObject(E)?To.merge({},E):To.isArray(E)?E.slice():E}function u(_){return To.isUndefined(r[_])?To.isUndefined(o[_])?void 0:s(void 0,o[_]):s(o[_],r[_])}function d(_){if(!To.isUndefined(r[_]))return s(void 0,r[_])}function h(_){return To.isUndefined(r[_])?To.isUndefined(o[_])?void 0:s(void 0,o[_]):s(void 0,r[_])}function f(_){return _ in r?s(o[_],r[_]):_ in o?s(void 0,o[_]):void 0}var m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:f};return To.forEach(Object.keys(o).concat(Object.keys(r)),function(_){var E=m[_]||u,y=E(_);To.isUndefined(y)&&E!==f||(i[_]=y)}),i},Tc=Sc,Ff={};["object","boolean","number","function","string","symbol"].forEach(function(o,r){Ff[o]=function(i){return typeof i===o||"a"+(r<1?"n ":" ")+o}});var YE={};Ff.transitional=function(o,r,i){function s(u,d){return"[Axios v0.27.2] Transitional option '"+u+"'"+d+(i?". "+i:"")}return function(u,d,h){if(!1===o)throw new Tc(s(d," has been removed"+(r?" in "+r:"")),Tc.ERR_DEPRECATED);return r&&!YE[d]&&(YE[d]=!0,console.warn(s(d," has been deprecated since v"+r+" and will be removed in the near future"))),!o||o(u,d,h)}};var HN=Wn,KI=xE,Ll=ik,JE=function(o){return Oi(o),o.headers=o.headers||{},o.data=zE.call(o,o.data,o.headers,o.transformRequest),o.headers=HI.merge(o.headers.common||{},o.headers[o.method]||{},o.headers),HI.forEach(["delete","get","head","post","put","patch","common"],function(r){delete o.headers[r]}),(o.adapter||GI.adapter)(o).then(function(r){return Oi(o),r.data=zE.call(o,r.data,r.headers,o.transformResponse),r},function(r){return jN(r)||(Oi(o),r&&r.response&&(r.response.data=zE.call(o,r.response.data,r.response.headers,o.transformResponse))),Promise.reject(r)})},kl=BN,qI=HE,Ze={assertOptions:function(o,r,i){if("object"!=typeof o)throw new Tc("options must be an object",Tc.ERR_BAD_OPTION_VALUE);for(var s=Object.keys(o),u=s.length;u-- >0;){var d=s[u],h=r[d];if(h){var f=o[d],m=void 0===f||h(f,d,o);if(!0!==m)throw new Tc("option "+d+" must be "+m,Tc.ERR_BAD_OPTION_VALUE)}else if(!0!==i)throw new Tc("Unknown option "+d,Tc.ERR_BAD_OPTION)}},validators:Ff},us=Ze.validators;function Cc(o){this.defaults=o,this.interceptors={request:new Ll,response:new Ll}}Cc.prototype.request=function(o,r){"string"==typeof o?(r=r||{}).url=o:r=o||{},r.method=(r=kl(this.defaults,r)).method?r.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var i=r.transitional;void 0!==i&&Ze.assertOptions(i,{silentJSONParsing:us.transitional(us.boolean),forcedJSONParsing:us.transitional(us.boolean),clarifyTimeoutError:us.transitional(us.boolean)},!1);var s=[],u=!0;this.interceptors.request.forEach(function(y){"function"==typeof y.runWhen&&!1===y.runWhen(r)||(u=u&&y.synchronous,s.unshift(y.fulfilled,y.rejected))});var d,h=[];if(this.interceptors.response.forEach(function(y){h.push(y.fulfilled,y.rejected)}),!u){var f=[JE,void 0];for(Array.prototype.unshift.apply(f,s),f=f.concat(h),d=Promise.resolve(r);f.length;)d=d.then(f.shift(),f.shift());return d}for(var m=r;s.length;){var _=s.shift(),E=s.shift();try{m=_(m)}catch(y){E(y);break}}try{d=JE(m)}catch(y){return Promise.reject(y)}for(;h.length;)d=d.then(h.shift(),h.shift());return d},Cc.prototype.getUri=function(o){o=kl(this.defaults,o);var r=qI(o.baseURL,o.url);return KI(r,o.params,o.paramsSerializer)},HN.forEach(["delete","get","head","options"],function(o){Cc.prototype[o]=function(r,i){return this.request(kl(i||{},{method:o,url:r,data:(i||{}).data}))}}),HN.forEach(["post","put","patch"],function(o){function r(i){return function(s,u,d){return this.request(kl(d||{},{method:o,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:u}))}}Cc.prototype[o]=r(),Cc.prototype[o+"Form"]=r(!0)});var ck=Cc,GN=KE;function Ic(o){if("function"!=typeof o)throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(s){r=s});var i=this;this.promise.then(function(s){if(i._listeners){var u,d=i._listeners.length;for(u=0;u<d;u++)i._listeners[u](s);i._listeners=null}}),this.promise.then=function(s){var u,d=new Promise(function(h){i.subscribe(h),u=h}).then(s);return d.cancel=function(){i.unsubscribe(u)},d},o(function(s){i.reason||(i.reason=new GN(s),r(i.reason))})}Ic.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Ic.prototype.subscribe=function(o){this.reason?o(this.reason):this._listeners?this._listeners.push(o):this._listeners=[o]},Ic.prototype.unsubscribe=function(o){if(this._listeners){var r=this._listeners.indexOf(o);-1!==r&&this._listeners.splice(r,1)}},Ic.source=function(){var o;return{token:new Ic(function(r){o=r}),cancel:o}};var WN=Ic,KN=Wn,XE=Wn,qN=MI,xl=ck,$N=BN,Co=function o(r){var i=new xl(r),s=qN(xl.prototype.request,i);return XE.extend(s,xl.prototype,i),XE.extend(s,i),s.create=function(u){return o($N(r,u))},s}(Vf);Co.Axios=xl,Co.CanceledError=KE,Co.CancelToken=WN,Co.isCancel=BI,Co.VERSION="0.27.2",Co.toFormData=xI,Co.AxiosError=Sc,Co.Cancel=Co.CanceledError,Co.all=function(o){return Promise.all(o)},Co.spread=function(o){return function(r){return o.apply(null,r)}},Co.isAxiosError=function(o){return KN.isObject(o)&&!0===o.isAxiosError},wE.exports=Co,wE.exports.default=Co;var Ni=wE.exports;class $I{constructor(r){S(this,"logger",void 0),S(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}class Lt{constructor(){S(this,"_events",{}),S(this,"addListener",this.on)}getListeners(r){return this._events[r]?this._events[r].map(i=>i.listener):[]}on(r,i){this._events[r]||(this._events[r]=[]);const s=this._events[r];-1===this._indexOfListener(s,i)&&s.push({listener:i,once:!1})}once(r,i){this._events[r]||(this._events[r]=[]);const s=this._events[r];-1===this._indexOfListener(s,i)&&s.push({listener:i,once:!0})}off(r,i){if(!this._events[r])return;const s=this._events[r],u=this._indexOfListener(s,i);-1!==u&&s.splice(u,1),0===this._events[r].length&&delete this._events[r]}removeAllListeners(r){r?delete this._events[r]:this._events={}}emit(r){this._events[r]||(this._events[r]=[]);const i=this._events[r].map(h=>h);for(var s=arguments.length,u=new Array(s>1?s-1:0),d=1;d<s;d++)u[d-1]=arguments[d];for(let h=0;h<i.length;h+=1){const f=i[h];f.once&&this.off(r,f.listener),f.listener.apply(this,u||[])}}_indexOfListener(r,i){let s=r.length;for(;s--;)if(r[s].listener===i)return s;return-1}}const Fo=new class extends Lt{reportLogUploadError(o){this.emit("REPORT_LOG_UPLOAD",o)}};let D;!function(o){o.UNEXPECTED_ERROR="UNEXPECTED_ERROR",o.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",o.TIMEOUT="TIMEOUT",o.INVALID_PARAMS="INVALID_PARAMS",o.NOT_READABLE="NOT_READABLE",o.NOT_SUPPORTED="NOT_SUPPORTED",o.INVALID_OPERATION="INVALID_OPERATION",o.OPERATION_ABORTED="OPERATION_ABORTED",o.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",o.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",o.NETWORK_ERROR="NETWORK_ERROR",o.NETWORK_TIMEOUT="NETWORK_TIMEOUT",o.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",o.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",o.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",o.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",o.ELECTRON_IS_NULL="ELECTRON_IS_NULL",o.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",o.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",o.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",o.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",o.PERMISSION_DENIED="PERMISSION_DENIED",o.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",o.TRACK_IS_DISABLED="TRACK_IS_DISABLED",o.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",o.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",o.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",o.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",o.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",o.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",o.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",o.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",o.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",o.UID_CONFLICT="UID_CONFLICT",o.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",o.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",o.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",o.INVALID_TRACK="INVALID_TRACK",o.SENDER_NOT_FOUND="SENDER_NOT_FOUND",o.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",o.SET_ANSWER_FAILED="SET_ANSWER_FAILED",o.ICE_FAILED="ICE_FAILED",o.PC_CLOSED="PC_CLOSED",o.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",o.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",o.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",o.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",o.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",o.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",o.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",o.INVALID_REMOTE_USER="INVALID_REMOTE_USER",o.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",o.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",o.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",o.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",o.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",o.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",o.WS_ABORT="WS_ABORT",o.WS_DISCONNECT="WS_DISCONNECT",o.WS_ERR="WS_ERR",o.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",o.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",o.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",o.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",o.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",o.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",o.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",o.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",o.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",o.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",o.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",o.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",o.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",o.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",o.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",o.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",o.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",o.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",o.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",o.INVALID_PLUGIN="INVALID_PLUGIN",o.DISCONNECT_P2P="DISCONNECT_P2P",o.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",o.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",o.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",o.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",o.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",o.PROHIBITED_OPERATION="PROHIBITED_OPERATION"}(D||(D={}));class L extends Error{constructor(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(i),S(this,"code",void 0),S(this,"message",void 0),S(this,"data",void 0),S(this,"name","AgoraRTCException"),this.code=r,this.message="AgoraRTCError ".concat(this.code,": ").concat(i),this.data=s}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return"error"===r&&R.error(this.toString()),"warning"===r&&R.warning(this.toString()),this}throw(){throw this.print(),this}}const vn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Ju(o,r){const i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,o));return Math.min(r.maxRetryTimeout,i)}function to(o,r,i,s){const u=Object.assign({},vn,s);let d=u.timeout;const h=function(){var _=M(function*(){var E;yield(E=d,new ie(y=>{window.setTimeout(y,E)})),d*=u.timeoutFactor,d=Math.min(u.maxRetryTimeout,d)});return function(){return _.apply(this,arguments)}}();let f=!1;const m=new ie(function(){var _=M(function*(E,y){r=r||(()=>!1),i=i||(()=>!0);for(let T=0;T<u.maxRetryCount;T+=1){if(f)return y(new L(D.OPERATION_ABORTED));try{const b=yield o();if(!r(b,T)||T+1===u.maxRetryCount)return E(b);yield h()}catch(b){if(!i(b,T)||T+1===u.maxRetryCount)return y(b);yield h()}}});return function(E,y){return _.apply(this,arguments)}}());return m.cancel=()=>f=!0,m}function Ul(){const o=new Date;return o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}function Xu(){const o=new Date,r=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return r?r?.[0]+":"+o.getUTCMilliseconds():o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}const Io={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Qu=Date.now(),Rc=o=>{for(const r in Io)if(Object.prototype.hasOwnProperty.call(Io,r)&&Io[r]===o)return r;return"DEFAULT"},R=new class{constructor(){S(this,"proxyServerURL",void 0),S(this,"logLevel",Io.DEBUG),S(this,"uploadState","collecting"),S(this,"uploadLogWaitingList",[]),S(this,"uploadLogUploadingList",[]),S(this,"uploadErrorCount",0),S(this,"currentLogID",0),S(this,"url",void 0),S(this,"extLog",(o,r)=>{this.appendLogToWaitingList(o,...r)})}debug(){for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];const s=[Io.DEBUG].concat(r);this.log.apply(this,s)}info(){for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];const s=[Io.INFO].concat(r);this.log.apply(this,s)}warning(){for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];const s=[Io.WARNING].concat(r);this.log.apply(this,s)}error(){for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];const s=[Io.ERROR].concat(r);this.log.apply(this,s)}upload(){for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];const s=[Io.DEBUG].concat(r);this.uploadLog.apply(this,s)}setLogLevel(o){o=Math.min(Math.max(0,o),4),this.logLevel=o}enableLogUpload(){_t("UPLOAD_LOG",!0)}disableLogUpload(){_t("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(o){this.proxyServerURL=o}prefix(o){return new $I(this).prefix(o)}log(){for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];if(Date.now()-Qu<100)return void setTimeout(()=>{this.log(...r)},Date.now()-Qu);const s=Math.max(0,Math.min(4,r[0]));if(r[0]=Ul()+" Agora-SDK [".concat(Rc(s),"]:"),this.appendLogToWaitingList(s,...r),s<this.logLevel)return;const u=Ul()+" %cAgora-SDK [".concat(Rc(s),"]:");let d=[];if(!V("USE_NEW_LOG"))switch(s){case Io.DEBUG:d=[u,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,d);break;case Io.INFO:d=[u,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,d);break;case Io.WARNING:d=[u,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,d);break;case Io.ERROR:d=[u,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];if(Date.now()-Qu<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-Qu);const s=Math.max(0,Math.min(4,r[0]));r[0]=Ul()+" Agora-SDK [".concat(Rc(s),"]:"),this.appendLogToWaitingList(s,...r)}appendLogToWaitingList(o){if(!V("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];Array.isArray(i[0])?i[0][0]=Xu()+" Agora-SDK [".concat(Rc(o),"]:"):i[0]=Xu()+" Agora-SDK [".concat(Rc(o),"]:");let u="";i.forEach(d=>{"object"==typeof d&&(d=JSON.stringify(d)),u+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:u,log_level:o,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var o=this;return M(function*(){const r=o.uploadLogUploadingList,i={sdk_version:no,process_id:V("PROCESS_ID"),payload:JSON.stringify(r)};return to(M(function*(){const s=yield Ni.post(o.url||(o.proxyServerURL?"https://".concat(o.proxyServerURL,"/ls/?h=").concat(V("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(V("LOG_UPLOAD_SERVER"),"/upload/v1")),i,{responseType:"text"});if("OK"!==s.data){const u=new Error("unexpected upload log response");throw u.response=s,u}}),()=>(o.uploadLogUploadingList=[],!1),s=>(Fo.reportLogUploadError(s.response?{status:s.response.status,data:s.response.data,headers:s.response.headers,message:s.message}:s.request?{status:s.request.status,message:s.message}:{status:-1,message:s.message}),!0),{timeout:V("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:V("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,V("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_INTERVAL"))}).catch(o=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},jf="v4.18.0-0-gcacc234f-dirty(6/21/2023, 3:22:58 PM)",no=function(o){if(o.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return o;const r=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(r&&r[1]&&r[2]){const u=r[2];return"".concat(r[1],".").concat(u)}const i=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(i&&i[1]&&i[2]){const u=i[2];return"".concat(i[1],".").concat(100*(Number(u)+1))}return"4.0.0.999"}("4.18.0"),QE=function(){try{return!0===JSON.parse("true")}catch{return!0}}(),zI=["CHINA","GLOBAL"],Ro=function(){const o="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const s=i.join(""),u=[];for(let f=0;f<6;f++)u.push("1");const d=u.join(""),h={};return h[o]=s,h[r]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ro;const YI={"90p":ke(160,90),"90p_1":ke(160,90),"120p":ke(160,120,15,30,65),"120p_1":ke(160,120,15,30,65),"120p_3":ke(120,120,15,30,50),"120p_4":ke(212,120),"180p":ke(320,180,15,30,140),"180p_1":ke(320,180,15,30,140),"180p_3":ke(180,180,15,30,100),"180p_4":ke(240,180,15,30,120),"240p":ke(320,240,15,40,200),"240p_1":ke(320,240,15,40,200),"240p_3":ke(240,240,15,40,140),"240p_4":ke(424,240,15,40,220),"360p":ke(640,360,15,80,400),"360p_1":ke(640,360,15,80,400),"360p_3":ke(360,360,15,80,260),"360p_4":ke(640,360,30,80,600),"360p_6":ke(360,360,30,80,400),"360p_7":ke(480,360,15,80,320),"360p_8":ke(480,360,30,80,490),"360p_9":ke(640,360,15,80,800),"360p_10":ke(640,360,24,80,800),"360p_11":ke(640,360,24,80,1e3),"480p":ke(640,480,15,100,500),"480p_1":ke(640,480,15,100,500),"480p_2":ke(640,480,30,100,1e3),"480p_3":ke(480,480,15,100,400),"480p_4":ke(640,480,30,100,750),"480p_6":ke(480,480,30,100,600),"480p_8":ke(848,480,15,100,610),"480p_9":ke(848,480,30,100,930),"480p_10":ke(640,480,10,100,400),"720p":ke(1280,720,15,120,1130),"720p_1":ke(1280,720,15,120,1130),"720p_2":ke(1280,720,30,120,2e3),"720p_3":ke(1280,720,30,120,1710),"720p_5":ke(960,720,15,120,910),"720p_6":ke(960,720,30,120,1380),"1080p":ke(1920,1080,15,120,2080),"1080p_1":ke(1920,1080,15,120,2080),"1080p_2":ke(1920,1080,30,120,3e3),"1080p_3":ke(1920,1080,30,120,3150),"1080p_5":ke(1920,1080,60,120,4780),"1440p":ke(2560,1440,30,120,4850),"1440p_1":ke(2560,1440,30,120,4850),"1440p_2":ke(2560,1440,60,120,7350),"4k":ke(3840,2160,30,120,8910),"4k_1":ke(3840,2160,30,120,8910),"4k_3":ke(3840,2160,60,120,13500)},zN={"480p":jo(640,480,5),"480p_1":jo(640,480,5),"480p_2":jo(640,480,30),"480p_3":jo(640,480,15),"720p":jo(1280,720,5),"720p_1":jo(1280,720,5),"720p_2":jo(1280,720,30),"720p_3":jo(1280,720,15),"1080p":jo(1920,1080,5),"1080p_1":jo(1920,1080,5),"1080p_2":jo(1920,1080,30),"1080p_3":jo(1920,1080,15)},YN={"1SL1TL":ev(1,1),"3SL3TL":ev(3,3),"2SL3TL":ev(2,3)};function bc(o){return o||(o="480p_1"),"string"==typeof o?Object.assign({},YI[o]):o}function ZE(o){return"string"==typeof o?Object.assign({},zN[o]):o}function Vl(o){return"string"==typeof o?Object.assign({},YN[o]):o}const JI={speech_low_quality:Fl(16e3,!1),speech_standard:Fl(32e3,!1,18),music_standard:Fl(48e3,!1),standard_stereo:Fl(48e3,!0,56),high_quality:Fl(48e3,!1,128),high_quality_stereo:Fl(48e3,!0,192)};function Bf(o){return"string"==typeof o?Object.assign({},JI[o]):o}function _t(o,r,i){Object.keys(Kr).includes(o)&&(!i&&Object.keys(Ac).includes(o)||(Kr[o]=r))}function V(o){return Kr[o]}const Kr={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:zI,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},Ac={};function Fl(o,r,i){return{sampleRate:o,stereo:r,bitrate:i}}function ke(o,r,i,s,u){return{width:o,height:r,frameRate:i,bitrateMin:s,bitrateMax:u}}function jo(o,r,i,s,u){return{width:{max:o},height:{max:r},frameRate:i,bitrateMin:s,bitrateMax:u}}function ev(o,r){return{numSpatialLayers:o,numTemporalLayers:r}}QE||(Kr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Kr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Kr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Kr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Kr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Kr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Kr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Kr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Kr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Kr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Kr.AREAS=["NORTH_AMERICA","OVERSEA"]);const JN=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Dc=[],Zu=[];function wc(o,r){return!!r&&Dc.some(i=>i.uid===o&&i.channelName===r)}var XN=Ot,tv=Yi,QN=ca,nv=function(o,r,i){var s=XN(r);s in o?tv.f(o,s,QN(0,i)):o[s]=i},XI=yp,ZN=Zr,e0=nv,ds=ot.Array,rv=Math.max,QI=function(o,r,i){for(var s=ZN(o),u=XI(r,s),d=XI(void 0===i?s:i,s),h=ds(rv(d-u,0)),f=0;u<d;u++,f++)e0(h,f,o[u]);return h.length=f,h},ov=QI,t0=Math.floor,Hf=function(o,r){var i=o.length,s=t0(i/2);return i<8?ZI(o,r):Gf(o,Hf(ov(o,0,s),r),Hf(ov(o,s),r),r)},ZI=function(o,r){for(var i,s,u=o.length,d=1;d<u;){for(s=d,i=o[d];s&&r(o[s-1],i)>0;)o[s]=o[--s];s!==d++&&(o[s]=i)}return o},Gf=function(o,r,i,s){for(var u=r.length,d=i.length,h=0,f=0;h<u||f<d;)o[h+f]=h<u&&f<d?s(r[h],i[f])<=0?r[h++]:i[f++]:h<u?r[h++]:i[f++];return o},iv=Hf,n0=$a.match(/firefox\/(\d+)/i),eR=!!n0&&+n0[1],tR=/MSIE|Trident/.test($a),sv=$a.match(/AppleWebKit\/(\d+)\./),av=tr,ls=Dn,r0=$i,o0=la,cv=Zr,rR=yu,uv=Qt,s0=iv,uk=Jg,dv=eR,a0=tR,jl=au,ed=!!sv&&+sv[1],Pi=[],c0=ls(Pi.sort),u0=ls(Pi.push),oR=uv(function(){Pi.sort(void 0)}),iR=uv(function(){Pi.sort(null)}),d0=uk("sort"),sR=!uv(function(){if(jl)return jl<70;if(!(dv&&dv>3)){if(a0)return!0;if(ed)return ed<603;var o,r,i,s,u="";for(o=65;o<76;o++){switch(r=String.fromCharCode(o),o){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(s=0;s<47;s++)Pi.push({k:r+s,v:i})}for(Pi.sort(function(d,h){return h.v-d.v}),s=0;s<Pi.length;s++)r=Pi[s].k.charAt(0),u.charAt(u.length-1)!==r&&(u+=r);return"DGBEFHACIJK"!==u}});av({target:"Array",proto:!0,forced:oR||!iR||!d0||!sR},{sort:function(o){void 0!==o&&r0(o);var r=o0(this);if(sR)return void 0===o?c0(r):c0(r,o);var i,s,u=[],d=cv(r);for(s=0;s<d;s++)s in r&&u0(u,r[s]);for(s0(u,function(h){return function(f,m){return void 0===m?-1:void 0===f?1:void 0!==h?+h(f,m)||0:rR(f)>rR(m)?1:-1}}(o)),i=u.length,s=0;s<i;)r[s]=u[s++];for(;s<d;)delete r[s++];return r}});var aR=gt("Array").sort,cR=ho,Bl=aR,lv=Array.prototype,Wf=function(o){var r=o.sort;return o===lv||cR(lv,o)&&r===lv.sort?Bl:r};function td(o,r){if("boolean"!=typeof o)throw new L(D.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Nn(o,r,i){if(!i.includes(o))throw new L(D.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function Rt(o,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(o<i||o>s||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function l0(o){return"number"==typeof o&&o%1==0}(o))throw new L(D.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(s,"]. integer only"))}function Oc(o,r){if("number"!=typeof o){if(!(o.min||o.max||o.ideal||o.exact))throw new L(D.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));void 0!==o.min&&Rt(o.min,"".concat(r,".min"),0,1/0),void 0!==o.max&&Rt(o.max,"".concat(r,".max"),1,1/0),void 0!==o.exact&&Rt(o.exact,"".concat(r,".exact"),1,1/0),void 0!==o.ideal&&Rt(o.ideal,"".concat(r,".ideal"),1,1/0)}else Rt(o,r,1,1/0)}function sr(o,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==o)throw new L(D.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!uR(o,i,s,u))throw new L(D.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(s,"].").concat(u?" ASCII characters only.":""))}function Ra(o,r){if(!Array.isArray(o))throw new L(D.INVALID_PARAMS,"".concat(r," should be an array"))}function hv(o){if("string"!=typeof o||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(o))throw R.error("Invalid Channel Name ".concat(o)),new L(D.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function pv(o){if(!("number"==typeof(r=o)&&Math.floor(r)===r&&0<=r&&r<=4294967295||uR(o,1,255)))throw R.error("Invalid UID ".concat(o," ").concat(typeof o)),new L(D.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;"string"==typeof o&&R.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function Dt(o){return null==o}function uR(o){return"string"==typeof o&&o.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&o.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function h0(o){if("string"!=typeof o)return!1;for(let r=0;r<o.length;r+=1){const i=o.charCodeAt(r);if(i<0||i>255)return!1}return!0}(o))}let dR,fv,qe;(function(o){o.FREE="free",o.UPLOADING="uploading"})(dR||(dR={})),function(o){o[o.MISC=0]="MISC",o[o.INTERNAL_EVENT=1]="INTERNAL_EVENT",o[o.PUBLIC_EVENT=2]="PUBLIC_EVENT",o[o.WEB_EVENT=3]="WEB_EVENT",o[o.INTERNAL_API=4]="INTERNAL_API",o[o.WEB_API=5]="WEB_API",o[o.PUBLIC_API=6]="PUBLIC_API"}(fv||(fv={})),function(o){o.NONE="none",o.INIT="init",o.CANPLAY="canplay",o.PLAYING="playing",o.PAUSED="paused",o.SUSPEND="suspend",o.STALLED="stalled",o.WAITING="waiting",o.ERROR="error",o.DESTROYED="destroyed",o.ABORT="abort",o.ENDED="ended",o.EMPTIED="emptied",o.LOADEDDATA="loadeddata"}(qe||(qe={}));const mv={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function Kf(o){return sr(o.reportId,"params.reportId",0,100,!1),sr(o.category,"params.category",0,100,!1),sr(o.event,"params.event",0,100,!1),sr(o.label,"params.label",0,100,!1),Rt(o.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const p0={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Kn,kt,lR,gv,pn,xt,ba,hs,nd,qf,ro,qn,fe,rd,st,Ue,yr,lt,ae,me,Ht,De,Hl,en;function Mi(o){return Rt(o.timeout,"config.timeout",0,1e5),Rt(o.timeoutFactor,"config.timeoutFactor",0,100,!1),Rt(o.maxRetryCount,"config.maxRetryConfig",0,1/0),Rt(o.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function ps(o){if(!Array.isArray(o)||o.length<1)return!1;try{o.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function Nc(o){return sr(o.turnServerURL,"turnServerURL"),sr(o.username,"username"),sr(o.password,"password"),o.udpport&&Rt(o.udpport,"udpport",1,99999,!0),o.forceturn&&td(o.forceturn,"forceturn"),o.security&&td(o.security,"security"),o.tcpport&&Rt(o.tcpport,"tcpport",1,99999,!0),!0}function Pc(o){return void 0!==o.level&&Nn(o.level,"level",[1,2,3]),!0}(function(o){o.PUBLISH="publish",o.SUBSCRIBE="subscribe",o.WS_COMPRESSOR_INIT="ws_compressor_init",o.SESSION_INIT="session_init",o.JOIN_CHOOSE_SERVER="join_choose_server",o.REQ_USER_ACCOUNT="req_user_account",o.JOIN_GATEWAY="join_gateway",o.REJOIN_GATEWAY="rejoin_gateway",o.STREAM_SWITCH="stream_switch",o.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",o.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",o.FIRST_VIDEO_RECEIVED="first_video_received",o.FIRST_AUDIO_RECEIVED="first_audio_received",o.FIRST_VIDEO_DECODE="first_video_decode",o.FIRST_AUDIO_DECODE="first_audio_decode",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_UPDATE_STREAM="on_update_stream",o.ON_REMOVE_STREAM="on_remove_stream",o.USER_ANALYTICS="req_user_analytics",o.PC_STATS="pc_stats"})(Kn||(Kn={})),function(o){o.SESSION="io.agora.pb.Wrtc.Session",o.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",o.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",o.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",o.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",o.PUBLISH="io.agora.pb.Wrtc.Publish",o.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",o.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",o.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",o.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",o.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",o.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",o.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",o.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",o.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",o.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",o.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",o.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",o.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",o.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",o.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",o.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",o.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",o.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",o.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",o.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",o.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",o.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",o.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",o.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",o.PC_STATS="io.agora.pb.Wrtc.PCStats"}(kt||(kt={})),function(o){o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(lR||(lR={})),function(o){o[o.SESSION=26]="SESSION",o[o.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",o[o.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",o[o.JOIN_GATEWAY=28]="JOIN_GATEWAY",o[o.PUBLISH=30]="PUBLISH",o[o.SUBSCRIBE=29]="SUBSCRIBE",o[o.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",o[o.STREAM_SWITCH=32]="STREAM_SWITCH",o[o.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",o[o.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",o[o.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",o[o.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",o[o.API_INVOKE=41]="API_INVOKE",o[o.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",o[o.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",o[o.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",o[o.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",o[o.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",o[o.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",o[o.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",o[o.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",o[o.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",o[o.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",o[o.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",o[o.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",o[o.USER_ANALYTICS=1e4]="USER_ANALYTICS",o[o.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(gv||(gv={})),function(o){o.CREATE_CLIENT="createClient",o.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",o.SET_AREA="setArea",o.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",o.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",o.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",o.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",o.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",o.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",o.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",o.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",o.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",o.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",o.START_PROXY_SERVER="Client.startProxyServer",o.STOP_PROXY_SERVER="Client.stopProxyServer",o.SET_PROXY_SERVER="Client.setProxyServer",o.SET_TURN_SERVER="Client.setTurnServer",o.SET_CLIENT_ROLE="Client.setClientRole",o.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",o.ENABLE_DUAL_STREAM="Client.enableDualStream",o.DISABLE_DUAL_STREAM="Client.disableDualStream",o.JOIN="Client.join",o.LEAVE="Client.leave",o.PUBLISH="Client.publish",o.UNPUBLISH="Client.unpublish",o.SUBSCRIBE="Client.subscribe",o.MASS_SUBSCRIBE="Client.massSubscribe",o.MASS_UNSUBSCRIBE="Client.massUnsubscribe",o.UNSUBSCRIBE="Client.unsubscribe",o.RENEW_TOKEN="Client.renewToken",o.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",o.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",o.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",o.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",o.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",o.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",o.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",o.DATACHANNEL_FAILBACK="Client._datachannelFailback",o.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",o.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",o.START_LIVE_STREAMING="Client.startLiveStreaming",o.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",o.STOP_LIVE_STREAMING="Client.stopLiveStreaming",o.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",o.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",o.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",o.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",o.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",o.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",o.SET_CONFIG_DISTRIBUTE="_configDistribute",o.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",o.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",o.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",o.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",o.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",o.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",o.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",o.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",o.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",o.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",o.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",o.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",o.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",o.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",o.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",o.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",o.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",o.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",o.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",o.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",o.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",o.STREAM_TYPE_CHANGE="streamTypeChange",o.CONNECTION_STATE_CHANGE="connectionStateChange",o.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage"}(pn||(pn={})),function(o){o.TRACER="tracer"}(xt||(xt={})),function(o){o.IDLE="IDLE",o.INITING="INITING",o.INITEND="INITEND"}(ba||(ba={})),function(o){o.STATE_CHANGE="state_change",o.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",o.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",o.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(hs||(hs={})),function(o){o[o.ACCESS_POINT=101]="ACCESS_POINT",o[o.UNILBS=201]="UNILBS",o[o.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(nd||(nd={})),function(o){o[o.IIIEGAL_APPID=1]="IIIEGAL_APPID",o[o.IIIEGAL_UID=2]="IIIEGAL_UID",o[o.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(qf||(qf={})),function(o){o[o.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",o[o.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",o[o.INTERNAL_ERROR=8]="INTERNAL_ERROR",o[o.NO_AUTHORIZED=9]="NO_AUTHORIZED",o[o.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",o[o.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",o[o.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",o[o.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",o[o.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",o[o.USER_OVERLOAD=16]="USER_OVERLOAD",o[o.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",o[o.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(ro||(ro={})),function(o){o[o.NO_FLAG_SET=100]="NO_FLAG_SET",o[o.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",o[o.INVALID_FALG_SET=102]="INVALID_FALG_SET",o[o.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",o[o.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",o[o.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",o[o.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",o[o.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",o[o.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",o[o.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",o[o.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",o[o.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",o[o.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",o[o.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",o[o.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",o[o.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",o[o.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",o[o.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",o[o.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(qn||(qn={})),function(o){o[o.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",o[o.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",o[o.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",o[o.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",o[o.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",o[o.K_TICKET_INVALID=7]="K_TICKET_INVALID",o[o.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",o[o.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",o[o.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",o[o.K_UID_BANNED=14]="K_UID_BANNED",o[o.K_IP_BANNED=15]="K_IP_BANNED",o[o.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",o[o.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",o[o.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",o[o.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",o[o.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",o[o.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",o[o.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",o[o.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",o[o.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",o[o.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",o[o.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",o[o.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",o[o.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",o[o.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",o[o.ERR_INVALID_UID=117]="ERR_INVALID_UID",o[o.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",o[o.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",o[o.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",o[o.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",o[o.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",o[o.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",o[o.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",o[o.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",o[o.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",o[o.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",o[o.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",o[o.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",o[o.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",o[o.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",o[o.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",o[o.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",o[o.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",o[o.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",o[o.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",o[o.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",o[o.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",o[o.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",o[o.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",o[o.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",o[o.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",o[o.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",o[o.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",o[o.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",o[o.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",o[o.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",o[o.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",o[o.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",o[o.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",o[o.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",o[o.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",o[o.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",o[o.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(fe||(fe={})),function(o){o[o.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",o[o.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",o[o.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(rd||(rd={})),function(o){o.LEAVE="LEAVE",o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.UID_BANNED="UID_BANNED",o.IP_BANNED="IP_BANNED",o.CHANNEL_BANNED="CHANNEL_BANNED",o.FALLBACK="FALLBACK",o.LICENSE_MISSING="LICENSE_MISSING",o.LICENSE_EXPIRED="LICENSE_EXPIRED",o.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",o.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",o.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",o.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(st||(st={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.MEDIA_RECONNECT_START="media-reconnect-start",o.MEDIA_RECONNECT_END="media-reconnect-end",o.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",o.USER_JOINED="user-joined",o.USER_LEAVED="user-left",o.USER_PUBLISHED="user-published",o.USER_UNPUBLISHED="user-unpublished",o.USER_INFO_UPDATED="user-info-updated",o.CLIENT_BANNED="client-banned",o.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",o.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",o.VOLUME_INDICATOR="volume-indicator",o.CRYPT_ERROR="crypt-error",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGED="stream-type-changed",o.STREAM_FALLBACK="stream-fallback",o.RECEIVE_METADATA="receive-metadata",o.STREAM_MESSAGE="stream-message",o.LIVE_STREAMING_ERROR="live-streaming-error",o.LIVE_STREAMING_WARNING="live-streaming-warning",o.INJECT_STREAM_STATUS="stream-inject-status",o.EXCEPTION="exception",o.ERROR="error",o.P2P_LOST="p2p_lost",o.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",o.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",o.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",o.PUBLISHED_USER_LIST="published-user-list",o.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",o.CONTENT_INSPECT_ERROR="content-inspect-error",o.CONTENT_INSPECT_RESULT="content-inspect-result"}(Ue||(Ue={})),function(o){o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK"}(yr||(yr={})),function(o){o.CONNECTING="connecting",o.CONNECTED="connected",o.RECONNECTING="reconnecting",o.CLOSED="closed"}(lt||(lt={})),function(o){o.WS_CONNECTED="ws_connected",o.WS_RECONNECTING="ws_reconnecting",o.WS_CLOSED="ws_closed",o.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",o.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",o.ON_BINARY_DATA="on_binary_data",o.REQUEST_RECOVER="request_recover",o.REQUEST_JOIN_INFO="request_join_info",o.REQUEST_REJOIN_INFO="req_rejoin_info",o.IS_P2P_DISCONNECTED="is_p2p_dis",o.DISCONNECT_P2P="dis_p2p",o.ABORT_P2P_EXECUTION="abort_p2p_execution",o.NEED_RENEW_SESSION="need-sid",o.REPORT_JOIN_GATEWAY="report_join_gateway",o.REQUEST_TIMEOUT="request_timeout",o.REQUEST_SUCCESS="request_success",o.JOIN_RESPONSE="join_response",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_CONNECTING="datachannel_connecting",o.DATACHANNEL_FAILBACK="datachannel_failback"}(ae||(ae={})),function(o){o.PING="ping",o.PING_BACK="ping_back",o.JOIN="join_v3",o.REJOIN="rejoin_v3",o.LEAVE="leave",o.SET_CLIENT_ROLE="set_client_role",o.PUBLISH="publish",o.UNPUBLISH="unpublish",o.SUBSCRIBE="subscribe",o.SUBSCRIBE_STREAMS="subscribe_streams",o.UNSUBSCRIBE="unsubscribe",o.UNSUBSCRIBE_STREAMS="unsubscribe_streams",o.SUBSCRIBE_CHANGE="subscribe_change",o.TRAFFIC_STATS="traffic_stats",o.RENEW_TOKEN="renew_token",o.SWITCH_VIDEO_STREAM="switch_video_stream",o.DEFAULT_VIDEO_STREAM="default_video_stream",o.SET_FALLBACK_OPTION="set_fallback_option",o.GATEWAY_INFO="gateway_info",o.CONTROL="control",o.SEND_METADATA="send_metadata",o.DATA_STREAM="data_stream",o.PICK_SVC_LAYER="pick_svc_layer",o.RESTART_ICE="restart_ice",o.CONNECT_PC="connect_pc",o.SET_VIDEO_PROFILE="set_video_profile",o.SET_PARAMETER="set_parameter"}(me||(me={})),function(o){o.PUBLISH_STATS="publish_stats",o.PUBLISH_RELATED_STATS="publish_related_stats",o.SUBSCRIBE_STATS="subscribe_stats",o.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",o.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",o.DENOISER_STATS="denoiser_stats",o.TRANSPORT_STATS="transport_stats",o.EXTENSION_USAGE_STATS="extension_usage_stats"}(Ht||(Ht={})),function(o){o.ON_USER_ONLINE="on_user_online",o.ON_USER_OFFLINE="on_user_offline",o.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",o.ON_PUBLISH_STREAM="on_publish_stream",o.ON_UPLINK_STATS="on_uplink_stats",o.ON_P2P_LOST="on_p2p_lost",o.ON_REMOVE_STREAM="on_remove_stream",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",o.ON_USER_BANNED="on_user_banned",o.ON_USER_LICENSE_BANNED="on_user_license_banned",o.ON_NOTIFICATION="on_notification",o.ON_CRYPT_ERROR="on_crypt_error",o.MUTE_AUDIO="mute_audio",o.MUTE_VIDEO="mute_video",o.UNMUTE_AUDIO="unmute_audio",o.UNMUTE_VIDEO="unmute_video",o.ON_P2P_OK="on_p2p_ok",o.RECEIVE_METADATA="receive_metadata",o.ON_DATA_STREAM="on_data_stream",o.ENABLE_LOCAL_VIDEO="enable_local_video",o.DISABLE_LOCAL_VIDEO="disable_local_video",o.ENABLE_LOCAL_AUDIO="enable_local_audio",o.DISABLE_LOCAL_AUDIO="disable_local_audio",o.ON_PUBLISHED_USER_LIST="on_published_user_list"}(De||(De={})),function(o){o.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",o.NEED_ANSWER="NEED_ANSWER",o.NEED_RENEGOTIATE="NEED_RENEGOTIATE",o.P2P_LOST="P2P_LOST",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NEED_UNPUB="NEED_UNPUB",o.NEED_UNSUB="NEED_UNSUB",o.NEED_UPLOAD="NEED_UPLOAD",o.NEED_CONTROL="NEED_CONTROL",o.START_RECONNECT="START_RECONNECT",o.END_RECONNECT="END_RECONNECT",o.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(Hl||(Hl={})),function(o){o.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",o.RECEIVE_TRACK_BUFFER="receive_track_buffer",o.ON_AUDIO_BUFFER="on_audio_buffer",o.UPDATE_SOURCE="update_source"}(en||(en={}));const Aa={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},Da={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Mc={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},id={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Lc={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let we,tn,Ks;(function(o){o.CONNECTED="websocket:connected",o.RECONNECTING="websocket:reconnecting",o.WILL_RECONNECT="websocket:will_reconnect",o.CLOSED="websocket:closed",o.FAILED="websocket:failed",o.ON_MESSAGE="websocket:on_message",o.REQUEST_NEW_URLS="websocket:request_new_urls",o.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"})(we||(we={})),function(o){o.TRANSCODE="mix_streaming",o.RAW="raw_streaming",o.INJECT="inject_streaming"}(tn||(tn={})),function(o){o[o.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",o[o.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",o[o.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",o[o.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",o[o.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",o[o.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",o[o.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",o[o.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",o[o.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Ks||(Ks={}));const hR={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},$f={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function zf(o,r){sr(o.url,"".concat(r,".url"),1,1e3,!1),Dt(o.x)||Rt(o.x,"".concat(r,".x"),0,1e4),Dt(o.y)||Rt(o.y,"".concat(r,".y"),0,1e4),Dt(o.width)||Rt(o.width,"".concat(r,".width"),0,1e4),Dt(o.height)||Rt(o.height,"".concat(r,".height"),0,1e4),Dt(o.zOrder)||Rt(o.zOrder,"".concat(r,".zOrder"),0,255),Dt(o.alpha)||Rt(o.alpha,"".concat(r,".alpha"),0,1,!1)}const pR={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},fR={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let Bo,wa,qt,f0,Sr,Li,br,kc,fn,Ut,nn,Yf,Ee,rn,fs,Gl,sd,ad,ui,xc,je;function cd(o){if(!o.channelName)throw new L(D.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof o.uid)throw new L(D.INVALID_PARAMS,"invalid uid in info, uid must be a number");return o.token&&sr(o.token,"info.token",1,2047),pv(o.uid),hv(o.channelName),!0}function mR(o){return Nn(o,"mediaSource",["screen","window","application"]),!0}(function(o){o.WARNING="@live_uap-warning",o.ERROR="@line_uap-error",o.PUBLISH_STREAM_STATUS="@live_uap-publish-status",o.INJECT_STREAM_STATUS="@live_uap-inject-status",o.WORKER_STATUS="@live_uap-worker-status",o.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Bo||(Bo={})),function(o){o.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(wa||(wa={})),function(o){o[o.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",o[o.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",o[o.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",o[o.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",o[o.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",o[o.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",o[o.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",o[o.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",o[o.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",o[o.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",o[o.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",o[o.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",o[o.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",o[o.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",o[o.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",o[o.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(qt||(qt={})),function(o){o.CONNECT_FAILED="connect failed",o.CONNECT_TIMEOUT="connect timeout",o.WS_DISCONNECTED="websocket disconnected",o.REQUEST_TIMEOUT="request timeout",o.REQUEST_FAILED="request failed",o.WAIT_STATUS_TIMEOUT="wait status timeout",o.WAIT_STATUS_ERROR="wait status error",o.BAD_STATE="bad state",o.WS_ABORT="ws abort",o.AP_REQUEST_TIMEOUT="AP request timeout",o.AP_JSON_PARSE_ERROR="AP json parse error",o.AP_REQUEST_ERROR="AP request error",o.AP_REQUEST_ABORT="AP request abort"}(f0||(f0={})),function(o){o[o.SetSdkProfile=0]="SetSdkProfile",o[o.SetSourceChannel=1]="SetSourceChannel",o[o.SetSourceUserId=2]="SetSourceUserId",o[o.SetDestChannel=3]="SetDestChannel",o[o.StartPacketTransfer=4]="StartPacketTransfer",o[o.StopPacketTransfer=5]="StopPacketTransfer",o[o.UpdateDestChannel=6]="UpdateDestChannel",o[o.Reconnect=7]="Reconnect",o[o.SetVideoProfile=8]="SetVideoProfile"}(Sr||(Sr={})),function(o){o.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",o.NETWORK_CONNECTED="NETWORK_CONNECTED",o.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",o.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",o.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",o.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",o.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",o.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",o.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",o.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(Li||(Li={})),function(o){o.RELAY_STATE_IDLE="RELAY_STATE_IDLE",o.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",o.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",o.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(br||(br={})),function(o){o.RELAY_OK="RELAY_OK",o.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",o.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",o.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(kc||(kc={})),function(o){o.High="high",o.Low="low",o.Audio="audio",o.Screen="screen",o.ScreenLow="screen_low"}(fn||(fn={})),function(o){o.DISCONNECT="disconnect",o.CONNECTION_STATE_CHANGE="connection-state-change",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGE="stream-type-change",o.IS_P2P_DISCONNECTED="is-p2p-dis",o.DISCONNECT_P2P="dis-p2p",o.REQUEST_NEW_GATEWAY_LIST="req-gate-url",o.NEED_RENEW_SESSION="need-sid",o.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",o.JOIN_RESPONSE="join-response",o.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",o.RESET_CONNECTION_EVENTS="reset-connection-events",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_FAILBACK="datachannel_failback",o.RESET_SIGNAL="reset-signal"}(Ut||(Ut={})),function(o){o[o.Nothing=0]="Nothing",o[o.Audio=1]="Audio",o[o.LwoVideo=2]="LwoVideo",o[o.Video=4]="Video",o[o.Data=8]="Data"}(nn||(nn={})),function(o){o[o.websocket=0]="websocket",o[o.datachannel=1]="datachannel"}(Yf||(Yf={})),function(o){o.NEED_RENEGOTIATE="@need_renegotiate",o.NEED_REPLACE_TRACK="@need_replace_track",o.NEED_CLOSE="@need_close",o.NEED_ENABLE_TRACK="@need_enable_track",o.NEED_DISABLE_TRACK="@need_disable_track",o.NEED_SESSION_ID="@need_sid",o.SET_OPTIMIZATION_MODE="@set_optimization_mode",o.GET_STATS="@get_stats",o.GET_LOW_VIDEO_TRACK="@get_low_video_track",o.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",o.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",o.NEED_MUTE_TRACK="@need_mute_track",o.NEED_UNMUTE_TRACK="@need_unmute_track"}(Ee||(Ee={})),function(o){o.SCREEN_TRACK="screen_track",o.CUSTOM_TRACK="custome_track",o.LOW_STREAM="low_stream"}(rn||(rn={})),function(o){o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM"}(fs||(fs={})),function(o){o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM"}(Gl||(Gl={})),function(o){o[o.DISABLE=0]="DISABLE",o[o.LOW_STREAM=1]="LOW_STREAM",o[o.AUDIO_ONLY=2]="AUDIO_ONLY"}(sd||(sd={})),function(o){o.TRANSCEIVER_UPDATED="transceiver-updated"}(ad||(ad={})),function(o){o.SOURCE_STATE_CHANGE="source-state-change",o.TRACK_ENDED="track-ended",o.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",o.CLOSED="closed"}(ui||(ui={})),function(o){o.FIRST_FRAME_DECODED="first-frame-decoded",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(xc||(xc={})),function(o){o.CHINA="CHINA",o.ASIA="ASIA",o.NORTH_AMERICA="NORTH_AMERICA",o.EUROPE="EUROPE",o.JAPAN="JAPAN",o.INDIA="INDIA",o.KOREA="KOREA",o.HKMC="HKMC",o.US="US",o.OCEANIA="OCEANIA",o.SOUTH_AMERICA="SOUTH_AMERICA",o.AFRICA="AFRICA",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="EXTENSIONS"}(je||(je={}));const m0=[je.AFRICA,je.ASIA,je.CHINA,je.EUROPE,je.GLOBAL,je.INDIA,je.JAPAN,je.NORTH_AMERICA,je.OCEANIA,je.OVERSEA,je.SOUTH_AMERICA];let Pn;!function(o){o.CHINA="CN",o.ASIA="AS",o.NORTH_AMERICA="NA",o.EUROPE="EU",o.JAPAN="JP",o.INDIA="IN",o.KOREA="KR",o.HKMC="HK",o.US="US",o.OCEANIA="OC",o.SOUTH_AMERICA="SA",o.AFRICA="AF",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="GLOBAL"}(Pn||(Pn={}));const Jf={CHINA:{},ASIA:{CODE:Pn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Pn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Pn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Pn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Pn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Pn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Pn.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Pn.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Pn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Pn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Pn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Pn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Pn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let Uc,Wl,be,ar,ki,de,on,Ge,cr,Oa,ur,Pr,oo,io,mn,ms,Gt,xi;QE&&(Jf.CHINA={CODE:Pn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(o){o.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Uc||(Uc={}));class Vc extends Lt{constructor(r,i){super(),S(this,"onICEConnectionStateChange",void 0),S(this,"onConnectionStateChange",void 0),S(this,"onDTLSTransportStateChange",void 0),S(this,"onDTLSTransportError",void 0),S(this,"onICETransportStateChange",void 0),S(this,"onFirstAudioReceived",void 0),S(this,"onFirstVideoReceived",void 0),S(this,"onFirstAudioDecoded",void 0),S(this,"onFirstVideoDecoded",void 0),S(this,"onFirstVideoDecodedTimeout",void 0),S(this,"onSelectedLocalCandidateChanged",void 0),S(this,"onSelectedRemoteCandidateChanged",void 0),S(this,"establishPromise",void 0)}}(function(o){o.SEND="sendonly",o.RECV="recvonly",o.SENDRECV="sendrecv",o.INACTIVE="inactive"})(Wl||(Wl={})),function(o){o.VIDEO="video",o.AUDIO="audio"}(be||(be={})),function(o){o[o.UDP=0]="UDP",o[o.TCP=1]="TCP",o[o.RELAY=2]="RELAY"}(ar||(ar={})),function(o){o[o.FIRST_CONNECTION=0]="FIRST_CONNECTION",o[o.TCP_RESTART=1]="TCP_RESTART",o[o.RELAY_RESTART=2]="RELAY_RESTART",o[o.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",o[o.OLD_RESTART=11]="OLD_RESTART",o[o.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(ki||(ki={})),function(o){o.LocalVideoTrack="videoTrack",o.LocalAudioTrack="audioTrack",o.LocalVideoLowTrack="videoLowTrack"}(de||(de={})),function(o){o.New="new",o.Connected="connected",o.Reconnecting="reconnecting",o.Disconnected="disconnected"}(on||(on={})),function(o){o.StateChange="stateChange",o.IceConnectionStateChange="iceConnectionStateChange",o.RequestMuteLocal="requestMuteLocal",o.RequestUnmuteLocal="requestUnmuteLocal",o.RequestRePublish="requestRePublish",o.RequestReSubscribe="requestReSubscribe",o.RequestUploadStats="requestUploadStats",o.MediaReconnectStart="MediaReconnectStart",o.MediaReconnectEnd="MediaReconnectEnd",o.NeedSignalRTT="NeedSignalRTT",o.RequestRestartICE="RequestRestartIce",o.PeerConnectionStateChange="PeerConnectionStateChange",o.RequestReconnect="RequestReconnect",o.RequestReconnectPC="RequestReconnectPC",o.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",o.P2PLost="P2PLost",o.UpdateVideoEncoder="UpdateVideoEncoder",o.ConnectionTypeChange="ConnectionTypeChange",o.RequestLowStreamParameter="RequestLowStreamParameter",o.QueryClientConnectionState="QueryClientConnectionState"}(Ge||(Ge={})),function(o){o.ONLINE="ONLINE",o.OFFLINE="OFFLINE"}(cr||(cr={})),function(o){o.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",o.ONLINE="ONLINE",o.OFFLINE="OFFLINE"}(Oa||(Oa={})),function(o){o.ON_TRACK="on_track",o.ON_NODE="on_node"}(ur||(ur={})),function(o){o.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",o.REQUEST_CONSTRAINTS="request_constraints"}(Pr||(Pr={})),function(o){o.CONNECTING="CONNECTING",o.RECONNECTING="RECONNECTING",o.CONNECTED="CONNECTED",o.CLOSED="CLOSED"}(oo||(oo={})),function(o){o[o.CONNECT_AP=0]="CONNECT_AP",o[o.AP_CONNECTED=1]="AP_CONNECTED",o[o.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",o[o.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",o[o.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",o[o.CONNECT_WORKER=5]="CONNECT_WORKER",o[o.WORKER_CONNECTED=6]="WORKER_CONNECTED",o[o.CLOSED=7]="CLOSED"}(io||(io={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.STATE_CHANGE="state-change",o.INSPECT_RESULT="inspect-result",o.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",o.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(mn||(mn={})),function(o){o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK"}(ms||(ms={})),function(o){o.CONNECTED="transmitter:connected",o.RECONNECTING="transmitter:reconnecting",o.WILL_RECONNECT="transmitter:will_reconnect",o.CLOSED="transmitter:closed",o.FAILED="transmitter:failed",o.ON_MESSAGE="transmitter:on_message",o.REQUEST_NEW_URLS="transmitter:request_new_urls",o.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",o.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",o.FAILBACK="transmitter:failback"}(Gt||(Gt={})),function(o){o.CAMERA_CHANGED="camera-changed",o.MICROPHONE_CHANGED="microphone-changed",o.PLAYBACK_DEVICE_CHANGED="playback-device-changed",o.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",o.AUTOPLAY_FAILED="autoplay-failed",o.SECURITY_POLICY_VIOLATION="security-policy-violation"}(xi||(xi={}));const $n={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1};function Yt(){return $n}let At;!function(o){o[o.CHOOSE_SERVER=11]="CHOOSE_SERVER",o[o.CLOUD_PROXY=18]="CLOUD_PROXY",o[o.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",o[o.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"}(At||(At={}));var qs=Bd,di=Array.isArray||function(o){return"Array"==qs(o)},gR=ot,_R=di,g0=dl,_0=Qo,_v=Fn("species"),Xf=gR.Array,Ev=function(o,r){return new(function(o){var r;return _R(o)&&(g0(r=o.constructor)&&(r===Xf||_R(r.prototype))||_0(r)&&null===(r=r[_v]))&&(r=void 0),void 0===r?Xf:r}(o))(0===r?0:r)},E0=Kd,v0=Zn,vR=la,Kl=Zr,yR=Ev,Mr=Dn([].push),$s=function(o){var r=1==o,i=2==o,s=3==o,u=4==o,d=6==o,h=7==o,f=5==o||d;return function(m,_,E,y){for(var T,b,w=vR(m),P=v0(w),k=E0(_,E),x=Kl(P),B=0,H=y||yR,ce=r?H(m,x):i||h?H(m,0):void 0;x>B;B++)if((f||B in P)&&(b=k(T=P[B],B,w),o))if(r)ce[B]=b;else if(b)switch(o){case 3:return!0;case 5:return T;case 6:return B;case 2:Mr(ce,T)}else switch(o){case 4:return!1;case 7:Mr(ce,T)}return d?-1:s||u?u:ce}},SR={forEach:$s(0),map:$s(1),filter:$s(2),some:$s(3),every:$s(4),find:$s(5),findIndex:$s(6),filterReject:$s(7)},TR=SR.forEach,vv=Jg("forEach")?[].forEach:function(o){return TR(this,o,arguments.length>1?arguments[1]:void 0)};tr({target:"Array",proto:!0,forced:[].forEach!=vv},{forEach:vv});var CR=gt("Array").forEach,yv=tc,y0=Pt,S0=ho,T0=CR,Qf=Array.prototype,Sv={DOMTokenList:!0,NodeList:!0},RR=la,Tv=VT;tr({target:"Object",stat:!0,forced:Qt(function(){Tv(1)})},{keys:function(o){return Tv(RR(o))}});var bR=da.Object.keys,AR=Qi,DR=tr,wR=di,OR=Dn([].reverse),ql=[1,2];DR({target:"Array",proto:!0,forced:String(ql)===String(ql.reverse())},{reverse:function(){return wR(this)&&(this.length=this.length),OR(this)}});var Na=gt("Array").reverse,C0=ho,I0=Na,$l=Array.prototype,Cv=Qt,R0=au,Iv=Fn("species"),b0=function(o){return R0>=51||!Cv(function(){var r=[];return(r.constructor={})[Iv]=function(){return{foo:1}},1!==r[o](Boolean).foo})},dk=tr,A0=ot,NR=di,PR=dl,D0=Qo,dr=yp,MR=Zr,w0=ua,O0=nv,LR=Fn,N0=ll,kR=b0("slice"),xR=LR("species"),Pa=A0.Array,P0=Math.max;dk({target:"Array",proto:!0,forced:!kR},{slice:function(o,r){var i,s,u,d=w0(this),h=MR(d),f=dr(o,h),m=dr(void 0===r?h:r,h);if(NR(d)&&((PR(i=d.constructor)&&(i===Pa||NR(i.prototype))||D0(i)&&null===(i=i[xR]))&&(i=void 0),i===Pa||void 0===i))return N0(d,f,m);for(s=new(void 0===i?Pa:i)(P0(m-f,0)),u=0;f<m;f++,u++)f in d&&O0(s,u,d[f]);return s.length=u,s}});var M0=gt("Array").slice,UR=ho,L0=M0,Zf=Array.prototype;function q(o,r,i,s,u){var d,h,f,m={};return function(o){var r=o.forEach;return o===Qf||S0(Qf,o)&&r===Qf.forEach||y0(Sv,yv(o))?T0:r}(d=bR(s)).call(d,function(_){m[_]=s[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=AR(h=function(o){var r=o.reverse;return o===$l||C0($l,o)&&r===$l.reverse?I0:r}(f=function(o){var r=o.slice;return o===Zf||UR(Zf,o)&&r===Zf.slice?L0:r}(i).call(i)).call(f)).call(h,function(_,E){return E(o,r,_)||_},m),u&&void 0!==m.initializer&&(m.value=m.initializer?m.initializer.call(u):void 0,m.initializer=void 0),void 0===m.initializer&&(AE(o,r,m),m=null),m}var em=gt("Array").keys,gs=tc,k0=Pt,x0=ho,_s=em,Ho=Array.prototype,Ui={DOMTokenList:!0,NodeList:!0},Ma=function(o){var r=o.keys;return o===Ho||x0(Ho,o)&&r===Ho.keys||k0(Ui,gs(o))?_s:r};function Rv(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function VR(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?Rv(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Rv(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let tm=0,bv=0;function Vi(o,r,i,s){return new ie((u,d)=>{r.timeout=r.timeout||V("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),tm+=md(r.data)):i&&(r.data.size?tm+=r.data.size:r.data instanceof FormData?tm+=function(h){let f=0;return/DingTalk/i.test(navigator.userAgent)&&h.realFormData&&(h=h.realFormData),h.forEach(m=>{f+="string"==typeof m?md(m):m.size}),f+138}(r.data):tm+=md(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=o,Ni.request(r).then(h=>{"string"==typeof h.data?bv+=md(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?bv+=h.data.byteLength:bv+=md(JSON.stringify(h.data)),s&&u({data:h.data,headers:h.headers}),u(h.data)}).catch(h=>{Ni.isCancel(h)?d(new L(D.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new L(D.NETWORK_TIMEOUT,h.message):h.response?new L(D.NETWORK_RESPONSE_ERROR,h.response.status):new L(D.NETWORK_ERROR,h.message))})})}function Av(o,r){return jc.apply(this,arguments)}function jc(){return jc=M(function*(o,r){const i=new Blob([r.data],{type:"buffer"});return yield Vi(o,VR(VR({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}),jc.apply(this,arguments)}const sn=new class extends Lt{set networkState(o){R.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+o),this.emit(Oa.NETWORK_STATE_CHANGE,o,this._networkState),o===cr.ONLINE?this.emit(Oa.ONLINE):o===cr.OFFLINE&&(this.onlineWaiter=new ie(r=>{this.once(Oa.ONLINE,()=>{this.onlineWaiter=void 0,r(cr.ONLINE)})}),this.emit(Oa.OFFLINE)),this._networkState=o}get networkState(){return this._networkState}constructor(){super(),S(this,"_moduleName","network-indicator"),S(this,"_networkState",cr.ONLINE),S(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=cr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=cr.OFFLINE})}};let nm=!1;const bo=new class extends Lt{constructor(){super(...arguments),S(this,"onAutoplayFailed",void 0),S(this,"onAudioAutoplayFailed",void 0)}};function FR(){if(ut(),!nm){const o=r=>{r.preventDefault(),nm=!1,_c()?document.body.removeEventListener("click",o,!0):(document.body.removeEventListener("touchstart",o,!0),document.body.removeEventListener("mousedown",o,!0))};nm=!0,_c()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),bo.onAutoplayFailed?bo.onAutoplayFailed():R.warning(bo.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),bo.emit("autoplay-failed")}}function rm(o){return(new TextEncoder).encode(o)}const Dv=function(o,r){const i=new Uint8Array(o.byteLength+r.byteLength);return i.set(new Uint8Array(o),0),i.set(new Uint8Array(r),o.byteLength),i},om=function(){var o=M(function*(r){return function(i,s){let u="";return new Uint8Array(i).forEach(d=>{u+=d.toString(16).padStart(2,"0")}),u}(yield crypto.subtle.digest("SHA-256",rm(r)))});return function(i){return o.apply(this,arguments)}}();function jR(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function Ae(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?jR(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):jR(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function pe(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(r,i,s){const u=s.value;if("function"==typeof u){const d=o.className||r.__className__||("AgoraRTCClient"===r.constructor.name?"Client":r.constructor.name);s.value=function(){for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];let _=f;if(o.argsMap)try{_=o.argsMap(this,...f)}catch(y){R.warning(y),_=[]}try{JSON.stringify(_)}catch{R.warning("arguments for method ".concat(d,".").concat(String(i)," not serializable for apiInvoke.")),_=[]}const E=(o.report||he).reportApiInvoke(this._sessionId||null,{name:"".concat(d,".").concat(String(i)),options:_,tag:xt.TRACER,reportResult:o.reportResult},o.throttleTime);try{const y=u.apply(this,f);return y instanceof ie?y.then(T=>(E.onSuccess(o.reportResult&&T),T)).catch(T=>{throw E.onError(T),T}):(E.onSuccess(o.reportResult&&y),y)}catch(y){throw E.onError(y),y}}}return s}}const he=new class{constructor(){var o=this;S(this,"baseInfoMap",new Map),S(this,"proxyServer",void 0),S(this,"clientList",Dc),S(this,"eventUploadTimer",void 0),S(this,"setSessionIdTimer",void 0),S(this,"url",void 0),S(this,"backupUrl",void 0),S(this,"_appId",void 0),S(this,"keyEventUploadPendingItems",[]),S(this,"normalEventUploadPendingItems",[]),S(this,"apiInvokeUploadPendingItems",[]),S(this,"apiInvokeCount",0),S(this,"ltsList",[]),S(this,"lastSendNormalEventTime",Date.now()),S(this,"customReportCounterTimer",void 0),S(this,"customReportCount",0),S(this,"extApiInvoke",function(){var r=M(function*(i){for(const s of i){const u=Ae(Ae({},s),{},{sid:null,invokeId:++o.apiInvokeCount,tag:xt.TRACER});o.sendApiInvoke(u)}});return function(i){return r.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),V("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),V("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(o){if(!this.baseInfoMap.has(o)&&!this.baseInfoMap.get(o))return void R.error("adjust session ".concat(o," start time, sid is not exist or info is undefined"));const r=this.baseInfoMap.get(o),i=Date.now(),s=r.startTime;r.startTime=i,R.debug("rewrite session ".concat(o," startTime: ").concat(i," , ").concat(i-s,"ms")),this.baseInfoMap.set(o,r)}setAppId(o){this._appId=o}reportApiInvoke(o,r,i){r.timeout=r.timeout||6e4,r.reportResult=void 0===r.reportResult||r.reportResult;const s=Date.now();this.apiInvokeCount+=1;const u=this.apiInvokeCount,d=()=>({tag:r.tag,invokeId:u,sid:o,name:r.name,apiInvokeTime:s,options:r.options,states:r.states||null}),h=!!V("SHOW_REPORT_INVOKER_LOG");h&&R.info("".concat(r.name," start"),r.options);let f=!1;hr(r.timeout).then(()=>{f||(this.sendApiInvoke(Ae(Ae({},d()),{},{error:D.API_INVOKE_TIMEOUT,success:!1})),R.debug("".concat(r.name," timeout")))});const m=new L(D.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:_=>{const E=()=>{if(f)throw m;return f=!0,this.sendApiInvoke(Ae(Ae({},d()),{},{success:!0},r.reportResult&&{result:_})),h&&R.info("".concat(r.name," onSuccess")),_};return i?mm(E,r.name+"Success",i,()=>f=!0):E()},onError:_=>{const E=()=>{if(f)throw _;f=!0,this.sendApiInvoke(Ae(Ae({},d()),{},{success:!1,error:_})),h&&R.info("".concat(r.name," onFailure"),_.toString())};return i?mm(E,r.name+"Error",i,()=>f=!0):E()}}}sessionInit(o,r){if(this.baseInfoMap.has(o))return;const i=Date.now(),s=this.createBaseInfo(o,i);s.cname=r.cname;const u=Object.assign({},{willUploadConsoleLog:V("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:QE?"global":"oversea",areas:V("AREAS")&&V("AREAS").join(",")},r.extend),d=Date.now(),h=Ae(Ae({},s),{},{eventType:Kn.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,build:jf,lts:d,elapse:d-i,extend:JSON.stringify(u),mode:r.mode,process:V("PROCESS_ID"),appType:V("APP_TYPE"),success:!0,version:no});this.send({type:kt.SESSION,data:h},!0)}joinChooseServer(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now(),d=Ae(Ae({},s),{},{eventType:Kn.JOIN_CHOOSE_SERVER,lts:u,eventElapse:u-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:u-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3});this.send({type:kt.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now(),d=Ae(Ae({},s),{},{eventType:Kn.REQ_USER_ACCOUNT,lts:u,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:u-i.startTime,eventElapse:u-r.lts,extend:JSON.stringify(r.extend)});this.send({type:kt.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info;r.vid&&(s.vid=r.vid),s.uid=r.uid,s.cid=r.cid;const u=Date.now(),{firstSuccess:d,avoidJoinStartTime:h,isProxy:f,addr:m}=r,_=u-(d&&h?h:i.startTime),E=Ae(Ae({},s),{},{eventType:Kn.JOIN_GATEWAY,lts:u,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,elapse:_,eventElapse:u-r.lts,firstSuccess:d,signalChannel:r.signalChannel}),y=E.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=u),d)this.send({type:kt.JOIN_GATEWAY,data:E},!0);else{let T;if(m)if(f){const w=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),P=m.match(/p=[0-9]{1,6}/g);T={isSuccess:y,gatewayIp:w&&w.length?w[0].split("=")[1].replace(/-/g,"."):"",port:P&&P.length?P[0].split("=")[1]:"",isProxy:f?1:0}}else{const w=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),P=m.match(/:[0-9]{1,6}/g);T={isSuccess:y,gatewayIp:w&&w.length?w[0].split("//")[1].replace(/-/g,"."):"",port:P&&P.length?P[0].split(":")[1]:"",isProxy:f?1:0}}else T={isSuccess:y,gatewayIp:"",port:"",isProxy:f?1:0};delete E.success,delete E.eventType,delete E.firstSuccess,E.vid=Number(E.vid);const b=Object.assign({},E,T,{eventType:Kn.REJOIN_GATEWAY});this.send({type:kt.RE_JOIN_GATEWAY,data:b},!0)}}joinChannelTimeout(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=Date.now(),u=Ae(Ae({},i.info),{},{lts:s,timeout:r,elapse:s-i.startTime});this.send({type:kt.JOIN_CHANNEL_TIMEOUT,data:u},!0)}publish(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now(),d=Ae(Ae({},s),{},{eventType:Kn.PUBLISH,lts:u,eventElapse:r.eventElapse,elapse:u-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:kt.PUBLISH,data:d},!0)}subscribe(o,r,i){const s=this.baseInfoMap.get(o);if(!s)return;const u=s.info,d=Date.now(),h=Ae(Ae({},u),{},{eventType:Kn.SUBSCRIBE,lts:d,eventElapse:r.eventElapse,elapse:d-s.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid},i&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof r.peerid?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:kt.SUBSCRIBE,data:h},!0)}wsCompressorInit(o){var r;const i=[...Ma(r=this.baseInfoMap).call(r)],u=this.baseInfoMap.get(i.length?i[0]:"UnableToGetSid");if(!u)return;const d=u.info,h=Date.now(),f=Ae(Ae({},d),{},{eventType:Kn.WS_COMPRESSOR_INIT,lts:h,eventElapse:o.eventElapse,elapse:h-u.startTime,status:o.status?1:2});this.send({type:kt.WS_COMPRESSOR_INIT,data:f},!0)}firstRemoteVideoDecode(o,r,i,s){const u=this.baseInfoMap.get(o);if(!u)return;const d=u.info,h=Date.now(),f=Ae(Ae(Ae({},d),s),{},{elapse:h-u.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max(h-u.startTime,0),apEnd:Math.max(s.apEnd-u.startTime,0),apStart:Math.max(s.apStart-u.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-u.startTime,0),joinGwStart:Math.max(s.joinGwStart-u.startTime,0),pcEnd:Math.max(s.pcEnd-u.startTime,0),pcStart:Math.max(s.pcStart-u.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-u.startTime,0),subscriberStart:Math.max(s.subscriberStart-u.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-u.startTime,0)});this.send({type:i,data:f},!0)}firstRemoteFrame(o,r,i,s){const u=this.baseInfoMap.get(o);if(!u)return;const d=u.info,h=Date.now(),f=Ae(Ae(Ae({},d),s),{},{elapse:h-u.startTime,eventType:r,lts:h});this.send({type:i,data:f},!0)}pcStats(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now(),d=Ae(Ae(Ae({},s),r),{},{vid:void 0===s.vid?0:Number(s.vid),elapse:u-i.startTime,eventType:Kn.PC_STATS,lts:u});this.send({type:kt.PC_STATS,data:d},!0)}onGatewayStream(o,r,i,s){const u=this.baseInfoMap.get(o);if(!u)return;const d=u.info,h=Date.now(),f=Ae(Ae(Ae({},d),s),{},{eventType:r,lts:h});this.send({type:i,data:f},!0)}streamSwitch(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now(),d=Ae(Ae({},s),{},{eventType:Kn.STREAM_SWITCH,lts:u,isDual:r.isdual,elapse:u-i.startTime,success:r.succ});this.send({type:kt.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now(),d=Ae(Ae({},s),{},{eventType:Kn.REQUEST_PROXY_APPCENTER,lts:u,eventElapse:u-r.lts,elapse:u-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:kt.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now(),d=Ae(Ae({},s),{},{eventType:Kn.REQUEST_PROXY_WORKER_MANAGER,lts:u,eventElapse:u-r.lts,elapse:u-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:kt.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(o){this.proxyServer=o,R.debug(o?"reportProxyServerurl: ".concat(o):"disable reportProxyServerurl: ".concat(o))}peerPublishStatus(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now(),d=Ae(Ae({},s),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:u,elapse:u-i.startTime,joinChannelSuccessElapse:u-(i.lastJoinSuccessTime||u),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:kt.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now();(function(d,h,f){const m=d[h];if(!m||"string"!=typeof m)return[d];d[h]="";const _=md(JSON.stringify(d));let E=0;const y=[];let T=0;for(let b=0;b<m.length;b++)T+=m.charCodeAt(b)<=127?1:3,T<=1300-_||(y[y.length]=$c($c({},d),{},{[h]:m.substring(E,b)}),E=b,T=m.charCodeAt(b)<=127?1:3);return E!==m.length-1&&(y[y.length]=$c($c({},d),{},{[h]:m.substring(E)})),y})(Ae(Ae(Ae({},s),r),{},{elapse:u-i.startTime,lts:u,productType:"WebRTC"}),"payload").forEach(d=>this.send({type:kt.WORKER_EVENT,data:d},!0))}apworkerEvent(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now(),d=Ae(Ae(Ae({},s),r),{},{elapse:u-i.startTime,lts:u});this.send({type:kt.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now(),d=Ae(Ae(Ae({},s),r),{},{elapse:u-i.startTime,lts:u,extend:r.extend||void 0});this.send({type:kt.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(o,r){const i=this.baseInfoMap.get(o);if(!i)return;const s=i.info,u=Date.now(),d=Ae(Ae(Ae({},s),r),{},{elapse:u-i.startTime,lts:u});this.send({type:kt.WEBSOCKET_QUIT,data:d},!0)}sendCustomReportMessage(o,r){var i=this;return M(function*(){if(i.customReportCount+=r.length,i.customReportCount>V("CUSTOM_REPORT_LIMIT"))throw new L(D.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);i.customReportCounterTimer||(i.customReportCounterTimer=window.setInterval(()=>{i.customReportCount=0},5e3));const s=Date.now(),u=r.map(d=>({type:kt.USER_ANALYTICS,data:Ae(Ae({sid:o},d),{},{lts:s})}));try{V("NEW_REPORT_SERVER")?yield i.postDataToStatsCollector2(u):yield i.postDataToStatsCollector(u)}catch(d){throw R.error("send custom report message failed",d.toString()),new L(D.CUSTOM_REPORT_SEND_FAILED,d.message)}})()}autoplayFailed(o,r,i,s){if(!o)return;const u=this.baseInfoMap.get(o);if(!u)return;const d=u.info,h=Date.now(),f=Ae(Ae({},d),{},{vid:void 0===d.vid?0:Number(d.vid),lts:h,elapse:h-u.startTime,cbRegistered:bo.onAutoplayFailed||bo.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:s,extend:void 0});this.send({type:kt.AUTOPLAY_FAILED,data:f},!0)}sendApiInvoke(o){const r=V("NOT_REPORT_EVENT");if(o.tag&&r.includes&&r.includes(o.tag))return!1;if(null===o.sid)return this.apiInvokeUploadPendingItems.push(o),!1;const i=this.baseInfoMap.get(o.sid);if(!i)return this.apiInvokeUploadPendingItems.push(o),!1;const{cname:s,uid:u,cid:d}=i.info;let h;if(o.lts=o.lts||Date.now(),o.error)if(o.error instanceof L){const{code:m,message:_}=o.error;h=m||_||o.error.toString()}else h=o.error.toString();const f={invokeId:o.invokeId,sid:o.sid,cname:s,cid:d,uid:u,lts:o.lts,success:o.success,elapse:o.lts-i.startTime,execElapse:o.lts-o.apiInvokeTime,apiName:o.name,options:o.options?JSON.stringify(o.options):void 0,execStates:o.states?JSON.stringify(o.states):void 0,execResult:o.result?JSON.stringify(o.result):void 0,errorCode:o.error?h:void 0,errorMsg:o.error?JSON.stringify(o.error):void 0};return this.send({type:kt.API_INVOKE,data:f},!1),!0}appendSessionId(){this.clientList.forEach(o=>{if(o._sessionId){const r=this.apiInvokeUploadPendingItems.length;for(let i=0;i<r;i++){const s=this.apiInvokeUploadPendingItems.shift();s&&(s.sid=o._sessionId,this.sendApiInvoke(Object.assign({},s)))}}})}send(o,r){if(r)return this.keyEventUploadPendingItems.push(o),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(o),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(o,r){const i=[],s=[];for(;o.length;){const d=o.shift();i.length<20?i.push(d):s.push(d)}o.push(...s);for(const d of[...i]){var u;-1!==this.ltsList.indexOf(d.data.lts)?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),Wf(u=this.ltsList).call(u,(h,f)=>h-f))}return r||(this.lastSendNormalEventTime=Date.now()),V("ENABLE_EVENT_REPORT")&&i.length&&(V("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((d=>h=>{V("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-V("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(i)),o}postDataToStatsCollector2(o){var r=this;return M(function*(){sn.networkState===cr.OFFLINE&&(yield ie.race([sn.onlineWaiter,hr(2*vn.maxRetryTimeout)]));const i=d=>{let h=new Uint8Array;return d.forEach(f=>{const m=rm(JSON.stringify(f.data)),_=new ArrayBuffer(5),E=(T=>{let b=0;return Object.entries(kt).forEach(w=>{let[P,k]=w;k===T.type&&(b=gv[P])}),b})(f),y=new DataView(_);y.setUint16(0,m.byteLength,!0),y.setUint8(2,255&E),y.setUint8(3,E>>>8&255),y.setUint8(4,E>>>16&255),h=Dv(h,new Uint8Array(_)),h=Dv(h,m)}),h},s="event";let u=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let d=0;d<2;d+=1){1===d&&(u=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{yield Vi(u,{timeout:1e4,data:i(o),headers:Ae(Ae({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},r._appId&&{appid:r._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(h){if(1===d)throw h;continue}return}})()}postDataToStatsCollector(o){var r=arguments,i=this;return M(function*(){let s=r.length>1&&void 0!==r[1]&&r[1];const u={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:o.map(f=>JSON.stringify(f)),vid:(f=>{const m=f&&f.data.sid&&i.baseInfoMap.get(f.data.sid);return m&&m.info.vid&&+m.info.vid||0})(o[0])};sn.networkState===cr.OFFLINE&&(yield ie.race([sn.onlineWaiter,hr(2*vn.maxRetryTimeout)]));const d=s?"/events/proto-raws":"/events/messages";let h=i.url||(i.proxyServer?"https://".concat(i.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(V("EVENT_REPORT_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(d));for(let f=0;f<2;f+=1){1===f&&(h=i.backupUrl||(i.proxyServer?"https://".concat(i.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(V("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(d)));try{s?yield Av(h,{timeout:1e4,data:u}):yield Vi(h,{timeout:1e4,data:u})}catch(m){if(1===f)throw m;continue}return}})()}createBaseInfo(o,r){const i=Object.assign({},p0);return i.sid=o,this.baseInfoMap.set(o,{info:i,startTime:r}),i}reportResourceTiming(o,r){const i=performance.getEntriesByName(o),s=i[i.length-1];s&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:s,tag:xt.TRACER}).onSuccess()}};Fo.on("REPORT_LOG_UPLOAD",o=>{o.networkState=sn.networkState,he.reportApiInvoke(null,{name:"logUploadError",options:o,tag:xt.TRACER})});class BR extends Lt{constructor(r,i){super(),S(this,"trackMediaType",void 0),S(this,"_ID",void 0),S(this,"_rtpTransceiver",void 0),S(this,"_lowRtpTransceiver",void 0),S(this,"_hints",[]),S(this,"_isClosed",!1),S(this,"_originMediaStreamTrack",void 0),S(this,"_mediaStreamTrack",void 0),S(this,"_external",{}),this._ID=i||wt(8,"track-"),this._originMediaStreamTrack=r,this._mediaStreamTrack=r,Zu.includes(this)||Zu.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){if(!r){he.reportApiInvoke(null,{name:pn.GET_MEDIA_STREAM_TRACK,options:[],tag:xt.TRACER}).onSuccess(this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?this._mediaStreamTrack.label:"")}return this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===fs.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const i=Zu.indexOf(r);-1!==i&&Zu.splice(i,1)}(this),this.emit(ui.CLOSED)}_updateRtpTransceiver(r,i){if(i===fs.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(ad.TRANSCEIVER_UPDATED,r,i)}}let Tn,HR=1;class Mn{constructor(r){S(this,"lockingPromise",ie.resolve()),S(this,"locks",0),S(this,"name",""),S(this,"lockId",void 0),this.lockId=HR++,r&&(this.name=r),R.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(r){let i;this.locks+=1,R.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof r?r:""));const s=new ie(d=>{i=()=>{this.locks-=1,R.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof r?r:"")),d()}}),u=this.lockingPromise.then(()=>i);return this.lockingPromise=this.lockingPromise.then(()=>s),u}}function Bc(o,r){return function(i,s,u){const d=u.value;if("function"!=typeof d)throw new Error("Cannot use mutex on object property.");return u.value=M(function*(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(o));const f=yield h.lock("From ".concat(o,".").concat(s));try{for(var m=arguments.length,_=new Array(m),E=0;E<m;E++)_[E]=arguments[E];return yield d.apply(this,_)}finally{f()}}),u}}class im extends BR{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}constructor(r,i){super(r,i),S(this,"_enabled",!0),S(this,"_muted",!1),S(this,"_isExternalTrack",!1),S(this,"_isClosed",!1),S(this,"_enabledMutex",void 0),S(this,"processor",void 0),S(this,"_processorContext",void 0),S(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Mn("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return null!==(r=null===(i=this._originMediaStreamTrack)||void 0===i?void 0:i.label)&&void 0!==r?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ee.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(r,i){var s=arguments,u=this;return M(function*(){u._isExternalTrack=s.length>2&&void 0!==s[2]&&s[2],r!==u._originMediaStreamTrack&&(u._originMediaStreamTrack.removeEventListener("ended",u._handleTrackEnded),i&&u._originMediaStreamTrack.stop(),r.addEventListener("ended",u._handleTrackEnded),u._originMediaStreamTrack=r,u._muted&&(u._originMediaStreamTrack.enabled=!1),u._mediaStreamTrack=u._originMediaStreamTrack,u._updatePlayerSource(),yield Wt(u,Ee.NEED_REPLACE_TRACK,u),u.processor&&u.processor.updateInput({track:u._originMediaStreamTrack,context:u.processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(ui.TRACK_ENDED)}stateCheck(r,i){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),td(i,r),this._enabled&&this._muted&&"enabled"===r&&!1===i)throw new L(D.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&"muted"===r&&!0===i)throw new L(D.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function wv(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}!function(o){o.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",o.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",o.IOS_INTERRUPTION_START="ios-interruption-start",o.IOS_INTERRUPTION_END="ios-interruption-end",o.STATE_CHANGE="state-change"}(Tn||(Tn={}));const Ov=window.AudioContext||window.webkitAudioContext;let so=null;const tt=new class extends Lt{constructor(){var o;super(...arguments),o=this,S(this,"prevState",void 0),S(this,"curState",void 0),S(this,"currentTime",void 0),S(this,"currentTimeStuckAt",void 0),S(this,"interruptDetectorTrack",void 0),S(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(Tn.IOS_15_16_INTERRUPTION_START)}),S(this,"onLocalAudioTrackUnmute",M(function*(){R.info("ios15-interruption-end"),"running"!==o.curState||o.duringInterruption?R.info("ios15-interruption-end-canceled"):(so&&(yield so.suspend()),o.emit(Tn.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(o){R.debug("webaudio bindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=o,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(o){R.debug("webaudio unbindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===o&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Hc(){if(!so){if(function GR(){if(!Ov)return void R.error("your browser is not support web audio");R.info("create audio context");const o=function(r){for(var i=1;i<arguments.length;i++){var s=null!=arguments[i]?arguments[i]:{};i%2?wv(Object(s),!0).forEach(function(u){S(r,u,s[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):wv(Object(s)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(s,u))})}return r}({},V("WEBAUDIO_INIT_OPTIONS"));var r;R.debug("audio context init option:",JSON.stringify(o)),so=new Ov(o),tt.curState=so.state,so.onstatechange=()=>{tt.prevState=tt.curState,tt.curState=so?so.state:void 0;const{prevState:r,curState:i}=tt,s="running"===i,u="interrupted"===i,d="running"===r,h="suspended"===r,f="interrupted"===r,m=ut().osVersion;(vr()||Wr())&&d&&u&&(R.info("ios".concat(m,"-interruption-start")),tt.emit(Tn.IOS_INTERRUPTION_START)),(vr()||Wr())&&(h||f)&&s&&(R.info("ios".concat(m,"-interruption-end")),tt.emit(Tn.IOS_INTERRUPTION_END)),r!==i&&(R.debug("AudioContext State Change","".concat(r,"=>").concat(i)),tt.emit(Tn.STATE_CHANGE))},setInterval(()=>{var r;const i=null===(r=so)||void 0===r?void 0:r.currentTime;tt.currentTime!==i?(tt.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(i)),tt.currentTimeStuckAt=void 0),tt.currentTime=i):(i!==tt.currentTimeStuckAt&&(he.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:xt.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(i))),tt.currentTimeStuckAt=i)},5e3),(r=M(function*(i){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let u,d=!1,h=!1,f=!1;function m(x){"running"===i.state?_(!1):vr()||Wr()?"suspended"===i.state&&(_(!0),x&&i.resume().then(y,y)):"closed"!==i.state&&(_(!0),x&&i.resume().then(y,y))}function _(x){if(d!==x){d=x;for(let B=0,H=s;B<H.length;B+=1){const ce=H[B];x?window.addEventListener(ce,T,{capture:!0,passive:!0}):window.removeEventListener(ce,T,{capture:!0,passive:!0})}}}function y(){m(!1)}function T(){m(!0)}function b(x){if(!f)if(u.paused)if(x){let B;w(!1),f=!0;try{B=u.play(),B?B.then(P,P):(u.addEventListener("playing",P),u.addEventListener("abort",P),u.addEventListener("error",P))}catch{P()}}else w(!0);else w(!1)}function w(x){if(h!==x){h=x;for(let B=0,H=s;B<H.length;B++){const ce=H[B];x?window.addEventListener(ce,k,{capture:!0,passive:!0}):window.removeEventListener(ce,k,{capture:!0,passive:!0})}}}function P(){u.removeEventListener("playing",P),u.removeEventListener("abort",P),u.removeEventListener("error",P),f=!1,b(!1)}function k(){b(!0)}if(vr()){const x=i.createMediaStreamDestination(),B=document.createElement("div");B.innerHTML="<audio x-webkit-airplay='deny'></audio>",u=B.children.item(0),u.controls=!1,u.disableRemotePlayback=!0,u.preload="auto",u.srcObject=x.stream,b(!0)}tt.on(Tn.STATE_CHANGE,function E(){m(!0)}),m(!1)}),function(i){return r.apply(this,arguments)})(so)}(),!so)throw new L(D.NOT_SUPPORTED,"can not create audio context");return so}return so}function WR(){return!!so}function Gc(o){if(function(){if(null!==Nv)return Nv;const s=Hc(),u=s.createBufferSource(),d=s.createGain(),h=s.createGain();u.connect(d),u.connect(h),u.disconnect(d);let f=!1;try{u.disconnect(d)}catch{f=!0}return u.disconnect(),Nv=f,f}())return;const r=o.connect,i=o.disconnect;o.connect=(s,u,d)=>(o._inputNodes||(o._inputNodes=[]),o._inputNodes.includes(s)||(s instanceof AudioNode?(o._inputNodes.push(s),r.call(o,s,u,d)):r.call(o,s,u)),o),o.disconnect=(s,u,d)=>{i.call(o),s?uy(o._inputNodes,s):o._inputNodes=[];for(const h of o._inputNodes)r.call(o,h)}}let Nv=null;function KR(o,r){let i=!1;const s=1/r;if(V("DISABLE_WEBAUDIO")){const u=window.setInterval(()=>{i?window.clearInterval(u):o(performance.now()/1e3)},1e3*s)}else{const u=Hc();let d=u.createGain();d.gain.value=0,d.connect(u.destination);const h=()=>{if(i)return void(d=null);const f=u.createOscillator();f.onended=h,f.connect(d),f.start(0),f.stop(u.currentTime+s),o(u.currentTime)};h()}return()=>{i=!0}}class qR{constructor(){S(this,"context",void 0),S(this,"analyserNode",void 0),S(this,"sourceNode",void 0),this.context=Hc(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||vr()||Wr()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let u=0;u<r.length;++u)r[u]=s[u]/128-1}const i=ti(r).call(r,(s,u)=>s+u*u,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;null===(r=this.sourceNode)||void 0===r||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(i=this.sourceNode)||void 0===i||i.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class $R extends Lt{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var s;null===(s=this.sourceNode)||void 0===s||s.disconnect(this.outputNode)}catch{}null===(i=this._processedNode)||void 0===i||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),S(this,"outputNode",void 0),S(this,"outputTrack",void 0),S(this,"isPlayed",!1),S(this,"sourceNode",void 0),S(this,"context",void 0),S(this,"audioBufferNode",void 0),S(this,"destNode",void 0),S(this,"audioOutputLevel",0),S(this,"volumeLevelAnalyser",void 0),S(this,"_processedNode",void 0),S(this,"playNode",void 0),S(this,"isDestroyed",!1),S(this,"onNoAudioInput",void 0),S(this,"isNoAudioInput",!1),S(this,"_noAudioInputCount",0),this.context=Hc(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Gc(this.outputNode),this.volumeLevelAnalyser=new qR}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(en.ON_AUDIO_BUFFER,function(s){for(let u=0;u<s.outputBuffer.numberOfChannels;u+=1){const d=s.outputBuffer.getChannelData(u);for(let h=0;h<d.length;h+=1)d[h]=0}return s.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Yt().webAudioMediaStreamDest)throw new L(D.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){"running"!==this.context.state&&Hi(()=>{tt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var r=arguments,i=this;return M(function*(){let s=r.length>0&&void 0!==r[0]?r[0]:0;if(s>5)return i.isNoAudioInput=!0,i.onNoAudioInput&&i.onNoAudioInput(),!1;vr()||Wr()?"suspended"===i.context.state&&i.context.resume():"running"!==i.context.state&&i.context.resume();const u=i.volumeLevelAnalyser.getAnalyserNode();let d;u.getFloatTimeDomainData?(d=new Float32Array(u.fftSize),u.getFloatTimeDomainData(d)):(d=new Uint8Array(u.fftSize),u.getByteTimeDomainData(d));let h=!1;for(let f=0;f<d.length;f++)0!==d[f]&&(h=!0);return h?(i.isNoAudioInput=!1,!0):(yield hr(200),(yield i.checkHasAudioInput(s?s+1:1))&&h)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;null===(r=this.processedNode)||void 0===r||r.disconnect(),null===(i=this.sourceNode)||void 0===i||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?null===(r=this.processedNode)||void 0===r||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Pv extends $R{get isFreeze(){return!1}constructor(r,i,s){var u,d;if(super(),u=this,S(this,"sourceNode",void 0),S(this,"track",void 0),S(this,"clonedTrack",void 0),S(this,"audioElement",void 0),S(this,"isCurrentTrackCloned",!1),S(this,"isRemoteTrack",!1),S(this,"originVolumeLevelAnalyser",void 0),S(this,"rebuildWebAudio",M(function*(){if(R.debug("ready to rebuild web audio, state:",u.context.state),u.isNoAudioInput&&(yield u.checkHasAudioInput()),!u.isNoAudioInput||u.isDestroyed)return document.body.removeEventListener("click",u.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",u.getAccurateVolumeLevel());u.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),u.disconnect();const m=u.track;u.track=u.track.clone(),u.isCurrentTrackCloned?m.stop():u.isCurrentTrackCloned=!0;const _=new MediaStream([u.track]);u.sourceNode=u.context.createMediaStreamSource(_),Gc(u.sourceNode),u.volumeLevelAnalyser.rebuildAnalyser();const E=u.outputNode.gain.value;u.outputNode=u.context.createGain(),u.outputNode.gain.setValueAtTime(E,u.context.currentTime),Gc(u.outputNode),u.emit(en.UPDATE_SOURCE),u.connect(),u.audioElement.srcObject=_,u.isPlayed&&u.play(u.playNode),u.checkHasAudioInput()})),"audio"!==r.kind)throw new L(D.UNEXPECTED_ERROR);this.track=r;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(h),Gc(this.sourceNode),s){const m=s.clone();m.enabled=!0,this.clonedTrack=m,R.debug("create an unmuted track ".concat(m.id," from the original track ").concat(s.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));Gc(_),this.originVolumeLevelAnalyser=new qR,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const f=ut();i&&f.os===Gn.IOS&&Number(null===(d=f.osVersion)||void 0===d?void 0:d.split(".")[0])<15&&(tt.on(Tn.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),Gc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(en.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),tt.off("state-change",this.rebuildWebAudio),null===(r=this.originVolumeLevelAnalyser)||void 0===r||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),R.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([i]));Gc(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function zR(o,r){return Mv.apply(this,arguments)}function Mv(){return Mv=M(function*(o,r){const i=(u,d)=>u?"number"!=typeof u?u.max||u.exact||u.ideal||u.min||d:u:d,s={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxHeight:i(r.height,1080),maxWidth:i(r.width,1920)}}};return r.frameRate&&"number"!=typeof r.frameRate?(s.video.mandatory.maxFrameRate=r.frameRate.max,s.video.mandatory.minFrameRate=r.frameRate.min):"number"==typeof r.frameRate&&(s.video.mandatory.maxFrameRate=r.frameRate),yield navigator.mediaDevices.getUserMedia(s)}),Mv.apply(this,arguments)}function Lv(){return Lv=M(function*(o){const r=yield YR(o.mediaSource),i=yield(s=r,new ie((u,d)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const f=document.createElement("div");f.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const m=document.createElement("div");m.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",m.setAttribute("style","height: 12%;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const E=document.createElement("div");E.setAttribute("style","text-align: right; padding: 16px 0;");const y=document.createElement("button");y.innerHTML="cancel",y.setAttribute("style","width: 85px;"),y.onclick=()=>{document.body.removeChild(T);const b=new Error("NotAllowedError");b.name="NotAllowedError",d(b)},E.appendChild(y),f.appendChild(m),f.appendChild(_),f.appendChild(E);const T=document.createElement("div");T.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),T.appendChild(h),T.appendChild(f),document.body.appendChild(T),s.map(b=>{if(b.id){const w=document.createElement("div");w.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let P=b.thumbnail;const{width:k}=P.getSize();k>1920&&(P=P.resize({width:1920})),w.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+P.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+b.name.replace(/[\u00A0-\u9999<>\&]/g,function(x){return"&#"+x.charCodeAt(0)+";"})+"</span>",w.onclick=()=>{document.body.removeChild(T),u(b.id)},_.appendChild(w)}})}));var s;return yield zR(i,o)}),Lv.apply(this,arguments)}function YR(o){return kv.apply(this,arguments)}function kv(){return kv=M(function*(o){let r=["window","screen"];"application"!==o&&"window"!==o||(r=["window"]),"screen"===o&&(r=["screen"]);const i=JR();if(!i)throw new L(D.ELECTRON_IS_NULL);let s=null;try{var u;s=(null===(u=i.desktopCapturer)||void 0===u?void 0:u.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{s=null}s&&s.then||(s=new ie((d,h)=>{i.desktopCapturer.getSources({types:r},(f,m)=>{f?h(f):d(m)})}));try{return yield s}catch(d){throw new L(D.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}),kv.apply(this,arguments)}let sm=null;function JR(){if(sm)return sm;try{return sm=window.require("electron"),sm}catch{return null}}function XR(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}const xv=new Mn("safari");let QR=!1,Uv=!1;function Go(o,r){return am.apply(this,arguments)}function am(){return am=M(function*(o,r){let i=0,s=null;for(;i<2;)try{s=yield ZR(o,r,i>0);break}catch(u){if(u instanceof L)throw R.error("[".concat(r,"] ").concat(u.toString())),u;const d=zl(u.name||u.code||u,u.message);if(d.code===D.MEDIA_OPTION_INVALID){R.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,yield hr(500);continue}throw R.error("[".concat(r,"] ").concat(d.toString())),d}if(!s)throw new L(D.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}),am.apply(this,arguments)}function ZR(o,r,i){return cm.apply(this,arguments)}function cm(){return cm=M(function*(o,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new L(D.NOT_SUPPORTED,"can not find getUserMedia");i&&(o.video&&(delete o.video.width,delete o.video.height),o.screen&&(delete o.screen.width,delete o.screen.height));const s=Yt(),u=new MediaStream;if(o.audioSource&&u.addTrack(o.audioSource),o.videoSource&&u.addTrack(o.videoSource),!o.audio&&!o.video&&!o.screen)return R.debug("Using Video Source/ Audio Source"),u;if(o.screen)if(JR())Wc(u,o.screen.sourceId?yield zR(o.screen.sourceId,o.screen):yield function U0(o){return Lv.apply(this,arguments)}(o.screen));else if(If()&&o.screen.extensionId&&o.screen.mandatory){if(!s.getStreamFromExtension)throw new L(D.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const T=yield(h=o.screen.extensionId,f=r,new ie((b,w)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},P=>{if(!P||!P.streamId)return R.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),P),void w(new L(D.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));b(P.streamId)})}catch(P){R.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),P.toString()),w(new L(D.CHROME_PLUGIN_NOT_INSTALL))}}));o.screen.mandatory.chromeMediaSourceId=T,Wc(u,yield navigator.mediaDevices.getUserMedia({video:{mandatory:o.screen.mandatory}}))}else if(s.getDisplayMedia){var d;o.screen.mediaSource&&mR(o.screen.mediaSource);const T={width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate,displaySurface:null!==(d=o.screen.displaySurface)&&void 0!==d?d:"screen"===o.screen.mediaSource?"monitor":o.screen.mediaSource},{selfBrowserSurface:b,surfaceSwitching:w,systemAudio:P}=o.screen,k={selfBrowserSurface:b,surfaceSwitching:w,systemAudio:P};!b&&delete k.selfBrowserSurface,!w&&delete k.surfaceSwitching,!P&&delete k.systemAudio,R.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:T,audio:!!o.screenAudio,controls:k})),Wc(u,yield navigator.mediaDevices.getDisplayMedia(function(x){for(var B=1;B<arguments.length;B++){var H=null!=arguments[B]?arguments[B]:{};B%2?XR(Object(H),!0).forEach(function(ce){S(x,ce,H[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(H)):XR(Object(H)).forEach(function(ce){Object.defineProperty(x,ce,Object.getOwnPropertyDescriptor(H,ce))})}return x}({video:T,audio:!!o.screenAudio},k)))}else{if(!Bt())throw R.error("[".concat(r,"] This browser does not support screenSharing")),new L(D.NOT_SUPPORTED,"This browser does not support screen sharing");{o.screen.mediaSource&&mR(o.screen.mediaSource);const T={video:{mediaSource:o.screen.mediaSource,width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate}};R.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(T))),Wc(u,yield navigator.mediaDevices.getUserMedia(T))}}var h,f;if(!o.video&&!o.audio)return u;let m={video:o.video,audio:o.audio},_=V("MEDIA_DEVICE_CONSTRAINTS");if(_)try{"string"==typeof _&&(_=JSON.parse(_)),m=function T(b,w){if(!yn(b)||!yn(w)||Array.isArray(b)&&!Array.isArray(w)||!Array.isArray(b)&&Array.isArray(w))return w;if(Array.isArray(w)&&Array.isArray(b)){const P=[...b];for(let k=0;k<w.length;k++)P[k]=T(b[k],w[k]);return P}{const P=$c({},b);for(const k in w)Object.prototype.hasOwnProperty.call(w,k)&&(P[k]=Object.prototype.hasOwnProperty.call(b,k)?T(b[k],w[k]):w[k]);return P}}(m,_)}catch{}R.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(m)),ut();let E,y=null;(or()||vr()||Sa())&&(y=yield xv.lock());try{E=yield navigator.mediaDevices.getUserMedia(m)}catch(T){throw y&&y(),T}return m.audio&&(QR=!0),m.video&&(Uv=!0),Wc(u,E),y&&y(),u}),cm.apply(this,arguments)}function zl(o,r){switch(o){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new L(D.MEDIA_OPTION_INVALID,"".concat(o,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new L(D.DEVICE_NOT_FOUND,"".concat(o,": ").concat(r));case"NotSupportedError":return new L(D.NOT_SUPPORTED,"".concat(o,": ").concat(r));case"NotReadableError":return new L(D.NOT_READABLE,"".concat(o,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new L(D.PERMISSION_DENIED,"".concat(o,": ").concat(r));case"ConstraintNotSatisfiedError":return new L(D.CONSTRAINT_NOT_SATISFIED,"".concat(o,": ").concat(r));default:return R.error("getUserMedia unexpected error",o),new L(D.UNEXPECTED_ERROR,"".concat(o,": ").concat(r))}}function Wc(o,r){const i=o.getVideoTracks()[0],s=o.getAudioTracks()[0],u=r.getVideoTracks()[0],d=r.getAudioTracks()[0];d&&(s&&o.removeTrack(s),o.addTrack(d)),u&&(i&&o.removeTrack(i),o.addTrack(u))}const ao=new class extends Lt{get state(){return this._state}set state(o){o!==this._state&&(this.emit(hs.STATE_CHANGE,o),this._state=o)}constructor(){super(),S(this,"_state",ba.IDLE),S(this,"isAccessMicrophonePermission",!1),S(this,"isAccessCameraPermission",!1),S(this,"lastAccessMicrophonePermission",!1),S(this,"lastAccessCameraPermission",!1),S(this,"checkdeviceMatched",!1),S(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(V("ENUMERATE_DEVICES_INTERVAL")||(Of()||Wu()===Gn.HARMONY_OS)&&as())&&this.updateDevicesInfo()},V("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(o=>R.error(o.toString()))}enumerateDevices(o,r){var i=arguments,s=this;return M(function*(){let u=i.length>2&&void 0!==i[2]&&i[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new L(D.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const d=yield navigator.mediaDevices.enumerateDevices(),h=s.checkMediaDeviceInfoIsOk(d);let f=!s.isAccessMicrophonePermission&&o,m=!s.isAccessCameraPermission&&r;h.audio&&(f=!1),h.video&&(m=!1);let _=null,E=null,y=null;if(!u&&(f||m)){if(xv.isLocked&&(R.debug("[device manager] wait GUM lock"),(yield xv.lock())(),R.debug("[device manager] GUM unlock")),QR&&(f=!1,s.isAccessMicrophonePermission=!0),Uv&&(m=!1,s.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",o,r,f,m),f&&m){try{y=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(T){const b=zl(T.name||T.code||T,T.message);if(b.code===D.PERMISSION_DENIED)throw b;R.warning("getUserMedia failed in getDevices",b)}s.isAccessCameraPermission=!0,s.isAccessMicrophonePermission=!0}else if(f){try{_=yield navigator.mediaDevices.getUserMedia({audio:o})}catch(T){const b=zl(T.name||T.code||T,T.message);if(b.code===D.PERMISSION_DENIED)throw b;R.warning("getUserMedia failed in getDevices",b)}s.isAccessMicrophonePermission=!0}else if(m){try{E=yield navigator.mediaDevices.getUserMedia({video:r})}catch(T){const b=zl(T.name||T.code||T,T.message);if(b.code===D.PERMISSION_DENIED)throw b;R.warning("getUserMedia failed in getDevices",b)}s.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",o,"cam permission",r)}try{const T=yield navigator.mediaDevices.enumerateDevices();return _&&_.getTracks().forEach(b=>b.stop()),E&&E.getTracks().forEach(b=>b.stop()),y&&y.getTracks().forEach(b=>b.stop()),_=null,E=null,y=null,T}catch(T){return _&&_.getTracks().forEach(b=>b.stop()),E&&E.getTracks().forEach(b=>b.stop()),y&&y.getTracks().forEach(b=>b.stop()),_=null,E=null,y=null,new L(D.ENUMERATE_DEVICES_FAILED,T.toString()).throw()}})()}getRecordingDevices(){var o=arguments,r=this;return M(function*(){let i=o.length>0&&void 0!==o[0]&&o[0];return(yield r.enumerateDevices(!0,!1,i)).filter(s=>"audioinput"===s.kind)})()}getCamerasDevices(){var o=arguments,r=this;return M(function*(){let i=o.length>0&&void 0!==o[0]&&o[0];return(yield r.enumerateDevices(!1,!0,i)).filter(s=>"videoinput"===s.kind)})()}getSpeakers(){var o=arguments,r=this;return M(function*(){let i=o.length>0&&void 0!==o[0]&&o[0];return(yield r.enumerateDevices(!0,!1,i)).filter(s=>"audiooutput"===s.kind)})()}searchDeviceIdByName(o){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===o&&(r=i.device.deviceId)}),r}getDeviceById(o){var r=this;return M(function*(){const i=(yield r.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===o);if(!i)throw new L(D.DEVICE_NOT_FOUND,"deviceId: ".concat(o));return i})()}init(){var o=this;return M(function*(){o.state=ba.INITING;try{yield o.updateDevicesInfo(),o.state=ba.INITEND}catch(r){throw R.warning("Device Detection functionality cannot start properly.",r.toString()),o.state=ba.IDLE,!("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)&&new L(D.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),r}})()}updateDevicesInfo(){var o=this;return M(function*(){const r=yield o.enumerateDevices(!0,!0,!0),i=Date.now(),s=[];if(r[0]&&r[0].label&&!1===o.checkdeviceMatched){o.checkdeviceMatched=!0;const d=r.find(f=>"audioinput"===f.kind&&"default"===f.deviceId),h=r.find(f=>"audiooutput"===f.kind&&"default"===f.deviceId);d&&h?h.groupId===d.groupId?R.debug("[device-check] default input ".concat(d.label," and output ").concat(h.label," is the same group")):R.warning("[device-check] default input ".concat(d.label," and output ").concat(h.label," is not the same group")):R.debug("[device-check] default input or output not found")}const u=o.checkMediaDeviceInfoIsOk(r);if(r.forEach(d=>{if(!d.deviceId)return;const h=o.deviceInfoMap.get("".concat(d.kind,"_").concat(d.deviceId));if("ACTIVE"!==(h?h.state:"INACTIVE")){const f={initAt:i,updateAt:i,device:d,state:"ACTIVE"};o.deviceInfoMap.set("".concat(d.kind,"_").concat(d.deviceId),f),s.push(f)}h&&(h.updateAt=i)}),o.deviceInfoMap.forEach((d,h)=>{"ACTIVE"===d.state&&d.updateAt!==i&&(d.state="INACTIVE",s.push(d))}),o.state!==ba.INITEND)return u.audio&&(o.lastAccessMicrophonePermission=!0,o.isAccessMicrophonePermission=!0),void(u.video&&(o.lastAccessCameraPermission=!0,o.isAccessCameraPermission=!0));s.forEach(d=>{switch(d.device.kind){case"audioinput":o.lastAccessMicrophonePermission&&o.isAccessMicrophonePermission&&o.emit(hs.RECORDING_DEVICE_CHANGED,d);break;case"videoinput":o.lastAccessCameraPermission&&o.isAccessCameraPermission&&o.emit(hs.CAMERA_DEVICE_CHANGED,d);break;case"audiooutput":o.lastAccessMicrophonePermission&&o.isAccessMicrophonePermission&&o.emit(hs.PLAYOUT_DEVICE_CHANGED,d)}}),u.audio&&(o.lastAccessMicrophonePermission=!0,o.isAccessMicrophonePermission=!0),u.video&&(o.lastAccessCameraPermission=!0,o.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(o){const r=o.filter(u=>"audioinput"===u.kind),i=o.filter(u=>"videoinput"===u.kind),s={audio:!1,video:!1};for(const u of r)if(u.label&&u.deviceId){s.audio=!0;break}for(const u of i)if(u.label&&u.deviceId){s.video=!0;break}return s}},eb=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],qr=new class{constructor(){S(this,"onAutoplayFailed",void 0),S(this,"elementMap",new Map),S(this,"elementStateMap",new Map),S(this,"elementsNeedToResume",[]),S(this,"sinkIdMap",new Map),S(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(o=>{let[r,i]=o;const s=this.elementStateMap.get(r),u=i.srcObject.getAudioTracks()[0];Ta()?u&&"live"===u.readyState&&"running"===tt.curState&&(R.debug("auto resume after interruption for iOS 15"),i.pause(),i.play()):s&&"paused"===s&&u&&"live"===u.readyState&&"running"===tt.curState&&(R.debug("auto resume after interruption for iOS"),i.play())})}),S(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(o=>{let[r,i]=o;const s=i.srcObject.getAudioTracks()[0];s&&"live"===s.readyState&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),tt.on(Tn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tt.on(Tn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),tt.on(Tn.STATE_CHANGE,()=>{vr()&&"suspended"===tt.prevState&&"running"===tt.curState&&this.autoResumeAfterInterruption()})}setSinkID(o,r){var i=this;return M(function*(){const s=i.elementMap.get(o);if(i.sinkIdMap.set(o,r),s)try{yield s.setSinkId(r)}catch(u){throw new L(D.PERMISSION_DENIED,"can not set sink id: "+u.toString())}})()}play(o,r,i,s){if(this.elementMap.has(r))return;const u=document.createElement("audio");u.autoplay=!0,u.srcObject=new MediaStream([o]),this.bindAudioElementEvents(r,u),this.elementMap.set(r,u),this.elementStateMap.set(r,qe.INIT),this.setVolume(r,i);const d=this.sinkIdMap.get(r);if(d)try{u.setSinkId(d).catch(f=>{R.warning("[".concat(r,"] set sink id failed"),f.toString())})}catch(f){R.warning("[".concat(r,"] set sink id failed"),f.toString())}const h=u.play();h&&h.then&&h.catch(f=>{s&&he.autoplayFailed(s,"audio",f.message,r),R.warning("audio element play warning",f.toString()),this.elementMap.has(r)&&"NotAllowedError"===f.name&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(u),Hi(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),FR()}))})}updateTrack(o,r){const i=this.elementMap.get(o);i&&(i.srcObject=new MediaStream([r]))}isPlaying(o){return this.elementMap.has(o)&&"playing"===this.elementStateMap.get(o)}setVolume(o,r){const i=this.elementMap.get(o);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}stop(o){const r=this.elementMap.get(o);if(this.sinkIdMap.delete(o),!r)return;const i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(o),this.elementStateMap.delete(o)}bindAudioElementEvents(o,r){eb.forEach(i=>{r.addEventListener(i,s=>{const u=this.elementStateMap.get(o),d="pause"===s.type?"paused":s.type;if(R.debug("[".concat(o,"] audio-element-status change ").concat(u," => ").concat(d)),"error"===s.type){const h=r?.error;h&&R.error("[".concat(o,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(o,d)})})}getPlayerState(o){return this.elementStateMap.get(o)||"uninit"}autoResumeAudioElement(){const o=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{R.debug("Auto resume audio element success")}).catch(i=>{R.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new ie(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{_c()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0))})}};function Vt(){return function(o,r,i){const s=i.value;return"function"==typeof s&&(i.value=function(){this._isClosed&&new L(D.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var u=arguments.length,d=new Array(u),h=0;h<u;h++)d[h]=arguments[h];const f=s.apply(this,d);return f instanceof ie?new ie((m,_)=>{f.then(m).catch(_)}):f}),i}}var Kc=gt("Array").values,V0=tc,F0=Pt,ud=ho,hk=Kc,Lr=Array.prototype,pk={DOMTokenList:!0,NodeList:!0},Fi=function(o){var r=o.values;return o===Lr||ud(Lr,o)&&r===Lr.values||F0(pk,V0(o))?hk:r};function Vv(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function Fv(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?Vv(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Vv(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class ge extends Lt{constructor(r){super(),S(this,"name","VideoProcessorDestination"),S(this,"ID","0"),S(this,"_source",void 0),S(this,"videoContext",void 0),S(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new L(D.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new L(D.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(ur.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ur.ON_TRACK,void 0)}}class tb extends Lt{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),S(this,"constraintsMap",new Map),S(this,"statsRegistry",[]),S(this,"usageRegistry",[]),S(this,"trackId",void 0),S(this,"direction",void 0),S(this,"_chained",!1),this.trackId=r,this.direction=i}getConstraints(){var r=this;return M(function*(){return yield zn(r,Pr.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(r,i){var s=this;return M(function*(){var u;return R.info("processor ".concat(i.name," requestApplyConstraints for ").concat(s.trackId)),r&&s.constraintsMap.set(i,r),Wt(s,Pr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(u=s.constraintsMap).call(u)))})()}requestRevertConstraints(r){var i=this;return M(function*(){var s;if(i.constraintsMap.has(r))return R.info("processor ".concat(r.name," requestRevertConstraints for ").concat(i.trackId)),i.constraintsMap.delete(r),Wt(i,Pr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(s=i.constraintsMap).call(s)))})()}registerStats(r,i,s){this.statsRegistry.find(u=>u.processorID===r.ID&&u.processorName===r.name&&u.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:s})}unregisterStats(r,i){const s=this.statsRegistry.findIndex(u=>u.processorID===r.ID&&u.processorName===r.name&&u.type===i);-1!==s&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:s,type:u,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:i,processorName:s,type:u,stats:h})}catch(h){R.error(new L(D.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);-1!==i&&this.usageRegistry.splice(i,1)}gatherUsage(){var r=this;return M(function*(){const i=[];if(!r.chained)return[];for(const{cb:s}of r.usageRegistry)try{let u=s();u instanceof ie&&(u=yield u),i.push(Fv(Fv({},u),{},{direction:r.direction}))}catch(u){R.error("gather extension usage error",u)}return i})()}getDirection(){return this.direction}}class nb extends Lt{constructor(r){super(),S(this,"name","AudioProcessorDestination"),S(this,"ID","0"),S(this,"inputTrack",void 0),S(this,"inputNode",void 0),S(this,"audioProcessorContext",void 0),S(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new L(D.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new L(D.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ur.ON_TRACK,void 0),this.emit(ur.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(ur.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(ur.ON_NODE,this.inputNode))}}class rb extends Lt{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,s){super(),S(this,"constraintsMap",new Map),S(this,"statsRegistry",[]),S(this,"audioContext",void 0),S(this,"trackId",void 0),S(this,"direction",void 0),S(this,"usageRegistry",[]),S(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=s}getConstraints(){var r=this;return M(function*(){return zn(r,Pr.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(r,i){var s=this;return M(function*(){var u;return R.info("processor ".concat(i.name," requestApplyConstraints for ").concat(s.trackId)),r&&s.constraintsMap.set(i,r),Wt(s,Pr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(u=s.constraintsMap).call(u)))})()}requestRevertConstraints(r){var i=this;return M(function*(){var s;if(i.constraintsMap.has(r))return i.constraintsMap.delete(r),Wt(i,Pr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(s=i.constraintsMap).call(s)))})()}registerStats(r,i,s){this.statsRegistry.find(u=>u.processorID===r.ID&&u.processorName===r.name&&u.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:s})}unregisterStats(r,i){const s=this.statsRegistry.findIndex(u=>u.processorID===r.ID&&u.processorName===r.name&&u.type===i);-1!==s&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:s,type:u,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:i,processorName:s,type:u,stats:h})}catch(h){R.error(new L(D.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);-1!==i&&this.usageRegistry.splice(i,1)}gatherUsage(){var r=this;return M(function*(){const i=[];if(!r.chained)return[];for(const{cb:s}of r.usageRegistry)try{let u=s();u instanceof ie&&(u=yield u),i.push(Fv(Fv({},u),{},{direction:r.direction}))}catch(u){R.error("gather extension usage error",u)}return i})()}getDirection(){return this.direction}}class La extends Lt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),S(this,"context",void 0),S(this,"processSourceNode",void 0),S(this,"outputTrack",void 0),S(this,"processedNode",void 0),S(this,"clonedTrack",void 0),S(this,"outputNode",void 0),this.outputNode=new j0}setVolume(){}createOutputTrack(){throw new L(D.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class j0{disconnect(){}connect(){}}let qc,zs=null;class kn{constructor(){S(this,"state","open"),S(this,"trigger",void 0),S(this,"tasks",[]),R.debug("[macro-task-queue] is created."),this.trigger=setTimeout(()=>{this.state="closed",R.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(r=>r.key),"]")),this.trigger=void 0,this.tasks.forEach(r=>{let{func:i}=r;return i()}),this.tasks.length=0,R.debug("[macro-task-queue] is closed.")})}enqueue(r,i){"closed"!==this.state&&(this.tasks.push({key:r,func:i}),R.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof r?r:"")))}runTask(r){if("closed"===this.state)return;const i=this.tasks.findIndex(s=>s.key===r);if(-1!==i){const s=this.tasks.splice(i,1);R.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof r?r:"")),s[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,R.debug("[macro-task-queue] is closed."))}}function ob(o){return function(r,i,s){var u;const d=null!==(u=s.value)&&void 0!==u?u:s.get,h=function(){zs&&"open"===zs.state&&zs.runTask(o);for(var f=arguments.length,m=new Array(f),_=0;_<f;_++)m[_]=arguments[_];return d?.apply(this,...m)};return s.value?s.value=h:s.get=h,s}}var jv,Bv,ib,Hv,Gv,Wv,Kv,sb,ab,cb,dd,ub,db,lb,Yl,qv,$v,zv,hb,ld,hd,at,pb,fb,Yv,Jv,Xv,mb,ji,gb,_b,B0,H0,G0,W0,Qv,Jl,Eb,vb,Zv,pd,Tr;function yb(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function ey(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?yb(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):yb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}!function(o){o.UPDATE_TRACK_SOURCE="update-track-source"}(qc||(qc={}));let lr=(jv=ob("INIT_WEBAUDIO"),Bv=ob("INIT_WEBAUDIO"),ib=ob("INIT_WEBAUDIO"),Hv=pe({argsMap:(o,r)=>[o.getTrackId(),r],throttleTime:300}),Gv=pe({argsMap:(o,r)=>[o.getTrackId(),r]}),Wv=Vt(),Kv=Bc("LocalAudioTrack","_enabledMutex"),sb=pe({argsMap:(o,r)=>[o.getTrackId(),r]}),ab=Vt(),cb=Bc("LocalAudioTrack","_enabledMutex"),dd=pe({argsMap:(o,r)=>[o.getTrackId(),r]}),ub=Vt(),db=Vt(),lb=Vt(),Yl=pe({argsMap:o=>[o.getTrackId()]}),qv=Vt(),$v=pe({argsMap:o=>[o.getTrackId()]}),zv=Vt(),hb=pe({argsMap:o=>[o.getTrackId()]}),ld=pe({argsMap:(o,r)=>[o.getTrackId(),r.name]}),hd=pe({argsMap:o=>[o.getTrackId()]}),q((at=class extends im{get _source(){return this._trackSource}set _source(o){this._trackSource=o}get processorContext(){return this._processorContext}set processorContext(o){this._processorContext=o}get processorDestination(){return this._processorDestination}set processorDestination(o){this._processorDestination=o}get isPlaying(){return this._useAudioElement?qr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(o,r,i,s,u){super(o,i),S(this,"trackMediaType","audio"),S(this,"_encoderConfig",void 0),S(this,"_trackSource",void 0),S(this,"_enabled",!0),S(this,"_volume",100),S(this,"_useAudioElement",!1),S(this,"_bypassWebAudio",!1),S(this,"processor",void 0),S(this,"_processorContext",void 0),S(this,"_processorDestination",void 0),S(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!s;const d=()=>{this.processorContext=new rb(this._source.context,this.getTrackId(),"local"),this.processorDestination=new nb(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(en.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},h=u&&or()&&!WR();V("DISABLE_WEBAUDIO")?(this._source=new La,this._useAudioElement=!0,this._bypassWebAudio=!0):h?this._source=new La:(this._source=new Pv(o,!1,this._getOriginVolumeLevel?o:void 0),V("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),d(),!V("DISABLE_WEBAUDIO")&&h&&(zs||(zs=new kn),zs).enqueue("INIT_WEBAUDIO",()=>{this._source=new Pv(o,!1,this._getOriginVolumeLevel?o:void 0),V("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),d(),this.emit(qc.UPDATE_TRACK_SOURCE)})}setVolume(o){Rt(o,"volume",0,1e3),this._volume=o,this._source.setVolume(o/100),this._useAudioElement&&qr.setVolume(this.getTrackId(),o);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,Wt(this,Ee.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(o){var r=this;return M(function*(){if(!r._useAudioElement)throw new L(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield qr.setSinkID(r.getTrackId(),o)})()}setEnabled(o,r,i){var s=this;return M(function*(){return s._setEnabled(o,r,i)})()}_setEnabled(o,r,i){var s=this;return M(function*(){if(!i){if(o===s._enabled)return;s.stateCheck("enabled",o)}if(R.info("[".concat(s.getTrackId(),"] start setEnabled"),o),o){s._originMediaStreamTrack.enabled=!0;try{i||(s._enabled=!0),yield Wt(s,Ee.NEED_ENABLE_TRACK,s),R.info("[".concat(s.getTrackId(),"] setEnabled to ").concat(o," success"))}catch(u){throw i||(s._enabled=!1),R.error("[".concat(s.getTrackId(),"] setEnabled to true error"),u.toString()),u}}else{s._originMediaStreamTrack.enabled=!1,i||(s._enabled=!1);try{yield Wt(s,Ee.NEED_DISABLE_TRACK,s)}catch(u){throw i||(s._enabled=!0),R.error("[".concat(s.getTrackId(),"] setEnabled to false error"),u.toString()),u}}})()}setMuted(o){var r=this;return M(function*(){o!==r._muted&&(r.stateCheck("muted",o),r._muted=o,r._originMediaStreamTrack.enabled=!o,R.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(o)),o?yield Wt(r,Ee.NEED_MUTE_TRACK,r):yield Wt(r,Ee.NEED_UNMUTE_TRACK,r))})()}getStats(){return gd(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Bi(this,Ee.GET_STATS)||ey({},Aa)}setAudioFrameCallback(o){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!o)return this._source.removeAllListeners(en.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(en.ON_AUDIO_BUFFER),this._source.on(en.ON_AUDIO_BUFFER,i=>o(i))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),qr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?qr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),o&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&qr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(o,r){var i=this;return M(function*(){i._originMediaStreamTrack!==o&&(i._originMediaStreamTrack.removeEventListener("ended",i._handleTrackEnded),o.addEventListener("ended",i._handleTrackEnded),r&&i._originMediaStreamTrack.stop(),i._originMediaStreamTrack=o,i._muted&&(i._originMediaStreamTrack.enabled=!1),i.processor&&i.processor.updateInput({track:o,context:i.processorContext}),i._mediaStreamTrack!==i._source.outputTrack?(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource(),yield Wt(i,Ee.NEED_REPLACE_TRACK,i)):i._source.updateTrack(i._originMediaStreamTrack),i._getOriginVolumeLevel&&i._source.updateOriginTrack(o))})()}renewMediaStreamTrack(o){return ie.resolve(void 0)}pipe(o){if(this._bypassWebAudio)throw new L(D.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===o)return o;if(o._source)throw new L(D.INVALID_OPERATION,"Processor ".concat(o.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=o,this.processor._source=this,o.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),o}unpipe(){var o;if(!this.processor)return;const r=this.processor;null===(o=this._source.processSourceNode)||void 0===o||o.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var o=this;this.processorDestination.on(ur.ON_TRACK,function(){var r=M(function*(i){i?i!==o._mediaStreamTrack&&(o._mediaStreamTrack=i,o._updatePlayerSource(!1),o._source.processedNode=o._source.createMediaStreamSourceNode(i),yield Wt(o,Ee.NEED_REPLACE_TRACK,o)):o._mediaStreamTrack!==o._originMediaStreamTrack&&(o._mediaStreamTrack=o._originMediaStreamTrack,o._updatePlayerSource(),yield Wt(o,Ee.NEED_REPLACE_TRACK,o))});return function(i){return r.apply(this,arguments)}}()),this.processorDestination.on(ur.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ur.ON_TRACK),this.processorDestination.removeAllListeners(ur.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Pr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Pr.REQUEST_CONSTRAINTS)}}).prototype,"_source",[jv],Object.getOwnPropertyDescriptor(at.prototype,"_source"),at.prototype),q(at.prototype,"processorContext",[Bv],Object.getOwnPropertyDescriptor(at.prototype,"processorContext"),at.prototype),q(at.prototype,"processorDestination",[ib],Object.getOwnPropertyDescriptor(at.prototype,"processorDestination"),at.prototype),q(at.prototype,"setVolume",[Hv],Object.getOwnPropertyDescriptor(at.prototype,"setVolume"),at.prototype),q(at.prototype,"setPlaybackDevice",[Gv,Wv],Object.getOwnPropertyDescriptor(at.prototype,"setPlaybackDevice"),at.prototype),q(at.prototype,"setEnabled",[Kv,sb,ab],Object.getOwnPropertyDescriptor(at.prototype,"setEnabled"),at.prototype),q(at.prototype,"setMuted",[cb,dd,ub],Object.getOwnPropertyDescriptor(at.prototype,"setMuted"),at.prototype),q(at.prototype,"getStats",[db],Object.getOwnPropertyDescriptor(at.prototype,"getStats"),at.prototype),q(at.prototype,"setAudioFrameCallback",[lb],Object.getOwnPropertyDescriptor(at.prototype,"setAudioFrameCallback"),at.prototype),q(at.prototype,"play",[Yl,qv],Object.getOwnPropertyDescriptor(at.prototype,"play"),at.prototype),q(at.prototype,"stop",[$v,zv],Object.getOwnPropertyDescriptor(at.prototype,"stop"),at.prototype),q(at.prototype,"close",[hb],Object.getOwnPropertyDescriptor(at.prototype,"close"),at.prototype),q(at.prototype,"pipe",[ld],Object.getOwnPropertyDescriptor(at.prototype,"pipe"),at.prototype),q(at.prototype,"unpipe",[hd],Object.getOwnPropertyDescriptor(at.prototype,"unpipe"),at.prototype),at),ty=(pb=pe({argsMap:(o,r)=>[o.getTrackId(),r]}),fb=Vt(),Yv=Bc("MicrophoneAudioTrack","_enabledMutex"),Jv=pe({argsMap:(o,r,i)=>[o.getTrackId(),r,i]}),Xv=Vt(),mb=pe({argsMap:o=>[o.getTrackId()]}),q((ji=class extends lr{get __className__(){return"MicrophoneAudioTrack"}constructor(o,r,i,s){super(o,r.encoderConfig?Bf(r.encoderConfig):{},s,V("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),S(this,"_config",void 0),S(this,"_deviceName","default"),S(this,"_constraints",void 0),S(this,"_originalConstraints",void 0),S(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=o.label,"boolean"==typeof r.bypassWebAudio&&(this._bypassWebAudio=r.bypassWebAudio),(Ta()||Df())&&tt.bindInterruptDetectorTrack(this),this.on(qc.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),WR()&&this.bindProcessorContextEvents()}setDevice(o){var r=this;return M(function*(){if(R.info("[".concat(r.getTrackId(),"] start set device to ").concat(o)),r._enabled)try{const i=yield ao.getDeviceById(o),s={};s.audio=ey({},r._constraints),s.audio.deviceId={exact:o},r._originMediaStreamTrack.stop();let u=null;try{u=yield Go(s,r.getTrackId())}catch(d){throw R.error("[".concat(r.getTrackId(),"] setDevice failed"),d.toString()),u=yield Go({audio:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),d}yield r._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),r._deviceName=i.label,r._config.microphoneId=o,r._constraints.deviceId={exact:o}}catch(i){throw R.error("[".concat(r.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=yield ao.getDeviceById(o);r._deviceName=i.label,r._config.microphoneId=o,r._constraints.deviceId={exact:o}}catch(i){throw R.error("[".concat(r.getTrackId(),"] setDevice error"),i.toString()),i}R.info("[".concat(r.getTrackId(),"] set device to ").concat(o," success"))})()}setEnabled(o,r,i){var s=()=>super._setEnabled,u=this;return M(function*(){if(r)return R.debug("[".concat(u.getTrackId(),"] setEnabled false (do not close microphone)")),yield s().call(u,o);if(!i){if(o===u._enabled)return;u.stateCheck("enabled",o)}if(R.info("[".concat(u.getTrackId(),"] start setEnabled"),o),!o){var d;u._originMediaStreamTrack.onended=null,u._originMediaStreamTrack.stop(),null===(d=u._source.clonedTrack)||void 0===d||d.stop(),i||(u._enabled=!1);try{yield Wt(u,Ee.NEED_DISABLE_TRACK,u)}catch(m){throw R.error("[".concat(u.getTrackId(),"] setEnabled false failed"),m.toString()),m}return}const h=ey({},u._constraints),f=ao.searchDeviceIdByName(u._deviceName);f&&!h.deviceId&&(h.deviceId=f);try{i||(u._enabled=!0);const m=yield Go({audio:u._constraints},u.getTrackId());yield u._updateOriginMediaStreamTrack(m.getAudioTracks()[0],!1),yield Wt(u,Ee.NEED_ENABLE_TRACK,u)}catch(m){throw i||(u._enabled=!1),R.error("[".concat(u.getTrackId(),"] setEnabled true failed"),m.toString()),m}R.info("[".concat(u.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(Ta()||Df())&&tt.unbindInterruptDetectorTrack(this)}onTrackEnded(){var o=this;if((vr()||Wr())&&this._enabled&&!this._isClosed&&tt.duringInterruption){const r=function(){var i=M(function*(){tt.off(Tn.IOS_INTERRUPTION_END,r),o._enabled&&!o._isClosed&&(R.debug("[".concat(o.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield o.setEnabled(!1),yield o.setEnabled(!0))});return function(){return i.apply(this,arguments)}}();tt.on(Tn.IOS_INTERRUPTION_END,r)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(ui.TRACK_ENDED)}renewMediaStreamTrack(o){var r=this;return M(function*(){const i=o||r._constraints,s=ao.searchDeviceIdByName(r._deviceName);if(s&&!i.deviceId&&(i.deviceId=s),r._constraints=i,r._enabled){r._originMediaStreamTrack.stop();const u=yield Go({audio:r._constraints},r.getTrackId());yield r._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(){var o=this;this.processorContext.on(Pr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=M(function*(i,s,u){try{const d=Object.assign({},o._originalConstraints,...i);yield o.renewMediaStreamTrack(d),s()}catch(d){u(d)}});return function(i,s,u){return r.apply(this,arguments)}}()),this.processorContext.on(Pr.REQUEST_CONSTRAINTS,function(){var r=M(function*(i){i(o._originMediaStreamTrack.getSettings())});return function(i){return r.apply(this,arguments)}}())}}).prototype,"setDevice",[pb,fb],Object.getOwnPropertyDescriptor(ji.prototype,"setDevice"),ji.prototype),q(ji.prototype,"setEnabled",[Yv,Jv,Xv],Object.getOwnPropertyDescriptor(ji.prototype,"setEnabled"),ji.prototype),q(ji.prototype,"close",[mb],Object.getOwnPropertyDescriptor(ji.prototype,"close"),ji.prototype),ji),K0=(gb=pe({argsMap:(o,r)=>[o.getTrackId(),r,o.duration]}),_b=Vt(),B0=pe({argsMap:o=>[o.getTrackId()]}),H0=Vt(),G0=pe({argsMap:o=>[o.getTrackId()]}),W0=Vt(),Qv=pe({argsMap:o=>[o.getTrackId()]}),Jl=Vt(),Eb=pe({argsMap:o=>[o.getTrackId()]}),vb=Vt(),Zv=pe({argsMap:o=>[o.getTrackId()]}),pd=Vt(),q((Tr=class extends lr{get __className__(){return"BufferSourceAudioTrack"}constructor(o,r,i,s){super(r.createOutputTrack(),i,s),S(this,"source",void 0),S(this,"_bufferSource",void 0),this.source=o,this._bufferSource=r,this._bufferSource.on(en.AUDIO_SOURCE_STATE_CHANGE,u=>{this.emit(ui.SOURCE_STATE_CHANGE,u)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(o){o&&this._bufferSource.updateOptions(o),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(o){this._bufferSource.seekAudioBuffer(o)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}setAudioBufferPlaybackSpeed(o){Rt(o,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(o)}}).prototype,"startProcessAudioBuffer",[gb,_b],Object.getOwnPropertyDescriptor(Tr.prototype,"startProcessAudioBuffer"),Tr.prototype),q(Tr.prototype,"pauseProcessAudioBuffer",[B0,H0],Object.getOwnPropertyDescriptor(Tr.prototype,"pauseProcessAudioBuffer"),Tr.prototype),q(Tr.prototype,"seekAudioBuffer",[G0,W0],Object.getOwnPropertyDescriptor(Tr.prototype,"seekAudioBuffer"),Tr.prototype),q(Tr.prototype,"resumeProcessAudioBuffer",[Qv,Jl],Object.getOwnPropertyDescriptor(Tr.prototype,"resumeProcessAudioBuffer"),Tr.prototype),q(Tr.prototype,"stopProcessAudioBuffer",[Eb,vb],Object.getOwnPropertyDescriptor(Tr.prototype,"stopProcessAudioBuffer"),Tr.prototype),q(Tr.prototype,"setAudioBufferPlaybackSpeed",[Zv,pd],Object.getOwnPropertyDescriptor(Tr.prototype,"setAudioBufferPlaybackSpeed"),Tr.prototype),Tr);class kr extends lr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Hc().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,wt(8,"track-mix-")),S(this,"trackList",void 0),S(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return-1!==this.trackList.indexOf(r)}addAudioTrack(r){-1===this.trackList.indexOf(r)?(R.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):R.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(-1!==this.trackList.indexOf(r)){R.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}uy(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof kr?i.emit(ad.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}}class q0 extends Lt{constructor(){super(...arguments),S(this,"resultStorage",new Map)}setLocalAudioStats(r,i,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(s,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(s,i))}setLocalVideoStats(r,i,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(s,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(s,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(s))}setRemoteAudioStats(r,i){const s=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){const s=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(i))}record(r,i,s){this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const u=this.resultStorage.get(r);if(u&&(u.result.push(s),u.result.length>=5)){const d=u.result.includes(!0);u.isPrevNormal&&!d&&this.emit("exception",Sb[r],r,i),!u.isPrevNormal&&d&&this.emit("exception",Sb[r]+2e3,r+"_RECOVER",i),u.isPrevNormal=d,u.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&0===r.receiveLevel)}checkAudioInputLevel(r,i){return i instanceof kr&&!i.isActive||!!i.muted||0!==r.sendVolumeLevel}checkFramerateInput(r,i){let s=null;i._encoderConfig&&i._encoderConfig.frameRate&&(s=Ys(i._encoderConfig.frameRate));const u=r.captureFrameRate;return!s||!u||!(s>10&&u<5||s<10&&s>=5&&u<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,i){return!!i.muted||0!==r.sendBitrate}checkSendAudioBitrate(r,i){return i instanceof kr&&!i.isActive||!!i.muted||0!==r.sendBitrate}checkVideoDecode(r){return 0===r.receiveBitrate||0!==r.decodeFrameRate}}const Sb={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},xr=new class{markSubscribeStart(o,r){performance.mark("agora-web-sdk/".concat(o,"/subscribe-").concat(r))}markPublishStart(o,r){performance.mark("agora-web-sdk/".concat(o,"/publish-").concat(r))}measureFromSubscribeStart(o,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(o,"/subscribe-").concat(r));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(o,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(o,"/publish-").concat(r));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function Tb(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function ka(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?Tb(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Tb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class fd{constructor(r){S(this,"store",void 0),S(this,"onStatsException",void 0),S(this,"onUploadPublishDuration",void 0),S(this,"onStatsChanged",void 0),S(this,"localStats",new Map),S(this,"remoteStats",new Map),S(this,"updateStatsInterval",void 0),S(this,"trafficStats",void 0),S(this,"trafficStatsPeerList",[]),S(this,"uplinkStats",void 0),S(this,"exceptionMonitor",void 0),S(this,"p2pChannel",void 0),S(this,"scalabilityMode",IE.L1T1),S(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new q0,this.exceptionMonitor.on("exception",(i,s,u)=>{this.onStatsException&&this.onStatsException(i,s,u)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(de.LocalAudioTrack)||ka({},Aa)}getLocalVideoTrackStats(){return this.localStats.get(de.LocalVideoTrack)||ka({},Da)}getRemoteAudioTrackStats(r){const i=(d,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return f&&(h.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},s={};if(r){var u;const d=null===(u=this.remoteStats.get(r))||void 0===u?void 0:u.audioStats;d&&(s[r]=i(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:f}]=d;f&&(s[h]=i(h,f))});return s}getRemoteNetworkQualityStats(r){const i={};if(r){var s;const u=null===(s=this.remoteStats.get(r))||void 0===s?void 0:s.networkStats;u&&(i[r]=u)}else Array.from(this.remoteStats.entries()).forEach(u=>{let[d,{networkStats:h}]=u;h&&(i[d]=h)});return i}getRemoteVideoTrackStats(r){const i=(d,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return f&&(h.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},s={};if(r){var u;const d=null===(u=this.remoteStats.get(r))||void 0===u?void 0:u.videoStats;d&&(s[r]=i(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:f}]=d;f&&(s[h]=i(h,f))});return s}getRTCStats(){let r=0,i=0,s=0,u=0;const d=this.localStats.get(de.LocalAudioTrack);d&&(r+=d.sendBytes,i+=d.sendBitrate);const h=this.localStats.get(de.LocalVideoTrack);h&&(r+=h.sendBytes,i+=h.sendBitrate);const f=this.localStats.get(de.LocalVideoLowTrack);f&&(r+=f.sendBytes,i+=f.sendBitrate),this.remoteStats.forEach(_=>{let{audioStats:E,videoStats:y}=_;E&&(s+=E.receiveBytes,u+=E.receiveBitrate),y&&(s+=y.receiveBytes,u+=y.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:i,SendBytes:r,RecvBytes:s,RecvBitrate:u,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>void 0!==i.B_ppad||void 0!==i.B_ppvd),r.peer_delay.filter(i=>-1===this.trafficStatsPeerList.indexOf(i.peer_uid)).forEach(i=>{var s;const u=null===(s=this.p2pChannel)||void 0===s?void 0:s.getRemoteMedia(i.peer_uid),d=null!=u&&u.videoSSRC?xr.measureFromSubscribeStart(this.store.clientId,u.videoSSRC):0,h=null!=u&&u.audioSSRC?xr.measureFromSubscribeStart(this.store.clientId,u.audioSSRC):0;void 0!==i.B_ppad&&void 0!==i.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,s){return!!r&&(!!s&&i.framesDecodeFreezeTime>s.framesDecodeFreezeTime||!(!s||i.framesDecodeCount>s.framesDecodeCount))}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[s,u]=i;switch(s){case de.LocalVideoTrack:case de.LocalVideoLowTrack:{const h=u,f=ka({},Da),m=r.getStats(),_=r.getLocalMedia(s);if(m){const E=m.videoSend.find(y=>y.ssrc===_?.ssrcs[0].ssrcId);if(E){const y=r.getLocalVideoSize(),T=r.getEncoderConfig(de.LocalVideoTrack);"H264"!==E.codec&&"H265"!==E.codec&&"VP8"!==E.codec&&"VP9"!==E.codec&&"AV1X"!==E.codec&&"AV1"!==E.codec||(f.codecType=E.codec),f.sendBytes=E.bytes,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0,E.inputFrame?(f.captureFrameRate=E.inputFrame.frameRate,f.captureResolutionHeight=E.inputFrame.height,f.captureResolutionWidth=E.inputFrame.width):y&&(f.captureResolutionWidth=y.width,f.captureResolutionHeight=y.height),E.sentFrame?(f.sendFrameRate=E.sentFrame.frameRate,f.sendResolutionHeight=E.sentFrame.height,f.sendResolutionWidth=E.sentFrame.width):y&&(f.sendResolutionWidth=y.width,f.sendResolutionHeight=y.height),E.avgEncodeMs&&(f.encodeDelay=E.avgEncodeMs),T&&T.bitrateMax&&(f.targetSendBitrate=1e3*T.bitrateMax),f.sendPackets=E.packets,f.sendPacketsLost=E.packetsLost,f.totalDuration=h?h.totalDuration+1:1,f.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(f.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(f.sendPacketsLost=this.trafficStats.B_pvlr4/100)}var d;this.localStats.set(s,f),(h?.sendResolutionWidth!==f.sendResolutionWidth||h?.sendResolutionHeight!==f.sendResolutionHeight)&&(null===(d=this.onStatsChanged)||void 0===d||d.call(this,"resolution",{width:f.sendResolutionWidth,height:f.sendResolutionHeight})),f&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,f);break}case de.LocalAudioTrack:{const h=u,f=ka({},Aa),m=r.getStats(),_=r.getLocalMedia(s);if(m){const E=m.audioSend.find(y=>y.ssrc===_?.ssrcs[0].ssrcId);if(E){if("opus"!==E.codec&&"aac"!==E.codec&&"PCMU"!==E.codec&&"PCMA"!==E.codec&&"G722"!==E.codec||(f.codecType=E.codec),E.inputLevel)f.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const y=r.getLocalAudioVolume();y&&(f.sendVolumeLevel=Math.round(32767*y))}f.sendBytes=E.bytes,f.sendPackets=E.packets,f.sendPacketsLost=E.packetsLost,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0}}this.trafficStats&&(f.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(de.LocalAudioTrack,f),f&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,f);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{videoStats:u,audioStats:d,videoPcStats:h}]=i;const f=d,m=u,_=h,E=ka({},Mc),y=ka({},Lc),T=ka({},id),{audioTrack:b,videoTrack:w,audioSSRC:P,videoSSRC:k}=r.getRemoteMedia(s),x=r.getStats(),B=x?.audioRecv.find(Re=>Re.ssrc===P),H=x?.videoRecv.find(Re=>Re.ssrc===k),ce=this.trafficStats&&this.trafficStats.peer_delay.find(Re=>Re.peer_uid===s);if(B&&("opus"!==B.codec&&"aac"!==B.codec&&"PCMU"!==B.codec&&"PCMA"!==B.codec&&"G722"!==B.codec||(E.codecType=B.codec),B.outputLevel?E.receiveLevel=Math.round(32767*B.outputLevel):b&&(E.receiveLevel=Math.round(32767*b.getVolumeLevel())),E.receiveBytes=B.bytes,E.receivePackets=B.packets,E.receivePacketsLost=B.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=f?8*Math.max(0,E.receiveBytes-f.receiveBytes):0,E.totalDuration=f?f.totalDuration+1:1,E.totalFreezeTime=f?f.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=B.jitterBufferMs,E.totalDuration>10&&fd.isRemoteAudioFreeze(b)&&(E.totalFreezeTime+=1)),H){"H264"!==H.codec&&"H265"!==H.codec&&"VP8"!==H.codec&&"VP9"!==H.codec&&"AV1X"!==H.codec&&"AV1"!==H.codec||(y.codecType=H.codec),y.receiveBytes=H.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,y.renderFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,H.outputFrame&&(y.renderFrameRate=H.outputFrame.frameRate),H.receivedFrame?(y.receiveFrameRate=H.receivedFrame.frameRate,y.receiveResolutionHeight=H.receivedFrame.height,y.receiveResolutionWidth=H.receivedFrame.width):w&&(y.receiveResolutionHeight=w._videoHeight||0,y.receiveResolutionWidth=w._videoWidth||0),void 0!==H.framesRateFirefox&&(y.receiveFrameRate=Math.round(H.framesRateFirefox)),y.receivePackets=H.packets,y.receivePacketsLost=H.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost),y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=m?m.totalFreezeTime:0,y.receiveDelay=H.jitterBufferMs||0;const Re=!!k&&r.getRemoteVideoIsReady(k);w&&Re&&fd.isRemoteVideoFreeze(w,H,_)&&(y.totalFreezeTime+=1),y.freezeRate=y.totalFreezeTime/y.totalDuration}ce&&(E.end2EndDelay=ce.B_ad,y.end2EndDelay=ce.B_vd,E.transportDelay=ce.B_ed,y.transportDelay=ce.B_ed,E.currentPacketLossRate=ce.B_ealr4/100,y.currentPacketLossRate=ce.B_evlr4/100,T.uplinkNetworkQuality=ce.B_punq?ce.B_punq:0,T.downlinkNetworkQuality=ce.B_pdnq?ce.B_pdnq:0),this.remoteStats.set(s,{audioStats:E,videoStats:y,videoPcStats:H,networkStats:T}),b&&this.exceptionMonitor.setRemoteAudioStats(b,E),w&&this.exceptionMonitor.setRemoteVideoStats(w,y)})}}const Es=new class extends Lt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),S(this,"_lastHiddenTime",0),S(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),R.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function Cb(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function Xl(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?Cb(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Cb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function um(o){return o.match(/^[\.\:\d]+$/)?"".concat(o.replace(/[^\d]/g,"-"),".").concat(V("TURN_DOMAIN")):(R.info("Cannot recognized as IP address ".concat(o,". Used As Host instead")),o)}function dm(o,r){var i,s;const u=V("GATEWAY_DOMAINS");let d=u[1]&&-1!==r.indexOf(u[1])?1:0;o.addresses=o.addresses||[];const h=o.addresses.map(m=>m.domain_prefix?{address:"".concat(m.domain_prefix,".").concat(u[d++%u.length],":").concat(m.port)}:m.ip.match(/^[\.\:\d]+$/)?{ip:m.ip,port:m.port,address:"".concat(m.ip.replace(/[^\d]/g,"-"),".").concat(u[d++%u.length],":").concat(m.port)}:(R.info("Cannot recognized as IP address ".concat(m.ip,". Used As Host instead")),{ip:m.ip,port:m.port,address:"".concat(m.ip,":").concat(m.port)}));if(null!==(i=o.detail)&&void 0!==i&&i[18]&&"string"==typeof(null===(s=o.detail)||void 0===s?void 0:s[18])){const m=o.detail[18],_=m?.split(";");for(let E=0;E<_.length;E++){var f;const y=is(f=_[E]).call(f);h[E]&&y&&(h[E].ip6=y)}}return{gatewayAddrs:h,uid:o.uid,cid:o.cid,cert:o.cert,vid:o.detail&&o.detail[8],uni_lbs_ip:o.detail&&o.detail[1],res:o,csIp:o.detail&&o.detail[502]}}function Ys(o){return"number"==typeof o?o:o.exact||o.ideal||o.max||o.min||0}function ny(o){const r=o._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?"".concat(Ys(r.width),"x").concat(Ys(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return"number"==typeof r.frameRate?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function ry(o){return o>=0&&o<.17?1:o>=.17&&o<.36?2:o>=.36&&o<.59?3:o>=.59&&o<=1?4:o>1?5:0}function oy(o,r){let i,s,u;switch(r){case At.CHOOSE_SERVER:i=4096,s="choose server";break;case At.CLOUD_PROXY:i=1048576,s="proxy";break;case At.CLOUD_PROXY_5:i=4194304,s="proxy5";break;case At.CLOUD_PROXY_FALLBACK:i=4194310,s="proxy fallback";break;default:throw new L(D.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:o.detail&&o.detail[502],retry:!1})}if(o.response_body.forEach(d=>{d.buffer&&d.buffer.flag===i&&(u={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>Xl(Xl({},h),{},{ticket:d.buffer.cert})),server_ts:o.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:Xl(Xl({},d.buffer.detail),o.detail),flag:d.buffer.flag,opid:o.opid,cert:d.buffer.cert})}),!u)throw new L(D.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:o.detail&&o.detail[502]});return u}function $0(o,r){return iy.apply(this,arguments)}function iy(){return iy=M(function*(o,r){return yield ie.all(o.addresses.map(function(){var i=M(function*(s){return{address:um(s.ip),tcpport:s.port,udpport:s.port,username:r&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Ro.username,password:r&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield om(r.toString()):Ro.password}});return function(s){return i.apply(this,arguments)}}()))}),iy.apply(this,arguments)}function sy(o,r){const i=r._videoWidth||r.getMediaStreamTrack(!0).getSettings().width;return i||R.warning("cannot get original video track's width, default scale down 4 times for low stream"),i?i/Ys(o.width):4}function lm(o){let{candidateType:r,relayProtocol:i,type:s,address:u,port:d,protocol:h}=o;return"local-candidate"===s?{candidateType:r,relayProtocol:i,protocol:h}:{candidateType:r,relayProtocol:i,address:u,port:d,protocol:h}}function ay(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function $c(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ay(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):ay(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function md(o){return window.TextEncoder?(new TextEncoder).encode(o).length:o.length}function hr(o){return new ie(r=>{window.setTimeout(r,o)})}function z0(o){const r=new L(D.TIMEOUT,"timeout");return new ie((i,s)=>{window.setTimeout(()=>s(r),o)})}function wt(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,o).toLowerCase();return i.length===o?"".concat(r).concat(i):"".concat(r).concat(i)+wt(o-i.length,"")}function cy(){return wt(32,"").toUpperCase()}const hm=()=>{};function Ib(o){return new ie((r,i)=>{let s=!1;const u=document.createElement("video");u.setAttribute("autoplay",""),u.setAttribute("muted",""),u.muted=!0,u.autoplay=!0,u.setAttribute("playsinline",""),u.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(u);const d=vr()?"canplay":"playing";u.addEventListener(d,()=>{const h=u.videoWidth,f=u.videoHeight;!h&&Bt()||(s=!0,u.srcObject=null,u.remove(),r([h,f]))}),u.srcObject=new MediaStream([o]),u.play().catch(hm),setTimeout(()=>{s||(u.srcObject=null,u.remove(),r([u.videoWidth,u.videoHeight]))},4e3)})}function zc(o){return ie.all(o.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}function zn(o,r){for(var i=arguments.length,s=new Array(i>2?i-2:0),u=2;u<i;u++)s[u-2]=arguments[u];return 0===o.getListeners(r).length?ie.reject(new L(D.UNEXPECTED_ERROR,"can not emit promise")):new ie((d,h)=>{o.emit(r,...s,d,h)})}function Wt(o,r){if(0===o.getListeners(r).length)return ie.resolve();for(var i=arguments.length,s=new Array(i>2?i-2:0),u=2;u<i;u++)s[u-2]=arguments[u];return zn(o,r,...s)}function Bi(o,r){if(0===o.getListeners(r).length)return null;for(var i=arguments.length,s=new Array(i>2?i-2:0),u=2;u<i;u++)s[u-2]=arguments[u];return xa(o,r,...s)}function xa(o,r){let i=null,s=null;for(var u=arguments.length,d=new Array(u>2?u-2:0),h=2;h<u;h++)d[h-2]=arguments[h];if(o.emit(r,...d,f=>{i=f},f=>{s=f}),null!==s)throw s;if(null===i)throw new L(D.UNEXPECTED_ERROR,"handler is not sync");return i}function uy(o,r){const i=o.indexOf(r);-1!==i&&o.splice(i,1)}function Rb(o){const r=[];return o.forEach(i=>{-1===r.indexOf(i)&&r.push(i)}),r}function Hi(o){ie.resolve().then(o)}function $t(o){return JSON.parse(JSON.stringify(o))}const pm={};function gd(o,r){pm[r]||(pm[r]=!0,o())}function Ql(o){const r=window.atob(o),i=new Uint8Array(new ArrayBuffer(r.length));for(let s=0;s<r.length;s+=1)i[s]=r.charCodeAt(s);return i}function fm(o){let r="";for(let i=0;i<o.length;i+=1)r+=String.fromCharCode(o[i]);return window.btoa(r)}const bb=new class{constructor(){S(this,"fnMap",new Map)}throttleByKey(o,r,i,s){for(var u=arguments.length,d=new Array(u>4?u-4:0),h=4;h<u;h++)d[h-4]=arguments[h];if(this.fnMap.has(r)){const f=this.fnMap.get(r);if(f.threshold!==i){f.fn(...f.args),clearTimeout(f.timer);const m=window.setTimeout(()=>{const _=this.fnMap.get(r);_&&_.fn(..._.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:o,threshold:i,timer:m,args:d,skipFn:s})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(r,$c($c({},f),{},{fn:o,args:d,skipFn:s}))}else{const f=window.setTimeout(()=>{const m=this.fnMap.get(r);m&&m.fn(...m.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:o,threshold:i,timer:f,args:d,skipFn:s})}}},mm=bb.throttleByKey.bind(bb),Zl=function(){var o=M(function*(r){let{fragementLength:i,referenceList:s,asyncMapHandler:u,allFailedhandler:d,promisesCollector:h}=r,f=0;const m=i;let _,E=0;const y=function(){var T=M(function*(){const b=(()=>{const w=f*m;return s.slice(w,w+m).map(u)})();h&&h.push(...b);try{_=yield zc(b)}catch(w){if(E+=m,f++,!(E>=s.length))return void(yield y());d(w)}b.forEach(w=>w.cancel())});return function(){return T.apply(this,arguments)}}();return yield y(),_});return function(i){return o.apply(this,arguments)}}();function yn(o){return"object"==typeof o&&null!==o&&!(o instanceof RegExp)}const _d={[nd.ACCESS_POINT]:{[qn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[qn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[qn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[qn.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[qn.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[qn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[qn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[nd.UNILBS]:{[ro.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ro.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ro.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ro.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ro.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ro.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ro.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ro.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ro.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ro.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ro.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ro.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[nd.STRING_UID_ALLOCATOR]:{[qf.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[qf.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[qf.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function eh(o){const r=_d[Math.floor(o/1e4)];if(!r)return{desc:"unkonw error",retry:!1};const i=r[o%1e4];if(!i){if(Math.floor(o/1e4)===nd.ACCESS_POINT){const s=o%1e4;if("1"===s.toString()[0])return{desc:o.toString(),retry:!1};if("2"===s.toString()[0])return{desc:o.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return i}const Y0={[fe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[fe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[fe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[fe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[fe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[fe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[fe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[fe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[fe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[fe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[fe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[fe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[fe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[fe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[fe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[fe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[fe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[fe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[fe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[fe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[fe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[fe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[fe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[fe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[fe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[fe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[fe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[fe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[fe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[fe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[fe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[fe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[fe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[fe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[fe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[fe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[fe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[fe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[fe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[fe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[fe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[fe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[fe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[fe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[fe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[fe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[fe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[fe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[fe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[fe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[fe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[fe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[fe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[fe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[fe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[fe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[fe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[fe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[fe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[fe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[fe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[fe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[fe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[fe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function gm(o){return Y0[o]||{desc:"UNKNOW_ERROR_".concat(o),action:"failed"}}function _m(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}class Ua extends Lt{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){["tryNext","recover"].includes(r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,"reconnecting"===this._state?this.emit(we.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(we.CONNECTED):"closed"===this._state?this.emit(we.CLOSED):"failed"===this._state&&this.emit(we.FAILED))}resetReconnectCount(r){R.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0;super(),S(this,"connectionID",0),S(this,"currentURLIndex",0),S(this,"urls",void 0),S(this,"_reconnectMode","tryNext"),S(this,"reconnectReason",void 0),S(this,"_initMutex",new Mn("websocket")),S(this,"name",void 0),S(this,"_state","closed"),S(this,"reconnectInterrupter",void 0),S(this,"websocket",void 0),S(this,"retryConfig",void 0),S(this,"reconnectCount",0),S(this,"forceCloseTimeout",5e3),S(this,"onlineReconnectListener",void 0),S(this,"useCompress",void 0),S(this,"tryDoubleDomain",!1),S(this,"wsInflateLength",0),S(this,"wsDeflateLength",0),S(this,"closeEstablishingWs",()=>{}),S(this,"store",void 0),S(this,"joinChannelServiceRecordIndex",void 0),this.store=d,this.name=r,this.retryConfig=function(E){for(var y=1;y<arguments.length;y++){var T=null!=arguments[y]?arguments[y]:{};y%2?_m(Object(T),!0).forEach(function(b){S(E,b,T[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(T)):_m(Object(T)).forEach(function(b){Object.defineProperty(E,b,Object.getOwnPropertyDescriptor(T,b))})}return E}({},i),this.useCompress=s,this.tryDoubleDomain=u;const{timeout:h,timeoutFactor:f}=i,m=Math.max(300,Math.floor(3*h/5)),_=Math.max(1.2,Math.floor(8*f)/10);cr.ONLINE&&(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_),sn.on(Oa.NETWORK_STATE_CHANGE,(E,y)=>{E!==y&&(this.resetReconnectCount("network state change: ".concat(y," -> ").concat(E)),E===cr.ONLINE?(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=f))})}getConnection(){return this.websocket||void 0}init(r){this.forceCloseTimeout=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=(u,d)=>{this.urls=r;const h=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(h).then(u).catch(d),this.once(we.CLOSED,()=>d(new L(D.WS_DISCONNECT))),this.once(we.CONNECTED,()=>u())};return this._initMutex.lock().then(u=>new ie((d,h)=>{s(d,h)}).then(()=>{u()}).catch(()=>{u()}))}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;i?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));var s;void 0!==r&&(this.reconnectMode=r),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinChannelServiceRecordIndex&&(null===(s=this.store)||void 0===s||s.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinChannelServiceRecordIndex));const u=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),u&&u.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new L(D.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(s){throw new L(D.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(r,i){var s=this;return M(function*(){return s.connectionID+=1,s.joinChannelServiceRecordIndex=void 0,new ie((u,d)=>{var h;const f=y=>{var T;null===(T=s.store)||void 0===T||T.signalChannelOpen(),R.debug("[".concat(s.name,"] websocket opened:"),y),s.reconnectMode="retry",s.state="connected",s.resetReconnectCount("opened"),u()},m=function(){var y=M(function*(T){if(R.debug("[".concat(s.name,"] websocket close ").concat(s.websocket&&s.websocket.url,", code: ").concat(T.code,", reason: ").concat(T.reason,", current mode: ").concat(s.reconnectMode)),s.reconnectCount<s.retryConfig.maxRetryCount){"connected"===s.state&&(s.reconnectReason=T.reason,s.state="reconnecting");const b=Bi(s,we.WILL_RECONNECT,s.reconnectMode)||s.reconnectMode,w=yield s.reconnectWithAction(b);if("closed"===s.state)return void R.debug("[".concat(s.connectionID,"] ws is closed, no need to reconnect"));if(!w)return d(new L(D.WS_DISCONNECT,"websocket reconnect failed: ".concat(T.code))),void s.close(!0);u()}else d(new L(D.WS_DISCONNECT,"websocket close: ".concat(T.code))),s.close()});return function(b){return y.apply(this,arguments)}}(),_=y=>{s.emit(we.ON_MESSAGE,y)};s.websocket&&(s.websocket.onclose=null,s.websocket.close()),V("GATEWAY_WSS_ADDRESS")&&s.name.startsWith("gateway")&&(r=V("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(s.name,"] start connect, url: ").concat(r));const E=null===(h=s.store)||void 0===h?void 0:h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});s.chooseBestWebsocketConnection(r,!!i,E).then(y=>{var T;s.websocket=y,f&&f(y.url),y.onclose=m,y.onmessage=_,null===(T=s.store)||void 0===T||T.recordJoinChannelService({endTs:Date.now(),status:"success"},E),s.joinChannelServiceRecordIndex=E}).catch(y=>{var T;if(null===(T=s.store)||void 0===T||T.recordJoinChannelService({endTs:Date.now(),status:y instanceof L&&y.code===D.WS_ABORT?"aborted":"error",errors:[y]},E),"closed"!==s.state){if(y instanceof L&&y.code===D.WS_ERR){const b=new L(D.WS_ERR,"init websocket failed! Error: ".concat(y.toString()));return R.error("[".concat(s.name,"]").concat(b)),void d(b)}m&&m(y)}else d(new L(D.WS_DISCONNECT,"websocket is closed: ".concat(y.toString())))})})})()}reconnectWithAction(r){var i=arguments,s=this;return M(function*(){let u=!(i.length>1&&void 0!==i[1])||i[1];if(s.reconnectCount>=s.retryConfig.maxRetryCount||!s.urls||"closed"===s.state)return!1;s.onlineReconnectListener||sn.networkState!==cr.OFFLINE||(s.onlineReconnectListener=sn.onlineWaiter&&sn.onlineWaiter.then(()=>{s.onlineReconnectListener=void 0}));let d=!0;if(s.reconnectInterrupter=()=>{d=!1},u){const m=Ju(s.reconnectCount,s.retryConfig);R.debug("[".concat(s.name,"] wait ").concat(m,"ms to reconnect websocket, mode: ").concat(r)),yield ie.race([hr(m),s.onlineReconnectListener||new ie(()=>{})])}if("closed"===s.state||!d)return!1;s.reconnectCount+=1;const h=function(){var m=M(function*(_,E){s.emit(we.RECONNECT_CREATE_CONNECTION,E),yield s.createWebSocketConnection(_)});return function(E,y){return m.apply(this,arguments)}}();try{if("retry"===r){const m=s.urls[s.currentURLIndex];s.emit(we.RECONNECT_WAITTING_FINISH,r),yield h(m,r)}else if("tryNext"===r){if(s.currentURLIndex+=1,s.currentURLIndex>=s.urls.length)return yield s.reconnectWithAction("recover",!1);R.debug("[".concat(s.name,"] websocket url length: ").concat(s.urls.length," current index: ").concat(s.currentURLIndex));const m=s.urls[s.currentURLIndex];s.emit(we.RECONNECT_WAITTING_FINISH,r),yield h(m,r)}else if("recover"===r){R.debug("[".concat(s.name,"] request new urls")),s.resetReconnectCount("recover mode"),s.emit(we.RECONNECT_WAITTING_FINISH,r),s.urls=yield zn(s,we.REQUEST_NEW_URLS),s.currentURLIndex=0;const m=s.urls[s.currentURLIndex];yield h(m,r)}return!0}catch(m){var f;return R.error("[".concat(s.name,"] reconnect failed"),m.toString()),null!=m&&null!==(f=m.data)&&void 0!==f&&f.desc&&Array.isArray(m.data.desc)&&m.data.desc.length&&m.data.desc.includes("dynamic key expired")?(s.emit(we.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):yield s.reconnectWithAction(r,u)}})()}chooseBestWebsocketConnection(r,i,s){var u=this;return M(function*(){return new ie((d,h)=>{let f=!1;const m=[];u.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),m.forEach(k=>{k.onclose=null,k.onopen=null,k.onmessage=null,k.close()}),h(new L(D.WS_ABORT,"choose best websocket aborted"))};const _=V("GATEWAY_DOMAINS");let E;const y=r.indexOf("?h="),T=_.find(k=>-1!==y?r.includes(k,y):r.includes(k));R.debug("[choose-best-ws] currentDomain: ",T,", domains: ",_);let b=!u.tryDoubleDomain||i||!T;if(!b&&T){var w;const k=Date.now();try{_.forEach(x=>{const B=-1===y?r.replace(T,x):r.substr(0,y)+r.substr(y).replace(T,x),H=new WebSocket(B);H.binaryType="arraybuffer",m.push(H),R.debug("[choose-best-ws] ws is connecting:",H.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),m.forEach(B=>B.close());m.length;)m.pop();b=!0}null===(w=u.store)||void 0===w||w.recordJoinChannelService({urls:m.map(x=>x.url),service:"gateway"},s),m.forEach(x=>{x.onopen=()=>{if(f)return;const B=Date.now()-k;R.debug("[choose-best-ws] ws open cost ".concat(B,"ms")),m.filter(H=>H!==x).forEach(H=>{R.debug("[choose-best-ws]close backup websocket: ".concat(H.url)),H.close()}),f=!0,d(x)},x.onclose=B=>{E=B,!f&&(m.find(H=>!(H.readyState===WebSocket.CLOSED||H.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),f=!0,h(E)))},x.onmessage=B=>{R.debug("[choose-best-ws]".concat(x.url," onmessage: ").concat(B.data))}}),hr(u.forceCloseTimeout).then(()=>{m.forEach(x=>{x.readyState!==WebSocket.OPEN&&x.close()})})}if(b){var P;let k;R.debug("[choose-best-ws] use single url: ",r),null===(P=u.store)||void 0===P||P.recordJoinChannelService({urls:[r],service:"gateway"},s);try{k=new WebSocket(r),m.push(k),k.binaryType="arraybuffer"}catch(x){const B=new L(D.WS_ERR,"init websocket failed! Error: ".concat(x.toString()));return R.error("[".concat(u.name,"]").concat(B)),void h(B)}k.onopen=()=>{d(k)},k.onclose=x=>{h(x)},k.onmessage=x=>{R.debug("[choose-best-ws]".concat(k.url," onmessage: ").concat(x.data))},hr(u.forceCloseTimeout).then(()=>{k&&k.readyState!==WebSocket.OPEN&&k.close()})}}).then(d=>(u.closeEstablishingWs=void 0,d)).catch(d=>{throw u.closeEstablishingWs=void 0,d})})()}}class Ab{constructor(r){S(this,"input",[]),S(this,"size",void 0),this.size=r}add(r){this.input.push(r),this.input.length>this.size&&this.input.splice(0,1)}mean(){var r;return 0===this.input.length?0:ti(r=this.input).call(r,(i,s)=>i+s)/this.input.length}}class dy extends Lt{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===lt.CONNECTED?this.emit(ae.WS_CONNECTED):r===lt.RECONNECTING?this.emit(ae.WS_RECONNECTING,this._websocketReconnectReason):r===lt.CLOSED&&this.emit(ae.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",lt.CLOSED),S(this,"reconnectToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new Ab(5)),S(this,"pingpongTimer",void 0),S(this,"wsInflateDataTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(ae.ON_BINARY_DATA,s.data);const u=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(u,"_id")){const d="res-@".concat(u._id);this.emit(d,u._result,u._message)}else if(Object.prototype.hasOwnProperty.call(u,"_type")){if(this.emit(u._type,u._message),u._type===De.ON_NOTIFICATION&&this.handleNotification(u._message),u._type===De.ON_USER_BANNED)switch(u._message.error_code){case 14:this.close(st.UID_BANNED);break;case 15:this.close(st.IP_BANNED);break;case 16:this.close(st.CHANNEL_BANNED)}if(u._type===De.ON_USER_LICENSE_BANNED)switch(u._message.error_code){case fe.ERR_LICENSE_MISSING:this.close(st.LICENSE_MISSING);break;case fe.ERR_LICENSE_EXPIRED:this.close(st.LICENSE_EXPIRED);break;case fe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(st.LICENSE_MINUTES_EXCEEDED);break;case fe.ERR_LICENSE_PERIOD_INVALID:this.close(st.LICENSE_PERIOD_INVALID);break;case fe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(st.LICENSE_MULTIPLE_SDK_SERVICE);break;case fe.ERR_LICENSE_ILLEGAL:this.close(st.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new Ua("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lt.CONNECTED&&this.reconnect("retry",yr.OFFLINE)})}request(r,i,s,u){var d=this;return M(function*(){const h=wt(6,""),f={_id:h,_type:r,_message:i},m=d.websocket.connectionID,_=()=>new ie((P,k)=>{if(d.connectionState===lt.CONNECTED)return P();const x=()=>{d.off(ae.WS_CLOSED,B),P()},B=()=>{d.off(ae.WS_CONNECTED,x),k(new L(D.WS_ABORT))};d.once(ae.WS_CONNECTED,x),d.once(ae.WS_CLOSED,B),r!==me.PUBLISH&&r!==me.SUBSCRIBE&&r!==me.UNSUBSCRIBE&&r!==me.UNPUBLISH&&r!==me.CONTROL&&r!==me.RESTART_ICE||d.once(ae.DISCONNECT_P2P,()=>{k(new L(D.DISCONNECT_P2P))}),r!==me.PUBLISH&&r!==me.RESTART_ICE||d.once(ae.ABORT_P2P_EXECUTION,()=>{k(new L(D.DISCONNECT_P2P))})});if(d.connectionState!==lt.CONNECTING&&d.connectionState!==lt.RECONNECTING||r===me.JOIN||r===me.REJOIN||(yield _()),d.websocket.sendMessage(f,!0),u)return;const E=new ie((P,k)=>{let x=!1;const B=(ce,Re)=>{x=!0,P({isSuccess:"success"===ce,message:Re||{}}),d.off(ae.WS_CLOSED,H),d.off(ae.WS_RECONNECTING,H),d.emit(ae.REQUEST_SUCCESS,r,i)};d.once("res-@".concat(h),B);const H=()=>{k(new L(D.WS_ABORT,"type: ".concat(r))),d.off(ae.WS_CLOSED,H),d.off(ae.WS_RECONNECTING,H),d.off("res-@".concat(h),B)};d.once(ae.WS_CLOSED,H),d.once(ae.WS_RECONNECTING,H),hr(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||x||(R.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(r)),d.emit(ae.REQUEST_TIMEOUT,r,i))})});let y=null;try{y=yield E}catch(P){if(d.connectionState===lt.CLOSED||r===me.LEAVE)throw new L(D.WS_ABORT);return!d.spec.forceWaitGatewayResponse||s?P.throw():r===me.JOIN||r===me.REJOIN?null:(yield _(),yield d.request(r,i))}if(y.isSuccess)return y.message;const T=Number(y.message.error_code||y.message.code),b=gm(T),w=new L(D.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(y.message.error_str),{code:T,data:y.message});return"success"===b.action?y.message:(R.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(T,", message: ").concat(b.desc,", action: ").concat(b.action)),T===fe.ERR_TOO_MANY_BROADCASTERS?((r===me.JOIN||r===me.REJOIN)&&(d.initError=w,d.close()),w.throw()):"failed"===b.action?w.throw():"quit"===b.action?(d.initError=w,d.close(),w.throw()):(T===fe.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,R.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",yr.MULTI_IP)):d.reconnect(b.action,yr.SERVER_ERROR),r===me.JOIN||r===me.REJOIN?null:yield d.request(r,i)))})()}waitMessage(r,i){return new ie(s=>{const u=d=>{(!i||i(d))&&(this.off(r,u),s(d))};this.on(r,u)})}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const d=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){this.websocket.sendMessage({_type:r,_message:i})}init(r,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ie((s,u)=>{this.once(ae.WS_CONNECTED,()=>s(this.joinResponse)),this.once(ae.WS_CLOSED,()=>u(this.initError||new L(D.WS_ABORT))),this.connectionState=lt.CONNECTING,this.websocket.init(r).catch(u),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),setTimeout(()=>{i&&void 0===this.openConnectionTime&&(R.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),u(new L(D.INIT_WEBSOCKET_TIMEOUT)))},V("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||st.LEAVE,this.connectionState=lt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),r===st.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Ua("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}join(){var r=this;return M(function*(){if(!r.joinResponse){r.emit(ae.ABORT_P2P_EXECUTION);const i=yield zn(r,ae.REQUEST_JOIN_INFO),s=yield r.request(me.JOIN,i);if(!s)return r.emit(ae.REPORT_JOIN_GATEWAY,D.TIMEOUT,r.url||""),!1;r.joinResponse=s,r.emit(ae.JOIN_RESPONSE,r.joinResponse),r.reconnectToken=r.joinResponse.rejoin_token}return r.connectionState=lt.CONNECTED,r.pingpongTimer&&window.clearInterval(r.pingpongTimer),r.pingpongTimer=window.setInterval(r.handlePingPong.bind(r),3e3),!0})()}rejoin(){var r=this;return M(function*(){if(!r.reconnectToken)throw new L(D.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=xa(r,ae.REQUEST_REJOIN_INFO);i.token=r.reconnectToken;const s=yield r.request(me.REJOIN,i);return!!s&&(r.connectionState=lt.CONNECTED,r.pingpongTimer&&window.clearInterval(r.pingpongTimer),r.pingpongTimer=window.setInterval(r.handlePingPong.bind(r),3e3),s.peers&&s.peers.forEach(u=>{r.emit(De.ON_USER_ONLINE,{uid:u.uid}),u.audio&&r.emit(De.ON_ADD_AUDIO_STREAM,{uid:u.uid,uint_id:u.uint_id,audio:!0,ssrcId:u.audio_ssrc}),u.video&&r.emit(De.ON_ADD_VIDEO_STREAM,{uid:u.uid,uint_id:u.uint_id,video:!0,ssrcId:u.video_ssrc}),r.emit(u.audio_mute?De.MUTE_AUDIO:De.UNMUTE_AUDIO,{uid:u.uid}),r.emit(u.video_mute?De.MUTE_VIDEO:De.UNMUTE_VIDEO,{uid:u.uid}),r.emit(u.audio_enable_local?De.ENABLE_LOCAL_AUDIO:De.DISABLE_LOCAL_AUDIO,{uid:u.uid}),r.emit(u.video_enable_local?De.ENABLE_LOCAL_VIDEO:De.DISABLE_LOCAL_VIDEO,{uid:u.uid}),u.audio||u.video||r.emit(De.ON_REMOVE_STREAM,{uid:u.uid,uint_id:u.uint_id})}),!0)})()}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=gm(r.code);if("success"!==i.action){if("failed"!==i.action)return"quit"===i.action?("ERR_REPEAT_JOIN_CHANNEL"===i.desc&&this.close(st.UID_BANNED),void this.close()):void this.reconnect(i.action,yr.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=V("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",yr.TIMEOUT):this.request(me.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),V("REPORT_STATS")&&this.send(me.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();0!==r&&0!==i&&this.upload(Ht.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(we.RECONNECT_WAITTING_FINISH,r=>{this.emit(ae.WS_RECONNECT_WAITTING_FINISH,r)}),this.websocket.on(we.RECONNECT_CREATE_CONNECTION,r=>{this.emit(ae.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(we.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(we.CLOSED,()=>{this.connectionState=lt.CLOSED}),this.websocket.on(we.FAILED,()=>{this._disconnectedReason=st.NETWORK_ERROR,this.connectionState=lt.CLOSED}),this.websocket.on(we.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState=this.connectionState===lt.CONNECTED?lt.RECONNECTING:lt.CONNECTING}),this.websocket.on(we.WILL_RECONNECT,(r,i)=>{if(xa(this,ae.IS_P2P_DISCONNECTED)&&"retry"===r)return R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ae.NEED_RENEW_SESSION),this.emit(ae.DISCONNECT_P2P),i("tryNext");"retry"!==r&&(R.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0,this.emit(ae.NEED_RENEW_SESSION),this.emit(ae.DISCONNECT_P2P)),i(r)}),this.websocket.on(we.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",yr.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(ae.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof L&&r.code===D.UNEXPECTED_RESPONSE&&r.data.code===fe.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",yr.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",yr.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(we.REQUEST_NEW_URLS,(r,i)=>{zn(this,ae.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(we.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(De.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function Em(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}class J0 extends Lt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){["tryNext","recover"].includes(r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,"reconnecting"===this._state?this.emit(Gt.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Gt.CONNECTED):"closed"===this._state?this.emit(Gt.CLOSED):"failed"===this._state&&this.emit(Gt.FAILED))}constructor(r,i,s,u){super(),S(this,"connectionID",0),S(this,"currentURLIndex",0),S(this,"reconnectReason",void 0),S(this,"_reconnectMode","tryNext"),S(this,"_initMutex",void 0),S(this,"_name",void 0),S(this,"_state","closed"),S(this,"_reconnectInterrupter",void 0),S(this,"_url",void 0),S(this,"_retryConfig",void 0),S(this,"_reconnectCount",0),S(this,"_forceCloseTimeout",5e3),S(this,"_onlineReconnectListener",void 0),S(this,"_closeEstablishingTransmitter",()=>{}),S(this,"_store",void 0),S(this,"_joinChannelServiceRecordIndex",void 0),S(this,"_transmitter",void 0),S(this,"_useCompress",void 0),S(this,"_inflateLength",0),S(this,"_deflateLength",0),this._store=u,this._name=r,this._retryConfig=function(d){for(var h=1;h<arguments.length;h++){var f=null!=arguments[h]?arguments[h]:{};h%2?Em(Object(f),!0).forEach(function(m){S(d,m,f[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(f)):Em(Object(f)).forEach(function(m){Object.defineProperty(d,m,Object.getOwnPropertyDescriptor(f,m))})}return d}({},i),this._useCompress=s}resetReconnectCount(r){R.debug("".concat(this._name," reset reconnect count, reason: ").concat(r)),this._reconnectCount=0}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const s=this._transmitter;i?setTimeout(()=>s.close(),500):s.close(),this._transmitter=void 0}this.state=r?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(r,i){if(!this._transmitter)return void R.warning("[".concat(this._name,"] can not reconnect, no websocket"));var s;void 0!==r&&(this.reconnectMode=r),R.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(s=this._store)||void 0===s||s.recordJoinChannelService({status:"error",errors:[new Error(i)]},this._joinChannelServiceRecordIndex));const u=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),u&&u.bind(this._transmitter)({code:9999,reason:i})}getInflateData(){const r=this._inflateLength,i=this._deflateLength;return this.clearInflateData(),{inflateLength:r,deflateLength:i}}setInflateData(r){this._deflateLength=this._deflateLength+r.originLength,this._inflateLength=this._inflateLength+r.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function ly(o,r,i){if("getBigUint64"in DataView.prototype)return o.getBigUint64(r,i);const s=o.getUint32(r,i),u=o.getUint32(r+4,i),d=+!!i,h=+!i;return BigInt(s*h+u*d)<<BigInt(32)|BigInt(s*d+u*h)}function vm(o,r,i,s){if("setBigUint64"in DataView.prototype)return o.setBigUint64(r,i,s);const u=Number(i>>BigInt(32)),d=Number(i&BigInt(4294967295));s?(o.setUint32(r+4,u,s),o.setUint32(r,d,s)):(o.setUint32(r,u,s),o.setUint32(r+4,d,s))}let Ao;!function(o){o[o.Default=0]="Default",o[o.Ack=1]="Ack"}(Ao||(Ao={}));class Db{constructor(r,i,s){S(this,"version",1),S(this,"initialRTO",void 0),S(this,"maxBatchAckCount",void 0),S(this,"maxRTO",void 0),S(this,"initialRTT",void 0),S(this,"ID",void 0),S(this,"rtt",void 0),S(this,"packetNumber",1),S(this,"rtoRatioMap",new Map),S(this,"timeoutMap",new Map),S(this,"unorderedPacketQueue",[]),S(this,"batchAckPacketQueue",[]),S(this,"lastOrderedPacketNumber",0),S(this,"batchAckTimer",void 0),S(this,"sendImpl",void 0),S(this,"receiveImpl",void 0),this.sendImpl=r,this.receiveImpl=i,this.ID=wt(7,"transmitter-"),this.initialRTO=void 0!==s?.initialRTO?s.initialRTO:V("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==s?.initialRTT?s.initialRTT:V("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==s?.initialRTT?s.initialRTT:V("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==s?.maxBatchAckCount?s.maxBatchAckCount:V("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==s?.maxRTO?s.maxRTO:V("TRANSMITTER_MAX_RTO")}packetize(r,i){return{type:Ao.Default,version:this.version,packetNumber:i,payload:r}}serialize(r){switch(r.type){case Ao.Default:{let i;i="string"==typeof r.payload?(new TextEncoder).encode(r.payload):r.payload;const s=new ArrayBuffer(i.length+15),u=new DataView(s);return u.setUint16(0,r.version),u.setUint8(2,r.type),u.setUint32(3,r.packetNumber),vm(u,7,BigInt(r.sendTs)),new Uint8Array(u.buffer).set(i,15),s}case Ao.Ack:{const i=new ArrayBuffer(16),s=new DataView(i);return s.setUint16(0,r.version),s.setUint8(2,r.type),s.setUint32(3,r.maxAckPacketNumber),s.setUint8(7,r.shift),vm(s,8,BigInt(r.ackSendTs)),i}}}deserialize(r){const i=new DataView(r),s=i.getUint16(0),u=i.getUint8(2);switch(u){case Ao.Default:{const d=i.getUint32(3),h=ly(i,7),f=r.slice(15),m=(new TextDecoder).decode(f);return{version:s,type:u,packetNumber:d,sendTs:Number(h),payload:m}}case Ao.Ack:{const d=i.getUint32(3),h=i.getUint8(7),f=ly(i,8);return{version:s,type:u,maxAckPacketNumber:d,shift:h,ackSendTs:Number(f)}}default:throw R.error("[".concat(this.ID,"] Unrecognized packet type ").concat(u)),new Error("Unrecognized packet type ".concat(u))}}sendMessage(r){const i=this.packetize(r,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const s=this.calculateRTO(i),u=window.setTimeout(()=>{this.resendMessage(i)},s);this.timeoutMap.set(i.packetNumber,u),this.sendPacket(i)}onData(r){const i=this.deserialize(r);i.type===Ao.Default?this.ack(i):i.type===Ao.Ack&&(this.updateRTT(i,Math.round(performance.now())),this.clearRTO(i))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(r=>{let[i,s]=r;window.clearTimeout(s)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(r){const i=this.calculateRTO(r),s=window.setTimeout(()=>{this.resendMessage(r)},i);this.timeoutMap.set(r.packetNumber,s),this.sendPacket(r)}calculateRTO(r){const i=this.rtoRatioMap.get(r.packetNumber);if(void 0===i)return this.rtoRatioMap.set(r.packetNumber,1),this.initialRTO;{const s=9*this.rtt/8*i;return this.rtoRatioMap.set(r.packetNumber,i+1),s>this.maxRTO?this.maxRTO:s}}updateRTT(r,i){this.rtt=this.rtt*(7/8)+(i-r.ackSendTs-this.rtt)/8}ack(r){if(r.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(r):(this.batchAckPacketQueue.push(r),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(r.payload);;){const i=this.unorderedPacketQueue[0];if(!i){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(i.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else r.packetNumber<=this.lastOrderedPacketNumber?this.sendPacket({ackSendTs:r.sendTs,maxAckPacketNumber:r.packetNumber,shift:0,type:Ao.Ack,version:this.version}):r.packetNumber>this.lastOrderedPacketNumber&&(this.unorderedPacketQueue[r.packetNumber-this.lastOrderedPacketNumber-2]=r,this.sendPacket({ackSendTs:r.sendTs,maxAckPacketNumber:r.packetNumber,shift:0,type:Ao.Ack,version:this.version}))}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0,this.sendPacket({ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Ao.Ack,version:this.version}),this.batchAckPacketQueue=[]}sendPacket(r){r.type===Ao.Default&&(r.sendTs=Math.round(performance.now()));const i=this.serialize(r);this.sendImpl(i)}clearRTO(r){for(let i=r.maxAckPacketNumber-r.shift;i<=r.maxAckPacketNumber;i++){const s=this.timeoutMap.get(i);void 0!==s&&window.clearTimeout(s),this.timeoutMap.delete(i),this.rtoRatioMap.delete(i)}}}class hy extends J0{constructor(r,i){super(r,i,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),S(this,"_initMutex",void 0),S(this,"_reconnectInterrupter",void 0),S(this,"_url",void 0),S(this,"_transmitter",void 0),S(this,"_addresses",void 0),S(this,"_reliableTransmission",void 0),this._initMutex=new Mn("datachannel");const{timeout:s,timeoutFactor:u}=i,d=Math.max(300,Math.floor(3*s/5)),h=Math.max(1.2,Math.floor(8*u)/10);cr.ONLINE&&(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h),sn.on(Oa.NETWORK_STATE_CHANGE,(f,m)=>{f!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(f)),f===cr.ONLINE?(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=s,this._retryConfig.timeoutFactor=u))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}init(r){var i=arguments,s=this;return M(function*(){s._forceCloseTimeout=i.length>1&&void 0!==i[1]?i[1]:5e3;return s._initMutex.lock().then(h=>new ie((f,m)=>{((h,f)=>{s._addresses=r,s.currentURLIndex=s._addresses.findIndex(_=>_.fingerprint||V("FINGERPRINT"));const m=s._addresses[s.currentURLIndex];s.state="connecting",s.createTransmitterConnection(m).then(h).catch(f),s.once(Gt.CLOSED,()=>f(new L(D.WS_DISCONNECT))),s.once(Gt.CONNECTED,()=>h())})(f,m)}).then(()=>{h()}).catch(()=>{h()}))})()}sendMessage(r){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new L(D.WS_ABORT,"datachannel is not ready");try{i||(r=JSON.stringify(r)),this._reliableTransmission.sendMessage(r)}catch(s){throw new L(D.WS_ERR,"send datachannel signal message error"+s.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(r){const i=JSON.stringify(r);return{compressed:i,compressedLength:i.length,origin:r}}sendMessageWithUint8Array(r){return{compressed:r,compressedLength:r.byteLength,origin:r}}createTransmitterConnection(r){var i=this;return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(r.ip,":").concat(r.port),new ie((s,u)=>{var d;const h=()=>{R.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s()},f=function(){var y=M(function*(T){var b;if(null===(b=i._closeEstablishingTransmitter)||void 0===b||b.call(i),R.debug("[".concat(i._name,"] datachannel close ").concat(i._url,", code: ").concat(T.code,", reason: ").concat(T.reason,", current mode: ").concat(i.reconnectMode)),i._reconnectCount<i._retryConfig.maxRetryCount){"connected"===i.state&&(i.reconnectReason=T.reason,i.state="reconnecting");const w=Bi(i,Gt.WILL_RECONNECT,i.reconnectMode)||i.reconnectMode,P=yield i.reconnectWithAction(w);if("closed"===i.state)return void R.debug("[".concat(i.connectionID,"] dc is closed, no need to reconnect"));if(!P)return u(new L(D.WS_DISCONNECT,"datachannel reconnect failed: ".concat(T.code))),void i.close(!0);s()}else u(new L(D.WS_DISCONNECT,"datachannel close: ".concat(T.code))),i.close()});return function(b){return y.apply(this,arguments)}}(),m=y=>{var T;null===(T=this._reliableTransmission)||void 0===T||T.onData(y.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),R.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(r)));const _=null===(d=this._store)||void 0===d?void 0:d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),E=Date.now();zn(this,Gt.TO_CONNECT_DATACHANNEL,r).then(y=>{var T,b;if(!y)throw new Error("transmissonInfo not exist yet");const{transmitter:w,close:P}=y;this._transmitter=w,null===(T=this._store)||void 0===T||T.signalChannelOpen();const k=Date.now()-E;R.debug("[choose dc] dc open cost ".concat(k,"ms")),this._reliableTransmission=new Db(x=>{var B;this._transmitter&&"open"===this._transmitter.readyState&&(null===(B=this._transmitter)||void 0===B||B.send(x))},x=>{"string"==typeof x&&this.emit(Gt.ON_MESSAGE,x)}),this._closeEstablishingTransmitter=()=>{var x;null===(x=this._reliableTransmission)||void 0===x||x.close(),this._reliableTransmission=void 0,P()},h&&h(),w.onclose=f,w.onmessage=m,null===(b=this._store)||void 0===b||b.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this._joinChannelServiceRecordIndex=_}).catch(y=>{var T;if(null===(T=this._store)||void 0===T||T.recordJoinChannelService({endTs:Date.now(),status:y instanceof L&&y.code===D.WS_ABORT?"aborted":"error",errors:[y]},_),"closed"!==this.state){if(y instanceof L&&y.code===D.WS_ERR){const b=new L(D.WS_ERR,"init datachannel failed! Error: ".concat(y.toString()));return R.error("[".concat(this._name,"]").concat(b)),void u(b)}f&&f(y)}else u(new L(D.WS_DISCONNECT,"datachannel is closed: ".concat(y.toString())))})})}reconnectWithAction(r){var i=arguments,s=this;return M(function*(){let u=!(i.length>1&&void 0!==i[1])||i[1];if(s._reconnectCount>=s._retryConfig.maxRetryCount||!s._addresses||"closed"===s.state)return!1;s._onlineReconnectListener||sn.networkState!==cr.OFFLINE||(s._onlineReconnectListener=sn.onlineWaiter&&sn.onlineWaiter.then(()=>{s._onlineReconnectListener=void 0}));let d=!0;if(s._reconnectInterrupter=()=>{d=!1},u){const m=Ju(s._reconnectCount,s._retryConfig);R.debug("[".concat(s._name,"] wait ").concat(m,"ms to reconnect datachannel, mode: ").concat(r)),yield ie.race([hr(m),s._onlineReconnectListener||new ie(()=>{})])}if("closed"===s.state||!d)return!1;s._reconnectCount+=1;const h=function(){var m=M(function*(_,E){s.emit(Gt.RECONNECT_CREATE_CONNECTION,E),yield s.createTransmitterConnection(_)});return function(E,y){return m.apply(this,arguments)}}();try{if("retry"===r){const m=s._addresses[s.currentURLIndex];s.emit(Gt.RECONNECT_WAITTING_FINISH,r),yield h(m,r)}else if("tryNext"===r){s.currentURLIndex+=1;for(let _=s.currentURLIndex;_<s._addresses.length;_++){if(s._addresses[_].fingerprint||V("FINGERPRINT")){s.currentURLIndex=_;break}s.currentURLIndex+=1}if(s.currentURLIndex>=s._addresses.length)return R.debug("[".concat(s._name,"] the available addresses are exhausted, change to recover")),yield s.reconnectWithAction("recover",!1);R.debug("[".concat(s._name,"] datachannel url length: ").concat(s._addresses.length," current index: ").concat(s.currentURLIndex));const m=s._addresses[s.currentURLIndex];s.emit(Gt.RECONNECT_WAITTING_FINISH,r),yield h(m,r)}else"recover"===r&&(R.debug("[".concat(s._name,"] start to failback to websocket")),s.resetReconnectCount("recover mode"),s.emit(Gt.RECONNECT_WAITTING_FINISH,r),s.emit(Gt.FAILBACK));return!0}catch(m){var f;return R.error("[".concat(s._name,"] reconnect failed"),m.toString()),null!=m&&null!==(f=m.data)&&void 0!==f&&f.desc&&Array.isArray(m.data.desc)&&m.data.desc.length&&m.data.desc.includes("dynamic key expired")?(s.emit(Gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):yield s.reconnectWithAction(r,u)}})()}}class vs extends Lt{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===lt.CONNECTED?this.emit(ae.WS_CONNECTED):r===lt.RECONNECTING?this.emit(ae.WS_RECONNECTING,this._websocketReconnectReason):r===lt.CLOSED&&this.emit(ae.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",lt.CLOSED),S(this,"reconnectToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new Ab(5)),S(this,"pingpongTimer",void 0),S(this,"inflateDataTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"onWebsocketMessage",s=>{if(s instanceof ArrayBuffer)return void this.emit(ae.ON_BINARY_DATA,s);const u=JSON.parse(s);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(u,"_id")){const d="res-@".concat(u._id);this.emit(d,u._result,u._message)}else if(Object.prototype.hasOwnProperty.call(u,"_type")&&(this.emit(u._type,u._message),u._type===De.ON_NOTIFICATION&&this.handleNotification(u._message),u._type===De.ON_USER_BANNED))switch(u._message.error_code){case 14:this.close(st.UID_BANNED);break;case 15:this.close(st.IP_BANNED);break;case 16:this.close(st.CHANNEL_BANNED)}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new hy("gateway-".concat(this.clientId),this.spec.retryConfig,!0,i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lt.CONNECTED&&this.reconnect("retry",ms.OFFLINE)})}request(r,i,s,u){var d=this;return M(function*(){const h=wt(6,""),f={_id:h,_type:r,_message:i},m=d.websocket.connectionID,_=()=>new ie((P,k)=>{if(d.connectionState===lt.CONNECTED)return P();const x=()=>{d.off(ae.WS_CLOSED,B),P()},B=()=>{d.off(ae.WS_CONNECTED,x),k(new L(D.WS_ABORT))};d.once(ae.WS_CONNECTED,x),d.once(ae.WS_CLOSED,B),r!==me.PUBLISH&&r!==me.SUBSCRIBE&&r!==me.UNSUBSCRIBE&&r!==me.UNPUBLISH&&r!==me.CONTROL&&r!==me.RESTART_ICE||d.once(ae.DISCONNECT_P2P,()=>{k(new L(D.DISCONNECT_P2P))}),r!==me.PUBLISH&&r!==me.RESTART_ICE||d.once(ae.ABORT_P2P_EXECUTION,()=>{k(new L(D.DISCONNECT_P2P))})});if(d.connectionState!==lt.CONNECTING&&d.connectionState!==lt.RECONNECTING||r===me.JOIN||r===me.REJOIN||(yield _()),r===me.LEAVE&&(d.websocket.unbindDcCloseEventListener(),u=!0),d.websocket.sendMessage(f,!0,!1),u)return;const E=new ie((P,k)=>{let x=!1;const B=(ce,Re)=>{x=!0,P({isSuccess:"success"===ce,message:Re||{}}),d.off(ae.WS_CLOSED,H),d.off(ae.WS_RECONNECTING,H),d.emit(ae.REQUEST_SUCCESS,r,i)};d.once("res-@".concat(h),B);const H=()=>{k(new L(D.WS_ABORT,"type: ".concat(r))),d.off(ae.WS_CLOSED,H),d.off(ae.WS_RECONNECTING,H),d.off("res-@".concat(h),B)};d.once(ae.WS_CLOSED,H),d.once(ae.WS_RECONNECTING,H),hr(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||x||(R.warning("dc request timeout, type: ".concat(r)),d.emit(ae.REQUEST_TIMEOUT,r,i))})});let y=null;try{y=yield E}catch(P){if(d.connectionState===lt.CLOSED||r===me.LEAVE)throw new L(D.WS_ABORT);return!d.spec.forceWaitGatewayResponse||s?P.throw():r===me.JOIN||r===me.REJOIN?null:(yield _(),yield d.request(r,i))}if(y.isSuccess)return y.message;const T=Number(y.message.error_code||y.message.code),b=gm(T),w=new L(D.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(y.message.error_str),{code:T,data:y.message});return"success"===b.action?y.message:(R.warning("[".concat(d.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(T,", message: ").concat(b.desc,", action: ").concat(b.action)),T===fe.ERR_TOO_MANY_BROADCASTERS?((r===me.JOIN||r===me.REJOIN)&&(d.initError=w,d.close()),w.throw()):"failed"===b.action?w.throw():"quit"===b.action?(d.initError=w,d.close(),w.throw()):(T===fe.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,R.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",ms.MULTI_IP)):d.reconnect(b.action,ms.SERVER_ERROR),r===me.JOIN||r===me.REJOIN?null:yield d.request(r,i)))})()}waitMessage(r,i){return new ie(s=>{const u=d=>{(!i||i(d))&&(this.off(r,u),s(d))};this.on(r,u)})}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const d=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){this.websocket.sendMessage({_type:r,_message:i})}init(r,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ie((s,u)=>{this.once(ae.WS_CONNECTED,()=>s(this.joinResponse)),this.once(ae.WS_CLOSED,()=>u(this.initError||new L(D.WS_ABORT))),this.connectionState=lt.CONNECTING,this.websocket.init(r).catch(u),this.websocket.once(Gt.FAILBACK,()=>{void 0===this.openConnectionTime&&u(new L(D.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{i&&void 0===this.openConnectionTime&&(R.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),u(new L(D.INIT_DATACHANNEL_TIMEOUT)))},V("DC_JOIN_WITH_FAILBACK"))})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||st.LEAVE,this.connectionState=lt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),r===st.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new hy("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}join(){var r=this;return M(function*(){if(!r.joinResponse){r.emit(ae.ABORT_P2P_EXECUTION);const i=yield zn(r,ae.DATACHANNEL_CONNECTING),s=yield r.request(me.JOIN,i);if(!s)return r.emit(ae.REPORT_JOIN_GATEWAY,D.TIMEOUT,r.url||""),!1;r.joinResponse=s,r.emit(ae.JOIN_RESPONSE,r.joinResponse),r.reconnectToken=r.joinResponse.rejoin_token}return r.connectionState=lt.CONNECTED,r.pingpongTimer&&window.clearInterval(r.pingpongTimer),r.pingpongTimer=window.setInterval(r.handlePingPong.bind(r),3e3),!0})()}rejoin(){var r=this;return M(function*(){if(!r.reconnectToken)throw new L(D.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=xa(r,ae.REQUEST_REJOIN_INFO);i.token=r.reconnectToken;const s=yield r.request(me.REJOIN,i);return!!s&&(r.connectionState=lt.CONNECTED,r.pingpongTimer&&window.clearInterval(r.pingpongTimer),r.pingpongTimer=window.setInterval(r.handlePingPong.bind(r),3e3),s.peers&&s.peers.forEach(u=>{r.emit(De.ON_USER_ONLINE,{uid:u.uid}),u.audio&&r.emit(De.ON_ADD_AUDIO_STREAM,{uid:u.uid,uint_id:u.uint_id,audio:!0,ssrcId:u.audio_ssrc}),u.video&&r.emit(De.ON_ADD_VIDEO_STREAM,{uid:u.uid,uint_id:u.uint_id,video:!0,ssrcId:u.video_ssrc}),r.emit(u.audio_mute?De.MUTE_AUDIO:De.UNMUTE_AUDIO,{uid:u.uid}),r.emit(u.video_mute?De.MUTE_VIDEO:De.UNMUTE_VIDEO,{uid:u.uid}),r.emit(u.audio_enable_local?De.ENABLE_LOCAL_AUDIO:De.DISABLE_LOCAL_AUDIO,{uid:u.uid}),r.emit(u.video_enable_local?De.ENABLE_LOCAL_VIDEO:De.DISABLE_LOCAL_VIDEO,{uid:u.uid}),u.audio||u.video||r.emit(De.ON_REMOVE_STREAM,{uid:u.uid,uint_id:u.uint_id})}),!0)})()}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=gm(r.code);if("success"!==i.action){if("failed"!==i.action)return"quit"===i.action?("ERR_REPEAT_JOIN_CHANNEL"===i.desc&&this.close(st.UID_BANNED),void this.close()):void this.reconnect(i.action,ms.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=V("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("PINGPONG Timeout. Last Socket Message: ".concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ms.TIMEOUT):this.request(me.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),V("REPORT_STATS")&&this.send(me.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleInflateData(){const{inflateLength:r,deflateLength:i}=this.websocket.getInflateData();0!==r&&0!==i&&this.upload(Ht.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){var r=this;this.websocket.on(Gt.RECONNECT_WAITTING_FINISH,i=>{this.emit(ae.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(Gt.RECONNECT_CREATE_CONNECTION,i=>{this.emit(ae.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Gt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Gt.CLOSED,()=>{this.connectionState=lt.CLOSED}),this.websocket.on(Gt.FAILED,()=>{this._disconnectedReason=st.NETWORK_ERROR,this.connectionState=lt.CLOSED}),this.websocket.on(Gt.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===lt.CONNECTED?lt.RECONNECTING:lt.CONNECTING}),this.websocket.on(Gt.WILL_RECONNECT,(i,s)=>{if(xa(this,ae.IS_P2P_DISCONNECTED)&&"retry"===i)return R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ae.NEED_RENEW_SESSION),this.emit(ae.DISCONNECT_P2P),s("tryNext");"retry"!==i&&(R.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(ae.NEED_RENEW_SESSION),this.emit(ae.DISCONNECT_P2P)),s(i)}),this.websocket.on(Gt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",ms.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(ae.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof L&&i.code===D.UNEXPECTED_RESPONSE&&i.data.code===fe.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ms.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ms.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(Gt.REQUEST_NEW_URLS,(i,s)=>{zn(this,ae.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(Gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(De.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Gt.TO_CONNECT_DATACHANNEL,function(){var i=M(function*(s,u,d){return zn(r,ae.DATACHANNEL_PRECONNECT,s).then(u).catch(d)});return function(s,u,d){return i.apply(this,arguments)}}()),this.websocket.on(Gt.FAILBACK,()=>{void 0!==this.openConnectionTime&&this.emit(ae.DATACHANNEL_FAILBACK)})}}function wb(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function ys(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?wb(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):wb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}const py=new Map;class X0 extends Lt{get state(){return this._state}set state(r){if(r===this._state)return;const i=this._state;this._state=r,"DISCONNECTED"===r&&this._disconnectedReason?this.emit(Ut.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit(Ut.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){super(),S(this,"store",void 0),S(this,"joinInfo",void 0),S(this,"key",void 0),S(this,"signal",void 0),S(this,"role",void 0),S(this,"inChannelInfo",{joinAt:null,duration:0}),S(this,"spec",void 0),S(this,"_state","DISCONNECTED"),S(this,"_statsCollector",void 0),S(this,"_disconnectedReason",void 0),S(this,"isSignalRecover",!1),S(this,"hasChangeBGPAddress",!1),S(this,"trafficStatsInterval",void 0),S(this,"networkQualityInterval",void 0),S(this,"_joinGatewayStartTime",0),S(this,"_signalTimeout",!1),S(this,"_clientRoleOptions",void 0),S(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useDataChannel?new vs(ys(ys({},i),{},{retryConfig:i.websocketRetryConfig}),r):new dy(ys(ys({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}join(r,i,s){var u=this;return M(function*(){if(u.signal instanceof vs){let _=!1;"disabled"!==r.cloudProxyServer?(R.debug("[".concat(u.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(r.cloudProxyServer,")")),_=!0):"".concat(r.apResponse.cid,"_").concat(r.apResponse.cert).length>255||"".concat(r.apResponse.cid,"_").concat(r.apResponse.cert).length<22?(R.debug("[".concat(u.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):r.apResponse.addresses.some(E=>E.fingerprint)||V("FINGERPRINT")||(R.debug("[".concat(u.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&u.resetSignal()}u.store.joinGatewayStart(),"disabled"!==r.cloudProxyServer&&(u.hasChangeBGPAddress=!0);const d=Date.now();let h=py.get(r.cname);if(h||(h=new Map,py.set(r.cname,h)),u._isProactiveJoin=!0,h.has(r.uid)){const _=new L(D.UID_CONFLICT);throw he.joinGateway(r.sid,{lts:d,succ:!1,ec:_.message,addr:null,uid:r.uid,cid:r.cid,firstSuccess:u._isProactiveJoin,avoidJoinStartTime:u.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:u.signal instanceof vs?"1":"0"}),u._isProactiveJoin=!1,_}h.set(r.uid,!0),u.joinInfo=r,u.key=i;let f=0;u.joinGatewayStartTime=d;const m=r.proxyServer;try{let _;if(R.debug("[".concat(u.store.clientId,"] use ").concat(u.signal instanceof vs?"datachannel":"websocket"," join uid ").concat(f)),u.signal instanceof vs)_=yield u.signal.init(r.apResponse.addresses,s);else{const E=r.proxyServer,y=r.gatewayAddrs.map(E?T=>{const b=T.address.split(":");return"wss://".concat(E,"/ws/?h=").concat(b[0],"&p=").concat(b[1])}:T=>"wss://".concat(T.address));_=yield u.signal.init(y,s)}f=_.uid,R.debug("[".concat(u.store.clientId,"] ").concat(u.signal instanceof vs?"datachannel":"websocket"," join uid ").concat(f," cost ").concat(Date.now()-u.joinGatewayStartTime))}catch(_){throw _&&_.code===D.INIT_WEBSOCKET_TIMEOUT?(R.warning("[".concat(u.store.clientId,"] User join failed"),_.toString()),_):_&&_.code===D.INIT_DATACHANNEL_TIMEOUT?(R.warning("[".concat(u.store.clientId,"] User join datachannel failed"),_.toString()),u.resetSignal(),_):(R.error("[".concat(u.store.clientId,"] User join failed"),_.toString()),he.joinGateway(r.sid,{lts:d,succ:!1,ec:_.message,addr:u.signal.url,uid:r.uid,cid:r.cid,firstSuccess:u._isProactiveJoin,avoidJoinStartTime:u.store.avoidJoinStart,isProxy:!!m,signalChannel:u.signal instanceof vs?"1":"0"}),u._isProactiveJoin=!1,h.delete(r.uid),u.signal.close(),_)}return u.state="CONNECTED",u.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(u.store.clientId,"] Connected to gateway server")),u.trafficStatsInterval=window.setInterval(()=>{u.updateTrafficStats().catch(_=>{R.warning("[".concat(u.store.clientId,"] get traffic stats error"),_.toString())})},3e3),u.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?u.emit(Ut.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):u.emit(Ut.NETWORK_QUALITY,u._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===u.state&&u._statsCollector.trafficStats?{uplinkNetworkQuality:ry(u._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:ry(u._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),u.store.joinGatewayEnd(),f})()}leave(){var r=arguments,i=this;return M(function*(){let s=r.length>0&&void 0!==r[0]&&r[0],u=r.length>1?r[1]:void 0;if("DISCONNECTED"!==i.state){u!==st.FALLBACK&&(i.state="DISCONNECTING");try{s||i.signal.connectionState!==lt.CONNECTED||(yield(d=i.signal.request(me.LEAVE,void 0,!0),3e3,ie.race([d,z0(3e3)])))}catch(d){R.warning("[".concat(i.store.clientId,"] leave request failed, ignore"),d)}i.signal.close(u),u!==st.FALLBACK&&(i.state="DISCONNECTED"),i.reset()}var d})()}publish(r,i,s){var u=this;return M(function*(){if("CONNECTED"!==u.state&&"RECONNECTING"!==u.state)throw new L(D.INVALID_OPERATION,"can not publish when connection state is ".concat(u.state));const d={state:"offer",p2p_id:u.store.p2pId,ortc:i,mode:u.spec.mode,extend:V("PUB_EXTEND"),twcc:!!V("PUBLISH_TWCC"),rtx:!!V("USE_PUB_RTX")};try{return(yield u.signal.request(me.PUBLISH,d,!0))._message}catch(h){if(s&&h.data&&h.data.code===fe.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(u.store.clientId,"] receive publish error code, retry"),h.toString()),yield u.tryUnpubBeforeRepub(r,i),u.publish(r,i,!1);throw h}})()}unpublish(r,i){var s=this;return M(function*(){try{if("CONNECTED"!==s.state&&"RECONNECTING"!==s.state)throw new L(D.INVALID_OPERATION,"can not publish when connection state is ".concat(s.state));yield s.signal.request(me.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(u){R.warning("[".concat(s.store.clientId,"] unpublish warning: "),u)}})()}subscribe(r,i,s){var u=this;return M(function*(){if("CONNECTED"!==u.state&&"RECONNECTING"!==u.state)throw new L(D.INVALID_OPERATION,"can not subscribe when connection state is ".concat(u.state));const d={stream_id:r,stream_type:i.stream_type,mode:u.spec.mode,codec:u.spec.codec,p2p_id:u.store.p2pId,twcc:!!V("SUBSCRIBE_TWCC"),rtx:!!V("USE_SUB_RTX"),extend:V("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(V("SVC"))&&0!==V("SVC").length?V("SVC"):void 0};try{return(yield u.signal.request(me.SUBSCRIBE,d,!0))._message}catch(h){if(s&&h.data&&h.data.code===fe.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(u.store.clientId,"] receiver subscribe error code, retry"),h.toString()),yield u.tryUnsubBeforeResub(r,i),yield u.subscribe(r,i,!1);throw h}})()}subscribeAll(r,i){var s=this;return M(function*(){if("CONNECTED"!==s.state&&"RECONNECTING"!==s.state)throw new L(D.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(s.state));const u={p2p_id:s.store.p2pId,users:r,dtx:!1,rtx:!!V("USE_SUB_RTX")};try{return yield s.signal.request(me.SUBSCRIBE_STREAMS,u,!0)}catch(d){if(i&&d.data&&d.data.code===fe.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(s.store.clientId,"] receiver massSubscribe error code, retry"),d.toString()),yield s.tryMassUnsubBeforeResub(r),yield s.subscribeAll(r,!1);throw d}})()}setVideoProfile(r){var i=this;return M(function*(){const s=function(u){if(!(u.bitrateMax&&u.bitrateMin&&u.frameRate&&u.height&&u.width))return;let d=u.frameRate,h=u.width,f=u.height,m=!0;return"number"!=typeof d&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),"number"!=typeof h&&(h=h.exact||h.ideal||h.max||h.min||0,h||(m=!1)),"number"!=typeof f&&(f=f.exact||f.ideal||f.max||f.min||0,d||(m=!1)),m?{stream_type:0,width:h,height:f,fps:d,start_bps:1e3*u.bitrateMax,min_bps:1e3*u.bitrateMin,target_bps:1e3*u.bitrateMax}:void 0}(r);if(s)return i.signal.request(me.SET_VIDEO_PROFILE,s);R.debug("[".concat(i.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(r,i){var s=this;return M(function*(){try{yield s.signal.request(me.UNSUBSCRIBE,{p2p_id:s.store.p2pId,ortc:r,stream_id:i},!0)}catch(u){R.warning("[".concat(s.store.clientId,"] unsubscribe warning: "),u)}})()}massUnsubscribe(r){var i=this;return M(function*(){try{yield i.signal.request(me.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){R.warning("[".concat(i.store.clientId,"] massUnsubscribeAll warning: "),s)}})()}reconnectPC(r){var i=this;return M(function*(){const{iceParameters:s,dtlsParameters:u,rtpCapabilities:d}=r;return{gatewayEstablishParams:yield i.signal.request(me.CONNECT_PC,{p2p_id:i.store.p2pId,stream_id:i.store.uid,ortc:{iceParameters:s,dtlsParameters:u,rtpCapabilities:d}},!0),gatewayAddress:i.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(me.GATEWAY_INFO)}renewToken(r){var i=this;return M(function*(){yield i.signal.request(me.RENEW_TOKEN,r),i.key=r.token})()}setClientRole(r,i){var s=this;return M(function*(){if(i&&(s._clientRoleOptions=Object.assign({},i)),"CONNECTED"!==s.state)return void(s.role=r);let u;u="audience"===r?s._clientRoleOptions&&s._clientRoleOptions.level?s._clientRoleOptions.level:2:0,yield s.signal.request(me.SET_CLIENT_ROLE,{role:r,level:u,client_ts:Date.now()}),s.role=r})()}setRemoteVideoStreamType(r,i){var s=this;return M(function*(){yield s.signal.request(me.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})})()}setDefaultRemoteVideoStreamType(r){var i=this;return M(function*(){yield i.signal.request(me.DEFAULT_VIDEO_STREAM,{stream_type:r})})()}setStreamFallbackOption(r,i){var s=this;return M(function*(){yield s.signal.request(me.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})})()}pickSVCLayer(r,i){var s=this;return M(function*(){yield s.signal.request(me.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ys({},this.inChannelInfo)}getGatewayVersion(){var r=this;return M(function*(){return(yield r.signal.request(me.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=py.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(i){let s;return s=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:Ro.username,password:Ro.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(ys(ys({},Ro),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var r=this;return M(function*(){if("CONNECTED"!==r.state)return;const i=yield r.signal.request(me.TRAFFIC_STATS,void 0,!0);i.timestamp=Date.now(),i.peer_delay.forEach(s=>{const u=r._statsCollector.trafficStats&&r._statsCollector.trafficStats.peer_delay.find(d=>d.peer_uid===s.peer_uid);u&&u.B_st!==s.B_st&&Hi(()=>{r.emit(Ut.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),r._statsCollector.updateTrafficStats(i)})()}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new L(D.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let s=V("REPORT_APP_SCENARIO");if("string"!=typeof s)try{s=JSON.stringify(s)}catch{s=void 0}s&&s.length>128&&(s=void 0);const u=ys({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:no,browser:navigator.userAgent,process_id:V("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:V("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:{enablePublishedUserList:V("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:V("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof V("SUBSCRIBE_AUDIO_FILTER_TOPN")?V("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof V("ENABLE_PUBLISH_AUDIO_FILTER")?V("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof V("ENABLE_USER_LICENSE_CHECK")?V("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===V("USE_PUB_RTX")||!0===V("USE_SUB_RTX")||void 0}},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(u.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(u.aes_mode=this.joinInfo.aesmode,V("ENCRYPT_AES")?(u.aes_secret=this.joinInfo.aespassword,u.aes_encrypt=!0):u.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(u.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(u.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),void 0!==this.joinInfo.defaultVideoStream&&(u.default_video_stream=this.joinInfo.defaultVideoStream),u}getRejoinMessage(){if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var r=this;this.signal.on(ae.WS_RECONNECT_WAITTING_FINISH,i=>{["tryNext","recover"].includes(i)&&this.joinInfo&&he.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(ae.WS_RECONNECT_CREATE_CONNECTION,i=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ae.WS_RECONNECTING,i=>{this.joinInfo&&he.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i||yr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",he.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ae.WS_CLOSED,i=>{let s;switch(i){case st.LEAVE:s=yr.LEAVE;break;case st.UID_BANNED:case st.IP_BANNED:case st.CHANNEL_BANNED:case st.SERVER_ERROR:s=yr.SERVER_ERROR;break;case st.FALLBACK:s=yr.FALLBACK;break;case st.LICENSE_MISSING:case st.LICENSE_EXPIRED:case st.LICENSE_MINUTES_EXCEEDED:case st.LICENSE_PERIOD_INVALID:case st.LICENSE_MULTIPLE_SDK_SERVICE:case st.LICENSE_ILLEGAL:s=i;break;default:s=yr.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+yr.NETWORK_ERROR)),this.joinInfo&&he.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:i===st.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=i,i!==st.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ae.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&this._clientRoleOptions.level&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),he.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof vs?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const i=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!i)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(i));_t("EVENT_REPORT_DOMAIN",i[1]),_t("EVENT_REPORT_BACKUP_DOMAIN",i[1]),_t("LOG_UPLOAD_SERVER","".concat(i[1],":6444"))}}),this.signal.on(De.ON_UPLINK_STATS,i=>{this._statsCollector.updateUplinkStats(i)}),this.signal.on(ae.REQUEST_RECOVER,(i,s,u)=>{if(!this.joinInfo)return u(new L(D.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));i&&(this.joinInfo.multiIP=i,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,zn(this,Ut.REQUEST_NEW_GATEWAY_LIST).then(s).catch(u)}),this.signal.on(ae.REQUEST_JOIN_INFO,function(){var i=M(function*(s){var u;r.updateTurnConfigFromSignal();const{iceParameters:d,dtlsParameters:h,rtpCapabilities:f}=yield zn(r,Ut.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(u=r.joinInfo)||void 0===u?void 0:u.turnServer});s(r.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:h,rtpCapabilities:f,version:"2"}}))});return function(s){return i.apply(this,arguments)}}()),this.signal.on(ae.REQUEST_REJOIN_INFO,i=>{i(this.getRejoinMessage())}),this.signal.on(ae.REPORT_JOIN_GATEWAY,(i,s)=>{this.joinInfo&&(he.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof vs?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(ae.IS_P2P_DISCONNECTED,i=>{i(xa(this,Ut.IS_P2P_DISCONNECTED))}),this.signal.on(ae.DISCONNECT_P2P,()=>{this.emit(Ut.DISCONNECT_P2P)}),this.signal.on(ae.NEED_RENEW_SESSION,()=>{this.emit(Ut.NEED_RENEW_SESSION)}),this.signal.on(ae.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ae.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ae.JOIN_RESPONSE,i=>{const s=this.getCurrentGatewayAddress();this.emit(Ut.JOIN_RESPONSE,i,s)}),this.signal.on(ae.DATACHANNEL_PRECONNECT,function(){var i=M(function*(s,u,d){r.updateTurnConfigFromSignal();const h=r.getCurrentGatewayAddress();return zn(r,Ut.DATACHANNEL_PRECONNECT,s,h).then(u).catch(d)});return function(s,u,d){return i.apply(this,arguments)}}()),this.signal.on(ae.DATACHANNEL_CONNECTING,function(){var i=M(function*(s){const{iceParameters:u,dtlsParameters:d,rtpCapabilities:h}=yield zn(r,Ut.REQUEST_DC_CONNECTION_PARAMS);s(r.getJoinMessage({ortc:{iceParameters:u,dtlsParameters:d,rtpCapabilities:h,version:"2"}}))});return function(s){return i.apply(this,arguments)}}()),this.signal.on(ae.DATACHANNEL_FAILBACK,()=>{R.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Ut.DATACHANNEL_FAILBACK)})}tryUnsubBeforeResub(r,i){var s=this;return M(function*(){try{yield s.signal.request(me.UNSUBSCRIBE,{p2p_id:s.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(u){throw R.warning("[".concat(s.store.clientId,"] tryUnsubBeforeResub warning"),u),u}})()}tryUnpubBeforeRepub(r,i){var s=this;return M(function*(){try{yield s.signal.request(me.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(u){throw R.warning("[".concat(s.store.clientId,"] tryUnpubBeforeRepub warning: "),u),u}})()}tryMassUnsubBeforeResub(r){var i=this;return M(function*(){const s={users:r.map(u=>({stream_id:u.stream_id,stream_type:u.stream_type}))};try{yield i.signal.request(me.UNSUBSCRIBE_STREAMS,s,!0)}catch(u){throw R.warning("[".concat(i.store.clientId,"] tryMassUnsubBeforeResub warning"),u),u}})()}muteLocal(r,i){var s=this;return M(function*(){const u={action:r.find(d=>d.stream_type===fn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:s.store.p2pId,ortc:r,stream_id:i};try{yield s.signal.request(me.CONTROL,u,!0,!0)}catch(d){throw R.warning("[".concat(s.store.clientId,"] gateway muteLocal warning: "),d),d}})()}unmuteLocal(r,i){var s=this;return M(function*(){const u={action:r.find(d=>d.stream_type===fn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:s.store.p2pId,ortc:r,stream_id:i};try{yield s.signal.request(me.CONTROL,u,!0,!0)}catch(d){throw R.warning("[".concat(s.store.clientId,"] gateway unmuteLocal warning: "),d),d}})()}uploadStats(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}restartICE(r){var i=this;return M(function*(){const s={p2p_id:i.store.p2pId,stream_id:i.store.uid,ortc:r};try{return yield i.signal.request(me.RESTART_ICE,s,!0)}catch(u){throw R.warning("[".concat(i.store.clientId,"] P2PChannel.restartICE warning: "),u),u}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,yr.P2P_FAILED)}getCurrentGatewayAddress(){var r;if(!V("GATEWAY_WSS_ADDRESS"))return null!==(r=this.joinInfo)&&void 0!==r&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(r){var i=this;return M(function*(){yield i.signal.request(me.SET_PARAMETER,{enablePublishAudioFilter:r})})()}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(st.FALLBACK)),this.store.useDataChannel=!1,this.signal=new dy(ys(ys({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Ut.RESET_SIGNAL,Yf.websocket)}}!function(){var o;function r(G){var z=0;return function(){return z<G.length?{done:!1,value:G[z++]}:{done:!0}}}var s,i="function"==typeof Object.defineProperties?Object.defineProperty:function(G,z,ne){return G==Array.prototype||G==Object.prototype||(G[z]=ne.value),G},u=function(G){G=["object"==typeof globalThis&&globalThis,G,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Mo&&Mo];for(var z=0;z<G.length;++z){var ne=G[z];if(ne&&ne.Math==Math)return ne}throw Error("Cannot find global object")}(this);function d(G,z){if(z)e:{var ne=u;G=G.split(".");for(var _e=0;_e<G.length-1;_e++){var We=G[_e];if(!(We in ne))break e;ne=ne[We]}(z=z(_e=ne[G=G[G.length-1]]))!=_e&&null!=z&&i(ne,G,{configurable:!0,writable:!0,value:z})}}function h(G){return(G={next:G})[Symbol.iterator]=function(){return this},G}function f(G){var z=typeof Symbol<"u"&&Symbol.iterator&&G[Symbol.iterator];return z?z.call(G):{next:r(G)}}if(d("Symbol",function(G){function z(We,X){this.A=We,i(this,"description",{configurable:!0,writable:!0,value:X})}if(G)return G;z.prototype.toString=function(){return this.A};var ne="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",_e=0;return function We(X){if(this instanceof We)throw new TypeError("Symbol is not a constructor");return new z(ne+(X||"")+"_"+_e++,X)}}),d("Symbol.iterator",function(G){if(G)return G;G=Symbol("Symbol.iterator");for(var z="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ne=0;ne<z.length;ne++){var _e=u[z[ne]];"function"==typeof _e&&"function"!=typeof _e.prototype[G]&&i(_e.prototype,G,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return G}),"function"==typeof Object.setPrototypeOf)s=Object.setPrototypeOf;else{var m;e:{var _={};try{_.__proto__={a:!0},m=_.a;break e}catch{}m=!1}s=m?function(G,z){if(G.__proto__=z,G.__proto__!==z)throw new TypeError(G+" is not extensible");return G}:null}var E=s;function y(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function T(G){if(G.m)throw new TypeError("Generator is already running");G.m=!0}function b(G,z){return G.h=3,{value:z}}function w(G){this.g=new y,this.G=G}function P(G,z,ne,_e){try{var We=z.call(G.g.j,ne);if(!(We instanceof Object))throw new TypeError("Iterator result "+We+" is not an object");if(!We.done)return G.g.m=!1,We;var X=We.value}catch(C){return G.g.j=null,G.g.s(C),k(G)}return G.g.j=null,_e.call(G.g,X),k(G)}function k(G){for(;G.g.h;)try{var z=G.G(G.g);if(z)return G.g.m=!1,{value:z.value,done:!1}}catch(ne){G.g.v=void 0,G.g.s(ne)}if(G.g.m=!1,G.g.l){if(z=G.g.l,G.g.l=null,z.F)throw z.D;return{value:z.return,done:!0}}return{value:void 0,done:!0}}function x(G){this.next=function(z){return G.o(z)},this.throw=function(z){return G.s(z)},this.return=function(z){return function(ne,_e){T(ne.g);var We=ne.g.j;return We?P(ne,"return"in We?We.return:function(X){return{value:X,done:!0}},_e,ne.g.return):(ne.g.return(_e),k(ne))}(G,z)},this[Symbol.iterator]=function(){return this}}function B(G,z){return z=new x(new w(z)),E&&G.prototype&&E(z,G.prototype),z}if(y.prototype.o=function(G){this.v=G},y.prototype.s=function(G){this.l={D:G,F:!0},this.h=this.C||this.u},y.prototype.return=function(G){this.l={return:G},this.h=this.u},w.prototype.o=function(G){return T(this.g),this.g.j?P(this,this.g.j.next,G,this.g.o):(this.g.o(G),k(this))},w.prototype.s=function(G){return T(this.g),this.g.j?P(this,this.g.j.throw,G,this.g.o):(this.g.s(G),k(this))},d("Array.prototype.entries",function(G){return G||function(){return function(z,ne){z instanceof String&&(z+="");var _e=0,We=!1,X={next:function(){if(!We&&_e<z.length){var C=_e++;return{value:ne(C,z[C]),done:!1}}return We=!0,{done:!0,value:void 0}}};return X[Symbol.iterator]=function(){return X},X}(this,function(z,ne){return[z,ne]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var H=function(G,z){for(var ne=0;ne<G.length;ne++)z(G[ne])},ce=function(G){return G.replace(/\r?\n|\r/g,"\r\n")},Re=function(G,z,ne){return z instanceof Blob?(z.name===(ne=void 0!==ne?ne+"":"string"==typeof z.name?z.name:"blob")&&"[object Blob]"!==Object.prototype.toString.call(z)||(z=new File([z],ne)),[String(G),z]):[String(G),String(z)]},Z=function(G,z){if(G.length<z)throw new TypeError(z+" argument required, but only "+G.length+" present.")},Y="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,ee=Y.FormData,oe=Y.XMLHttpRequest&&Y.XMLHttpRequest.prototype.send,Et=Y.Request&&Y.fetch,Oe=Y.navigator&&Y.navigator.sendBeacon,ht=Y.Element&&Y.Element.prototype,vt=Y.Symbol&&Symbol.toStringTag;vt&&(Blob.prototype[vt]||(Blob.prototype[vt]="Blob"),"File"in Y&&!File.prototype[vt]&&(File.prototype[vt]="File"));try{new File([],"")}catch{Y.File=function(z,ne,_e){return z=new Blob(z,_e||{}),Object.defineProperties(z,{name:{value:ne},lastModified:{value:+(_e&&void 0!==_e.lastModified?new Date(_e.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),vt&&Object.defineProperty(z,vt,{value:"File"}),z}}var Jn=function(G){return G.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Jt=function(G){this.i=[];var z=this;G&&H(G.elements,function(ne){if(ne.name&&!ne.disabled&&"submit"!==ne.type&&"button"!==ne.type&&!ne.matches("form fieldset[disabled] *"))if("file"===ne.type){var _e=ne.files&&ne.files.length?ne.files:[new File([],"",{type:"application/octet-stream"})];H(_e,function(We){z.append(ne.name,We)})}else"select-multiple"===ne.type||"select-one"===ne.type?H(ne.options,function(We){!We.disabled&&We.selected&&z.append(ne.name,We.value)}):"checkbox"===ne.type||"radio"===ne.type?ne.checked&&z.append(ne.name,ne.value):(_e="textarea"===ne.type?ce(ne.value):ne.value,z.append(ne.name,_e))})};if((o=Jt.prototype).append=function(G,z,ne){Z(arguments,2),this.i.push(Re(G,z,ne))},o.delete=function(G){Z(arguments,1);var z=[];G=String(G),H(this.i,function(ne){ne[0]!==G&&z.push(ne)}),this.i=z},o.entries=function G(){var z,ne=this;return B(G,function(_e){if(1==_e.h&&(z=0),3!=_e.h)return z<ne.i.length?_e=b(_e,ne.i[z]):(_e.h=0,_e=void 0),_e;z++,_e.h=2})},o.forEach=function(G,z){Z(arguments,1);for(var ne=f(this),_e=ne.next();!_e.done;_e=ne.next()){var We=f(_e.value);_e=We.next().value,We=We.next().value,G.call(z,We,_e,this)}},o.get=function(G){Z(arguments,1);var z=this.i;G=String(G);for(var ne=0;ne<z.length;ne++)if(z[ne][0]===G)return z[ne][1];return null},o.getAll=function(G){Z(arguments,1);var z=[];return G=String(G),H(this.i,function(ne){ne[0]===G&&z.push(ne[1])}),z},o.has=function(G){Z(arguments,1),G=String(G);for(var z=0;z<this.i.length;z++)if(this.i[z][0]===G)return!0;return!1},o.keys=function G(){var z,ne,X=this;return B(G,function(C){if(1==C.h&&(z=f(X),ne=z.next()),3!=C.h)return ne.done?void(C.h=0):b(C,f(ne.value).next().value);ne=z.next(),C.h=2})},o.set=function(G,z,ne){Z(arguments,2),G=String(G);var _e=[],We=Re(G,z,ne),X=!0;H(this.i,function(C){C[0]===G?X&&(X=!_e.push(We)):_e.push(C)}),X&&_e.push(We),this.i=_e},o.values=function G(){var z,ne,We,X=this;return B(G,function(C){if(1==C.h&&(z=f(X),ne=z.next()),3!=C.h)return ne.done?void(C.h=0):((We=f(ne.value)).next(),b(C,We.next().value));ne=z.next(),C.h=2})},Jt.prototype._asNative=function(){for(var G=new ee,z=f(this),ne=z.next();!ne.done;ne=z.next()){var _e=f(ne.value);ne=_e.next().value,_e=_e.next().value,G.append(ne,_e)}return G},Jt.prototype._blob=function(){var G="----formdata-polyfill-"+Math.random(),z=[],ne="--"+G+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(_e,We){return"string"==typeof _e?z.push(ne+Jn(ce(We))+'"\r\n\r\n'+ce(_e)+"\r\n"):z.push(ne+Jn(ce(We))+'"; filename="'+Jn(_e.name)+'"\r\nContent-Type: '+(_e.type||"application/octet-stream")+"\r\n\r\n",_e,"\r\n")}),z.push("--"+G+"--"),new Blob(z,{type:"multipart/form-data; boundary="+G})},Jt.prototype[Symbol.iterator]=function(){return this.entries()},Jt.prototype.toString=function(){return"[object FormData]"},ht&&!ht.matches&&(ht.matches=ht.matchesSelector||ht.mozMatchesSelector||ht.msMatchesSelector||ht.oMatchesSelector||ht.webkitMatchesSelector||function(G){for(var z=(G=(this.document||this.ownerDocument).querySelectorAll(G)).length;0<=--z&&G.item(z)!==this;);return-1<z}),vt&&(Jt.prototype[vt]="FormData"),oe){var Sn=Y.XMLHttpRequest.prototype.setRequestHeader;Y.XMLHttpRequest.prototype.setRequestHeader=function(G,z){Sn.call(this,G,z),"content-type"===G.toLowerCase()&&(this.B=!0)},Y.XMLHttpRequest.prototype.send=function(G){G instanceof Jt?(G=G._blob(),this.B||this.setRequestHeader("Content-Type",G.type),oe.call(this,G)):oe.call(this,G)}}Et&&(Y.fetch=function(G,z){return z&&z.body&&z.body instanceof Jt&&(z.body=z.body._blob()),Et.call(this,G,z)}),Oe&&(Y.navigator.sendBeacon=function(G,z){return z instanceof Jt&&(z=z._asNative()),Oe.call(this,G,z)}),Y.FormData=Jt}}();const th=()=>{const o=V("AREAS");return 0===o.length&&o.push(je.GLOBAL),ti(o).call(o,(r,i,s)=>{const u=Q0(i);return u?0===s?u:"".concat(r,",").concat(u):r},"")},Q0=o=>o===je.OVERSEA?"".concat(Pn.ASIA,",").concat(Pn.EUROPE,",").concat(Pn.AFRICA,",").concat(Pn.NORTH_AMERICA,",").concat(Pn.SOUTH_AMERICA,",").concat(Pn.OCEANIA):Pn[o],Ob=o=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return o.map(i=>{const s=Jf[i],u=Object.keys(s);u&&u.map(d=>{"CODE"!==d&&(r[d]=r[d].concat(s[d]))})}),r},ym={GLOBAL:{ASIA:[je.CHINA,je.JAPAN,je.INDIA,je.KOREA,je.HKMC],EUROPE:[],NORTH_AMERICA:[je.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},fy=Object.keys(ym[je.GLOBAL]),Z0=[je.CHINA,je.NORTH_AMERICA,je.EUROPE,je.ASIA,je.JAPAN,je.INDIA,je.OCEANIA,je.SOUTH_AMERICA,je.AFRICA,je.KOREA,je.HKMC,je.US],eP=function(o,r){let i=[];if(o.includes(je.GLOBAL)){const d=[je.GLOBAL,je.OVERSEA],h=Object.keys(Jf);if(r===je.GLOBAL)throw new L(D.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===je.CHINA)i=[je.OVERSEA];else if(fy.includes(r)){const f=ym[je.GLOBAL][r]||[],m=[...d,r,...f];i=h.filter(_=>!m.includes(_))}else if(function(f){let m=!1;return fy.forEach(_=>{ym[je.GLOBAL][_].includes(f)&&(m=!0)}),m}(r)){const f=function(_){let E;return fy.forEach(y=>{ym[je.GLOBAL][y].includes(_)&&(E=y)}),E}(r),m=[...d,f,r];i=h.filter(_=>!m.includes(_))}else i=o;i=function(f){const m=[];return Z0.forEach(_=>{f.includes(_)&&m.push(_)}),m.concat(f.filter(_=>!Z0.includes(_)))}(i)}else i=o;return i};function Nb(o){if(!o&&V("AREAS").includes(je.EXTENSIONS))return R.debug("update area from ap : reset"),void my(zI,!0);if(!V("AREAS").includes(je.GLOBAL)||!o)return;let r=Jf.EXTENSIONS;r&&(r={CODE:Q0(je.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(o,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(o,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(o,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(o,".agora.io"),"cds-ap-web-2-".concat(o,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(o,".agora.io"),"sua-ap-web-2-".concat(o,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(o,".agora.io"),"uap-ap-web-2-".concat(o,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(o,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(o,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(o,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(o,".agora.io")]},R.debug("update area from ap success: ".concat(o,",config is "),r),_t("AREAS",[je.EXTENSIONS],!0),Object.keys(r).map(i=>{_t(i,"LOG_UPLOAD_SERVER"===i||"EVENT_REPORT_DOMAIN"===i||"EVENT_REPORT_BACKUP_DOMAIN"===i||"PROXY_SERVER_TYPE3"===i?r[i][0]:r[i])}))}function my(o){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=he.reportApiInvoke(null,{name:pn.SET_AREA,options:o,tag:xt.TRACER});try{let s=[];if("string"==typeof o&&(s=[o]),Array.isArray(o)&&(o.forEach(d=>{if(!m0.includes(d))throw new L(D.INVALID_PARAMS,"invalid area code")}),s=o),"[object Object]"===Object.prototype.toString.call(o)){const{areaCode:d,excludedArea:h}=o;if(!d)throw new L(D.INVALID_PARAMS,"area code is needed");let f=d;"string"==typeof d&&(f=[d]),s=h?eP(f,h):f}if(!r){if(Ac.AREAS){const d=new L(D.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(d),void R.warning("setArea is prohibited because of config-distribute")}if(s.includes(je.GLOBAL)&&V("AREAS")===je.EXTENSIONS){const d=new L(D.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(d),void R.warning("setArea is prohibited because of ap extensions")}}_t("AREAS",s,r);const u=Ob(s);Object.keys(u).map(d=>{_t(d,"LOG_UPLOAD_SERVER"===d||"EVENT_REPORT_DOMAIN"===d||"EVENT_REPORT_BACKUP_DOMAIN"===d||"PROXY_SERVER_TYPE3"===d?u[d][0]:u[d])}),R.debug("set area success:",s.join(","))}catch(s){throw i.onError(s),s}i.onSuccess()}function Pb(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function Mb(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?Pb(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Pb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let gy=1;let _y=1;function Lb(o,r,i,s){let{url:u,areaCode:d}=o;const h=Date.now();let f;const[m,_]=Ey(r,d,[At.CHOOSE_SERVER]);let E=sn.networkState;return to(M(function*(){E&&sn.networkState===cr.OFFLINE&&sn.onlineWaiter&&(yield ie.race([sn.onlineWaiter,hr(s&&s.maxRetryTimeout||vn.maxRetryTimeout)])),E=sn.networkState;const{data:y,headers:T}=yield Vi(u,{data:m,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f="1"===T.http3?1:-1,he.reportResourceTiming(u,r.sid),xb(y,u,r,h,[At.CHOOSE_SERVER],f);const b=oy(y,At.CHOOSE_SERVER);return Ub(b),dm(b,u)}),y=>(y&&he.joinChooseServer(r.sid,{lts:h,succ:!0,csAddr:u,opid:_,serverList:y.gatewayAddrs.map(T=>T.address),ec:null,cid:y.cid.toString(),uid:y.uid.toString(),csIp:y.csIp,unilbsServerIds:[At.CHOOSE_SERVER].toString(),isHttp3:f}),!1),y=>y.code!==D.OPERATION_ABORTED&&(y.code===D.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(he.joinChooseServer(r.sid,{lts:h,succ:!1,csAddr:u,serverList:null,opid:_,ec:y.code,csIp:y.data&&y.data.csIp,unilbsServerIds:[At.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:E}),isHttp3:f}),R.warning("[".concat(r.clientId,"] Choose server network error, retry"),y),!0)),s)}function kb(o,r,i,s){let u,{url:d,areaCode:h,serviceIds:f}=o;const m=Date.now(),[_,E]=Ey(r,h,f);let y;return to(M(function*(){y&&sn.networkState===cr.OFFLINE&&sn.onlineWaiter&&(yield ie.race([sn.onlineWaiter,hr(s&&s.maxRetryTimeout||vn.maxRetryTimeout)])),y=sn.networkState;const{data:T,headers:b}=yield Vi(d,{data:_,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u="1"===b.http3?1:-1,he.reportResourceTiming(d,r.sid),xb(T,d,r,m,f,u);const w=oy(T,At.CHOOSE_SERVER),P=oy(T,"proxy5"===r.cloudProxyServer?At.CLOUD_PROXY_5:"proxy3"===r.cloudProxyServer||"proxy4"===r.cloudProxyServer?At.CLOUD_PROXY:At.CLOUD_PROXY_FALLBACK);return Ub(w),{gatewayInfo:dm(w,d),proxyInfo:P,url:d}}),T=>(T.gatewayInfo&&he.joinChooseServer(r.sid,{lts:m,succ:!0,csAddr:d,serverList:T.gatewayInfo.gatewayAddrs.map(b=>b.address),ec:null,opid:E,cid:T.gatewayInfo.cid.toString(),uid:T.gatewayInfo.uid.toString(),csIp:T.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:u}),T.proxyInfo&&he.joinWebProxyAP(r.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:T.proxyInfo.addresses.map(b=>b.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:f.toString()}),!1),T=>T.code!==D.OPERATION_ABORTED&&(T.code===D.CAN_NOT_GET_GATEWAY_SERVER?T.data.retry:(he.joinWebProxyAP(r.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:T.code,eventType:r.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:y})}),R.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),T),!0)),s)}const xb=(o,r,i,s,u,d)=>{const h=[],f=m=>{4096===m.flag?he.joinChooseServer(i.sid,{lts:s,succ:!1,csAddr:r,opid:o.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:u.toString(),isHttp3:d}):1048576!==m.flag&&4194304!==m.flag&&4194310!==m.flag||he.joinWebProxyAP(i.sid,{lts:s,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:m.error.code,eventType:i.cloudProxyServer,unilbsServerIds:u.toString()})};if(o.response_body.forEach(m=>{const _=m.buffer.code;if(23===m.uri&&0===_&&!m.buffer.edges_services)if(4194310===m.buffer.flag)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const E={error:new L(D.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:o.detail[502]}),flag:m.buffer.flag};h.push(E),f(E)}if(0!==_){const E=eh(_),y={error:new L(D.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{desc:E.desc,retry:E.retry,csIp:o.detail[502]}),flag:m.buffer.flag};4194310===m.buffer.flag?R.warning(y.error.toString()):h.push(y),f(y)}}),h.length)throw R.warning("[".concat(i.clientId,"] multi unilbs ").concat(r," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new L(D.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:o.detail[502],desc:[...new Set(h.map(m=>{var _,E;return null==m||null===(_=m.error)||void 0===_||null===(E=_.data)||void 0===E?void 0:E.desc}).filter(m=>!!m))]})},Ub=o=>{var r,i,s,u;if(o.addresses&&0===o.addresses.length&&0===o.code)throw new L(D.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:o.detail&&o.detail[502]});if(V("AP_AREA")&&(null!==(s=o.detail)&&void 0!==s&&s[23]&&"string"==typeof(null===(u=o.detail)||void 0===u?void 0:u[23])?Nb(o.detail[23].toLowerCase()):Nb()),null!==(r=o.detail)&&void 0!==r&&r[19]&&"string"==typeof(null===(i=o.detail)||void 0===i?void 0:i[19])){const h=o.detail[19],f=h?.split(";");for(let m=0;m<f.length;m++){var d;const _=is(d=f[m]).call(d);o.addresses[m]&&f&&(o.addresses[m].fingerprint=_)}}if(V("GATEWAY_ADDRESS")&&V("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",V("GATEWAY_ADDRESS"));const h=V("GATEWAY_ADDRESS").map(f=>{var m,_;const E=null!==(m=null===(_=o.addresses.find(y=>y.ip===f.ip&&y.port===f.port))||void 0===_?void 0:_.fingerprint)&&void 0!==m?m:"";return{ip:f.ip,port:f.port,ticket:o.addresses[0]&&o.addresses[0].ticket,fingerprint:E}});o.addresses=h}},nh=(o,r)=>{if(o.response_body&&o.response_body.length){const i=o.response_body[0];if(0!==i.buffer.code){const s=eh(i.buffer.code);throw new L(D.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return i.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",r),new L(D.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Ey=(o,r,i)=>{const s=Math.floor(1e12*Math.random()),u={appid:o.appId,client_ts:Date.now(),opid:s,sid:o.sid,request_bodies:[{uri:22,buffer:{cname:o.cname,detail:{6:o.stringUid,11:r,12:V("USE_NEW_TOKEN")?"1":void 0,22:r},key:o.token,service_ids:i,uid:o.uid||0}}]};u.request_bodies.forEach(h=>{o.multiIP&&o.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[o.multiIP.uni_lbs_ip],vos_ip:[o.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(u)),[d,s]},Vb=(o,r)=>{const i=Math.floor(1e12*Math.random()),s={appid:o.appId,client_ts:Date.now(),opid:i,sid:o.sid,request_bodies:[{uri:28,buffer:{cname:o.cname,detail:{1:"",6:o.stringUid,12:"1"},token:o.token,service_ids:r,uid:o.uid||0,edges_services:o.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},u=new FormData;return u.append("request",JSON.stringify(s)),[u,i]};let Sm=0;function Tm(o,r,i,s){return Cm.apply(this,arguments)}function Cm(){return Cm=M(function*(o,r,i,s){return{gatewayInfo:yield(d=M(function*(h,f,m,_){let E=null;const y=[],T=function(){var w=M(function*(){const P=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(B=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:th()})),k=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(B=>B.url)}),x=yield Zl({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:B=>(R.debug("[".concat(h.clientId,"] Connect to choose_server:"),B.url),Lb(B,h,f,m)),allFailedhandler:B=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},k),B[0]},promisesCollector:y});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},k),x});return function(){return w.apply(this,arguments)}}(),b=function(){var w=M(function*(){if(yield hr(1e3),null!==E)return E;const P=V("WEBCS_DOMAIN_BACKUP_LIST").map(B=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:th()})),k=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(B=>B.url)}),x=yield Zl({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:B=>(R.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),B.url),Lb(B,h,f,m)),allFailedhandler:B=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},k),B[0]},promisesCollector:y});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},k),x});return function(){return w.apply(this,arguments)}}();try{return E=yield zc([T(),b()]),y.length&&y.forEach(w=>w.cancel&&"function"==typeof w.cancel&&w.cancel()),E}catch(w){throw w[0]}}),function(h,f,m,_){return d.apply(this,arguments)})(o,r,i,s)};var d}),Cm.apply(this,arguments)}function Fb(o,r,i,s,u){return vy.apply(this,arguments)}function vy(){return vy=M(function*(o,r,i,s,u){const d=o.cloudProxyServer;if("disabled"===d){if(!s)return;if(o.useLocalAccessPoint)return yield Tm(o,r,i,u);if(V("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:_,proxyInfo:E}=yield jb(o,r,i,u);return o.turnServer&&"auto"!==o.turnServer.mode||(o.turnServer={mode:"manual",servers:E.map(y=>({turnServerURL:y.address,tcpport:y.tcpport||Ro.tcpport,udpport:y.udpport||Ro.udpport,username:y.username||Ro.username,password:y.password||Ro.password,forceturn:!1,security:!0}))}),{gatewayInfo:_}}return yield Tm(o,r,i,u)}const{proxyInfo:h,gatewayInfo:f}=yield jb(o,r,i,u),m={gatewayInfo:f};return o.turnServer={mode:"manual",servers:h.map(_=>({turnServerURL:_.address,tcpport:"proxy3"===d?void 0:_.tcpport?_.tcpport:Ro.tcpport,udpport:"proxy4"===d?void 0:_.udpport?_.udpport:Ro.udpport,username:_.username||Ro.username,password:_.password||Ro.password,forceturn:"proxy4"!==d,security:"proxy5"===d}))},R.debug("[".concat(o.clientId,"] set proxy server: ").concat(o.proxyServer,", mode: ").concat(d)),m}),vy.apply(this,arguments)}function nP(o,r,i,s,u){return yy.apply(this,arguments)}function yy(){return yy=M(function*(o,r,i,s,u){let h=[];h=V("ACCOUNT_REGISTER").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(r.proxyServer?m=>"https://".concat(r.proxyServer,"/ap/?url=").concat(m+"/api/v1"):m=>"https://".concat(m,"/api/v1"));const f=u?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=yield(_=M(function*(E,y,T,b,w){const P=Date.now(),k={sid:T.sid,opid:10,appid:T.appId,string_uid:y};let x=E[0];const B=yield to(()=>Vi(x+"".concat(-1===x.indexOf("?")?"?":"&","action=stringuid"),{data:k,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(H,ce)=>{if(0===H.code){if(H.uid<=0||H.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(y," => ").concat(H.uid),H),he.reqUserAccount(k.sid,{lts:P,success:!1,serverAddr:x,stringUid:k.string_uid,uid:H.uid,errorCode:D.INVALID_UINT_UID_FROM_STRING_UID,extend:k}),new L(D.INVALID_UINT_UID_FROM_STRING_UID);return he.reqUserAccount(k.sid,{lts:P,success:!0,serverAddr:x,stringUid:k.string_uid,uid:H.uid,errorCode:null,extend:k}),!1}const Re=eh(H.code);return Re.retry&&(x=E[(ce+1)%E.length]),he.reqUserAccount(k.sid,{lts:P,success:!1,serverAddr:x,stringUid:k.string_uid,uid:H.uid,errorCode:Re.desc,extend:k}),Re.retry},(H,ce)=>H.code!==D.OPERATION_ABORTED&&(he.reqUserAccount(k.sid,{lts:P,success:!1,serverAddr:x,stringUid:k.string_uid,uid:null,errorCode:H.code,extend:k}),x=E[(ce+1)%E.length],!0),w);if(0!==B.code){const H=eh(B.code);throw new L(D.UNEXPECTED_RESPONSE,H.desc)}return B}),function(E,y,T,b,w){return _.apply(this,arguments)})(h,o,r,i,s);return u?.recordJoinChannelService({status:"success",endTs:Date.now()},f),m.uid}catch(m){throw u?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},f),m}var _}),yy.apply(this,arguments)}function Sy(){return Sy=M(function*(o,r,i){const s=V("CDS_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(f=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(f+"/api/v1"):"https://".concat(f,"/api/v1?action=config")).map(f=>function(m,_,E,y){const T=ut(),b={flag:64,cipher_method:0,features:{device:T.name,system:T.os,system_general:navigator.userAgent,vendor:_.appId,version:no,cname:_.cname,sid:_.sid,session_id:_.sid,detail:"",proxyServer:_.proxyServer}};return to(()=>Vi(m,{data:b,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,w=>w.code!==D.OPERATION_ABORTED,y)}(f,o,r,i));let u=null,d=null,h={};try{u=yield zc(s)}catch(f){if(f.code===D.OPERATION_ABORTED)throw f;d=f}if(s.forEach(f=>f.cancel()),he.reportApiInvoke(o.sid,{name:pn.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:u}}).onSuccess(),u&&u.test_tags)try{h=function(f){if(!f.test_tags)return{};const m=f.test_tags,_=Object.keys(m),E={};return _.forEach(y=>{var T;const b=is(T=y.slice(4)).call(T),w=JSON.parse(m[y])[1];E[b]=w}),E}(u)}catch{}return h}),Sy.apply(this,arguments)}function jb(o,r,i,s){return Ty.apply(this,arguments)}function Ty(){return Ty=M(function*(o,r,i,s){const u=V("PROXY_SERVER_TYPE3"),d=(b,w,P)=>{let k=P||u;return Array.isArray(k)&&(k=w%2==0?u[1]:u[0]),"https://".concat(k,"/ap/?url=").concat(b)};let h=null;const f=[],m=function(){var b=M(function*(){const w=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map((x,B)=>{let H;return H="disabled"===o.cloudProxyServer&&o.proxyServer?d("".concat(x,"/api/v2/transpond/webrtc?v=2"),B,o.proxyServer):"disabled"===o.cloudProxyServer||"fallback"===o.cloudProxyServer?"https://".concat(x,"/api/v2/transpond/webrtc?v=2"):d("".concat(x,"/api/v2/transpond/webrtc?v=2"),B),{url:H,areaCode:th(),serviceIds:[At.CHOOSE_SERVER,"proxy5"===o.cloudProxyServer?At.CLOUD_PROXY_5:"proxy3"===o.cloudProxyServer||"proxy4"===o.cloudProxyServer?At.CLOUD_PROXY:At.CLOUD_PROXY_FALLBACK]}}),P=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:w.map(x=>x.url)}),k=yield Zl({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:x=>(R.debug("[".concat(o.clientId,"] Connect to choose_server:"),x.url),kb(x,o,r,i)),allFailedhandler:x=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:x},P),x[0]},promisesCollector:f});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},P),k});return function(){return b.apply(this,arguments)}}(),_=function(){var b=M(function*(){if(yield hr(1e3),null!==h)return h;const w=V("WEBCS_DOMAIN_BACKUP_LIST").map((x,B)=>{let H;return H="disabled"===o.cloudProxyServer&&o.proxyServer?d("".concat(x,"/api/v2/transpond/webrtc?v=2"),B,o.proxyServer):"disabled"===o.cloudProxyServer||"fallback"===o.cloudProxyServer?"https://".concat(x,"/api/v2/transpond/webrtc?v=2"):d("".concat(x,"/api/v2/transpond/webrtc?v=2"),B),{url:H,areaCode:th(),serviceIds:[At.CHOOSE_SERVER,"proxy5"===o.cloudProxyServer?At.CLOUD_PROXY_5:"proxy3"===o.cloudProxyServer||"proxy4"===o.cloudProxyServer?At.CLOUD_PROXY:At.CLOUD_PROXY_FALLBACK]}}),P=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:w.map(x=>x.url)}),k=yield Zl({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:x=>(R.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),x.url),kb(x,o,r,i)),allFailedhandler:x=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:x},P),x[0]},promisesCollector:f});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},P),k});return function(){return b.apply(this,arguments)}}();let E,y,T;try{({gatewayInfo:E,proxyInfo:y,url:T}=yield zc([m(),_()]))}catch(b){throw b[0]}if(f.length&&f.forEach(b=>b.cancel&&"function"==typeof b.cancel&&b.cancel()),!E||!y)throw new L(D.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(o.apUrl=T,"disabled"!==o.cloudProxyServer&&Array.isArray(u)&&T){const b=/^https?:\/\/(.+?)(\/.*)?$/.exec(T)[1];u.includes(b)&&(o.proxyServer=b,R.setProxyServer(b),he.setProxyServer(b))}return h={gatewayInfo:E,proxyInfo:yield $0(y,E.uid)},h}),Ty.apply(this,arguments)}function Ed(o,r,i,s){return Cy.apply(this,arguments)}function Cy(){return Cy=M(function*(o,r,i,s){const u=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(d=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"));return yield function tP(o,r,i,s,u){gy+=1;const d={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:gy,requestId:gy,version:no,cname:i.cname},h={service_name:r,json_body:JSON.stringify(d)};let f,m,_=o[0];return to(M(function*(){f=Date.now();const E=yield Vi(_,{data:h,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-f,0!==E.code){const b=new L(D.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw R.error(b.toString()),b}const y=JSON.parse(E.json_body);if(200!==y.code){const b=new L(D.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(y.code,", reason: ").concat(y.reason),{code:y.code,responseTime:m});throw R.error(b.toString()),b}if(!y.servers||0===y.servers.length){const b=new L(D.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:y.code,responseTime:m});throw R.error(b.toString()),b}const T=(w=r,{addressList:(b=y).servers.map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(P.wss,"?serviceName=").concat(encodeURIComponent(w))),workerToken:b.workerToken,vid:b.vid});var b,w;return V("LIVE_STREAMING_ADDRESS")&&(T.addressList=V("LIVE_STREAMING_ADDRESS")instanceof Array?V("LIVE_STREAMING_ADDRESS"):[V("LIVE_STREAMING_ADDRESS")]),Mb(Mb({},T),{},{responseTime:m})}),(E,y)=>(he.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(E.addressList),firstSuccess:0===y,responseTime:m,serverIp:o[y%o.length]}),!1),(E,y)=>(he.apworkerEvent(i.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:r,responseTime:m,serverIp:o[y%o.length]}),!!(E.code!==D.OPERATION_ABORTED&&E.code!==D.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(_=o[(y+1)%o.length],!0)),u)}(u,o,r,i,s)}),Cy.apply(this,arguments)}function Cn(){return Cn=M(function*(o,r,i){const s=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(u=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")).map(u=>function(d,h,f,m){const _={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:no,cname:h.cname,uid:h.uid.toString(),requestId:_y,seq:_y};_y+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(_)};return to(M(function*(){const y=yield Vi(d,{data:E,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==y.code){const b=new L(D.UNEXPECTED_RESPONSE,"cross channel ap error, code"+y.code,{retry:!0});throw R.error(b.toString()),b}const T=JSON.parse(y.json_body);if(200!==T.code){const b=new L(D.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw R.error(b.toString()),b}if(!T.servers||0===T.servers.length){const b=new L(D.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(b.toString()),b}return{vid:T.vid,workerToken:T.workerToken,addressList:(V("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(b=>"wss://".concat(b.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(b.wss))}}),void 0,y=>!!(y.code!==D.OPERATION_ABORTED&&y.code!==D.UNEXPECTED_RESPONSE||y.data&&y.data.retry),m)}(u,o,r,i));try{const u=yield zc(s);return s.forEach(d=>d.cancel()),u}catch(u){throw u[0]}}),Cn.apply(this,arguments)}function rh(){return rh=M(function*(o,r,i){let s=null;const u=[],d=function(){var h=M(function*(f){const m=V(f?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return f&&(yield hr(1e3),null!==s)?s:yield Zl({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(R.debug("[".concat(o.clientId,"] update ticket, Connect to ").concat(f?"backup":""," choose_server:"),_),function(E,y,T,b){const[w]=Vb(y,[At.CHOOSE_SERVER]);let P=sn.networkState;return to(M(function*(){P&&sn.networkState===cr.OFFLINE&&sn.onlineWaiter&&(yield ie.race([sn.onlineWaiter,hr(b&&b.maxRetryTimeout||vn.maxRetryTimeout)])),P=sn.networkState;const k=yield Vi(E,{data:w,cancelToken:T,headers:{"Content-Type":"multipart/form-data;"}},!0);return nh(k,E)}),()=>!1,k=>k.code!==D.OPERATION_ABORTED&&(k.code===D.UPDATE_TICKET_FAILED?k.data.retry:(R.warning("[".concat(y.clientId,"] update ticket network error, retry"),k),!0)),b)}(_,o,r,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:u})});return function(m){return h.apply(this,arguments)}}();try{return s=yield zc([d(!1),d(!0)]),u.length&&u.forEach(h=>h.cancel&&"function"==typeof h.cancel&&h.cancel()),s}catch(h){throw h[0]}}),rh.apply(this,arguments)}function Ss(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function Bb(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?Ss(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Ss(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class iP extends Lt{constructor(){super(),S(this,"configs",void 0),S(this,"joinInfo",void 0),S(this,"cancelToken",void 0),S(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),S(this,"interval",void 0),S(this,"mutex",new Mn("config-distribute")),S(this,"mutableParamsRead",!1)}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),V("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},V("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var r=this;return M(function*(){r.mutex.isLocked&&(yield r.mutex.lock())()})()}updateConfigDistribute(){var r=this;return M(function*(){if(r.mutableParamsRead||(r.mutableParamsRead=!0,he.reportApiInvoke(null,{options:void 0,name:pn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:xt.TRACER}).onSuccess(JSON.stringify(Ac))),!r.joinInfo||!r.cancelToken||!r.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let i;const s=yield r.mutex.lock();try{i=yield function rP(o,r,i){return Sy.apply(this,arguments)}(r.joinInfo,r.cancelToken,r.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(i)),i.limit_bitrate&&r.handleBitrateLimit(i.limit_bitrate),r.cacheGlobalParameterConfig(i),r.configs=i}catch(u){const d=new L(D.NETWORK_RESPONSE_ERROR,u);R.warning("[config-distribute] ".concat(d.toString()))}finally{s()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(r){var i;(i=r)&&i.uplink&&i.id&&void 0!==i.uplink.max_bitrate&&void 0!==i.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==r.id&&this.emit(Uc.UPDATE_BITRATE_LIMIT,r):this.emit(Uc.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&Bb({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(r){var i;const s=Wf(i=Object.keys(r).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(i);for(let d=0;d<s.length;d++)for(let h=s.length-1;h>d;h--){const f=s[h];if("number"==typeof r[f].__priority){const _=s[h-1];if("number"==typeof r[_].__priority){if(!(r[f].__priority>r[_].__priority))continue;{const E=f;s[h]=s[h-1],s[h-1]=E}}else{const E=f;s[h]=s[h-1],s[h-1]=E}}}const u={};s.forEach(d=>{const h=r[d],f=h.__expires;Object.keys(h).forEach(m=>{"__priority"===m||"__expires"===m||Object.prototype.hasOwnProperty.call(u,m)||(u[m]=Bb({value:h[m]},f&&{expires:f}))})});try{const d=JSON.stringify(u),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),R.debug("Caching global parameters ".concat(d))}catch(d){R.error("Error caching global parameters:",d.message)}}}function Hb(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function Va(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?Hb(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Hb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Gb extends Lt{constructor(r,i,s,u){super(),S(this,"spec",void 0),S(this,"token",void 0),S(this,"websocket",void 0),S(this,"pingpongTimer",void 0),S(this,"reconnectMode","retry"),S(this,"serviceMode",void 0),S(this,"reqId",0),S(this,"commandReqId",0),S(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),S(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):this.serviceMode===tn.INJECT?this.emit(Bo.INJECT_STREAM_STATUS,h):(he.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===tn.TRANSCODE?1:2}),this.emit(Bo.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=r,this.serviceMode=u,this.websocket=new Ua("live-streaming",s),this.websocket.on(we.CONNECTED,this.handleWebSocketOpen),this.websocket.on(we.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(we.REQUEST_NEW_URLS,(d,h)=>{zn(this,Bo.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(we.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}request(r,i,s,u){var d=this;return M(function*(){d.reqId+=1,"request"===r&&(d.commandReqId+=1);const h=d.commandReqId,f=d.reqId;if(!f||!d.websocket)throw new L(D.UNEXPECTED_ERROR);const m=Va({command:r,sdkVersion:"4.18.0"===no?"0.0.1":no,seq:f,requestId:f,allocate:s,cname:d.spec.cname,appId:d.spec.appId,sid:d.spec.sid,uid:d.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if("closed"===d.websocket.state)throw new L(D.WS_DISCONNECT);const _=()=>new ie((b,w)=>{d.websocket.once(we.CLOSED,()=>w(new L(D.WS_ABORT))),d.websocket.once(we.CONNECTED,b)});"connected"!==d.websocket.state&&(yield _()),m.clientRequest&&(m.clientRequest.workerToken=d.token);const E=new ie((b,w)=>{const P=()=>{w(new L(D.WS_ABORT))};d.websocket.once(we.RECONNECTING,P),d.websocket.once(we.CLOSED,P),d.once("@".concat(f,"-").concat(d.spec.sid),k=>{b(k)})});u&&he.workerEvent(d.spec.sid,Va(Va({},u),{},{requestId:h,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const y=Date.now();d.websocket.sendMessage(m);let T=null;try{T=yield E}catch(b){if("closed"===d.websocket.state)throw b;return yield _(),yield d.request(r,i,s)}return u&&he.workerEvent(d.spec.sid,Va(Va({},u),{},{requestId:h,actionType:"response",payload:JSON.stringify(T.serverResponse),serverCode:T.code,success:200===T.code,responseTime:Date.now()-y})),200!==T.code&&d.handleResponseError(T),T})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r="4.18.0"===no?"0.0.1":no;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case qt.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case qt.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case qt.LIVE_STREAM_RESPONSE_BAD_STREAM:case qt.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new L(D.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case qt.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===r.serverResponse.command||"UninjectStream"===r.serverResponse.command)return;throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case qt.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new L(D.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case qt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new L(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Bo.WARNING,i,r.serverResponse.url)}case qt.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new L(D.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Bo.WARNING,i,r.serverResponse.url)}case qt.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case qt.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new L(D.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case qt.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new L(D.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Bo.WARNING,i,r.serverResponse.url)}case qt.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case qt.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case qt.LIVE_STREAM_RESPONSE_WORKER_LOST:case qt.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===r.serverResponse.command||"UninjectStream"===r.serverResponse.command)return;throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case qt.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===r.serverResponse.command||"UninjectStream"===r.serverResponse.command)return;if("UpdateTranscoding"===r.serverResponse.command||"ControlStream"===r.serverResponse.command)return new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case qt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case qt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case qt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case qt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new L(D.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(hm)},6e3)}}function Wb(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function Ur(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?Wb(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Wb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Ry extends Lt{constructor(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vn,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vn;super(),S(this,"onLiveStreamWarning",void 0),S(this,"onLiveStreamError",void 0),S(this,"onInjectStatusChange",void 0),S(this,"spec",void 0),S(this,"retryTimeout",1e4),S(this,"connection",void 0),S(this,"httpRetryConfig",void 0),S(this,"wsRetryConfig",void 0),S(this,"streamingTasks",new Map),S(this,"isStartingStreamingTask",!1),S(this,"taskMutex",new Mn("live-streaming")),S(this,"cancelToken",Ni.CancelToken.source()),S(this,"transcodingConfig",void 0),S(this,"injectConfig",Ur({},fR)),S(this,"injectLoopTimes",0),S(this,"uapResponse",void 0),S(this,"lastTaskId",1),S(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=s,this.wsRetryConfig=i}setTranscodingConfig(r){var i=this;return M(function*(){const s=Ur(Ur({},pR),r);var f;66!==s.videoCodecProfile&&77!==s.videoCodecProfile&&100!==s.videoCodecProfile&&(R.debug("[".concat(i.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(f=>Ur(Ur(Ur({},hR),f),{},{zOrder:f.zOrder?f.zOrder+1:1}))),Dt((f=s).width)||Rt(f.width,"config.width",0,1e4),Dt(f.height)||Rt(f.height,"config.height",0,1e4),Dt(f.videoBitrate)||Rt(f.videoBitrate,"config.videoBitrate",1,1e6),Dt(f.videoFrameRate)||Rt(f.videoFrameRate,"config.videoFrameRate"),Dt(f.lowLatency)||td(f.lowLatency,"config.lowLatency"),Dt(f.audioSampleRate)||Nn(f.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Dt(f.audioBitrate)||Rt(f.audioBitrate,"config.audioBitrate",1,128),Dt(f.audioChannels)||Nn(f.audioChannels,"config.audioChannels",[1,2,3,4,5]),Dt(f.videoGop)||Rt(f.videoGop,"config.videoGop"),Dt(f.videoCodecProfile)||Nn(f.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Dt(f.userCount)||Rt(f.userCount,"config.userCount",0,17),Dt(f.backgroundColor)||Rt(f.backgroundColor,"config.backgroundColor",0,16777215),Dt(f.userConfigExtraInfo)||sr(f.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),f.transcodingUsers&&!Dt(f.transcodingUsers)&&(Ra(f.transcodingUsers,"config.transcodingUsers"),f.transcodingUsers.forEach((m,_)=>{pv(m.uid),Dt(m.x)||Rt(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Dt(m.y)||Rt(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Dt(m.width)||Rt(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Dt(m.height)||Rt(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Dt(m.zOrder)||Rt(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Dt(m.alpha)||Rt(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Dt(f.watermark)||zf(f.watermark,"watermark"),Dt(f.backgroundImage)||zf(f.backgroundImage,"backgroundImage"),f.images&&!Dt(f.images)&&(Ra(f.images,"config.images"),f.images.forEach((m,_)=>{zf(m,"images[".concat(_,"]"))}));const u=[];s.images&&u.push(...s.images.map(f=>Ur(Ur(Ur({},$f),f),{},{zOrder:255}))),s.backgroundImage&&(u.push(Ur(Ur(Ur({},$f),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(u.push(Ur(Ur(Ur({},$f),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=u,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(f=>Ur({},f)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const d=(s.userConfigs||[]).map(f=>"number"==typeof f.uid?ie.resolve(f.uid):nP(f.uid,i.spec,i.cancelToken.token,i.httpRetryConfig));if((yield ie.all(d)).forEach((f,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=f)}),i.transcodingConfig=s,i.connection)try{var h;const f=yield i.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:i.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Fi(h=i.streamingTasks).call(h)).map(m=>m.taskId).join("#")});R.debug("[".concat(i.spec.clientId,"] update live transcoding config success, code: ").concat(f.code,", config:"),JSON.stringify(i.transcodingConfig))}catch(f){if(!f.data||!f.data.retry)throw f;f.data.changeAddress&&i.connection.tryNextAddress(),i.streamingTasks.forEach(m=>{R.warning("[".concat(i.spec.clientId,"] live streaming receive error"),f.toString(),"try to republish",m.url),i.startLiveStreamingTask(m.url,m.mode,f).then(()=>{R.debug("[".concat(i.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{R.error("[".concat(i.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),i.onLiveStreamError&&i.onLiveStreamError(m.url,_)})})}})()}setInjectStreamConfig(r,i){this.injectConfig=Object.assign({},this.injectConfig,r),this.injectLoopTimes=i}startLiveStreamingTask(r,i,s){var u=this;return M(function*(){var d;if(Array.from(Fi(d=u.streamingTasks).call(d)).find(_=>_.mode===tn.INJECT)&&i===tn.INJECT)return new L(D.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!u.transcodingConfig&&i===tn.TRANSCODE)throw new L(D.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let h={command:"PublishStream",ts:Date.now(),url:r,uid:u.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(u.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));const f=yield u.taskMutex.lock();if(!u.connection&&s)return void f();if(u.streamingTasks.get(r)&&!s)return f(),new L(D.LIVE_STREAMING_TASK_CONFLICT).throw();try{u.connection||(u.connection=yield u.connect(i))}catch(_){throw f(),_}switch(i){case tn.TRANSCODE:h.transcodingConfig=Ur({},u.transcodingConfig);break;case tn.RAW:break;case tn.INJECT:h={cname:u.spec.cname,command:"InjectStream",sid:u.spec.sid,transcodingConfig:u.injectConfig,ts:Date.now(),url:r,loopTimes:u.injectLoopTimes}}u.uapResponse&&u.uapResponse.vid&&(h.vid=u.uapResponse.vid),u.isStartingStreamingTask=!0;const m=u.lastTaskId++;try{const _=new ie((y,T)=>{hr(u.retryTimeout).then(()=>{if(s)return T(s);const b=u.statusError.get(r);return b?(u.statusError.delete(r),T(b)):void 0})}),E=yield ie.race([u.connection.request("request",{clientRequest:h},!0,{url:r,command:"PublishStream",workerType:i===tn.TRANSCODE?1:2,requestByUser:!s,tid:m.toString()}),_]);u.isStartingStreamingTask=!1,R.debug("[".concat(u.spec.clientId,"] live streaming started, code: ").concat(E.code)),u.streamingTasks.set(r,{clientRequest:h,mode:i,url:r,taskId:m}),f()}catch(_){if(f(),u.isStartingStreamingTask=!1,!_.data||!_.data.retry||s)throw _;return _.data.changeAddress?(u.connection.tryNextAddress(),yield u.startLiveStreamingTask(r,i,_)):yield u.startLiveStreamingTask(r,i,_)}})()}stopLiveStreamingTask(r){return new ie((i,s)=>{const u=this.streamingTasks.get(r);if(!u||!this.connection)return new L(D.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=u.mode;u.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:d===tn.INJECT?"UninjectStream":"UnpublishStream",url:u.url}},!1,{url:r,command:"UnPublishStream",workerType:d===tn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),0===this.streamingTasks.size&&d!==tn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),i(),d===tn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Ks.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,r)}).catch(s)})}controlInjectStream(r,i,s,u){var d=this;return M(function*(){const h=d.streamingTasks.get(r);if(!h||!d.connection||h.mode!==tn.INJECT)throw new L(D.INVALID_OPERATION,"can not find inject stream task to control");return(yield d.connection.request("request",{clientRequest:{command:"ControlStream",url:r,control:i,audioVolume:s,position:u}})).serverResponse})()}resetAllTask(){var r;const i=Array.from(Fi(r=this.streamingTasks).call(r));this.terminate();for(const s of i)this.startLiveStreamingTask(s.url,s.mode).catch(u=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,u)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ni.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(r){var i=this;return M(function*(){if(i.connection)throw new L(D.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=yield zn(i,wa.REQUEST_WORKER_MANAGER_LIST,r);return i.uapResponse=s,i.connection=new Gb(s.workerToken,i.spec,i.wsRetryConfig,r),i.connection.on(Bo.WARNING,(u,d)=>i.onLiveStreamWarning&&i.onLiveStreamWarning(d,u)),i.connection.on(Bo.PUBLISH_STREAM_STATUS,u=>i.handlePublishStreamServer(u)),i.connection.on(Bo.INJECT_STREAM_STATUS,u=>i.handleInjectStreamServerStatus(u)),i.connection.on(Bo.REQUEST_NEW_ADDRESS,(u,d)=>{if(!i.connection)return d(new L(D.UNEXPECTED_ERROR,"can not get new live streaming address list"));zn(i,wa.REQUEST_WORKER_MANAGER_LIST,r).then(h=>{i.uapResponse=h,u(h.addressList)}).catch(d)}),yield i.connection.init(s.addressList),i.connection})()}handlePublishStreamServer(r){const i=r.serverStatus&&r.serverStatus.url||"empty_url",s=this.streamingTasks.get(i),u=r.reason;switch(r.code){case qt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case qt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case qt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case qt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new L(D.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(s)return R.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case qt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new L(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,u);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case qt.LIVE_STREAM_RESPONSE_WORKER_LOST:case qt.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Fi(d=this.streamingTasks).call(d));for(const f of h)f.abortTask?f.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(m=>{R.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,m)}));return}}}handleInjectStreamServerStatus(r){const i=Number(r.uid),s=r.serverStatus&&r.serverStatus.url;switch(r.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Ks.INJECT_STREAM_STATUS_START_SUCCESS,i,s));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Ks.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,i,s),void this.streamingTasks.delete(s);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Ks.INJECT_STREAM_STATUS_START_UNAUTHORIZED,i,s),void this.streamingTasks.delete(s);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Ks.INJECT_STREAM_STATUS_BROKEN,i,s),void this.streamingTasks.delete(s);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Ks.INJECT_STREAM_STATUS_START_TIMEOUT,i,s),void this.streamingTasks.delete(s);default:return void R.debug("inject stream server status",r)}}hasUrl(r){return this.streamingTasks.has(r)}}class Kb{constructor(){S(this,"destChannelMediaInfos",new Map),S(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){cd(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){cd(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){hv(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function qb(o){if(!(o instanceof Kb))return new L(D.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=o.getSrcChannelMediaInfo(),i=o.getDestChannelMediaInfo();return r?0===i.size?new L(D.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new L(D.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class $b extends Lt{constructor(r,i,s){super(),S(this,"ws",void 0),S(this,"requestId",1),S(this,"heartBeatTimer",void 0),S(this,"joinInfo",void 0),S(this,"clientId",void 0),S(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),S(this,"onClose",u=>{this.emit("close"),this.dispose()}),S(this,"onMessage",u=>{const d=JSON.parse(u.data);if(!d||"serverResponse"!==d.command||!d.requestId)return d&&"serverStatus"===d.command&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=r,this.clientId=i,this.ws=new Ua("cross-channel-".concat(this.clientId),s),this.ws.on(we.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(we.CONNECTED,this.onOpen),this.ws.on(we.ON_MESSAGE,this.onMessage),this.ws.on(we.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(r){const i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new ie((i,s)=>{const u=window.setTimeout(()=>{s(new L(D.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,d=>{window.clearTimeout(u),d.state&&0!==d.state?s(new L(D.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(u),s(new L(D.WS_ABORT))})})}request(r){var i=this;return M(function*(){if("closed"===i.ws.state)throw new L(D.WS_DISCONNECT);"connected"!==i.ws.state&&(yield new ie((f,m)=>{i.ws.once(we.CLOSED,()=>m(new L(D.WS_ABORT))),i.ws.once(we.CONNECTED,f)}));const u=i.sendMessage(r),d=new ie((f,m)=>{const _=()=>{m(new L(D.WS_ABORT))};i.ws.once(we.RECONNECTING,_),i.ws.once(we.CLOSED,_),i.once("req_".concat(u),f),hr(3e3).then(()=>{i.removeAllListeners("req_".concat(u)),i.ws.off(we.RECONNECTING,_),i.ws.off(we.CLOSED,_),m(new L(D.TIMEOUT,"cross channel ws request timeout"))})}),h=yield d;if(!h||200!==h.code)throw new L(D.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h})()}connect(r){var i=this;return M(function*(){i.ws.removeAllListeners(we.REQUEST_NEW_URLS),i.ws.on(we.REQUEST_NEW_URLS,s=>{s(r)}),yield i.ws.init(r)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class sP extends Lt{set state(r){r!==this._state&&(r!==br.RELAY_STATE_FAILURE&&(this.errorCode=kc.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,s,u,d){var h;super(),h=this,S(this,"joinInfo",void 0),S(this,"sid",void 0),S(this,"clientId",void 0),S(this,"cancelToken",Ni.CancelToken.source()),S(this,"workerToken",void 0),S(this,"requestId",0),S(this,"signal",void 0),S(this,"prevChannelMediaConfig",void 0),S(this,"httpRetryConfig",void 0),S(this,"_resolution",void 0),S(this,"_state",br.RELAY_STATE_IDLE),S(this,"errorCode",kc.RELAY_OK),S(this,"onStatus",f=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(f))),f&&f.command&&("onAudioPacketReceived"===f.command&&this.emit("event",Li.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===f.command&&this.emit("event",Li.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===f.command&&(this.errorCode=kc.SRC_TOKEN_EXPIRED,this.state=br.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===f.command&&(this.errorCode=kc.DEST_TOKEN_EXPIRED,this.state=br.RELAY_STATE_FAILURE))}),S(this,"onReconnect",M(function*(){R.debug("[".concat(h.clientId,"] ChannelMediaSocket disconnect, reconnecting")),h.emit("event",Li.NETWORK_DISCONNECTED),h.state=br.RELAY_STATE_IDLE,h.prevChannelMediaConfig&&h.sendStartRelayMessage(h.prevChannelMediaConfig).catch(f=>{h.state!==br.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",f.toString()),h.errorCode=kc.SERVER_CONNECTION_LOST,h.state=br.RELAY_STATE_FAILURE)})})),this.joinInfo=r,this.clientId=i,this.sid=cy(),this.signal=new $b(this.joinInfo,this.clientId,s),this.httpRetryConfig=u,this._resolution=d}startChannelMediaRelay(r){var i=this;return M(function*(){if(i.state!==br.RELAY_STATE_IDLE)throw new L(D.INVALID_OPERATION);i.state=br.RELAY_STATE_CONNECTING,yield i.connect(),R.debug("[".concat(i.clientId,"] startChannelMediaRelay: connect success"));try{yield i.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&"SetSourceChannel"===s.data.serverResponse.command?new L(D.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&"SetDestChannelStatus"===s.serverResponse.command?new L(D.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&"StartPacketTransfer"===s.serverResponse.command?new L(D.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}i.prevChannelMediaConfig=r})()}updateChannelMediaRelay(r){var i=this;return M(function*(){if(i.state!==br.RELAY_STATE_RUNNING)throw new L(D.INVALID_OPERATION);yield i.sendUpdateMessage(r),i.prevChannelMediaConfig=r})()}setVideoProfile(r){var i=this;return M(function*(){if(i._resolution=r,i.state!==br.RELAY_STATE_RUNNING)throw new L(D.INVALID_OPERATION);const s=i.genMessage(Sr.SetVideoProfile);yield i.signal.request(s),R.debug("[".concat(i.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var r=this;return M(function*(){yield r.sendStopRelayMessage(),R.debug("[".concat(r.clientId,"] stopChannelMediaRelay: send stop message success")),r.state=br.RELAY_STATE_IDLE,r.dispose()})()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ni.CancelToken.source(),this.state=br.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var r=this;return M(function*(){const i=yield function Iy(o,r,i){return Cn.apply(this,arguments)}(r.joinInfo,r.cancelToken.token,r.httpRetryConfig);r.workerToken=i.workerToken,yield r.signal.connect(i.addressList),r.emit("event",Li.NETWORK_CONNECTED),r.signal.on("status",r.onStatus),r.signal.on("reconnecting",r.onReconnect)})()}sendStartRelayMessage(r){var i=this;return M(function*(){const s=i.genMessage(Sr.StopPacketTransfer);yield i.signal.request(s),yield i.signal.waitStatus("Normal Quit"),R.debug("[".concat(i.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const u=i.genMessage(Sr.SetSdkProfile,r);yield i.signal.request(u),R.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const d=i.genMessage(Sr.SetSourceChannel,r);yield i.signal.request(d),yield i.signal.waitStatus("SetSourceChannelStatus"),i.emit("event",Li.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=i.genMessage(Sr.SetSourceUserId,r);yield i.signal.request(h),R.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const f=i.genMessage(Sr.SetDestChannel,r);yield i.signal.request(f),yield i.signal.waitStatus("SetDestChannelStatus"),i.emit("event",Li.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=i.genMessage(Sr.StartPacketTransfer,r);yield i.signal.request(m),i.emit("event",Li.PACKET_SENT_TO_DEST_CHANNEL),i.state=br.RELAY_STATE_RUNNING,R.debug("[".concat(i.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),i.setVideoProfile(i._resolution)})()}sendUpdateMessage(r){var i=this;return M(function*(){const s=i.genMessage(Sr.UpdateDestChannel,r);yield i.signal.request(s),i.emit("event",Li.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(i.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var r=this;return M(function*(){const i=r.genMessage(Sr.StopPacketTransfer);yield r.signal.request(i),R.debug("[".concat(r.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(r,i){const s=[],u=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:no,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.18.0"===h.sdkVersion&&(h.sdkVersion="0.0.1");let f=null,m=null;switch(r){case Sr.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Sr.SetSourceChannel:if(m=i&&i.getSrcChannelMediaInfo(),!m)throw new L(D.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case Sr.SetSourceUserId:if(m=i&&i.getSrcChannelMediaInfo(),!m)throw new L(D.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case Sr.SetDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new L(D.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(_=>{s.push(_.channelName),u.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:s,uid:u,token:d},h;case Sr.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Sr.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Sr.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Sr.UpdateDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new L(D.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(_=>{s.push(_.channelName),u.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:s,uid:u,token:d},h;case Sr.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const by=o=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new ie((i,s)=>{r.toBlob(function(){var u=M(function*(d){if(r.remove(),d){const h=yield Ay(d);i({buffer:h,width:r.width,height:r.height})}else s(new L(D.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(d){return u.apply(this,arguments)}}(),o,1)})},Ay=function(){var o=M(function*(r){const i=yield r.arrayBuffer();return new Uint8Array(i)});return function(i){return o.apply(this,arguments)}}();function li(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function zb(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?li(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):li(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Dy{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}constructor(r){S(this,"trackId",void 0),S(this,"config",void 0),S(this,"onFirstVideoFrameDecoded",void 0),S(this,"freezeTimeCounterList",[]),S(this,"renderFreezeAccTime",0),S(this,"isKeepLastFrame",!1),S(this,"timeUpdatedCount",0),S(this,"freezeTime",0),S(this,"playbackTime",0),S(this,"lastTimeUpdatedTime",0),S(this,"autoplayFailed",!1),S(this,"videoTrack",void 0),S(this,"videoElement",void 0),S(this,"cacheVideoElement",void 0),S(this,"videoElementCheckInterval",void 0),S(this,"_videoElementStatus",qe.NONE),S(this,"isGettingVideoDimensions",!1),S(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),S(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===tt.curState&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Se())),RE()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),S(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=qe.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=qe.CANPLAY;break;case"stalled":this.videoElementStatus=qe.STALLED;break;case"suspend":this.videoElementStatus=qe.SUSPEND;break;case"pause":this.videoElementStatus=qe.PAUSED,vr()||Wr()||or()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=qe.WAITING;break;case"abort":this.videoElementStatus=qe.ABORT;break;case"ended":this.videoElementStatus=qe.ENDED;break;case"emptied":this.videoElementStatus=qe.EMPTIED;break;case"error":{this.videoElementStatus=qe.ERROR;const s=this.videoElement.error;s&&R.error("[".concat(this.trackId,"] media error, code: ").concat(s.code,", message: ").concat(s.message));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const u=s-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,Es.lastVisibleTime<Es.lastHiddenTime||d<Es.lastHiddenTime||d<Es.lastVisibleTime)return;for(u>V("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=u),this.playbackTime+=u;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),S(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Se())),RE()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,this.videoElement=r.element instanceof HTMLVideoElement?r.element:document.createElement("video"),tt.on(Tn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tt.on(Tn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return null!==(r=this.videoElement.parentElement)&&void 0!==r?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const i=this.videoElement.play();i&&i.catch&&i.catch(u=>{r&&he.autoplayFailed(r,"video",u.message,this.trackId),"NotAllowedError"===u.name?(R.warning("detected video element autoplay failed",u),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),u)});const s=ut();if(("Safari"===s.name&&15===Number(s.version)||Ta())&&i&&i.then&&i.catch){const u=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(u).catch(u)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");if(!i)return R.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);const s=i.getImageData(0,0,r.width,r.height);return r.remove(),s}getCurrentFrameToUint8Array(r){var i=arguments,s=this;return M(function*(){let u=i.length>1&&void 0!==i[1]?i[1]:1;const d=document.createElement("canvas");d.width=s.videoElement.videoWidth,d.height=s.videoElement.videoHeight;const h=d.getContext("2d");return h?(h.drawImage(s.videoElement,0,0,d.width,d.height),new ie((f,m)=>{d.toBlob(function(){var _=M(function*(E){if(d.remove(),E){const y=yield Ay(E);f({buffer:y,width:d.width,height:d.height})}else m(new L(D.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(E){return _.apply(this,arguments)}}(),r,u<0?.1:u>1?1:u)})):yield by(r)})()}destroy(){tt.off(Tn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tt.off(Tn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=qe.INIT,!this.videoElementCheckInterval&&(wy.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var d;(d=this.videoElement)!==document.body&&document.body.contains(d)||(this.videoElementStatus=qe.DESTROYED)},1e3),V("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let d;const h=(f,m)=>{if(this.videoElementStatus===qe.PLAYING){if(d){const y=m.presentationTime-d.presentationTime;y>V("VIDEO_FREEZE_DURATION")&&Es.lastVisibleTime>=Es.lastHiddenTime&&d.timestamp>Es.lastVisibleTime&&d.timestamp>Es.lastHiddenTime&&(this.renderFreezeAccTime+=y)}d=zb(zb({},m),{},{timestamp:f})}var _,E;V("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(_=(E=this.videoElement).requestVideoFrameCallback)||void 0===_||_.call(E,h))};null===(r=(i=this.videoElement).requestVideoFrameCallback)||void 0===r||r.call(i,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Of()&&(this.videoElement.poster="noposter");const s=ut();"Safari"===s.name&&15===Number(s.version)||Ta()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Bt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Bt()&&this.videoElement.load());const u=this.videoElement.play();void 0!==u&&u.catch(d=>{R.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){wy.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=qe.NONE}handleAutoPlayFailed(){const r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{R.error(s)}),this.autoplayFailed=!1,_c()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};_c()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),FR()}}const wy=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Oy extends Dy{constructor(r){super(r),S(this,"container",void 0),S(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const i=r.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(r){var i=arguments,s=()=>super.getCurrentFrameToUint8Array,u=this;return M(function*(){var d;let h=i.length>1&&void 0!==i[1]?i[1]:1;return null!==(d=u.container)&&void 0!==d&&d.contains(u.videoElement)?yield s().call(u,r,h):yield by(r)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",V("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if(null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function vd(o){const r={};o.facingMode&&(r.facingMode=o.facingMode),o.cameraId&&(r.deviceId={exact:o.cameraId});const i=bc(o.encoderConfig);return r.width=i.width,r.height=i.height,!wf()&&i.frameRate&&(r.frameRate=i.frameRate),ut().name===it.EDGE&&"object"==typeof r.frameRate&&(r.frameRate.max=60),Bt()&&(r.frameRate={ideal:30,max:30}),r}function Jb(o){const r={};if(wf()||(void 0!==o.AGC&&(r.autoGainControl=o.AGC),void 0!==o.AEC&&(r.echoCancellation=o.AEC),void 0!==o.ANS&&(r.noiseSuppression=o.ANS,If()&&o.ANS&&(r.googHighpassFilter=o.ANS))),o.encoderConfig){const i=Bf(o.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return o.microphoneId&&(r.deviceId={exact:o.microphoneId}),Of()&&(r.sampleRate=void 0),r}var Yc,oh;(function(o){o.COVERED="COVERED",o.POSITION="POSITION",o.SIZE="SIZE",o.STYLE="STYLE"})(Yc||(Yc={})),function(o){o.UNMOUNTED="UNMOUNTED",o.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(oh||(oh={}));var Xb,Qb,Im,Rm,Ny,bm,Am,Zb,eA,tA,nA,Py,Dm,ih,wm,My,sh,rA,Ly,ky,oA,xy,iA,$r,Me,sA,aA,aP,cP,Uy,Om,yd,cA,co,uA=new class{constructor(){S(this,"_clientSize",null),S(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),S(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),S(this,"getStyle",o=>window.getComputedStyle(o,null)),S(this,"checkCssVisibleProperty",o=>{let r=!0;const i=this.getStyle(o),{display:s,visibility:u,opacity:d,filter:h}=i;return("none"===s||["hidden","collapse"].includes(u)||Number(d)<.1)&&(r=!1),!!r&&(h&&h.split(" ").filter(f=>{const m=f.split("(")[0];return["brightness","blur","opacity"].includes(m)}).map(f=>{const[m,_]=f.split(/\(|\)/);return[m,Number(_.match(/^[0-9\.]+/))]}).forEach(f=>{const[m,_]=f;switch(m){case"brightness":(_<.1||_>3)&&(r=!1);break;case"blur":_>3&&(r=!1);break;case"opacity":_<.1&&(r=!1)}}),r)}),S(this,"checkPropertyUpToAllParentNodes",(o,r)=>{let i=!0,s=!0;let d=o;for(;d&&s;)r(d)||(i=!1,s=!1),d=d.parentElement,d||(s=!1);return i}),S(this,"checkActualCssVisibleIncludeInherit",o=>this.checkPropertyUpToAllParentNodes(o,this.checkCssVisibleProperty)),S(this,"getSizeAboutClient",o=>{const{width:r,height:i,left:s,right:u,top:d,bottom:h}=o.getBoundingClientRect(),f=this.getClientWidth(),m=this.getClientHeight();return{width:r,height:i,left:s,right:u,top:d,bottom:h,clientWidth:f,clientHeight:m,clientMin:Math.min(f,m)}}),S(this,"checkActualSize",()=>{const{width:o,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(o,r,i)}),S(this,"elementFromPoint",(o,r)=>document.elementFromPoint?document.elementFromPoint(o,r):null),S(this,"checkCoverForAPoint",(o,r,i)=>{const s=this.elementFromPoint(o,r);return null!==s&&s!==i}),S(this,"getPointPositionList",()=>{const{width:o,height:r,left:i,top:s}=this._clientSize,u=o/6,d=r/6,h=[],f=10**6;for(let m=0;m<5;m++)for(let _=0;_<5;_++)h.push({x:(i*f+(0===m?.1:4===m?(u*m*f-1e5)/f:u*m)*f)/f,y:(s*f+(0===_?.1:4===_?(d*_*f-1e5)/f:d*_)*f)/f});return[...h]}),S(this,"checkElementCover",o=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,o)).filter(r=>!!r).length>6),S(this,"checkSizeIsVisible",(o,r,i)=>(o>50||i/o<=10)&&(r>50||i/r<=10)),S(this,"checkSizeOfPartInClient",()=>{const{left:o,right:r,top:i,bottom:s,clientHeight:u,clientWidth:d,clientMin:h}=this._clientSize;let f,m,_,E;if(o<0)f=0;else{if(!(o<d))return!1;f=o}if(r<0)return!1;if(m=r<d?r:d,i<0)_=0;else{if(!(i<u))return!1;_=i}return!(s<0)&&(E=s<u?s:u,this.checkSizeIsVisible(m-f,E-_,h))}),S(this,"returnHiddenResult",o=>(this._clientSize=null,{visible:!1,reason:o})),S(this,"checkOneElementVisible",o=>{if(o instanceof HTMLElement){if(this.checkElementIsMountedOnDom(o)){if(this.checkActualCssVisibleIncludeInherit(o)){if(this._clientSize=this.getSizeAboutClient(o),this.checkElementCover(o))return this.returnHiddenResult(Yc.COVERED);{const r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(Yc.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Yc.SIZE)}}return this.returnHiddenResult(Yc.STYLE)}return this.returnHiddenResult(oh.UNMOUNTED)}return this.returnHiddenResult(oh.INVALID_HTML_ELEMENT)}),S(this,"checkElementIsMountedOnDom",o=>this.checkPropertyUpToAllParentNodes(o,r=>"HTML"!==r.nodeName.toUpperCase()?null!==r.parentElement:!!document.documentElement))}};function Vy(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function ah(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?Vy(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Vy(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let an=(Xb=pe({argsMap:(o,r,i)=>[o.getTrackId(),"string"==typeof r?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),Qb=Vt(),Im=pe({argsMap:o=>[o.getTrackId()]}),Rm=Bc("LocalVideoTrack","_enabledMutex"),Ny=pe({argsMap:(o,r)=>[o.getTrackId(),r]}),bm=Vt(),Am=Bc("LocalVideoTrack","_enabledMutex"),Zb=pe({argsMap:(o,r)=>[o.getTrackId(),r]}),eA=Vt(),tA=pe({argsMap:(o,r)=>[o.getTrackId(),r]}),nA=Vt(),Py=Vt(),Dm=pe({argsMap:(o,r,i)=>[o.getTrackId(),r,i]}),ih=Vt(),wm=Vt(),My=Vt(),sh=Vt(),rA=Vt(),Ly=Vt(),ky=Vt(),oA=pe({argsMap:(o,r)=>[o.getTrackId(),r.name]}),xy=pe({argsMap:o=>[o.getTrackId()]}),iA=pe({argsMap:o=>[o.getTrackId()]}),$r=pe({argsMap:(o,r,i)=>[o.getTrackId(),r.label,i]}),q((Me=class bU extends im{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==qe.PLAYING)}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,s,u,d,h){if(super(r,d),S(this,"trackMediaType","video"),S(this,"_player",void 0),S(this,"_videoVisibleTimer",null),S(this,"_previousVideoVisibleStatus",void 0),S(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),S(this,"_encoderConfig",void 0),S(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),S(this,"_optimizationMode",void 0),S(this,"_videoHeight",void 0),S(this,"_videoWidth",void 0),S(this,"_forceBitrateLimit",void 0),S(this,"_enabled",!0),S(this,"processorDestination",void 0),S(this,"_processorContext",void 0),or()){const{width:f,height:m}=r.getSettings();this._videoWidth=f,this._videoHeight=m}else this.updateMediaStreamTrackResolution();this._encoderConfig=i,this._scalabiltyMode=s,this._optimizationMode=u,this._hints=h||[],-1===this._hints.indexOf(rn.SCREEN_TRACK)&&this.updateBitrateFromProfile(),i&&-1!==this._hints.indexOf(rn.CUSTOM_TRACK)&&this.setEncoderConfiguration(i),this.processorContext=new tb(this.getTrackId(),"local"),this.processorDestination=new ge(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof r){const u=document.getElementById(r);u?r=u:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=ah(ah(ah({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(s):(this._player=r instanceof HTMLVideoElement?new Dy(s):new Oy(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const u=this.getVideoElementVisibleStatus();this.emit(ui.VIDEO_ELEMENT_VISIBLE_STATUS,u)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(r,i){var s=this;return M(function*(){if(!i){if(r===s._enabled)return;s.stateCheck("enabled",r)}if(R.info("[".concat(s.getTrackId(),"] start setEnabled"),r),!r){s._originMediaStreamTrack.enabled=!1;try{yield Wt(s,Ee.NEED_DISABLE_TRACK,s)}catch(u){throw R.error("[".concat(s.getTrackId(),"] setEnabled to false error"),u.toString()),u}return i||(s._enabled=!1),void R.info("[".concat(s.getTrackId(),"] setEnabled to false success"))}s._originMediaStreamTrack.enabled=!0;try{yield Wt(s,Ee.NEED_ENABLE_TRACK,s)}catch(u){throw R.error("[".concat(s.getTrackId(),"] setEnabled to true error"),u.toString()),u}R.info("[".concat(s.getTrackId(),"] setEnabled to true success")),i||(s._enabled=!0)})()}setMuted(r){var i=this;return M(function*(){r!==i._muted&&(i.stateCheck("muted",r),i._muted=r,i._originMediaStreamTrack.enabled=!r,R.debug("[".concat(i.getTrackId(),"] start set muted: ").concat(r)),r?yield Wt(i,Ee.NEED_MUTE_TRACK,i):yield Wt(i,Ee.NEED_UNMUTE_TRACK,i))})()}setEncoderConfiguration(r,i){var s=this;return M(function*(){if(!s._enabled)throw new L(D.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=bc(r),s._forceBitrateLimit&&(r.bitrateMax=s._forceBitrateLimit.max_bitrate?s._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=s._forceBitrateLimit.min_bitrate?s._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const u=vd({encoderConfig:r});(or()||vr()||Wr())&&(u.deviceId=void 0),R.debug("[".concat(s.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(u));try{yield s._originMediaStreamTrack.applyConstraints(u),s.updateMediaStreamTrackResolution()}catch(d){const h=new L(D.UNEXPECTED_ERROR,d.toString());throw R.error("[".concat(s.getTrackId(),"] applyConstraints error"),h.toString()),h}}s._encoderConfig=r,-1===s._hints.indexOf(rn.SCREEN_TRACK)&&s.updateBitrateFromProfile();try{yield Wt(s,Ee.NEED_UPDATE_VIDEO_ENCODER,s)}catch(u){return u.throw()}})()}getStats(){return gd(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Bi(this,Ee.GET_STATS)||ah({},Da)}setBeautyEffect(r){return M(function*(){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(r){var i=arguments,s=this;return M(function*(){return s._player?s._player.getCurrentFrameToUint8Array(r,i.length>1&&void 0!==i[1]?i[1]:1):yield by(r)})()}clone(r,i,s,u){const d=this._mediaStreamTrack.clone();return new bU(d,r,i,s,u)}setBitrateLimit(r){var i=this;return M(function*(){if(R.debug("[".concat(i.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r){i._forceBitrateLimit=r,i._encoderConfig&&(i._encoderConfig.bitrateMax=i._encoderConfig.bitrateMax&&i._encoderConfig.bitrateMax<r.max_bitrate?i._encoderConfig.bitrateMax:r.max_bitrate,i._encoderConfig.bitrateMin=r.min_bitrate);try{yield Wt(i,Ee.NEED_UPDATE_VIDEO_ENCODER,i)}catch(s){return s.throw()}}})()}setOptimizationMode(r){var i=this;return M(function*(){if("motion"!==r&&"detail"!==r&&"balanced"!==r)return void R.error(D.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=i._optimizationMode;try{i._optimizationMode=r,yield Wt(i,Ee.SET_OPTIMIZATION_MODE,i)}catch(u){throw i._optimizationMode=s,R.error("[".concat(i.getTrackId(),"] set optimization mode failed"),u.toString()),u}R.info("[".concat(i.getTrackId(),"] set optimization mode success (").concat(r,")"))})()}setScalabiltyMode(r){if(1===r.numSpatialLayers&&1!==r.numTemporalLayers)return R.error(D.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=r,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){Ib(this._originMediaStreamTrack).then(r=>{let[i,s]=r;this._videoHeight=s,this._videoWidth=i}).catch(hm)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:i,frameRate:s}=this.getMediaStreamTrackSettings();if(!r||!i||!s)return;const[u,d]=function(h,f,m){const _=V("BITRATE_ADAPTER_TYPE");let E;const y=200*Math.pow(m/15,.6)*Math.pow(h*f/640/360,.75),T=y;if("STANDARD_BITRATE"===_)E=4*y;else{if("COMPATIABLE_BITRATE"!==_)return;E=2*y}return[Math.floor(E),Math.floor(T)]}(r,i,s)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=u,R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(u,", brMin: ").concat(d,"]")))}getVideoElementVisibleStatus(){try{var r,i;const s=null==this||null===(r=this._player)||void 0===r?void 0:r.getContainerElement(),u={track:this,element:null==this||null===(i=this._player)||void 0===i?void 0:i.getVideoElement(),slot:s?.parentElement},{element:d,slot:h}=u;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=uA.checkOneElementVisible(d),m=Object.assign({},f);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;he.reportApiInvoke(null,{tag:xt.TRACER,name:pn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new L(D.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}renewMediaStreamTrack(r){return M(function*(){})()}pipe(r){if(this.processor===r)return r;if(r._source)throw new L(D.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}replaceTrack(r,i){var s=this;return M(function*(){if(!(r instanceof MediaStreamTrack))throw new L(D.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==r.kind)throw new L(D.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield s._updateOriginMediaStreamTrack(r,i,!0),s.updateMediaStreamTrackResolution()})()}bindProcessorDestinationEvents(){var r=this;this.processorDestination.on(ur.ON_TRACK,function(){var i=M(function*(s){s?s!==r._mediaStreamTrack&&(r._mediaStreamTrack=s,r._updatePlayerSource(),yield Wt(r,Ee.NEED_REPLACE_TRACK,r)):r._mediaStreamTrack!==r._originMediaStreamTrack&&(r._mediaStreamTrack=r._originMediaStreamTrack,r._updatePlayerSource(),yield Wt(r,Ee.NEED_REPLACE_TRACK,r))});return function(s){return i.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ur.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Pr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Pr.REQUEST_CONSTRAINTS)}}).prototype,"play",[Xb,Qb],Object.getOwnPropertyDescriptor(Me.prototype,"play"),Me.prototype),q(Me.prototype,"stop",[Im],Object.getOwnPropertyDescriptor(Me.prototype,"stop"),Me.prototype),q(Me.prototype,"setEnabled",[Rm,Ny,bm],Object.getOwnPropertyDescriptor(Me.prototype,"setEnabled"),Me.prototype),q(Me.prototype,"setMuted",[Am,Zb,eA],Object.getOwnPropertyDescriptor(Me.prototype,"setMuted"),Me.prototype),q(Me.prototype,"setEncoderConfiguration",[tA,nA],Object.getOwnPropertyDescriptor(Me.prototype,"setEncoderConfiguration"),Me.prototype),q(Me.prototype,"getStats",[Py],Object.getOwnPropertyDescriptor(Me.prototype,"getStats"),Me.prototype),q(Me.prototype,"setBeautyEffect",[Dm,ih],Object.getOwnPropertyDescriptor(Me.prototype,"setBeautyEffect"),Me.prototype),q(Me.prototype,"getCurrentFrameData",[wm],Object.getOwnPropertyDescriptor(Me.prototype,"getCurrentFrameData"),Me.prototype),q(Me.prototype,"getCurrentFrameImage",[My],Object.getOwnPropertyDescriptor(Me.prototype,"getCurrentFrameImage"),Me.prototype),q(Me.prototype,"setBitrateLimit",[sh],Object.getOwnPropertyDescriptor(Me.prototype,"setBitrateLimit"),Me.prototype),q(Me.prototype,"setOptimizationMode",[rA],Object.getOwnPropertyDescriptor(Me.prototype,"setOptimizationMode"),Me.prototype),q(Me.prototype,"setScalabiltyMode",[Ly],Object.getOwnPropertyDescriptor(Me.prototype,"setScalabiltyMode"),Me.prototype),q(Me.prototype,"updateMediaStreamTrackResolution",[ky],Object.getOwnPropertyDescriptor(Me.prototype,"updateMediaStreamTrackResolution"),Me.prototype),q(Me.prototype,"pipe",[oA],Object.getOwnPropertyDescriptor(Me.prototype,"pipe"),Me.prototype),q(Me.prototype,"unpipe",[xy],Object.getOwnPropertyDescriptor(Me.prototype,"unpipe"),Me.prototype),q(Me.prototype,"close",[iA],Object.getOwnPropertyDescriptor(Me.prototype,"close"),Me.prototype),q(Me.prototype,"replaceTrack",[$r],Object.getOwnPropertyDescriptor(Me.prototype,"replaceTrack"),Me.prototype),Me),dA=(sA=pe({argsMap:(o,r)=>[o.getTrackId(),r]}),aA=Vt(),aP=Bc("CameraVideoTrack","_enabledMutex"),cP=pe({argsMap:(o,r)=>[o.getTrackId(),r]}),Uy=Vt(),Om=pe({argsMap:(o,r)=>[o.getTrackId(),r]}),yd=Vt(),cA=pe({argsMap:o=>[o.getTrackId()]}),q((co=class extends an{get __className__(){return"CameraVideoTrack"}constructor(o,r,i,s,u,d){var h;super(o,bc(r.encoderConfig),s,u,d),h=this,S(this,"_config",void 0),S(this,"_originalConstraints",void 0),S(this,"_constraints",void 0),S(this,"_enabled",!0),S(this,"_deviceName","default"),S(this,"tryResumeVideoForIOS15_16WeChat",M(function*(){(Ta()||Df())&&!function(){const f=ut();if(f.os!==Gn.IOS||!f.osVersion)return!1;const m=f.osVersion.split(".");return 15===Number(m[0])&&Number(m[1])>=2}()&&NI()&&h._enabled&&!h._isClosed&&(R.debug("[".concat(h.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield h.renewMediaStreamTrack())})),this._config=r,this._originalConstraints=i,this._constraints=i,this._deviceName=o.label,this._encoderConfig=bc(this._config.encoderConfig),tt.on(Tn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tt.on(Tn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(o){var r=this;return M(function*(){if(R.info("[".concat(r.getTrackId(),"] set device to ").concat(o)),r._enabled)try{const i=yield ao.getDeviceById(o),s={};s.video=ah({},r._constraints),s.video.deviceId={exact:o},s.video.facingMode=void 0,r._originMediaStreamTrack.stop();let u=null;try{u=yield Go(s,r.getTrackId())}catch(d){throw R.error("[".concat(r.getTrackId(),"] setDevice failed"),d.toString()),u=yield Go({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(u.getVideoTracks()[0],!1),d}yield r._updateOriginMediaStreamTrack(u.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution(),r._deviceName=i.label,r._config.cameraId=o,r._constraints.deviceId={exact:o}}catch(i){throw R.error("[".concat(r.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=yield ao.getDeviceById(o);r._deviceName=i.label,r._config.cameraId=o,r._constraints.deviceId={exact:o}}catch(i){throw R.error("[".concat(r.getTrackId(),"] setDevice error"),i.toString()),i}R.info("[".concat(r.getTrackId(),"] setDevice success"))})()}setEnabled(o,r){var i=this;return M(function*(){if(!r){if(o===i._enabled)return;i.stateCheck("enabled",o)}if(R.info("[".concat(i.getTrackId(),"] start setEnabled"),o),o){try{if(i.isExternalTrack)i._originMediaStreamTrack.enabled=!0;else{const s=yield Go({video:i._constraints},i.getTrackId());yield i._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1)}yield Wt(i,Ee.NEED_ENABLE_TRACK,i)}catch(s){throw R.error("[".concat(i.getTrackId(),"] setEnabled true error"),s.toString()),s}i.updateMediaStreamTrackResolution(),R.info("[".concat(i.getTrackId(),"] setEnabled to true success")),r||(i._enabled=!0)}else{i.isExternalTrack?i._originMediaStreamTrack.enabled=!1:(i._originMediaStreamTrack.onended=null,i._originMediaStreamTrack.stop()),r||(i._enabled=!1);try{yield Wt(i,Ee.NEED_DISABLE_TRACK,i)}catch(s){throw R.error("[".concat(i.getTrackId(),"] setEnabled to false error"),s.toString()),s}R.info("[".concat(i.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(o,r){var i=this;return M(function*(){if(!i._enabled)throw new L(D.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");o=bc(o),i._forceBitrateLimit&&(o.bitrateMax=i._forceBitrateLimit.max_bitrate?i._forceBitrateLimit.max_bitrate:o.bitrateMax,o.bitrateMin=i._forceBitrateLimit.min_bitrate?i._forceBitrateLimit.min_bitrate:o.bitrateMin);const s=$t(i._config);s.encoderConfig=o;const u=vd(s);(or()||vr()||Wr())&&(u.deviceId=void 0),R.debug("[".concat(i.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(o),JSON.stringify(u));try{yield i._originMediaStreamTrack.applyConstraints(u),i.updateMediaStreamTrackResolution()}catch(d){const h=new L(D.UNEXPECTED_ERROR,d.toString());throw R.error("[".concat(i.getTrackId(),"] applyConstraints error"),h.toString()),h}i._config=s,i._constraints=u,i._originalConstraints=u,i._encoderConfig=o,-1===i._hints.indexOf(rn.SCREEN_TRACK)&&i.updateBitrateFromProfile();try{yield Wt(i,Ee.NEED_UPDATE_VIDEO_ENCODER,i)}catch(d){return d.throw()}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var o=this;if((vr()||Wr())&&this._enabled&&!this._isClosed&&tt.duringInterruption){const r=function(){var i=M(function*(){tt.off(Tn.IOS_INTERRUPTION_END,r),o._enabled&&!o._isClosed&&(R.debug("[".concat(o.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield o.setEnabled(!1),yield o.setEnabled(!0))});return function(){return i.apply(this,arguments)}}();tt.on(Tn.IOS_INTERRUPTION_END,r)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(ui.TRACK_ENDED)}renewMediaStreamTrack(o){var r=this;return M(function*(){const i=o||r._constraints,s=ao.searchDeviceIdByName(r._deviceName);if(s&&!i.deviceId&&(i.deviceId={exact:s}),r._enabled){const u=yield Go({video:i},r.getTrackId());r._constraints=i,yield r._updateOriginMediaStreamTrack(u.getVideoTracks()[0],!0),r.updateMediaStreamTrackResolution()}})()}close(){super.close(),tt.off(Tn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tt.off(Tn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}bindProcessorContextEvents(){var o=this;this.processorContext.on(Pr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=M(function*(i,s,u){try{const d=Object.assign({},o._originalConstraints,...i);yield o.renewMediaStreamTrack(d),s()}catch(d){u(d)}});return function(i,s,u){return r.apply(this,arguments)}}()),this.processorContext.on(Pr.REQUEST_CONSTRAINTS,function(){var r=M(function*(i){i(o._originMediaStreamTrack.getSettings())});return function(i){return r.apply(this,arguments)}}())}}).prototype,"setDevice",[sA,aA],Object.getOwnPropertyDescriptor(co.prototype,"setDevice"),co.prototype),q(co.prototype,"setEnabled",[aP,cP,Uy],Object.getOwnPropertyDescriptor(co.prototype,"setEnabled"),co.prototype),q(co.prototype,"setEncoderConfiguration",[Om,yd],Object.getOwnPropertyDescriptor(co.prototype,"setEncoderConfiguration"),co.prototype),q(co.prototype,"close",[cA],Object.getOwnPropertyDescriptor(co.prototype,"close"),co.prototype),co);class ch{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(r,i){S(this,"uid",void 0),S(this,"_uintid",void 0),S(this,"_trust_in_room_",!0),S(this,"_trust_audio_enabled_state_",!0),S(this,"_trust_video_enabled_state_",!0),S(this,"_trust_audio_mute_state_",!0),S(this,"_trust_video_mute_state_",!0),S(this,"_audio_muted_",!1),S(this,"_video_muted_",!1),S(this,"_audio_enabled_",!0),S(this,"_video_enabled_",!0),S(this,"_audio_added_",!1),S(this,"_video_added_",!1),S(this,"_trust_video_stream_added_state_",!0),S(this,"_trust_audio_stream_added_state_",!0),S(this,"_audioTrack",void 0),S(this,"_videoTrack",void 0),S(this,"_audioSSRC",void 0),S(this,"_videoSSRC",void 0),S(this,"_audioOrtc",void 0),S(this,"_videoOrtc",void 0),S(this,"_cname",void 0),S(this,"_rtxSsrcId",void 0),this.uid=r,this._uintid=i}}var lA=dE,uP=uc,Nm=tf;tr({target:"Promise",stat:!0},{try:function(o){var r=uP.f(this),i=Nm(o);return(i.error?r.reject:r.resolve)(i.value),r.promise}});var uh=lA,fk=tr,hA=ot,dP=Qt,pA=di,Sd=Qo,lP=la,fA=Zr,Pm=nv,mk=Ev,hP=b0,gk=au,mA=Fn("isConcatSpreadable"),gA=9007199254740991,_A="Maximum allowed index exceeded",Fy=hA.TypeError,EA=gk>=51||!dP(function(){var o=[];return o[mA]=!1,o.concat()[0]!==o}),pP=hP("concat"),vA=function(o){if(!Sd(o))return!1;var r=o[mA];return void 0!==r?!!r:pA(o)};fk({target:"Array",proto:!0,forced:!EA||!pP},{concat:function(o){var r,i,s,u,d,h=lP(this),f=mk(h,0),m=0;for(r=-1,s=arguments.length;r<s;r++)if(vA(d=-1===r?h:arguments[r])){if(m+(u=fA(d))>gA)throw Fy(_A);for(i=0;i<u;i++,m++)i in d&&Pm(f,m,d[i])}else{if(m>=gA)throw Fy(_A);Pm(f,m++,d)}return f.length=m,f}});var jy={},fP=Bd,mP=ua,By=Or.f,gP=QI,Hy="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];jy.f=function(o){return Hy&&"Window"==fP(o)?function(r){try{return By(r)}catch{return gP(Hy)}}(o):By(mP(o))};var Td={};Td.f=Fn;var Gy=da,_P=Pt,EP=Td,_k=Yi.f,xn=function(o){var r=Gy.Symbol||(Gy.Symbol={});_P(r,o)||_k(r,o,{value:EP.f(o)})},dh=tr,SA=ot,Ek=Ns,vk=Ig,Mm=po,yk=Dn,lh=Xo,Cd=qi,TA=Qt,Un=Pt,Wy=di,CA=Qn,vP=Qo,Js=ho,Ky=Lg,IA=Ji,Sk=la,qy=ua,Id=Ot,RA=yu,Lm=ca,hh=Dp,yP=VT,SP=Or,$y=jy,km=Qa,TP=jd,hi=Yi,CP=Eu,xm=Rg,bA=ll,zy=Fp,Um=Hd.exports,In=Je,AA=Vg,Vm=Fn,IP=Td,RP=xn,Yy=Zt,Jy=sl,ph=SR.forEach,Do=vp("hidden"),fh="Symbol",Xy=Vm("toPrimitive"),DA=Jy.set,mh=Jy.getterFor(fh),Wo=Object.prototype,Ts=SA.Symbol,Jc=Ts&&Ts.prototype,Fm=SA.TypeError,Cs=SA.QObject,Rd=Ek("JSON","stringify"),jm=TP.f,Is=hi.f,wA=$y.f,Tk=xm.f,Qy=yk([].push),Xs=Um("symbols"),bd=Um("op-symbols"),Zy=Um("string-to-symbol-registry"),eS=Um("symbol-to-string-registry"),OA=Um("wks"),NA=!Cs||!Cs.prototype||!Cs.prototype.findChild,Bm=lh&&TA(function(){return 7!=hh(Is({},"a",{get:function(){return Is(this,"a",{value:7}).a}})).a})?function(o,r,i){var s=jm(Wo,r);s&&delete Wo[r],Is(o,r,i),s&&o!==Wo&&Is(Wo,r,s)}:Is,tS=function(o,r){var i=Xs[o]=hh(Jc);return DA(i,{type:fh,tag:o,description:r}),lh||(i.description=r),i},gh=function(o,r,i){o===Wo&&gh(bd,r,i),IA(o);var s=Id(r);return IA(i),Un(Xs,s)?(i.enumerable?(Un(o,Do)&&o[Do][s]&&(o[Do][s]=!1),i=hh(i,{enumerable:Lm(0,!1)})):(Un(o,Do)||Is(o,Do,Lm(1,{})),o[Do][s]=!0),Bm(o,s,i)):Is(o,s,i)},PA=function(o,r){IA(o);var i=qy(r),s=yP(i).concat(oS(i));return ph(s,function(u){lh&&!Mm(Hm,i,u)||gh(o,u,i[u])}),o},Hm=function(o){var r=Id(o),i=Mm(Tk,this,r);return!(this===Wo&&Un(Xs,r)&&!Un(bd,r))&&(!(i||!Un(this,r)||!Un(Xs,r)||Un(this,Do)&&this[Do][r])||i)},nS=function(o,r){var i=qy(o),s=Id(r);if(i!==Wo||!Un(Xs,s)||Un(bd,s)){var u=jm(i,s);return!u||!Un(Xs,s)||Un(i,Do)&&i[Do][s]||(u.enumerable=!0),u}},rS=function(o){var r=wA(qy(o)),i=[];return ph(r,function(s){Un(Xs,s)||Un(In,s)||Qy(i,s)}),i},oS=function(o){var r=o===Wo,i=wA(r?bd:qy(o)),s=[];return ph(i,function(u){!Un(Xs,u)||r&&!Un(Wo,u)||Qy(s,Xs[u])}),s};if(Cd||(zy(Jc=(Ts=function(){if(Js(Jc,this))throw Fm("Symbol is not a constructor");var o=arguments.length&&void 0!==arguments[0]?RA(arguments[0]):void 0,r=AA(o),i=function(s){this===Wo&&Mm(i,bd,s),Un(this,Do)&&Un(this[Do],r)&&(this[Do][r]=!1),Bm(this,r,Lm(1,s))};return lh&&NA&&Bm(Wo,r,{configurable:!0,set:i}),tS(r,o)}).prototype,"toString",function(){return mh(this).tag}),zy(Ts,"withoutSetter",function(o){return tS(AA(o),o)}),xm.f=Hm,hi.f=gh,CP.f=PA,TP.f=nS,SP.f=$y.f=rS,km.f=oS,IP.f=function(o){return tS(Vm(o),o)},lh&&Is(Jc,"description",{configurable:!0,get:function(){return mh(this).description}})),dh({global:!0,wrap:!0,forced:!Cd,sham:!Cd},{Symbol:Ts}),ph(yP(OA),function(o){RP(o)}),dh({target:fh,stat:!0,forced:!Cd},{for:function(o){var r=RA(o);if(Un(Zy,r))return Zy[r];var i=Ts(r);return Zy[r]=i,eS[i]=r,i},keyFor:function(o){if(!Ky(o))throw Fm(o+" is not a symbol");if(Un(eS,o))return eS[o]},useSetter:function(){NA=!0},useSimple:function(){NA=!1}}),dh({target:"Object",stat:!0,forced:!Cd,sham:!lh},{create:function(o,r){return void 0===r?hh(o):PA(hh(o),r)},defineProperty:gh,defineProperties:PA,getOwnPropertyDescriptor:nS}),dh({target:"Object",stat:!0,forced:!Cd},{getOwnPropertyNames:rS,getOwnPropertySymbols:oS}),dh({target:"Object",stat:!0,forced:TA(function(){km.f(1)})},{getOwnPropertySymbols:function(o){return km.f(Sk(o))}}),Rd&&dh({target:"JSON",stat:!0,forced:!Cd||TA(function(){var o=Ts();return"[null]"!=Rd([o])||"{}"!=Rd({a:o})||"{}"!=Rd(Object(o))})},{stringify:function(o,r,i){var s=bA(arguments),u=r;if((vP(r)||void 0!==o)&&!Ky(o))return Wy(r)||(r=function(d,h){if(CA(u)&&(h=Mm(u,this,d,h)),!Ky(h))return h}),s[1]=r,vk(Rd,null,s)}}),!Jc[Xy]){var MA=Jc.valueOf;zy(Jc,Xy,function(o){return Mm(MA,this)})}Yy(Ts,fh),In[Do]=!0,xn("asyncIterator"),xn("hasInstance"),xn("isConcatSpreadable"),xn("iterator"),xn("match"),xn("matchAll"),xn("replace"),xn("search"),xn("species"),xn("split"),xn("toPrimitive"),xn("toStringTag"),xn("unscopables"),Zt(ot.JSON,"JSON",!0);var LA=da.Symbol;xn("asyncDispose"),xn("dispose"),xn("matcher"),xn("metadata"),xn("observable"),xn("patternMatch"),xn("replaceAll");var Xc=LA,_h=Td.f("asyncIterator");function iS(o){this.wrapped=o}function Eh(o){var r,i;function s(d,h){try{var f=o[d](h),m=f.value,_=m instanceof iS;uh.resolve(_?m.wrapped:m).then(function(E){_?s("return"===d?"return":"next",E):u(f.done?"return":"normal",E)},function(E){s("throw",E)})}catch(E){u("throw",E)}}function u(d,h){switch(d){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?s(r.key,r.arg):i=null}this._invoke=function(d,h){return new uh(function(f,m){var _={key:d,arg:h,resolve:f,reject:m,next:null};i?i=i.next=_:(r=i=_,s(d,h))})},"function"!=typeof o.return&&(this.return=void 0)}function pi(o){return function(){return new Eh(o.apply(this,arguments))}}function Ve(o){return new iS(o)}Eh.prototype["function"==typeof Xc&&_h||"@@asyncIterator"]=function(){return this},Eh.prototype.next=function(o){return this._invoke("next",o)},Eh.prototype.throw=function(o){return this._invoke("throw",o)},Eh.prototype.return=function(o){return this._invoke("return",o)};var xA=Td.f("iterator");function Gm(o,r){var i={},s=!1;function u(d,h){return s=!0,h=new uh(function(f){f(o[d](h))}),{done:!1,value:r(h)}}return i[void 0!==Xc&&xA||"@@iterator"]=function(){return this},i.next=function(d){return s?(s=!1,d):u("next",d)},"function"==typeof o.throw&&(i.throw=function(d){if(s)throw s=!1,d;return u("throw",d)}),"function"==typeof o.return&&(i.return=function(d){return s?(s=!1,d):u("return",d)}),i}var bP=_h,gn={exports:{}};function AP(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function DP(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?AP(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):AP(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function Wm(o,r,i,s,u,d,h){let f=[],m=[],_=[],E=[],y=!1,T=!1;if(gn.exports.parse(o).mediaDescriptions.forEach(b=>{h&&h!==b.attributes.direction||("video"!==b.media.mediaType||y||(m=b.attributes.payloads,E=b.attributes.extmaps,y=!0),"audio"!==b.media.mediaType||T||(f=b.attributes.payloads,_=b.attributes.extmaps,T=!0))}),!E||0===m.length)throw new Error("Cannot get video capabilities from SDP.");if(!_||0===f.length)throw new Error("Cannot get audio capabilities from SDP.");return m.forEach(b=>{var w;null!==(w=b.rtpMap)&&void 0!==w&&w.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate))}),f.forEach(b=>{var w;null!==(w=b.rtpMap)&&void 0!==w&&w.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate))}),r&&(f=f.filter(b=>{var w;return"rtx"!==(null===(w=b.rtpMap)||void 0===w?void 0:w.encodingName.toLowerCase())}),m=m.filter(b=>{var w;return"rtx"!==(null===(w=b.rtpMap)||void 0===w?void 0:w.encodingName.toLowerCase())})),i&&(m=m.filter(b=>{var w;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(w=b.rtpMap)||void 0===w?void 0:w.encodingName)||"")})),s&&(f=f.filter(b=>{var w;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(w=b.rtpMap)||void 0===w?void 0:w.encodingName)||"")})),u&&u?.length>0&&(f=f.filter(b=>{var w;return u.includes((null===(w=b.rtpMap)||void 0===w?void 0:w.encodingName.toLowerCase())||"")})),d&&d?.length>0&&(m=m.filter(b=>{var w;return d.includes((null===(w=b.rtpMap)||void 0===w?void 0:w.encodingName.toLowerCase())||"")})),{audioCodecs:f,videoCodecs:m,audioExtensions:_,videoExtensions:E}}function Rs(o){const r=gn.exports.parse(o);let i,s;for(const u of r.mediaDescriptions){if(!i){const d=u.attributes.iceUfrag,h=u.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:d,icePwd:h}}if(!s){const d=u.attributes.fingerprints;d.length>0&&(s={fingerprints:d})}}if(!s&&r.attributes.fingerprints.length>0&&(s={fingerprints:r.attributes.fingerprints}),!s||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:s}}function UA(o,r){const i=[],s=o.attributes.ssrcGroups.filter(h=>"FID"===h.semantic),u=o.attributes.ssrcGroups.find(h=>"SIM"===h.semantic),d=o.attributes.ssrcs;if(u)u.ssrcIds.forEach(h=>{var f;const m=null===(f=s.find(_=>_.ssrcIds[0]===h))||void 0===f?void 0:f.ssrcIds[1];i.push({ssrcId:h,rtx:r?m:void 0})});else if(s.length>0)i.push({ssrcId:s[0].ssrcIds[0],rtx:r?s[0].ssrcIds[1]:void 0});else{if(0===d.length)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:d[0].ssrcId})}return i}function VA(o,r){const{cname:i}=o;let s;r&&r.ip&&"number"==typeof r.port?(s=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:r.ip,port:r.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(r.ip,":").concat(r.port)),r.ip6&&(s.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:r.ip6,port:r.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(r.ip6,":").concat(r.port)))):s=o.iceParameters.candidates.map(f=>({foundation:f.foundation,componentId:"1",transport:f.protocol,priority:f.priority.toString(),connectionAddress:f.ip,port:f.port.toString(),type:f.type,extension:{}}));const u={fingerprints:o.dtlsParameters.fingerprints.map(f=>({hashFunction:f.algorithm,fingerprint:f.fingerprint}))},d={iceUfrag:o.iceParameters.iceUfrag,icePwd:o.iceParameters.icePwd};let h;switch(o.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}return{dtlsParameters:u,iceParameters:d,candidates:s,rtpCapabilities:Qs(o.rtpCapabilities),setup:h,cname:i}}function fi(o,r,i){const s=[],u=[];return o.forEach(d=>{let{ssrcId:h,rtx:f}=d;const m=wt(8,"track-"),_={ssrcId:h,attributes:DP({label:m,mslabel:i=i||wt(10,""),msid:"".concat(i," ").concat(m)},r&&{cname:r})};if(s.push(_),void 0!==f){const E={ssrcId:f,attributes:DP({label:m,mslabel:i,msid:"".concat(i," ").concat(m)},r&&{cname:r})};s.push(E),u.push({semantic:"FID",ssrcIds:[h,f]})}}),o.length>1&&u.push({semantic:"SIM",ssrcIds:o.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:s,ssrcGroups:u}}function vh(o,r){r instanceof lr&&o.attributes.payloads.forEach(i=>{var s;const u=null===(s=i.rtpMap)||void 0===s?void 0:s.encodingName.toLowerCase();if(!u||-1===["opus","pcmu","pcma","g722"].indexOf(u))return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const d=r._encoderConfig;d&&"pcmu"!==u&&"pcma"!==u&&"g722"!==u&&(d.bitrate&&!Bt()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function FA(o){const r=o.attributes.unrecognized.findIndex(i=>"x-google-flag"===i.attField&&"conference"===i.attValue);-1!==r&&o.attributes.unrecognized.splice(r,1)}function jA(o,r){if(!(r instanceof an&&r._encoderConfig&&-1===r._hints.indexOf(rn.SCREEN_TRACK)))return;const i=r._encoderConfig;Yt().supportMinBitrate&&i.bitrateMin&&o.attributes.payloads.forEach(s=>{var u;["h264","h265","vp8","vp9","av1"].includes((null===(u=s.rtpMap)||void 0===u?void 0:u.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Yt().supportMinBitrate&&!r._hints.includes(rn.LOW_STREAM)&&i.bitrateMax&&o.attributes.payloads.forEach(s=>{var u;["h264","h265","vp8","vp9","av1"].includes((null===(u=s.rtpMap)||void 0===u?void 0:u.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(V("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function wP(o){if("video"!==o.media.mediaType)return;const r=ut();if(r.name!==it.SAFARI&&r.os!==Gn.IOS)return;const i=o.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));-1!==i&&o.attributes.extmaps.splice(i,1)}function Km(o,r,i){if(!r)return;let s,u;if("video"===o.media.mediaType?(s=i.videoExtensions,u=i.videoCodecs):(s=i.audioExtensions,u=i.audioCodecs),!0===r.twcc){const d=s.find(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);d&&(o.attributes.extmaps.find(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName)||o.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),(h=u,f=o.attributes.payloads,f.filter(m=>!!h.find(_=>_.payloadType===m.payloadType&&!!_.rtcpFeedbacks.find(E=>"transport-cc"===E.type)))).forEach(h=>{h.rtcpFeedbacks.find(f=>"transport-cc"===f.type)||h.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(!1===r.twcc){const d=o.attributes.extmaps.findIndex(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);-1!==d&&o.attributes.extmaps.splice(d,1),o.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(m=>"transport-cc"===m.type);-1!==f&&h.rtcpFeedbacks.splice(f,1)})}var h,f;if(!0===r.remb){const d=s.find(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);d&&(o.attributes.extmaps.find(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName)||o.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(h,f){return f.filter(m=>!!h.find(_=>_.payloadType===m.payloadType&&!!_.rtcpFeedbacks.find(E=>"goog-remb"===E.type)))}(u,o.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(f=>"goog-remb"===f.type)||h.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(!1===r.remb){const d=o.attributes.extmaps.findIndex(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);-1!==d&&o.attributes.extmaps.splice(d,1),o.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(m=>"goog-remb"===m.type);-1!==f&&h.rtcpFeedbacks.splice(f,1)})}}function yh(o,r,i){if(Bt()||"video"!==o.media.mediaType||!(r instanceof an)||"vp9"!==i&&"vp8"!==i||"vp8"===i&&!V("SIMULCAST")||void 0===r._scalabiltyMode||r._scalabiltyMode.numSpatialLayers<=1)return;const s="vp8"===i?2:r._scalabiltyMode.numSpatialLayers,u=o.attributes.ssrcs[0],d=o.attributes.ssrcGroups.find(f=>"FID"===f.semantic&&f.ssrcIds[0]===u.ssrcId),h={semantic:"SIM",ssrcIds:[u.ssrcId]};for(let f=1;f<s;f++)o.attributes.ssrcs.push({ssrcId:u.ssrcId+f,attributes:$t(u.attributes)}),h.ssrcIds.push(u.ssrcId+f),d&&(o.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+f,attributes:$t(u.attributes)}),o.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[u.ssrcId+f,d.ssrcIds[1]+f]}));o.attributes.ssrcGroups.unshift(h)}function BA(o,r,i,s,u){return sS.apply(this,arguments)}function sS(){return sS=M(function*(o,r,i,s,u){const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly"}),d.addTransceiver("audio",{direction:"sendonly"}),d.addTransceiver("video",{direction:"recvonly"}),d.addTransceiver("audio",{direction:"recvonly"});const h=(yield d.createOffer()).sdp,f=Wm(h,o,r,i,s,u,"sendonly"),m=Wm(h,o,r,i,s,u,"recvonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Sh(f,m,"videoExtensions",_,E,y),Sh(f,m,"videoCodecs",_,E,y),Sh(f,m,"audioExtensions",_,E,y),Sh(f,m,"audioCodecs",_,E,y),V("RAISE_H264_BASELINE_PRIORITY")){const T=y.videoCodecs.findIndex(b=>{var w,P;return"h264"===(null===(w=b.rtpMap)||void 0===w?void 0:w.encodingName.toLocaleLowerCase())&&"42001f"===(null===(P=b.fmtp)||void 0===P?void 0:P.parameters["profile-level-id"])});if(-1!==T){const b=y.videoCodecs.findIndex(w=>{var P;return"h264"===(null===(P=w.rtpMap)||void 0===P?void 0:P.encodingName.toLocaleLowerCase())});if(b<T){R.debug("raising H264 baseline profile priority");const w=y.videoCodecs[T];y.videoCodecs.splice(T,1),y.videoCodecs.splice(b,0,w)}-1!==b&&(E.videoCodecs=E.videoCodecs.filter(w=>{var P,k;return!("h264"===(null===(P=w.rtpMap)||void 0===P?void 0:P.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(k=w.fmtp)||void 0===k?void 0:k.parameters["profile-level-id"]))})),-1!==b&&V("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(w=>{var P,k;return!("h264"===(null===(P=w.rtpMap)||void 0===P?void 0:P.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(k=w.fmtp)||void 0===k?void 0:k.parameters["profile-level-id"]))}))}}try{d.close()}catch{}return{send:_,recv:E,sendrecv:y}}),sS.apply(this,arguments)}function Sh(o,r,i,s,u,d){if("videoExtensions"===i||"audioExtensions"===i){const h=[];return o[i].forEach(f=>{r[i].some((m,_)=>{if(f.entry===m.entry&&f.extensionName===m.extensionName)return h.push(_),!0})?d[i].push(f):s[i].push(f)}),void r[i].forEach((f,m)=>{-1===h.indexOf(m)&&u[i].push(f)})}if("videoCodecs"===i||"audioCodecs"===i){const h=[];return o[i].forEach(f=>{r[i].some((m,_)=>{if(f.payloadType===m.payloadType&&JSON.stringify(f)===JSON.stringify(m))return h.push(_),!0})?d[i].push(f):s[i].push(f)}),void r[i].forEach((f,m)=>{-1===h.indexOf(m)&&u[i].push(f)})}}function Qs(o){const{send:r,recv:i,sendrecv:s}=o;if(!s){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let u,d;return r?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...r.audioCodecs,...s.audioCodecs],u.videoCodecs=[...r.videoCodecs,...s.videoCodecs],u.audioExtensions=[...r.audioExtensions,...s.audioExtensions],u.videoExtensions=[...r.videoExtensions,...s.videoExtensions]):u=s,i?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...i.audioCodecs,...s.audioCodecs],d.videoCodecs=[...i.videoCodecs,...s.videoCodecs],d.audioExtensions=[...i.audioExtensions,...s.audioExtensions],d.videoExtensions=[...i.videoExtensions,...s.videoExtensions]):d=s,{send:u,recv:d}}function Zs(o){"audio"===o.media.mediaType&&o.attributes.payloads.filter(r=>{var i;return"opus"===(null===(i=r.rtpMap)||void 0===i?void 0:i.encodingName.toLowerCase())}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function qm(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function $m(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?qm(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):qm(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}!function(o,r){o.exports=(()=>{var i={8:(d,h,f)=>{f.r(h),f.d(h,{Parser:()=>Oe,Printer:()=>Sn,parse:()=>_e,print:()=>We});const m="\n",_="".concat("\r").concat(m),E=" ";let y;function T(X){return X>="0"&&X<="9"}function b(X){return X>="!"&&X<="~"}function w(X){return b(X)||X>="\x80"&&X<="\xff"}function P(X){return"!"===X||X>="#"&&X<="'"||X>="*"&&X<="+"||X>="-"&&X<="."||X>="0"&&X<="9"||X>="A"&&X<="Z"||X>="^"&&X<="~"}function k(X){return X>="1"&&X<="9"}function x(X){return X>="A"&&X<="Z"||X>="a"&&X<="z"}function B(X){return"d"===X||"h"===X||"m"===X||"s"===X}function H(X){return X>"\x01"&&X<"\t"||X>"\v"&&X<"\f"||X>"\x0e"&&X<"\xff"}function ce(X){return x(X)||T(X)||"+"===X||"/"===X}function Re(X){return T(X)||x(X)||"+"===X||"/"===X||"-"===X||"_"===X}function Z(X){return x(X)||T(X)||"+"===X||"/"===X}function Y(X,C){var N=Object.keys(X);if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols(X);C&&(U=U.filter(function(K){return Object.getOwnPropertyDescriptor(X,K).enumerable})),N.push.apply(N,U)}return N}function ee(X){for(var C=1;C<arguments.length;C++){var N=null!=arguments[C]?arguments[C]:{};C%2?Y(Object(N),!0).forEach(function(U){oe(X,U,N[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(N)):Y(Object(N)).forEach(function(U){Object.defineProperty(X,U,Object.getOwnPropertyDescriptor(N,U))})}return X}function oe(X,C,N){return C in X?Object.defineProperty(X,C,{value:N,enumerable:!0,configurable:!0,writable:!0}):X[C]=N,X}var X;(X=y||(y={})).VERSION="v",X.ORIGIN="o",X.SESSION_NAME="s",X.INFORMATION="i",X.URI="u",X.EMAIL="e",X.PHONE="p",X.CONNECTION="c",X.BANDWIDTH="b",X.TIME="t",X.REPEAT="r",X.ZONE_ADJUSTMENTS="z",X.KEY="k",X.ATTRIBUTE="a",X.MEDIA="m";class Et{consumeText(C,N){let U=N;for(;U<C.length;){const K=C[U];if("\0"===K||"\r"===K||K===m)break;U+=1}if(U-N==0)throw new Error("Invalid text, at ".concat(C));return U}consumeUnicastAddress(C,N,U){return this.consumeTill(C,N,E)}consumeOneOrMore(C,N,U){let K=N;for(;U(C[K]);)K++;if(K-N==0)throw new Error("Invalid rule at ".concat(N,"."));return K}consumeSpace(C,N){if(C[N]===E)return N+1;throw new Error("Invalid space at ".concat(N,"."))}consumeIP4Address(C,N){let U=N;for(let K=0;K<4;K++)if(U=this.consumeDecimalUChar(C,U),3!==K){if("."!==C[U])throw new Error("Invalid IP4 address.");U++}return U}consumeDecimalUChar(C,N){let U=N;for(let Ce=0;Ce<3&&T(C[U]);Ce++,U++);if(U-N==0)throw new Error("Invalid decimal uchar.");const K=parseInt(C.slice(N,U));if(K>=0&&K<=255)return U;throw new Error("Invalid decimal uchar")}consumeIP6Address(C,N){let U=this.consumeHexpart(C,N);return":"===C[U]&&(U+=1,U=this.consumeIP4Address(C,U)),U}consumeHexpart(C,N){let U=N;if(":"===C[U]&&":"===C[U+1]){U+=2;try{U=this.consumeHexseq(C,U)}catch{}return U}if(U=this.consumeHexseq(C,U),":"===C[U]&&":"===C[U+1]){U+=2;try{U=this.consumeHexseq(C,U)}catch{}return U}return U}consumeHexseq(C,N){let U=N;for(;U=this.consumeHex4(C,U),":"===C[U]&&":"!==C[U+1];)U+=1;return U}consumeHex4(C,N){let U=0;for(;U<4;U++)if(!((K=C[N+U])>="0"&&K<="9"||K>="a"&&K<="f"||K>="A"&&K<="F")){if(0===U)throw new Error("Invalid hex 4");break}var K;return N+U}consumeFQDN(C,N){let U=N;for(;T(C[U])||x(C[U])||"-"===C[U]||"."===C[U];)U+=1;if(U-N<4)throw new Error("Invalid FQDN");return U}consumeExtnAddr(C,N){return this.consumeOneOrMore(C,N,w)}consumeMulticastAddress(C,N,U){switch(U){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(C,N);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(C,N);default:try{return this.consumeFQDN(C,N)}catch{return this.consumeExtnAddr(C,N)}}}consumeIP6MulticastAddress(C,N){const U=this.consumeHexpart(C,N);return"/"===C[U]?this.consumeInteger(C,U+1):U}consumeIP4MulticastAddress(C,N){let U=N+3;const K=C.slice(N,U),Ce=parseInt(K);if(Ce<224||Ce>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Ct=0;Ct<3;Ct++){if("."!==C[U])throw new Error("Invalid IP4 multicast address.");U+=1,U=this.consumeDecimalUChar(C,U)}return"/"===C[U]&&(U+=1),U=this.consumeTTL(C,U),"/"===C[U]&&(U=this.consumeInteger(C,U)),U}consumeInteger(C,N){if(!k(C[N]))throw new Error("Invalid integer.");for(N+=1;T(C[N]);)N+=1;return N}consumeTTL(C,N){if("0"===C[N])return N+1;if(!k(C[N]))throw new Error("Invalid TTL.");N+=1;for(let U=0;U<2&&T(C[N]);U++)N+=1;return N}consumeToken(C,N){return this.consumeOneOrMore(C,N,P)}consumeTime(C,N){let U=N;if("0"===C[U])return U+1;for(k(C[U])&&(U+=1);T(C[U]);)U++;if(U-N<10)throw new Error("Invalid time");return U}consumeAddress(C,N){return this.consumeTill(C,N,E)}consumeTypedTime(C,N){let U=N;return U=this.consumeOneOrMore(C,U,T),B(C[U])?U+1:U}consumeRepeatInterval(C,N){if(!k(C[N]))throw new Error("Invalid repeat interval");for(N+=1;T(C[N]);)N+=1;return B(C[N])&&(N+=1),N}consumePort(C,N){return this.consumeOneOrMore(C,N,T)}consume(C,N,U){for(let K=0;K<U.length;K++){if(N+K>=C.length)throw new Error("consume exceeding value length");if(C[N+K]!==U[K])throw new Error("consume ".concat(U," failed at ").concat(K))}return N+U.length}consumeTill(C,N,U){let K=N;for(;K<C.length&&("string"!=typeof U||C[K]!==U)&&("function"!=typeof U||!U(C[K]));)K++;return K}}class Oe extends Et{constructor(){super(),oe(this,"records",[]),oe(this,"currentLine",0)}parse(C){const N=this.probeEOL(C);this.records=C.split(N).filter(Xr=>!!Xr.trim()).map(this.parseLine),this.currentLine=0;const U=this.parseVersion(),K=this.parseOrigin(),Ce=this.parseSessionName(),Ct=this.parseInformation(),mr=this.parseUri(),$o=this.parseEmail(),tu=this.parsePhone(),vi=this.parseConnection(),nu=this.parseBandWidth(),Od=this.parseTimeFields(),Kt=this.parseKey(),Xt=this.parseSessionAttribute(),yt=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:U,origin:K,sessionName:Ce,information:Ct,uri:mr,emails:$o,phones:tu,connection:vi,bandwidths:nu,timeFields:Od,key:Kt,attributes:Xt,mediaDescriptions:yt}}getCurrentRecord(){const C=this.records[this.currentLine];if(!C)throw new Error("Record doesn't exit.");return C}probeEOL(C){for(let N=0;N<C.length;N++)if(C[N]===m)return"\r"===C[N-1]?_:m;throw new Error("Invalid newline character.")}parseLine(C,N){if(C.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const U=C[0];if("="!==C[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:U,value:C.slice(2),line:N,cur:0}}parseSessionAttribute(){const C=new vt;for(;this.currentLine<this.records.length;){const N=this.getCurrentRecord();if(N.type!==y.ATTRIBUTE)break;const U={attField:this.extractOneOrMore(N,K=>P(K)&&":"!==K),_cur:0};":"===N.value[N.cur]&&(N.cur+=1,U.attValue=this.extractOneOrMore(N,H)),C.parse(U),this.currentLine++}return C.digest()}parseMediaAttributes(C){const N=new Jn(C);for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==y.ATTRIBUTE)break;const K={attField:this.extractOneOrMore(U,Ce=>P(Ce)&&":"!==Ce),_cur:0};":"===U.value[U.cur]&&(U.cur+=1,K.attValue=this.extractOneOrMore(U,H)),N.parse(K),this.currentLine++}return N.digest()}parseKey(){const C=this.getCurrentRecord();if(C.type===y.KEY){if("prompt"===C.value||"clear:"===C.value||"base64:"===C.value||"uri:"===C.value)return C.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const C=this.getCurrentRecord();if(C.type===y.ZONE_ADJUSTMENTS){const N=[];for(;;)try{const U=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);let K=!1;"-"===C.value[C.cur]&&(K=!0,C.cur+=1);const Ce=this.extract(C,this.consumeTypedTime);N.push({time:U,typedTime:Ce,back:K})}catch{break}if(0===N.length)throw new Error("Invalid zone adjustments");return this.currentLine++,N}return[]}parseRepeat(){const C=[];for(;;){const N=this.getCurrentRecord();if(N.type!==y.REPEAT)break;{const U=this.extract(N,this.consumeRepeatInterval),K=this.parseTypedTime(N);C.push({repeatInterval:U,typedTimes:K}),this.currentLine++}}return C}parseTypedTime(C){const N=[];for(;;)try{this.consumeSpaceForRecord(C),N.push(this.extract(C,this.consumeTypedTime))}catch{break}if(0===N.length)throw new Error("Invalid typed time.");return N}parseTime(){const C=this.getCurrentRecord(),N=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);const U=this.extract(C,this.consumeTime);return this.currentLine++,{startTime:N,stopTime:U}}parseBandWidth(){const C=[];for(;this.currentLine<this.records.length;){const N=this.getCurrentRecord();if(N.type!==y.BANDWIDTH)break;{const U=this.extractOneOrMore(N,P);if(":"!==N.value[N.cur])throw new Error("Invalid bandwidth field.");N.cur++;const K=this.extractOneOrMore(N,T);C.push({bwtype:U,bandwidth:K}),this.currentLine++}}return C}parseVersion(){const C=this.getCurrentRecord();if(C.type!==y.VERSION)throw new Error("first sdp record must be version");const N=C.value.slice(0,this.consumeOneOrMore(C.value,0,T));if(N.length!==C.value.length)throw new Error('invalid proto version, "v='.concat(C.value,'"'));return this.currentLine++,N}parseOrigin(){const C=this.getCurrentRecord();if(C.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const N=this.extractOneOrMore(C,w);this.consumeSpaceForRecord(C);const U=this.extractOneOrMore(C,T);this.consumeSpaceForRecord(C);const K=this.extractOneOrMore(C,T);this.consumeSpaceForRecord(C);const Ce=this.extractOneOrMore(C,P);this.consumeSpaceForRecord(C);const Ct=this.extractOneOrMore(C,P);this.consumeSpaceForRecord(C);const mr=this.extract(C,this.consumeUnicastAddress);return this.currentLine++,{username:N,sessId:U,sessVersion:K,nettype:Ce,addrtype:Ct,unicastAddress:mr}}parseSessionName(){const C=this.getCurrentRecord();if(C.type===y.SESSION_NAME){const N=this.extract(C,this.consumeText);return this.currentLine++,N}}parseInformation(){const C=this.getCurrentRecord();if(C.type!==y.INFORMATION)return;const N=this.extract(C,this.consumeText);return this.currentLine++,N}parseUri(){const C=this.getCurrentRecord();if(C.type===y.URI)return this.currentLine++,C.value}parseEmail(){const C=[];for(;;){const N=this.getCurrentRecord();if(N.type!==y.EMAIL)break;C.push(N.value),this.currentLine++}return C}parsePhone(){const C=[];for(;;){const N=this.getCurrentRecord();if(N.type!==y.PHONE)break;C.push(N.value),this.currentLine++}return C}parseConnection(){const C=this.getCurrentRecord();if(C.type===y.CONNECTION){const N=this.extractOneOrMore(C,P);this.consumeSpaceForRecord(C);const U=this.extractOneOrMore(C,P);this.consumeSpaceForRecord(C);const K=this.extract(C,this.consumeAddress);return this.currentLine++,{nettype:N,addrtype:U,address:K}}}parseMedia(){const C=this.getCurrentRecord(),N=this.extract(C,this.consumeToken);this.consumeSpaceForRecord(C);let U=this.extract(C,this.consumePort);"/"===C.value[C.cur]&&(C.cur+=1,U+=this.extract(C,this.consumeInteger)),this.consumeSpaceForRecord(C);const K=[];for(K.push(this.extract(C,this.consumeToken));"/"===C.value[C.cur];)C.cur+=1,K.push(this.extract(C,this.consumeToken));if(0===K.length)throw new Error("Invalid proto");const Ce=this.parseFmt(C);return this.currentLine++,{mediaType:N,port:U,protos:K,fmts:Ce}}parseTimeFields(){const C=[];for(;this.getCurrentRecord().type===y.TIME;){const N=this.parseTime(),U=this.parseRepeat(),K=this.parseZone();C.push({time:N,repeats:U,zones:K})}return C}parseMediaDescription(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const N=this.parseMedia(),U=this.parseInformation(),K=this.parseConnections(),Ce=this.parseBandWidth(),Ct=this.parseKey(),mr=this.parseMediaAttributes(N);C.push({media:N,information:U,connections:K,bandwidths:Ce,key:Ct,attributes:mr})}return C}parseConnections(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)C.push(this.parseConnection());return C}parseFmt(C){const N=[];for(;;)try{this.consumeSpaceForRecord(C),N.push(this.extract(C,this.consumeToken))}catch{break}if(0===N.length)throw new Error("Invalid fmts");return N}extract(C,N,...U){const K=N.call(this,C.value,C.cur,...U),Ce=C.value.slice(C.cur,K);return C.cur=K,Ce}extractOneOrMore(C,N){const U=this.consumeOneOrMore(C.value,C.cur,N),K=C.value.slice(C.cur,U);return C.cur=U,K}consumeSpaceForRecord(C){if(C.value[C.cur]!==E)throw new Error("Invalid space at ".concat(C.cur,"."));C.cur+=1}}class ht extends Et{constructor(...C){super(...C),oe(this,"attributes",void 0),oe(this,"digested",!1)}extractOneOrMore(C,N,U){const K=this.consumeOneOrMore(C.attValue,C._cur,N),Ce=C.attValue.slice(C._cur,K),[Ct,mr]=U||[];if("number"==typeof Ct&&Ce.length<Ct)throw new Error("error in length, should be more or equal than ".concat(Ct," characters."));if("number"==typeof mr&&Ce.length>mr)throw new Error("error in length, should be less or equal than ".concat(mr," characters."));return C._cur=K,Ce}consumeAttributeSpace(C){if(C.attValue[C._cur]!==E)throw new Error("Invalid space at ".concat(C._cur,"."));C._cur+=1}extract(C,N,...U){if(!C.attValue)throw new Error("Nothing to extract from attValue.");const K=N.call(this,C.attValue,C._cur,...U),Ce=C.attValue.slice(C._cur,K);return C._cur=K,Ce}atEnd(C){if(!C.attValue)throw new Error;return C._cur>=C.attValue.length}peekChar(C){if(!C.attValue)throw new Error;return C.attValue[C._cur]}peek(C,N){if(!C.attValue)throw new Error;for(let U=0;U<N.length;U++)if(N[U]!==C.attValue[C._cur+U])return!1;return!0}parseIceUfrag(C){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(C,ce,[4,256])}parseIcePwd(C){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(C,ce,[22,256])}parseIceOptions(C){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const N=[];for(;!this.atEnd(C);){N.push(this.extractOneOrMore(C,ce));try{this.consumeAttributeSpace(C)}catch(U){if(this.atEnd(C))break;throw U}}this.attributes.iceOptions=N}parseFingerprint(C){const N=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const U=this.extract(C,this.consumeTill);this.attributes.fingerprints.push({hashFunction:N,fingerprint:U})}parseExtmap(C){const N=this.extractOneOrMore(C,T);let U;"/"===this.peekChar(C)&&(this.extract(C,this.consume,"/"),U=this.extract(C,this.consumeToken)),this.consumeAttributeSpace(C);const K=this.extract(C,this.consumeTill,E),Ce=ee(ee({entry:parseInt(N,10)},U&&{direction:U}),{},{extensionName:K});this.peekChar(C)===E&&(this.consumeAttributeSpace(C),Ce.extensionAttributes=this.extract(C,this.consumeTill)),this.attributes.extmaps.push(Ce)}parseSetup(C){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const N=this.extract(C,this.consumeTill);if("active"!==N&&"passive"!==N&&"actpass"!==N&&"holdconn"!==N)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=N}}class vt extends ht{constructor(...C){super(...C),oe(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"group":this.parseGroup(C);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"fingerprint":this.parseFingerprint(C);break;case"setup":this.parseSetup(C);break;case"tls-id":this.parseTlsId(C);break;case"identity":this.parseIdentity(C);break;case"extmap":this.parseExtmap(C);break;case"msid-semantic":this.parseMsidSemantic(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(N){throw console.error("parsing session attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),N}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(C){const N=this.extract(C,this.consumeToken),U=[];for(;!this.atEnd(C)&&this.peekChar(C)===E;)this.consumeAttributeSpace(C),U.push(this.extract(C,this.consumeToken));this.attributes.groups.push({semantic:N,identificationTag:U})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(C){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(C,Re)}parseIdentity(C){const N=this.extractOneOrMore(C,Z),U=[];for(;!this.atEnd(C)&&this.peekChar(C)===E;){this.consumeAttributeSpace(C);const K=this.extract(C,this.consumeToken);this.extract(C,this.consume,"=");const Ce=this.extractOneOrMore(C,Ct=>Ct!==E&&H(Ct));U.push({name:K,value:Ce})}this.attributes.identities.push({assertionValue:N,extensions:U})}parseMsidSemantic(C){this.peekChar(C)===E&&this.consumeAttributeSpace(C);const N={semantic:this.extract(C,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(C)}catch{break}if("*"===this.peekChar(C)){this.extract(C,this.consume,"*"),N.applyForAll=!0;break}{const U=this.extract(C,this.consumeTill,E);N.identifierList.push(U)}}this.attributes.msidSemantic=N}}class Jn extends ht{constructor(C){super(),oe(this,"attributes",void 0),-1!==C.protos.indexOf("RTP")||C.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"extmap":this.parseExtmap(C);break;case"setup":this.parseSetup(C);break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"candidate":this.parseCandidate(C);break;case"remote-candidate":this.parseRemoteCandidate(C);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(C);break;case"rtpmap":this.parseRtpmap(C);break;case"ptime":this.parsePtime(C);break;case"maxptime":this.parseMaxPtime(C);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(C);break;case"ssrc":this.parseSSRC(C);break;case"fmtp":this.parseFmtp(C);break;case"rtcp-fb":this.parseRtcpFb(C);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(C);break;case"mid":this.parseMid(C);break;case"msid":this.parseMsid(C);break;case"imageattr":this.parseImageAttr(C);break;case"rid":this.parseRid(C);break;case"simulcast":this.parseSimulcast(C);break;case"sctp-port":this.parseSctpPort(C);break;case"max-message-size":this.parseMaxMessageSize(C);break;case"ssrc-group":this.parseSSRCGroup(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(N){throw console.error("parsing media attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),N}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}parseCandidate(C){const N=this.extractOneOrMore(C,ce,[1,32]);this.consumeAttributeSpace(C);const U=this.extractOneOrMore(C,T,[1,5]);this.consumeAttributeSpace(C);const K=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const Ce=this.extractOneOrMore(C,T,[1,10]);this.consumeAttributeSpace(C);const Ct=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const mr=this.extract(C,this.consumePort);this.consumeAttributeSpace(C),this.extract(C,this.consume,"typ"),this.consumeAttributeSpace(C);const $o={foundation:N,componentId:U,transport:K,priority:Ce,connectionAddress:Ct,port:mr,type:this.extract(C,this.consumeToken),extension:{}};for(this.peek(C," raddr")&&(this.extract(C,this.consume," raddr"),this.consumeAttributeSpace(C),$o.relAddr=this.extract(C,this.consumeAddress)),this.peek(C," rport")&&(this.extract(C,this.consume," rport"),this.consumeAttributeSpace(C),$o.relPort=this.extract(C,this.consumePort));this.peekChar(C)===E;){this.consumeAttributeSpace(C);const tu=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C),$o.extension[tu]=this.extractOneOrMore(C,b)}this.attributes.candidates.push($o)}parseRemoteCandidate(C){const N=[];for(;;){const U=this.extractOneOrMore(C,T,[1,5]);this.consumeAttributeSpace(C);const K=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const Ce=this.extract(C,this.consumePort);N.push({componentId:U,connectionAddress:K,port:Ce});try{this.consumeAttributeSpace(C)}catch{break}}this.attributes.remoteCandidatesList.push(N)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(C){const N=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const U=this.extract(C,this.consumeTill,"/");this.extract(C,this.consume,"/");const K={encodingName:U,clockRate:this.extractOneOrMore(C,T)};this.atEnd(C)||"/"!==this.peekChar(C)||(this.extract(C,this.consume,"/"),K.encodingParameters=parseInt(this.extract(C,this.consumeTill),10));const Ce=this.attributes.payloads.find(Ct=>Ct.payloadType===parseInt(N,10));Ce?Ce.rtpMap=K:this.attributes.payloads.push({payloadType:parseInt(N,10),rtpMap:K,rtcpFeedbacks:[]})}parsePtime(C){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(C,this.consumeTill)}parseMaxPtime(C){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(C,this.consumeTill)}parseDirection(C){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=C.attField}parseSSRC(C){const N=this.extractOneOrMore(C,T);this.consumeAttributeSpace(C);const U=this.extract(C,this.consumeTill,":");let K;":"===this.peekChar(C)&&(this.extract(C,this.consume,":"),K=this.extract(C,this.consumeTill));const Ce=this.attributes.ssrcs.find(Ct=>Ct.ssrcId===parseInt(N,10));Ce?Ce.attributes[U]=K:this.attributes.ssrcs.push({ssrcId:parseInt(N,10),attributes:{[U]:K}})}parseFmtp(C){const N=this.extract(C,this.consumeTill,E);this.consumeAttributeSpace(C);const U=this.extract(C,this.consumeTill),K={};U.split(";").forEach(Ct=>{let[mr,$o]=Ct.split("=");mr=mr.trim();const tu="string"==typeof $o?$o.trim():null;"string"==typeof mr&&mr.length>0&&(K[mr]=tu)});const Ce=this.attributes.payloads.find(Ct=>Ct.payloadType===parseInt(N,10));Ce?Ce.fmtp={parameters:K}:this.attributes.payloads.push({payloadType:parseInt(N,10),rtcpFeedbacks:[],fmtp:{parameters:K}})}parseFmtParameters(C){const N={},U=this.extract(C,this.consumeTill,"=");C._cur++;const K=this.extract(C,this.consumeTill,";");for(N[U]=K;";"===C.attValue[C._cur];){const Ce=this.extract(C,this.consumeTill,"=");C._cur++;const Ct=this.extract(C,this.consumeTill,";");N[Ce]=Ct}return N}parseRtcpFb(C){let N="";N="*"===this.peekChar(C)?this.extract(C,this.consume,"*"):this.extract(C,this.consumeTill,E),this.consumeAttributeSpace(C);const U=this.extract(C,this.consumeTill,E);let K;if("trr-int"===U)K={type:U,interval:this.extract(C,this.consumeTill)};else{const Ce={type:U};this.peekChar(C)===E&&(this.consumeAttributeSpace(C),Ce.parameter=this.extract(C,this.consumeToken),this.peekChar(C)===E&&(Ce.additional=this.extract(C,this.consumeTill))),K=Ce}if("*"===N)this.attributes.rtcpFeedbackWildcards.push(K);else{const Ce=this.attributes.payloads.find(Ct=>Ct.payloadType===parseInt(N,10));Ce?Ce.rtcpFeedbacks.push(K):this.attributes.payloads.push({payloadType:parseInt(N,10),rtcpFeedbacks:[K]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(C){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const N={port:this.extract(C,this.consumePort)};this.peekChar(C)===E&&(this.consumeAttributeSpace(C),N.netType=this.extractOneOrMore(C,P),this.consumeAttributeSpace(C),N.addressType=this.extractOneOrMore(C,P),this.consumeAttributeSpace(C),N.address=this.extract(C,this.consumeAddress)),this.attributes.rtcp=N}parseMsid(C){const N={id:this.extractOneOrMore(C,P,[1,64])};this.peekChar(C)===E&&(this.consumeAttributeSpace(C),N.appdata=this.extractOneOrMore(C,P,[1,64])),this.attributes.msids.push(N)}parseImageAttr(C){this.attributes.imageattr.push(C.attValue)}parseRid(C){const N=this.extractOneOrMore(C,K=>x(K)||T(K)||"_"===K||"-"===K);this.consumeAttributeSpace(C);const U={id:N,direction:this.extract(C,this.consumeToken),params:[]};if(this.peekChar(C)===E){if(this.consumeAttributeSpace(C),this.peek(C,"pt=")){this.extract(C,this.consume,"pt=");const K=[];for(;;){const Ce=this.extract(C,this.consumeToken);K.push(Ce);try{this.extract(C,this.consume,",")}catch{break}}U.payloads=K,this.peekChar(C)===E&&this.extract(C,this.consume,E)}for(;;){const K=this.extract(C,this.consumeToken);switch(K){case"depend":{const Ce={type:K,rids:this.extract(C,this.consume,"=").split(",")};U.params.push(Ce);break}default:{const Ce={type:K};"="===this.peekChar(C)&&(this.extract(C,this.consume,"="),Ce.val=this.extract(C,this.consumeTill,";")),U.params.push(Ce)}}try{this.extract(C,this.consume,";")}catch{break}}}this.attributes.rids.push(U)}parseSimulcast(C){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=C.attValue,this.extract(C,this.consumeTill)}parseSctpPort(C){this.attributes.sctpPort=this.extractOneOrMore(C,T,[1,5])}parseMaxMessageSize(C){this.attributes.maxMessageSize=this.extractOneOrMore(C,T,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(C){this.attributes.mid=this.extract(C,this.consumeToken)}parseSSRCGroup(C){const N=this.extract(C,this.consumeToken),U=[];for(;;)try{this.consumeAttributeSpace(C);const K=this.extract(C,this.consumeInteger);U.push(parseInt(K,10))}catch{break}this.attributes.ssrcGroups.push({semantic:N,ssrcIds:U})}}function Jt(X,C,N){return C in X?Object.defineProperty(X,C,{value:N,enumerable:!0,configurable:!0,writable:!0}):X[C]=N,X}class Sn{constructor(){Jt(this,"eol",_)}print(C,N){let U="";return N&&(this.eol=N),U+=this.printVersion(C.version),U+=this.printOrigin(C.origin),U+=this.printSessionName(C.sessionName),U+=this.printInformation(C.information),U+=this.printUri(C.uri),U+=this.printEmail(C.emails),U+=this.printPhone(C.phones),U+=this.printConnection(C.connection),U+=this.printBandwidth(C.bandwidths),U+=this.printTimeFields(C.timeFields),U+=this.printKey(C.key),U+=this.printSessionAttributes(C.attributes),U+=this.printMediaDescription(C.mediaDescriptions),U}printVersion(C){return"v=".concat(C).concat(this.eol)}printOrigin(C){return"o=".concat(C.username," ").concat(C.sessId," ").concat(C.sessVersion," ").concat(C.nettype," ").concat(C.addrtype," ").concat(C.unicastAddress).concat(this.eol)}printSessionName(C){return C?"s=".concat(C).concat(this.eol):""}printInformation(C){return C?"i=".concat(C).concat(this.eol):""}printUri(C){return C?"u=".concat(C).concat(this.eol):""}printEmail(C){let N="";for(const U of C)N+="e=".concat(U).concat(this.eol);return N}printPhone(C){let N="";for(const U of C)N+="e=".concat(U).concat(this.eol);return N}printConnection(C){return C?"c=".concat(C.nettype," ").concat(C.addrtype," ").concat(C.address).concat(this.eol):""}printBandwidth(C){let N="";for(const U of C)N+="b=".concat(U.bwtype,":").concat(U.bandwidth).concat(this.eol);return N}printTimeFields(C){let N="";for(const U of C){N+="t=".concat(U.time.startTime," ").concat(U.time.startTime).concat(this.eol);for(const K of U.repeats)N+="r=".concat(K.repeatInterval," ").concat(K.typedTimes.join(" ")).concat(this.eol);U.zoneAdjustments&&(N+="z=",N+="z=".concat(U.zoneAdjustments.map(K=>"".concat(K.time," ").concat(K.back?"-":""," ").concat(K.typedTime)).join(" ")).concat(this.eol),N+=this.eol)}return N}printKey(C){return C?"k=".concat(C).concat(this.eol):""}printAttributes(C){let N="";for(const U of C)N+="a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol);return N}printMediaDescription(C){let N="";for(const U of C)N+=this.printMedia(U.media),N+=this.printInformation(U.information),N+=this.printConnections(U.connections),N+=this.printBandwidth(U.bandwidths),N+=this.printKey(U.key),N+=this.printMediaAttributes(U);return N}printConnections(C){let N="";for(const U of C)N+=this.printConnection(U);return N}printMedia(C){return"m=".concat(C.mediaType," ").concat(C.port," ").concat(C.protos.join("/")," ").concat(C.fmts.join(" ")).concat(this.eol)}printSessionAttributes(C){return new z(this.eol).print(C)}printMediaAttributes(C){return new ne(this.eol).print(C)}}class G{constructor(C){Jt(this,"eol",void 0),this.eol=C}printIceUfrag(C){return void 0===C?"":"a=ice-ufrag:".concat(C).concat(this.eol)}printIcePwd(C){return void 0===C?"":"a=ice-pwd:".concat(C).concat(this.eol)}printIceOptions(C){return void 0===C?"":"a=ice-options:".concat(C.join(E)).concat(this.eol)}printFingerprints(C){return C.length>0?C.map(N=>"a=fingerprint:".concat(N.hashFunction).concat(E).concat(N.fingerprint)).join(this.eol)+this.eol:""}printExtmap(C){return C.map(N=>"a=extmap:".concat(N.entry).concat(N.direction?"/".concat(N.direction):"").concat(E).concat(N.extensionName).concat(N.extensionAttributes?"".concat(E).concat(N.extensionAttributes):"").concat(this.eol)).join("")}printSetup(C){return void 0===C?"":"a=setup:".concat(C).concat(this.eol)}printUnrecognized(C){return C.map(N=>"a=".concat(N.attField).concat(N.attValue?":".concat(N.attValue):"").concat(this.eol)).join("")}}class z extends G{print(C){let N="";return N+=this.printGroups(C.groups),N+=this.printMsidSemantic(C.msidSemantic),N+=this.printIceLite(C.iceLite),N+=this.printIceUfrag(C.iceUfrag),N+=this.printIcePwd(C.icePwd),N+=this.printIceOptions(C.iceOptions),N+=this.printFingerprints(C.fingerprints),N+=this.printSetup(C.setup),N+=this.printTlsId(C.tlsId),N+=this.printIdentity(C.identities),N+=this.printExtmap(C.extmaps),N+=this.printUnrecognized(C.unrecognized),N}printGroups(C){let N="";return C.length>0&&(N+=C.map(U=>"a=group:".concat(U.semantic).concat(U.identificationTag.map(K=>"".concat(E).concat(K)).join("")).concat(this.eol)).join("")),N}printIceLite(C){return void 0===C?"":"a=ice-lite"+this.eol}printTlsId(C){return C?"a=tls-id:".concat(C).concat(this.eol):""}printIdentity(C){return 0===C.length?"":C.map(N=>"a=identity:".concat(N.assertionValue).concat(N.extensions.map(U=>"".concat(E).concat(U.name).concat(U.value?"=".concat(U.value):"")))).join(this.eol)+this.eol}printMsidSemantic(C){if(!C)return"";let N="a=msid-semantic:".concat(C.semantic);return C.applyForAll?N+="".concat(E,"*"):C.identifierList.length>0&&(N+=C.identifierList.map(U=>"".concat(E).concat(U))),N+this.eol}}class ne extends G{print(C){const N=C.attributes;let U="";return U+=this.printRTCP(N.rtcp),U+=this.printIceUfrag(N.iceUfrag),U+=this.printIcePwd(N.icePwd),U+=this.printIceOptions(N.iceOptions),U+=this.printCandidates(N.candidates),U+=this.printRemoteCandidatesList(N.remoteCandidatesList),U+=this.printEndOfCandidates(N.endOfCandidates),U+=this.printFingerprints(N.fingerprints),U+=this.printSetup(N.setup),U+=this.printMid(N.mid),U+=this.printExtmap(N.extmaps),U+=this.printRTPRelated(N),U+=this.printPtime(N.ptime),U+=this.printMaxPtime(N.maxPtime),U+=this.printDirection(N.direction),U+=this.printSSRCGroups(N.ssrcGroups),U+=this.printSSRC(N.ssrcs),U+=this.printRTCPMux(N.rtcpMux),U+=this.printRTCPMuxOnly(N.rtcpMuxOnly),U+=this.printRTCPRsize(N.rtcpRsize),U+=this.printMSId(N.msids),U+=this.printImageattr(N.imageattr),U+=this.printRid(N.rids),U+=this.printSimulcast(N.simulcast),U+=this.printSCTPPort(N.sctpPort),U+=this.printMaxMessageSize(N.maxMessageSize),U+=this.printUnrecognized(N.unrecognized),U}printCandidates(C){return C.map(N=>"a=candidate:".concat(N.foundation).concat(E).concat(N.componentId).concat(E).concat(N.transport).concat(E).concat(N.priority).concat(E).concat(N.connectionAddress).concat(E).concat(N.port).concat(E,"typ").concat(E).concat(N.type).concat(N.relAddr?"".concat(E,"raddr").concat(E).concat(N.relAddr):"").concat(N.relPort?"".concat(E,"rport").concat(E).concat(N.relPort):"").concat(Object.keys(N.extension).map(U=>"".concat(E).concat(U).concat(E).concat(N.extension[U])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(C){return C.map(N=>"a=remote-candidates:".concat(N.join(E)).concat(this.eol)).join("")}printEndOfCandidates(C){return void 0===C?"":"a=end-of-candidates"+this.eol}printRTPRelated(C){if(!C.payloads)return"";const N=C.payloads;let U="";U+=C.rtcpFeedbackWildcards.map(K=>this.printRTCPFeedback("*",K)).join("");for(const K of N)U+=this.printRtpMap(K.payloadType,K.rtpMap),U+=this.printFmtp(K.payloadType,K.fmtp),U+=K.rtcpFeedbacks.map(Ce=>this.printRTCPFeedback(K.payloadType,Ce)).join("");return U}printFmtp(C,N){if(!N)return"";const U=Object.keys(N.parameters);return 1===U.length&&null===N.parameters[U[0]]?"a=fmtp:".concat(C).concat(E).concat(U[0]).concat(this.eol):"a=fmtp:".concat(C).concat(E).concat(Object.keys(N.parameters).map(K=>"".concat(K,"=").concat(N.parameters[K])).join(";")).concat(this.eol)}printRtpMap(C,N){return N?"a=rtpmap:".concat(C).concat(E).concat(N.encodingName,"/").concat(N.clockRate).concat(N.encodingParameters?"/".concat(N.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(C,N){let U="a=rtcp-fb:".concat(C).concat(E),K=N;return"trr-int"===K.type?U+="ttr-int".concat(E).concat(K.interval):(U+="".concat(K.type),K.parameter&&(U+="".concat(E).concat(K.parameter),K.additional&&(U+="".concat(E).concat(K.additional)))),U+this.eol}printPtime(C){return void 0===C?"":"a=ptime:".concat(C).concat(this.eol)}printMaxPtime(C){return void 0===C?"":"a=maxptime:".concat(C).concat(this.eol)}printDirection(C){return void 0===C?"":"a=".concat(C).concat(this.eol)}printSSRC(C){return C.map(N=>Object.keys(N.attributes).map(U=>"a=ssrc:".concat(N.ssrcId.toString(10)).concat(E).concat(U).concat(N.attributes[U]?":".concat(N.attributes[U]):"").concat(this.eol)).join("")).join("")}printRTCPMux(C){return void 0===C?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(C){return void 0===C?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(C){return void 0===C?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(C){if(void 0===C)return"";let N="a=rtcp:".concat(C.port);return C.netType&&(N+="".concat(E).concat(C.netType)),C.addressType&&(N+="".concat(E).concat(C.addressType)),C.address&&(N+="".concat(E).concat(C.address)),N+this.eol}printMSId(C){return C.map(N=>"a=msid:".concat(N.id).concat(N.appdata?"".concat(E).concat(N.appdata):"").concat(this.eol)).join("")}printImageattr(C){return C.map(N=>"a=imageattr:".concat(N).concat(this.eol)).join("")}printRid(C){return C.map(N=>{let U="a=rid:".concat(N.id).concat(E).concat(N.direction);return N.payloads&&(U+="".concat(E,"pt=").concat(N.payloads.join(","))),N.params.length>0&&(U+="".concat(E).concat(N.params.map(K=>"depend"===K.type?"depend=".concat(K.rids.join(",")):"".concat(K.type,"=").concat(K.val)).join(";"))),U+this.eol}).join("")}printSimulcast(C){return void 0===C?"":"a=simulcast:".concat(C).concat(this.eol)}printSCTPPort(C){return void 0===C?"":"a=sctp-port:".concat(C).concat(this.eol)}printMaxMessageSize(C){return void 0===C?"":"a=max-message-size:".concat(C).concat(this.eol)}printMid(C){return void 0===C?"":"a=mid:".concat(C).concat(this.eol)}printSSRCGroups(C){return C.map(N=>"a=ssrc-group:".concat(N.semantic).concat(N.ssrcIds.map(U=>"".concat(E).concat(U.toString(10))).join("")).concat(this.eol)).join("")}}function _e(X){return(new Oe).parse(X)}function We(X,C){return(new Sn).print(X,C)}}},s={};function u(d){if(s[d])return s[d].exports;var h=s[d]={exports:{}};return i[d](h,h.exports,u),h.exports}return u.d=(d,h)=>{for(var f in h)u.o(h,f)&&!u.o(d,f)&&Object.defineProperty(d,f,{enumerable:!0,get:h[f]})},u.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),u.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},u(8)})()}(gn);class OP{constructor(r){S(this,"sessionDesc",void 0),S(this,"localCapabilities",void 0),S(this,"rtpCapabilities",void 0),S(this,"candidates",void 0),S(this,"iceParameters",void 0),S(this,"dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),r=$t(r);const{remoteIceParameters:i,remoteDtlsParameters:s,candidates:u,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:f,cname:_}=r,E=gn.exports.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=d,this.candidates=u,this.iceParameters=i,this.dtlsParameters=s,this.setup=h,this.localCapabilities=f,this.cname=_;for(let y=0;y<E.mediaDescriptions.length;y++){const T=E.mediaDescriptions[y];T.attributes.iceUfrag=i.iceUfrag,T.attributes.icePwd=i.icePwd,T.attributes.fingerprints=s.fingerprints,T.attributes.candidates=u,T.attributes.setup=h,"video"===T.media.mediaType&&(T.media.fmts=d.videoCodecs.map(b=>b.payloadType.toString(10)),T.attributes.payloads=d.videoCodecs,T.attributes.extmaps=d.videoExtensions),"audio"===T.media.mediaType&&(T.media.fmts=d.audioCodecs.map(b=>b.payloadType.toString(10)),T.attributes.payloads=d.audioCodecs,T.attributes.extmaps=d.audioExtensions),E.mediaDescriptions[y]=this.mungMediaDesc(T)}this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return gn.exports.print(this.sessionDesc)}send(r,i,s){const{ssrcs:u,ssrcGroups:d}=fi(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(_=>r===be.VIDEO?"video"===_.media.mediaType:"audio"===_.media.mediaType),f=u[0].attributes.label,m=u[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(u),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:f,mslabel:m}}batchSend(r){return r.map(i=>{let{kind:s,ssrcMsg:u}=i;return this.send(s,u,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const s=[],u=[],d=[];i.attributes.ssrcs.forEach(h=>{r.includes(h.attributes.label||"")?d.push(h):s.push(h)}),i.attributes.ssrcGroups.forEach(h=>{d.map(f=>f.ssrcId).includes(h.ssrcIds[0])||u.push(h)}),i.attributes.ssrcs=s,i.attributes.ssrcGroups=u})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,s){r.forEach((u,d)=>{const h=u._mediaStreamTrack,f=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===h.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],u);this.sessionDesc.mediaDescriptions[f]=m})}stopReceiving(r){}updateCandidates(r){r===ar.TCP?this.candidates.forEach(i=>{-1===this.candidates.findIndex(s=>"tcp"===s.transport&&s.connectionAddress===i.connectionAddress&&s.port===i.port)&&this.candidates.push($m($m({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this.candidates=this.candidates.filter(i=>"tcp"!==i.transport);for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(r){r=$t(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let s=0;s<r;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}mungRecvMediaDsec(r,i){const s=$t(r);return vh(s,i),jA(s,i),s}updateRecvMedia(r,i){const s=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===r);if(-1!==s){const u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=u}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,s){const u=this.sessionDesc.mediaDescriptions.find(h=>r===be.VIDEO?"video"===h.attributes.mid:"audio"===h.attributes.mid);if(u){const h=u.attributes.ssrcs.find(f=>f.attributes.label===i);var d;h&&(h.attributes.label=s,null===(d=h.attributes.msid)||void 0===d||d.replace(i,s))}}mungMediaDesc(r){const i=$t(r);return FA(i),function(s){const u=s.attributes.extmaps.find(d=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===d.extensionName);u&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(u),1),s.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(f=>"transport-cc"===f.type);-1!==h&&d.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const s of i.attributes.ssrcs)if(s.attributes.label===r)return[s]}}function wo(o){if(Array.isArray(o))return o.map(i=>i);if(!zm(o))return o;const r={};for(const i in o)r[i]=zm(o[i])||Array.isArray(o[i])?wo(o[i]):o[i];return r}function zm(o){return!("object"!=typeof o||Array.isArray(o)||!o)}class HA{constructor(r){S(this,"input",[]),S(this,"size",void 0),this.size=r}add(r){this.input.push(r),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Qc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Ad={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Qc,remoteCandidate:Qc}},GA={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},WA={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},KA={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},qA={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function aS(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function cS(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?aS(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):aS(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Jm{constructor(r,i){var s=this;S(this,"onFirstVideoReceived",void 0),S(this,"onFirstVideoDecoded",void 0),S(this,"onFirstAudioReceived",void 0),S(this,"onFirstVideoDecodedTimeout",void 0),S(this,"onFirstAudioDecoded",void 0),S(this,"onSelectedLocalCandidateChanged",void 0),S(this,"onSelectedRemoteCandidateChanged",void 0),S(this,"videoIsReady",!1),S(this,"videoIsReady2",{}),S(this,"pc",void 0),S(this,"options",void 0),S(this,"intervalTimer",void 0),S(this,"stats",wo(Ad)),S(this,"isFirstVideoReceived",{}),S(this,"isFirstVideoDecoded",{}),S(this,"isFirstAudioReceived",{}),S(this,"isFirstAudioDecoded",{}),S(this,"isFirstVideoDecodedTimeout",{}),S(this,"lossRateWindowStats",[]),this.pc=r,this.options=i,this.intervalTimer=window.setInterval(M(function*(){s.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ie(r=>{r({local:cS({},Qc),remote:cS({},Qc)})})}setVideoIsReady(r){this.videoIsReady=r}setVideoIsReady2(r,i){this.videoIsReady2[r]=i}getVideoIsReady(r){return this.videoIsReady2[r]||!1}setIsFirstAudioDecoded(r){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(r){this.lossRateWindowStats.push(r),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const i=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let u=0,d=0,h=0,f=0;for(const m of s)r[m].forEach((_,E)=>{if(!this.lossRateWindowStats[i-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const y=this.lossRateWindowStats[i-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,T=this.lossRateWindowStats[i-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;"videoSend"===m||"audioSend"===m?(u+=y,h+=T):(d+=y,f+=T),_.packetLostRate=Number.isNaN(y)||Number.isNaN(y)||y<=0||T<=0?0:T/(y+T)});r.sendPacketLossRate=u<=0||h<=0?0:h/(u+h),r.recvPacketLossRate=d<=0||f<=0?0:f/(d+f)}}function $A(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function NP(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?$A(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):$A(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class zA extends Jm{constructor(){super(...arguments),S(this,"_stats",Ad),S(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var r=this;return M(function*(){const i=yield r._getStats(),s=r.statsResponsesToObjects(i);r._stats=wo(Ad);const u=s.filter(h=>"ssrc"===h.type);r.processSSRCStats(u);const d=s.find(h=>"VideoBwe"===h.type);d&&r.processBandwidthStats(d),r._stats.timestamp=Date.now(),r.calcLossRate(r._stats),r.stats=r._stats})()}processBandwidthStats(r){this._stats.bitrate={actualEncoded:Number(r.googActualEncBitrate),targetEncoded:Number(r.googTargetEncBitrate),retransmit:Number(r.googRetransmitBitrate),transmit:Number(r.googTransmitBitrate)},this._stats.sendBandwidth=Number(r.googAvailableSendBandwidth)}processSSRCStats(r){r.forEach(i=>{const s=i.id.includes("send");switch("".concat(i.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const u=wo(WA);u.codec=i.googCodecName,u.adaptionChangeReason="none",i.googCpuLimitedResolution&&(u.adaptionChangeReason="cpu"),i.googBandwidthLimitedResolution&&(u.adaptionChangeReason="bandwidth"),u.avgEncodeMs=Number(i.googAvgEncodeMs),u.inputFrame={width:Number(i.googFrameWidthInput)||Number(i.googFrameWidthSent),height:Number(i.googFrameHeightInput)||Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},u.sentFrame={width:Number(i.googFrameWidthSent),height:Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},u.firsCount=Number(i.googFirReceived),u.nacksCount=Number(i.googNacksReceived),u.plisCount=Number(i.googPlisReceived),u.frameCount=Number(i.framesEncoded),u.bytes=Number(i.bytesSent),u.packets=Number(i.packetsSent),u.packetsLost=Number(i.packetsLost),u.ssrc=Number(i.ssrc),u.rttMs=Number(i.googRtt||0),this._stats.videoSend.push(u),this._stats.rtt=u.rttMs;break}case"video_recv":{const u=wo(GA),d=this.lastDecodeVideoReceiverStats.get(Number(i.ssrc));if(u.codec=i.googCodecName,u.targetDelayMs=Number(i.googTargetDelayMs),u.renderDelayMs=Number(i.googRenderDelayMs),u.currentDelayMs=Number(i.googCurrentDelayMs),u.minPlayoutDelayMs=Number(i.googMinPlayoutDelayMs),u.decodeMs=Number(i.googDecodeMs),u.maxDecodeMs=Number(i.googMaxDecodeMs),u.receivedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateReceived)},u.decodedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateDecoded)},u.decodeFrameRate=Number(i.googFrameRateDecoded),u.outputFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateOutput)},u.jitterBufferMs=Number(i.googJitterBufferMs),u.firsCount=Number(i.googFirsSent),u.nacksCount=Number(i.googNacksSent),u.plisCount=Number(i.googPlisSent),u.framesDecodeCount=Number(i.framesDecoded),u.bytes=Number(i.bytesReceived),u.packets=Number(i.packetsReceived),u.packetsLost=Number(i.packetsLost),u.ssrc=Number(i.ssrc),u.packets>0&&!this.isFirstVideoReceived[u.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(u.ssrc),this.isFirstVideoReceived[u.ssrc]=!0),u.framesDecodeCount>0&&!this.isFirstVideoDecoded[u.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(u.ssrc,u.decodedFrame.width,u.decodedFrame.height),this.isFirstVideoDecoded[u.ssrc]=!0),d){const h=d.stats,f=Date.now()-d.lts;u.framesDecodeFreezeTime=h.framesDecodeFreezeTime,u.framesDecodeInterval=h.framesDecodeInterval,u.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[u.ssrc]?(d.lts=Date.now(),u.framesDecodeInterval=f,u.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc,10))?u.framesDecodeFreezeTime+=u.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):u.framesDecodeCount<d.stats.framesDecodeCount&&(u.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(u.ssrc,{stats:NP({},u),lts:Date.now()}),this._stats.videoRecv.push(u);break}case"audio_recv":{const u=wo(qA);u.codec=i.googCodecName,u.outputLevel=Math.abs(Number(i.audioOutputLevel))/32767,u.decodingCNG=Number(i.googDecodingCNG),u.decodingCTN=Number(i.googDecodingCTN),u.decodingCTSG=Number(i.googDecodingCTSG),u.decodingNormal=Number(i.googDecodingNormal),u.decodingPLC=Number(i.googDecodingPLC),u.decodingPLCCNG=Number(i.googDecodingPLCCNG),u.expandRate=Number(i.googExpandRate),u.accelerateRate=Number(i.googAccelerateRate),u.preemptiveExpandRate=Number(i.googPreemptiveExpandRate),u.secondaryDecodedRate=Number(i.googSecondaryDecodedRate),u.speechExpandRate=Number(i.googSpeechExpandRate),u.preferredJitterBufferMs=Number(i.googPreferredJitterBufferMs),u.jitterBufferMs=Number(i.googJitterBufferMs),u.jitterMs=Number(i.googJitterReceived),u.bytes=Number(i.bytesReceived),u.packets=Number(i.packetsReceived),u.packetsLost=Number(i.packetsLost),u.ssrc=Number(i.ssrc),u.receivedFrames=Number(i.googDecodingCTN)||Number(i.packetsReceived),u.droppedFrames=Number(i.googDecodingPLC)+Number(i.googDecodingPLCCNG)||Number(i.packetsLost),u.receivedFrames>0&&!this.isFirstAudioReceived[u.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(u.ssrc),this.isFirstAudioReceived[u.ssrc]=!0),u.decodingNormal>0&&!this.isFirstAudioDecoded[u.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(u.ssrc),this.isFirstAudioDecoded[u.ssrc]=!0),this._stats.audioRecv.push(u);break}case"audio_send":{const u=wo(KA);u.codec=i.googCodecName,u.inputLevel=Math.abs(Number(i.audioInputLevel))/32767,u.aecReturnLoss=Number(i.googEchoCancellationReturnLoss||0),u.aecReturnLossEnhancement=Number(i.googEchoCancellationReturnLossEnhancement||0),u.residualEchoLikelihood=Number(i.googResidualEchoLikelihood||0),u.residualEchoLikelihoodRecentMax=Number(i.googResidualEchoLikelihoodRecentMax||0),u.bytes=Number(i.bytesSent),u.packets=Number(i.packetsSent),u.packetsLost=Number(i.packetsLost),u.ssrc=Number(i.ssrc),u.rttMs=Number(i.googRtt||0),this._stats.rtt=u.rttMs,this._stats.audioSend.push(u);break}}})}_getStats(){return new ie((r,i)=>{this.pc.getStats(r,i)})}statsResponsesToObjects(r){const i=[];return r.result().forEach(s=>{const u={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(d=>{u[d]=s.stat(d)}),i.push(u)}),i}}function Th(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function Dd(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?Th(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Th(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class uS extends Jm{constructor(){super(...arguments),S(this,"_stats",Ad),S(this,"report",void 0),S(this,"lastDecodeVideoReceiverStats",new Map),S(this,"lastVideoFramesRecv",new Map),S(this,"lastVideoFramesSent",new Map),S(this,"lastVideoFramesDecode",new Map),S(this,"lastVideoJBDelay",new Map),S(this,"lastAudioJBDelay",new Map),S(this,"mediaBytesSent",new Map),S(this,"mediaBytesRetransmit",new Map),S(this,"mediaBytesTargetEncode",new Map),S(this,"lastEncoderMs",new Map)}updateStats(){var r=this;return M(function*(){r.report=yield r.pc.getStats(),r._stats=wo(Ad),r.report.forEach(i=>{switch(i.type){case So.OUTBOUND:"audio"===i.mediaType?r.processAudioOutboundStats(i):"video"===i.mediaType&&r.processVideoOutboundStats(i);break;case So.INBOUND:"audio"===i.mediaType?r.processAudioInboundStats(i):"video"===i.mediaType&&r.processVideoInboundStats(i);break;case So.TRANSPORT:{const s=r.report.get(i.selectedCandidatePairId);s&&r.processCandidatePairStats(s);break}case So.CANDIDATE_PAIR:i.selected&&r.processCandidatePairStats(i)}}),r.updateSendBitrate(),r._stats.timestamp=Date.now(),r.calcLossRate(r._stats),r.stats=r._stats})()}getSelectedCandidatePair(){var r=this;return M(function*(){const i=yield r.pc.getStats(),s={local:Dd({},Qc),remote:Dd({},Qc)};return i.forEach(u=>{let d;if(u.type===So.TRANSPORT&&(d=i.get(u.selectedCandidatePairId)),u.type===So.CANDIDATE_PAIR&&u.selected&&(d=u),d){const h=(f,m)=>{f.type=m.type,f.id=m.id,m.address&&(f.address=m.address),m.candidateType&&(f.candidateType=m.candidateType),m.port&&(f.port=m.port),m.priority&&(f.priority=m.priority),m.protocol&&(f.protocol=m.protocol),m.relayProtocol&&(f.relayProtocol=m.relayProtocol)};if(d.localCandidateId){const f=i.get(d.localCandidateId);f&&h(s.local,f)}if(d.remoteCandidateId){const f=i.get(d.remoteCandidateId);f&&h(s.remote,f)}}}),s})()}processCandidatePairStats(r){if(this._stats.sendBandwidth=r.availableOutgoingBitrate||0,r.currentRoundTripTime&&(this._stats.rtt=1e3*r.currentRoundTripTime),this._stats.videoSend.forEach(i=>{r.currentRoundTripTime&&(i.rttMs=1e3*r.currentRoundTripTime)}),this._stats.audioSend.forEach(i=>{r.currentRoundTripTime&&(i.rttMs=1e3*r.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=r.id,r.localCandidateId){const i=this.report.get(r.localCandidateId);i&&this.processCandidateStats(i)}if(r.remoteCandidateId){const i=this.report.get(r.remoteCandidateId);i&&this.processCandidateStats(i)}}processCandidateStats(r){let i;r.type===So.LOCAL_CANDIDATE&&(i=this._stats.selectedCandidatePair.localCandidate),r.type===So.REMOTE_CANDIDATE&&(i=this._stats.selectedCandidatePair.remoteCandidate),i&&(i.type=r.type,i.id=r.id,r.address&&(i.address=r.address),r.candidateType&&(i.candidateType=r.candidateType),r.port&&(i.port=r.port),r.priority&&(i.priority=r.priority),r.protocol&&(i.protocol=r.protocol),r.relayProtocol&&(i.relayProtocol=r.relayProtocol),r.type===So.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==i.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Dd({},i),Dd({},this.stats.selectedCandidatePair.localCandidate)),r.type===So.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==i.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Dd({},i),Dd({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(r){let i=this._stats.audioRecv.find(s=>s.ssrc===r.ssrc);i||(i=wo(qA),this._stats.audioRecv.push(i)),i.ssrc=r.ssrc,i.packets=r.packetsReceived,i.packetsLost=r.packetsLost,i.bytes=r.bytesReceived,i.jitterMs=1e3*r.jitter,this.processAudioTrackReceiverStats(r,r.trackId,i),r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),i.receivedFrames||(i.receivedFrames=r.packetsReceived),i.droppedFrames||(i.droppedFrames=r.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.outputLevel&&i.outputLevel>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),"number"==typeof r.concealedSamples&&(i.concealedSamples=r.concealedSamples)}processVideoInboundStats(r){let i=this._stats.videoRecv.find(h=>h.ssrc===r.ssrc);i||(i=wo(GA),this._stats.videoRecv.push(i)),i.ssrc=r.ssrc,i.packets=r.packetsReceived,i.packetsLost=r.packetsLost,i.bytes=r.bytesReceived,i.firsCount=r.firCount,i.nacksCount=r.nackCount,i.plisCount=r.pliCount,i.framesDecodeCount=r.framesDecoded,i.totalInterFrameDelay=r.totalInterFrameDelay,i.totalSquaredInterFrameDelay=r.totalSquaredInterFrameDelay;const s=this.lastDecodeVideoReceiverStats.get(i.ssrc),u=this.lastVideoFramesDecode.get(i.ssrc),d=Date.now();if(i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame?i.decodedFrame.width:0,i.decodedFrame?i.decodedFrame.height:0),this.isFirstVideoDecoded[i.ssrc]=!0),s){const h=s.stats,f=d-s.lts;i.framesDecodeFreezeTime=h.framesDecodeFreezeTime,i.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[i.ssrc]&&f>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[i.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(i.ssrc),this.isFirstVideoDecodedTimeout[i.ssrc]=!0),i.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=f,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):i.framesDecodeCount<h.framesDecodeCount&&(i.framesDecodeInterval=0),r.framesDecoded&&r.qpSum&&(i.qpSumPerFrame=s.stats.framesDecodeCount>r.framesDecoded?r.qpSum/r.framesDecoded:(r.qpSum-s.qpSum)/(r.framesDecoded-s.stats.framesDecodeCount))}u&&d-u.lts>=800?(i.decodeFrameRate=Math.round((i.framesDecodeCount-u.count)/((d-u.lts)/1e3)),this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:d,rate:i.decodeFrameRate})):u?i.decodeFrameRate=u.rate:this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:d,rate:0}),r.totalDecodeTime&&(i.decodeMs=1e3*r.totalDecodeTime),this.processVideoTrackReceiverStats(r,r.trackId,i),r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),r.framerateMean&&(i.framesRateFirefox=r.framerateMean),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:Dd({},i),lts:s?s.lts:Date.now(),qpSum:r.qpSum})}processVideoOutboundStats(r){let i=this._stats.videoSend.find(u=>u.ssrc===r.ssrc);i||(i=wo(WA),this._stats.videoSend.push(i));const s=this.mediaBytesSent.get(r.ssrc);if(s)s.add(r.bytesSent);else{const u=new HA(10);u.add(r.bytesSent),this.mediaBytesSent.set(r.ssrc,u)}if(void 0!==r.retransmittedBytesSent){const u=this.mediaBytesRetransmit.get(r.ssrc);if(u)u.add(r.retransmittedBytesSent);else{const d=new HA(10);d.add(r.retransmittedBytesSent),this.mediaBytesRetransmit.set(r.ssrc,d)}}if(r.totalEncodedBytesTarget){const u=this.mediaBytesTargetEncode.get(r.ssrc);if(u)u.add(r.totalEncodedBytesTarget);else{const d=new HA(10);d.add(r.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(r.ssrc,d)}}if(i.ssrc=r.ssrc,i.bytes=r.bytesSent,i.packets=r.packetsSent,i.firsCount=r.firCount,i.nacksCount=r.nackCount,i.plisCount=r.pliCount,i.frameCount=r.framesEncoded,i.adaptionChangeReason=r.qualityLimitationReason,i.scalabilityMode=r.scalabilityMode,r.totalEncodeTime&&r.framesEncoded){const u=this.lastEncoderMs.get(r.ssrc);i.avgEncodeMs=!u||u.lastFrameCount>r.framesEncoded?1e3*r.totalEncodeTime/r.framesEncoded:1e3*(r.totalEncodeTime-u.lastEncoderTime)/(r.framesEncoded-u.lastFrameCount)}if(r.framesEncoded&&r.qpSum){const u=this.lastEncoderMs.get(r.ssrc);i.qpSumPerFrame=!u||u.lastFrameCount>r.framesEncoded?r.qpSum/r.framesEncoded:(r.qpSum-u.lastQpSum)/(r.framesEncoded-u.lastFrameCount)}if(this.lastEncoderMs.set(r.ssrc,{lastFrameCount:r.framesEncoded,lastEncoderTime:r.totalEncodeTime,lastQpSum:r.qpSum,lts:Date.now()}),r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),r.mediaSourceId&&this.processVideoMediaSource(r.mediaSourceId,i),this.processVideoTrackSenderStats(r,r.trackId,i),r.remoteId)this.processRemoteInboundStats(r.remoteId,i);else{const u=this.findRemoteStatsId(r.ssrc,So.REMOTE_INBOUND);u&&this.processRemoteInboundStats(u,i)}}processAudioOutboundStats(r){let i=this._stats.audioSend.find(s=>s.ssrc===r.ssrc);if(i||(i=wo(KA),this._stats.audioSend.push(i)),i.ssrc=r.ssrc,i.packets=r.packetsSent,i.bytes=r.bytesSent,r.mediaSourceId&&this.processAudioMediaSource(r.mediaSourceId,i),r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),this.processAudioTrackSenderStats(r,r.trackId,i),r.remoteId)this.processRemoteInboundStats(r.remoteId,i);else{const s=this.findRemoteStatsId(r.ssrc,So.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,i)}}findRemoteStatsId(r,i){var s;const u=Array.from(Fi(s=this.report).call(s)).find(d=>d.type===i&&d.ssrc===r);return u?u.id:null}processVideoMediaSource(r,i){const s=this.report.get(r);s&&s.width&&s.height&&s.framesPerSecond&&(i.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(r,i){const s=this.report.get(r);s&&(i.inputLevel=s.audioLevel)}processVideoTrackSenderStats(r,i,s){var u,d,h;const f=i?this.report.get(i):void 0,m=null!==(u=f?.framesSent)&&void 0!==u?u:r.framesSent;let _=null!==(d=f?.frameWidth)&&void 0!==d?d:r.frameWidth,E=null!==(h=f?.frameHeight)&&void 0!==h?h:r.frameHeight;if("number"!=typeof m)return;"number"==typeof _&&"number"==typeof E||(_=0,E=0);let y=0;const T=Date.now(),b=this.lastVideoFramesSent.get(s.ssrc);b&&T-b.lts>=800?(y=Math.round((m-b.count)/((T-b.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:m,lts:T,rate:y})):b?y=b.rate:this.lastVideoFramesSent.set(s.ssrc,{count:m,lts:T,rate:0}),s.sentFrame={width:_,height:E,frameRate:Math.max(0,y)}}processVideoTrackReceiverStats(r,i,s){var u,d,h,f,m;const _=i?this.report.get(i):void 0,E=null!==(u=_?.framesReceived)&&void 0!==u?u:r.framesReceived,y=null!==(d=_?.frameWidth)&&void 0!==d?d:r.frameWidth,T=null!==(h=_?.frameHeight)&&void 0!==h?h:r.frameHeight,b=null!==(f=_?.jitterBufferDelay)&&void 0!==f?f:r.jitterBufferDelay,w=null!==(m=_?.jitterBufferEmittedCount)&&void 0!==m?m:r.jitterBufferEmittedCount;if("number"==typeof E){const P=this.lastVideoFramesRecv.get(s.ssrc),k=Date.now();s.framesReceivedCount=E;let x=0;P&&k-P.lts>=800?(x=Math.round((E-P.count)/((k-P.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:k,rate:x})):P?x=P.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:k,rate:0}),s.receivedFrame={width:y||0,height:T||0,frameRate:x||0},s.decodedFrame={width:y||0,height:T||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:y||0,height:T||0,frameRate:s.decodeFrameRate||0}}if(b&&w){let P=this.lastVideoJBDelay.get(s.ssrc);this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:b,jitterBufferEmittedCount:w}),P||(P={jitterBufferDelay:0,jitterBufferEmittedCount:0});const k=1e3*(b-P.jitterBufferDelay)/(w-P.jitterBufferEmittedCount);s.jitterBufferMs=k,s.currentDelayMs=Math.round(k)}}processAudioTrackSenderStats(r,i,s){var u,d,h,f;const m=i?this.report.get(i):void 0,_=null!==(u=null!==(d=m?.echoReturnLoss)&&void 0!==d?d:r.echoReturnLoss)&&void 0!==u?u:0,E=null!==(h=null!==(f=m?.echoReturnLossEnhancement)&&void 0!==f?f:r.echoReturnLossEnhancement)&&void 0!==h?h:0;s.aecReturnLoss=_,s.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(r,i,s){var u,d,h,f,m,_,E;const y=i?this.report.get(i):void 0,T=null!==(u=y?.removedSamplesForAcceleration)&&void 0!==u?u:r.removedSamplesForAcceleration,b=null!==(d=y?.totalSamplesReceived)&&void 0!==d?d:r.totalSamplesReceived,w=null!==(h=y?.jitterBufferDelay)&&void 0!==h?h:r.jitterBufferDelay,P=null!==(f=y?.jitterBufferEmittedCount)&&void 0!==f?f:r.jitterBufferEmittedCount,k=null!==(m=y?.audioLevel)&&void 0!==m?m:r?.audioLevel,x=null!==(_=y?.totalSamplesDuration)&&void 0!==_?_:r?.totalSamplesDuration,B=null!==(E=y?.concealedSamples)&&void 0!==E?E:r.concealedSamples;if(T&&b&&(s.accelerateRate=T/b),w&&P){let ce=this.lastAudioJBDelay.get(s.ssrc);this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:w,jitterBufferEmittedCount:P}),ce||(ce={jitterBufferDelay:0,jitterBufferEmittedCount:0}),s.jitterBufferMs=Math.round(1e3*(w-ce.jitterBufferDelay)/(P-ce.jitterBufferEmittedCount))}s.outputLevel=k;let H=1920;x&&b&&(H=b/x/50,s.receivedFrames=Math.round(b/H)),B&&(s.droppedFrames=Math.round(B/H))}processRemoteInboundStats(r,i){const s=this.report.get(r);s&&(i.packetsLost=s.packetsLost,s.roundTripTime&&(i.rttMs=1e3*s.roundTripTime))}getCodecFromCodecStats(r){const i=this.report.get(r);if(!i)return"";const s=i.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let r=0,i=null,s=null;this.mediaBytesSent.forEach(d=>{r+=d.diffMean()}),this.mediaBytesRetransmit.forEach(d=>{i=null===i?d.diffMean():i+d.diffMean()}),this.mediaBytesTargetEncode.forEach(d=>{s=null===s?d.diffMean():s+d.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==i?r-i:r)/(this.options.updateInterval/1e3),transmit:8*r/(this.options.updateInterval/1e3)},null!==i&&(this._stats.bitrate.retransmit=8*i/(this.options.updateInterval/1e3)),null!==s&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}}class Ch extends Jm{updateStats(){return ie.resolve()}}function dS(o){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const d=function Ym(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null}();return d?d<76?new zA(o,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:u}):new uS(o,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:u}):function Ck(o){return!!window.RTCStatsReport&&o.getStats()instanceof ie}(o)?new uS(o,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:u}):new Ch(o,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:u})}var pt;function PP(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function MP(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?PP(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):PP(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let Ih=(q((pt=class ZS extends Vc{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(r,i){super(r,i),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"statsFilter",void 0),S(this,"useRTX",!1),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"establishPromise",void 0),S(this,"mutex",new Mn("P2PConnection-mutex")),this.store=i,this.peerConnection=new RTCPeerConnection(ZS.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=dS(this.peerConnection,void 0,void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var r=this;return M(function*(){try{const i=yield r.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Rs(i.sdp),u=Wm(i.sdp,!r.useRTX,V("FILTER_VIDEO_FEC"),V("FILTER_AUDIO_FEC"),["opus"]);return r.localCapabilities=u,r.initialOffer=i,MP(MP({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:u},offerSDP:i.sdp})}catch(i){throw new L(D.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}})()}connect(r,i,s,u,d,h){var f=this;return M(function*(){try{if(!f.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");f.remoteSDP=new OP({remoteIceParameters:r,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:u.send,remoteSetup:d,localCapabilities:f.localCapabilities,sdkCodec:f.store.codec,cname:h});const m=f.remoteSDP.toString();yield f.peerConnection.setLocalDescription(f.initialOffer),yield f.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(r,i){var s=this;return pi(function*(){const u=yield Ve(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=r.map(T=>s.peerConnection.addTrack(T._mediaStreamTrack)),h=yield Ve(s.peerConnection.createOffer()),f=gn.exports.parse(h.sdp),m=r.map(T=>{const b=T._mediaStreamTrack,w=f.mediaDescriptions.find(P=>P.attributes.mid===b.kind);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return function(P,k,x){const B=P.attributes.ssrcs.filter(ce=>ce.attributes.label===k),H=P.attributes.ssrcGroups;if(0===B.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(H&&B.length>1){const ce=H.find(Re=>-1!==Re.ssrcIds.indexOf(B[0].ssrcId));return ce?[{ssrcId:ce.ssrcIds[0],rtx:x?ce.ssrcIds[1]:void 0}]:[{ssrcId:B[0].ssrcId}]}return[{ssrcId:B[0].ssrcId}]}(w,b.id,s.useRTX)});let _;try{_=yield m}catch(T){throw d.forEach(b=>{or()&&b.replaceTrack(null),s.peerConnection.removeTrack(b)}),T}const E=s.mungSendOfferSDP(h.sdp,r);s.remoteSDP.receive(r,i,_);const y=s.remoteSDP.toString();return yield Ve(s.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ve(s.applySendEncodings(d,r)),yield Ve(s.peerConnection.setRemoteDescription({type:"answer",sdp:y})),r.map((T,b)=>({localSSRC:m[b],id:T._mediaStreamTrack.id}))}catch(d){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{u()}})()}stopSending(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=i.peerConnection.getSenders().filter(h=>{var f;return-1!==r.indexOf((null===(f=h.track)||void 0===f?void 0:f.id)||"")});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(h=>{or()&&h.replaceTrack(null),i.peerConnection.removeTrack(h)});const u=yield i.peerConnection.createOffer();yield i.peerConnection.setLocalDescription(u),i.remoteSDP.stopReceiving(r);const d=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}})()}receive(r,i,s,u){var d=this;return M(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:h,mslabel:f}=d.remoteSDP.send(r,i,u),m=new ie((y,T)=>{const b=setTimeout(()=>{T(new Error("Cannot receive track, id: ".concat(h)))},1e4),w=P=>{const k=ut();if(("Safari"===k.name&&11===Number(k.version)||vr())&&P.track.id!==h&&P.streams[0].id===f){var x;const B=P.streams[0].getTracks()[0];return null===(x=d.remoteSDP)||void 0===x||x.updateTrackLabel(r,h,P.track.id),d.peerConnection.removeEventListener("track",w),clearTimeout(b),void y(B)}if(P.track.id===h)return d.peerConnection.removeEventListener("track",w),clearTimeout(b),void y(P.track)};d.peerConnection.addEventListener("track",w)}),_=d.remoteSDP.toString();yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const E=yield d.peerConnection.createAnswer();return yield d.peerConnection.setLocalDescription(E),{track:yield m,id:h}}catch(h){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");i.remoteSDP.stopSending(r);const s=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const u=yield i.peerConnection.createAnswer();yield i.peerConnection.setLocalDescription(u)}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(r){return M(function*(){})()}unmuteRemote(r){return M(function*(){})()}muteLocal(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=i.peerConnection.getSenders().filter(u=>{var d;return-1!==r.indexOf((null===(d=u.track)||void 0===d?void 0:d.id)||"")});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(u=>{if(or()&&u.track)u.track.enabled=!1;else{const d=u.getParameters();d.encodings.forEach(h=>h.active=!1),u.setParameters(d)}})}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=i.peerConnection.getSenders().filter(h=>{var f;return-1!==r.indexOf((null===(f=h.track)||void 0===f?void 0:f.id)||"")});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(function(){var h=M(function*(f){if(or()&&f.track)f.track.enabled=!0;else{const m=f.getParameters();m.encodings.forEach(_=>_.active=!0),yield f.setParameters(m)}});return function(f){return h.apply(this,arguments)}}());const u=yield i.peerConnection.createOffer();yield i.peerConnection.setLocalDescription(u);const d=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(r){var i=this;return pi(function*(){const s=yield Ve(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Yt().supportPCSetConfiguration){const m=i.peerConnection.getConfiguration(),_=r===ar.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,i.peerConnection.setConfiguration(m))}else if(r===ar.RELAY)return;r!==ar.RELAY&&i.remoteSDP.updateCandidates(r);const u=yield Ve(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Rs(u.sdp),{remoteIceParameters:h}=yield d.iceParameters;i.remoteSDP.restartICE(h);const f=i.remoteSDP.toString();yield Ve(i.peerConnection.setLocalDescription(u)),yield Ve(i.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(u){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),u)}finally{s()}})()}close(){var r;this.peerConnection.close(),null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}updateEncoderConfig(r,i){var s=this;return M(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const u=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(u.sdp,[i]);s.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const h=s.remoteSDP.toString();yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(u){throw new L(D.EXCHANGE_SDP_FAILED,u.toString())}})()}updateSendParameters(r,i){var s=this;return M(function*(){const u=s.peerConnection.getSenders().filter(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===r});1===u.length&&(yield s.applySendEncodings(u,[i]))})()}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}replaceTrack(r,i){var s=this;return M(function*(){const u=s.peerConnection.getSenders().find(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===i});u&&(yield u.replaceTrack(r._mediaStreamTrack))})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;null===(r=this.onICEConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&"off"!==r.turnServer.mode&&(ps(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...ZS.turnServerConfigToIceServers(r.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...ZS.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}applySendEncodings(r,i){var s=this;return M(function*(){try{if(!Yt().supportSetRtpSenderParameters||r.length!==i.length)return;for(let d=0;d<r.length;d++){var u;const h=r[d],f=i[d];if(!f)continue;const m={},_={};if(f instanceof an)switch(f._optimizationMode){case"motion":m.degradationPreference="maintain-framerate";break;case"detail":m.degradationPreference="maintain-resolution";break;default:m.degradationPreference="balanced"}if(V("DSCP_TYPE")&&as()){const T=V("DSCP_TYPE");["very-low","low","medium","high"].includes(T)&&(_.networkPriority=T)}const E=h.getParameters(),y=null===(u=E.encodings)||void 0===u?void 0:u[0];y&&Object.assign(y,_),Object.assign(E,m),yield h.setParameters(E)}}catch{R.debug("[".concat(s.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(r,i){const s=gn.exports.parse(r);return i.forEach((u,d)=>{const h=u._mediaStreamTrack,f=s.mediaDescriptions.find(m=>m.attributes.mid===h.kind);f&&vh(f,u)}),gn.exports.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;null===(i=this.onFirstAudioReceived)||void 0===i||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;null===(i=this.onFirstVideoReceived)||void 0===i||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;null===(i=this.onFirstAudioDecoded)||void 0===i||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var u;null===(u=this.onFirstVideoDecoded)||void 0===u||u.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=i.remoteSDP.batchSend(r).map((h,f)=>{let{id:m,mslabel:_}=h;const{kind:E}=r[f];return new ie((y,T)=>{const b=setTimeout(()=>{T(new Error("Cannot receive track, id: ".concat(m)))},1e4),w=P=>{const k=ut();if("Safari"===k.name&&11===Number(k.version)&&P.track.id!==m&&P.streams[0].id===_){var x;const B=P.streams[0].getTracks()[0];return null===(x=i.remoteSDP)||void 0===x||x.updateTrackLabel(E,m,P.track.id),i.peerConnection.removeEventListener("track",w),clearTimeout(b),void y({track:B,id:m})}if(P.track.id===m)return i.peerConnection.removeEventListener("track",w),clearTimeout(b),void y({track:P.track,id:m})};i.peerConnection.addEventListener("track",w)})}),u=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"offer",sdp:u});const d=yield i.peerConnection.createAnswer();return yield i.peerConnection.setLocalDescription(d),yield ie.all(s)}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}getRemoteSSRC(r){var i=this;return M(function*(){if(!i.remoteSDP)return;const s=i.remoteSDP.getSSRC(r);return s?.[0].ssrcId})()}setConfiguration(r){if(Yt().supportPCSetConfiguration){const i=ZS.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}}).prototype,"connect",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"connect"),pt.prototype),q(pt.prototype,"stopSending",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"stopSending"),pt.prototype),q(pt.prototype,"receive",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"receive"),pt.prototype),q(pt.prototype,"stopReceiving",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"stopReceiving"),pt.prototype),q(pt.prototype,"muteRemote",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"muteRemote"),pt.prototype),q(pt.prototype,"unmuteRemote",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteRemote"),pt.prototype),q(pt.prototype,"muteLocal",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"muteLocal"),pt.prototype),q(pt.prototype,"unmuteLocal",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteLocal"),pt.prototype),q(pt.prototype,"close",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"close"),pt.prototype),q(pt.prototype,"updateEncoderConfig",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"updateEncoderConfig"),pt.prototype),q(pt.prototype,"updateSendParameters",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"updateSendParameters"),pt.prototype),q(pt.prototype,"replaceTrack",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"replaceTrack"),pt.prototype),q(pt.prototype,"getRemoteSSRC",[Ko],Object.getOwnPropertyDescriptor(pt.prototype,"getRemoteSSRC"),pt.prototype),pt);function Ko(o,r,i){const s=o[r];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=M(function*(){const u=this.mutex,d=yield u.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield s.apply(this,f)}finally{d()}}),i}function YA(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function JA(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?YA(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):YA(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Ik{get localCapabilities(){return $t(this._localCapabilities)}get rtpCapabilities(){return $t(this._rtpCapabilities)}get candidates(){return $t(this._candidates)}get iceParameters(){return $t(this._iceParameters)}get dtlsParameters(){return $t(this._dtlsParameters)}constructor(r){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),S(this,"firefoxSsrcMidMap",new Map),r=$t(r);const{remoteIceParameters:i,remoteDtlsParameters:s,candidates:u,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:f,cname:m}=r,_=gn.exports.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=d,this._candidates=u,this._iceParameters=i,this._dtlsParameters=s,this._localCapabilities=f,this.setup=h,this.cname=m;const E=this.rtpCapabilities.send;for(const y of _.mediaDescriptions){if(y.attributes.iceUfrag=i.iceUfrag,y.attributes.icePwd=i.icePwd,y.attributes.fingerprints=s.fingerprints,y.attributes.candidates=u,y.attributes.setup=h,"video"===y.media.mediaType&&(y.media.fmts=E.videoCodecs.map(T=>T.payloadType.toString(10)),y.attributes.payloads=E.videoCodecs,y.attributes.extmaps=E.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:b}=fi([{ssrcId:4e4,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);y.attributes.ssrcs=T,y.attributes.ssrcGroups=b}if("audio"===y.media.mediaType&&(y.media.fmts=E.audioCodecs.map(T=>T.payloadType.toString(10)),y.attributes.payloads=E.audioCodecs,y.attributes.extmaps=E.audioExtensions,Zs(y),V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:b}=fi([{ssrcId:2e4}],this.cname);y.attributes.ssrcs=T,y.attributes.ssrcGroups=b}}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}preloadRemoteMedia(){const r=V("PRELOAD_MEDIA_COUNT"),i=this.candidates,s=this.dtlsParameters,u=this.iceParameters,d=this.rtpCapabilities.send;for(let h=1;h<r;h++){const f=2*h+2e4,m=2*h+4e4,{ssrcs:_,ssrcGroups:E}=fi([{ssrcId:f}],this.cname),{ssrcs:y,ssrcGroups:T}=fi([{ssrcId:m,rtx:V("USE_SUB_RTX")?m+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:u.iceUfrag,icePwd:u.icePwd,unrecognized:[],candidates:i,extmaps:d.videoExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:u.iceUfrag,icePwd:u.icePwd,unrecognized:[],candidates:i,extmaps:d.audioExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return gn.exports.print(this.sessionDesc)}send(r,i,s,u){const{ssrcs:d,ssrcGroups:h}=fi(i,this.cname,V("SYNC_GROUP")?s:void 0),f=this.findPreloadMediaDesc(d);if(f){if(Bt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,f.attributes.mid),u&&(u.twcc||u.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(f,u),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(r,d);let _;return-1===m||1===m&&(or()||Af())||0===m&&V("USE_SUB_RTX")||OI()?(_=this.createOrRecycleSendMedia(r,d,h,"sendonly",u),this.updateBundleMids()):(_=$t(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=d,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,u)),Bt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,_.attributes.mid),{mid:_.attributes.mid,needExchangeSDP:!0}}}batchSend(r){const i=r.map(d=>{let{kind:h,ssrcMsg:f,mslabel:m}=d;return this.send(h,f,m)}),s=[];let u=!1;return i.forEach(d=>{let{mid:h,needExchangeSDP:f}=d;f&&(u=!0),s.push(h)}),{mids:s,needExchangeSDP:u}}stopSending(r){const i=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&-1!==r.indexOf(s.attributes.mid));if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(s=>{"0"===s.attributes.mid||Bt()||OI()?s.attributes.ssrcs=[]:(s.attributes.ssrcs=[],s.attributes.direction="inactive",s.media.port="0")}),this.updateBundleMids()}mute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}muteRemote(r){const i=this.sessionDesc.mediaDescriptions.filter(s=>r.includes(s.attributes.mid||""));if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(r){const i=this.sessionDesc.mediaDescriptions.filter(s=>r.includes(s.attributes.mid||""));if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="recvonly"})}receive(r,i,s,u){r.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",i,s,u[h])}),this.updateBundleMids()}stopReceiving(r){const i=this.sessionDesc.mediaDescriptions.filter(s=>-1!==r.indexOf(s.attributes.mid));if(i.length!==r.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(r){r===ar.TCP?this._candidates.forEach(i=>{-1===this._candidates.findIndex(s=>"tcp"===s.transport&&s.connectionAddress===i.connectionAddress&&s.port===i.port)&&this._candidates.push(JA(JA({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this._candidates=this._candidates.filter(i=>"tcp"!==i.transport);for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(r){r=$t(r),this._iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let s=0;s<r;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}findAvailableMediaIndex(r,i){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const u=s.media.mediaType===r&&"0"!==s.media.port&&("sendonly"===s.attributes.direction||"sendrecv"===s.attributes.direction)&&0===s.attributes.ssrcs.length;if(Bt()){if(u){const d=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(d||"0"!==s.attributes.mid&&"1"!==s.attributes.mid)||!(!d||d!==s.attributes.mid)}return!1}return u})}createOrRecycleRecvMedia(r,i,s,u,d,h){const f=r._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,_=this.localCapabilities.send;let E=[];if(f===be.VIDEO){var y,T;if(V("H264_PROFILE_LEVEL_ID")&&"h264"===u&&(E=m.videoCodecs.filter(x=>{var B,H;return((null===(B=x.rtpMap)||void 0===B?void 0:B.encodingName.toLowerCase())||"").includes(u)&&(null==x||null===(H=x.fmtp)||void 0===H?void 0:H.parameters["profile-level-id"])===V("H264_PROFILE_LEVEL_ID")})),!E||0===(null===(y=E)||void 0===y?void 0:y.length)){const x=_.videoCodecs.filter(B=>{var H;return((null===(H=B.rtpMap)||void 0===H?void 0:H.encodingName.toLowerCase())||"").includes(u)});0!==x.length&&(E=m.videoCodecs.filter(B=>x.some(H=>H.payloadType===B.payloadType)))}if(V("USE_PUB_RTX")){const x=E.map(H=>H.payloadType.toString()),B=m.videoCodecs.filter(H=>{var ce,Re;return"rtx"===(null===(ce=H.rtpMap)||void 0===ce?void 0:ce.encodingName)&&x.includes((null===(Re=H.fmtp)||void 0===Re?void 0:Re.parameters.apt)||"")});E=[...E,...B]}0===E.length&&(R.warning("codec ".concat(u," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(T=m.videoCodecs[0].rtpMap)||void 0===T?void 0:T.encodingName)),E=m.videoCodecs)}else E=m.audioCodecs.filter(x=>{var B;return((null===(B=x.rtpMap)||void 0===B?void 0:B.encodingName.toLowerCase())||"").includes(d)}),0===E.length&&(R.warning("codec ".concat(d," not included in rtpCapabilities, fallback to opus")),E=m.audioCodecs.filter(x=>{var B;return((null===(B=x.rtpMap)||void 0===B?void 0:B.encodingName.toLowerCase())||"").includes("opus")}));const b=f===be.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const w="".concat(this.currentMidIndex);let P={media:{mediaType:f,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:E.map(x=>x.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:b,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:E,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(w)}};P=this.mungRecvMediaDsec(P,r,h);const k=this.findFirstClosedMedia(f);if(k){const x=this.sessionDesc.mediaDescriptions.indexOf(k);this.sessionDesc.mediaDescriptions[x]=P}else this.sessionDesc.mediaDescriptions.push(P);return P}createOrRecycleSendMedia(r,i,s,u,d){const h=this.rtpCapabilities.send,f=r===be.VIDEO?h.videoCodecs:h.audioCodecs,m=r===be.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let E={media:{mediaType:r,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:u,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};E=this.mungSendMediaDesc(E,d);const y=this.findFirstClosedMedia(r);if(y){const T=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[T]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(r=>"0"!==r.media.port).map(r=>r.attributes.mid)}mungRecvMediaDsec(r,i,s){const u=$t(r);return FA(u),vh(u,i),jA(u,i),wP(u),Km(u,s,this.localCapabilities.send),u}mungSendMediaDesc(r,i){const s=$t(r);return Km(s,i,this.localCapabilities.recv),Zs(s),s}updateRecvMedia(r,i){const s=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===r);if(-1!==s){const u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=u}}bumpMid(r){this.currentMidIndex+=r}findFirstClosedMedia(r){return this.sessionDesc.mediaDescriptions.find(i=>Bt()?"0"===i.media.port&&i.media.mediaType===r:"0"===i.media.port)}findPreloadMediaDesc(r){return this.sessionDesc.mediaDescriptions.find(i=>{var s,u;return(null===(s=i.attributes)||void 0===s||null===(u=s.ssrcs[0])||void 0===u?void 0:u.ssrcId)===r[0].ssrcId})}getSSRC(r){var i;return null===(i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r))||void 0===i?void 0:i.attributes.ssrcs}}var ft;function Xm(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function Zc(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?Xm(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Xm(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let bs=(q((ft=class eT extends Vc{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i,s;return null!==(r=null===(i=this.peerConnection.getReceivers()[0])||void 0===i||null===(s=i.transport)||void 0===s?void 0:s.state)&&void 0!==r?r:null}constructor(r,i){super(r,i),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"transportEventReceiver",void 0),S(this,"statsFilter",void 0),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"selectedCandidatePairTimer",void 0),S(this,"establishPromise",void 0),S(this,"mutex",new Mn("P2PConnection-mutex")),this.store=i,this.peerConnection=new RTCPeerConnection(eT.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=dS(this.peerConnection,void 0,void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var r=this;return M(function*(){try{r.peerConnection.addTransceiver("video",{direction:"recvonly"}),r.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=yield r.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Rs(i.sdp),u=yield BA(!V("USE_PUB_RTX")&&!V("USE_SUB_RTX"),V("FILTER_VIDEO_FEC"),V("FILTER_AUDIO_FEC"));return r.localCapabilities=Qs(u),r.initialOffer=i,Zc(Zc({},s),{},{rtpCapabilities:u,offerSDP:i.sdp})}catch(i){throw new L(D.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}})()}connect(r,i,s,u,d,h){var f=this;return M(function*(){try{if(!f.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");f.remoteSDP=new Ik({remoteIceParameters:r,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:u,remoteSetup:d,localCapabilities:f.localCapabilities,cname:h});const m=f.remoteSDP.toString(),_=gn.exports.parse(f.initialOffer.sdp),E=_.mediaDescriptions.find(w=>"audio"===w.media.mediaType);E&&Zs(E);const y=gn.exports.print(_),T=f.logSDPExchange(y||"","offer","local","connect");f.store.descriptionStart(),yield f.peerConnection.setLocalDescription({type:"offer",sdp:y}),T?.(m),yield f.peerConnection.setRemoteDescription({type:"answer",sdp:m});const b=f.peerConnection.getTransceivers()[0];if(null!=b&&b.receiver&&f.tryBindTransportEvents(b.receiver),V("PRELOAD_MEDIA_COUNT")>0){f.remoteSDP.preloadRemoteMedia();const w=f.remoteSDP.toString();yield f.peerConnection.setRemoteDescription({type:"offer",sdp:w});const P=yield f.peerConnection.createAnswer();yield f.peerConnection.setLocalDescription(P)}}catch(m){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(r,i,s){var u=this;return pi(function*(){const d=yield Ve(u.mutex.lock("From P2PConnection.send"));try{if(!u.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];r.forEach(P=>{const k=u.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(k),P._updateRtpTransceiver(k)}),Bt()&&!0===V("SIMULCAST")&&(yield Ve(u.applySimulcastForFirefox(h,r)));const f=yield Ve(u.peerConnection.createOffer()),m=u.remoteSDP.predictReceivingMids(r.length),_=u.mungSendOfferSDP(f.sdp,r,m),E=gn.exports.parse(_),y=m.map(P=>{const k=E.mediaDescriptions.find(x=>x.attributes.mid===P);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return UA(k,V("USE_PUB_RTX"))});let T;try{T=yield y}catch(P){T=[],u.remoteSDP.receive(r,i,s,T);const k=u.remoteSDP.toString();throw yield Ve(u.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Ve(u.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield Ve(u.stopSending(m,!0)),P}u.remoteSDP.receive(r,i,s,T);const b=u.remoteSDP.toString(),w=u.logSDPExchange(_,"offer","local","send");return yield Ve(u.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Ve(u.applySimulcastEncodings(h,r)),yield Ve(u.applySendEncodings(h,r)),w?.(b),yield Ve(u.peerConnection.setRemoteDescription({type:"answer",sdp:b})),h.map((P,k)=>({localSSRC:y[k],id:m[k],transceiver:P}))}catch(h){throw h instanceof L?h:new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}stopSending(r,i){var s=this;return M(function*(){const u=i?void 0:yield s.mutex.lock("From P2PConnection.stopSending");try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=s.peerConnection.getTransceivers().filter(_=>-1!==r.indexOf(_.mid));if(d.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");d.map(_=>{var E;_.direction="inactive",null===(E=_.stop)||void 0===E||E.call(_)});const h=yield s.peerConnection.createOffer(),f=s.logSDPExchange(h.sdp||"","offer","local","stopSending");yield s.peerConnection.setLocalDescription(h),s.remoteSDP.stopReceiving(r);const m=s.remoteSDP.toString();f?.(m),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{u&&u()}})()}receive(r,i,s,u){var d=this;return M(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=d.remoteSDP.send(r,i,s,u);if(f){const _=d.remoteSDP.toString(),E=d.logSDPExchange(_,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=yield d.peerConnection.createAnswer(),T=d.mungReceiveAnswerSDP(y.sdp,h,r);E?.(T||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:T}),R.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else R.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h,transceiver:m}}catch(h){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:u}=i.remoteSDP.batchSend(r);if(u){const d=i.remoteSDP.toString(),h=i.logSDPExchange(d,"offer","remote","receive");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:d});const f=yield i.peerConnection.createAnswer();h?.(f.sdp||""),yield i.peerConnection.setLocalDescription(f),R.debug("[".concat(i.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else R.debug("[".concat(i.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return s.map(d=>{const h=i.peerConnection.getTransceivers().find(f=>f.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d,transceiver:h}})}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}stopReceiving(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");i.remoteSDP.stopSending(r);const s=i.remoteSDP.toString(),u=i.logSDPExchange(s,"offer","remote","stopReceiving");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();u?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));i.remoteSDP.mute(r);const s=i.remoteSDP.toString(),u=i.logSDPExchange(s,"offer","remote","muteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();u?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}})()}unmuteRemote(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));i.remoteSDP.unmute(r);const s=i.remoteSDP.toString(),u=i.logSDPExchange(s,"offer","remote","unmuteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();u?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}})()}muteLocal(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==r.indexOf(f.mid));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(f=>{f.direction="inactive"});const u=yield i.peerConnection.createOffer(),d=i.logSDPExchange(u.sdp||"","offer","local","muteLocal");yield i.peerConnection.setLocalDescription(u),i.remoteSDP.muteRemote(r);const h=i.remoteSDP.toString();d?.(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==r.indexOf(f.mid));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(function(){var f=M(function*(m,_){m.direction="sendonly"});return function(m,_){return f.apply(this,arguments)}}());const u=yield i.peerConnection.createOffer(),d=i.logSDPExchange(u.sdp||"","offer","local","unmuteLocal");yield i.peerConnection.setLocalDescription(u),i.remoteSDP.unmuteRemote(r);const h=i.remoteSDP.toString();d?.(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(r){var i=this;return pi(function*(){const s=yield Ve(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Yt().supportPCSetConfiguration){const _=i.peerConnection.getConfiguration(),E=r===ar.RELAY?"relay":"all";_.iceTransportPolicy!==E&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,i.peerConnection.setConfiguration(_))}else if(r===ar.RELAY)return;r!==ar.RELAY&&i.remoteSDP.updateCandidates(r);const u=yield Ve(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Rs(u.sdp),{remoteIceParameters:h}=yield d.iceParameters;i.remoteSDP.restartICE(h);const f=i.remoteSDP.toString(),m=i.logSDPExchange(u.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Ve(i.peerConnection.setLocalDescription(u)),m?.(f),yield Ve(i.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(u){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),u)}finally{s()}})()}close(){var r;this.peerConnection.close(),null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}updateEncoderConfig(r,i){var s=this;return M(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const u=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(u.sdp,[i],[r]);s.remoteSDP.updateRecvMedia(r,i);const h=s.remoteSDP.toString(),f=s.logSDPExchange(d,"offer","local","updateEncoderConfig");yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),f?.(h),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(u){throw new L(D.EXCHANGE_SDP_FAILED,u.toString())}})()}updateSendParameters(r,i){var s=this;return M(function*(){const u=s.peerConnection.getTransceivers().filter(d=>d.mid===r);1===u.length&&(s.isVP8Simulcast(i)?Bt()||(yield s.applySimulcastEncodings(u,[i])):yield s.applySendEncodings(u,[i]))})()}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}replaceTrack(r,i){var s=this;return M(function*(){const u=s.peerConnection.getTransceivers().find(d=>d.mid===i);u&&(yield u.sender.replaceTrack(r._mediaStreamTrack))})()}getSelectedCandidatePair(){var r=this;return M(function*(){const i=r.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const s=i[0].transport.iceTransport,{local:u,remote:d}=s.getSelectedCandidatePair();return{local:Zc(Zc({},Qc),{},{candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port}),remote:Zc(Zc({},Qc),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return r.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;null===(r=this.onICEConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&"off"!==r.turnServer.mode&&(ps(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...eT.turnServerConfigToIceServers(r.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...eT.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),V("ENABLE_ENCODED_TRANSFORM")&&Yt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(um(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!V("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var u;null!=i&&i.state&&(null===(u=this.onDTLSTransportStateChange)||void 0===u||u.call(this,i.state))},i.onerror=u=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in u?u.error:u)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const u=i?.iceTransport.state;var d;u&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,u))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:u,remote:d}=s.getSelectedCandidatePair();R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}applySendEncodings(r,i){var s=this;return M(function*(){try{if(!Yt().supportSetRtpSenderParameters||r.length!==i.length)return;for(let E=0;E<r.length;E++){const y=r[E],T=i[E];if(T&&T instanceof an){var u,d;if(s.isVP8Simulcast(T))continue;const b={},w={};switch(T._optimizationMode){case"motion":b.degradationPreference="maintain-framerate";break;case"detail":b.degradationPreference="maintain-resolution";break;default:b.degradationPreference="balanced"}var h,f,m,_;if(null!==(u=T._encoderConfig)&&void 0!==u&&u.bitrateMax&&(w.maxBitrate=1e3*(null===(h=T._encoderConfig)||void 0===h?void 0:h.bitrateMax)),T._hints.includes(rn.LOW_STREAM)&&(null!==(f=T._encoderConfig)&&void 0!==f&&f.frameRate&&(w.maxFramerate=Ys(T._encoderConfig.frameRate)),null!==(m=T._encoderConfig)&&void 0!==m&&m.scaleResolutionDownBy&&(null===(_=T._encoderConfig)||void 0===_?void 0:_.scaleResolutionDownBy)>1&&(w.scaleResolutionDownBy=T._encoderConfig.scaleResolutionDownBy)),V("DSCP_TYPE")&&as()){const x=V("DSCP_TYPE");["very-low","low","medium","high"].includes(x)&&(w.networkPriority=x)}const P=y.sender.getParameters(),k=null===(d=P.encodings)||void 0===d?void 0:d[0];Bt()&&!k&&(b.encodings=[w]),k&&Object.assign(k,w),Object.assign(P,b),yield y.sender.setParameters(P)}}}catch{R.debug("[".concat(s.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(r,i,s){const u=gn.exports.parse(r);return i.forEach((d,h)=>{const f=s[h],m=u.mediaDescriptions.find(_=>_.attributes.mid===f);m&&(vh(m,d),yh(m,d,this.store.codec))}),gn.exports.print(u)}mungReceiveAnswerSDP(r,i,s){const u=gn.exports.parse(r),d=u.mediaDescriptions.find(h=>h.attributes.mid===i);return d&&s===be.AUDIO&&"audio"===d.media.mediaType&&Zs(d),gn.exports.print(u)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;null===(i=this.onFirstAudioReceived)||void 0===i||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;null===(i=this.onFirstVideoReceived)||void 0===i||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;null===(i=this.onFirstAudioDecoded)||void 0===i||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var u;null===(u=this.onFirstVideoDecoded)||void 0===u||u.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;null===(i=this.onFirstVideoDecodedTimeout)||void 0===i||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(r,i){var s=this;return M(function*(){if(r.length===i.length)for(let m=0;m<r.length;m++){var u,d,h,f;const _=r[m],E=i[m];if(E instanceof an&&!E._hints.includes(rn.LOW_STREAM)&&null!==(u=E._encoderConfig)&&void 0!==u&&u.bitrateMax&&(null===(d=E._encoderConfig)||void 0===d?void 0:d.bitrateMax)>200&&null!==(h=E._scalabiltyMode)&&void 0!==h&&h.numSpatialLayers&&(null===(f=E._scalabiltyMode)||void 0===f?void 0:f.numSpatialLayers)>1&&"vp8"===s.store.codec){const y={},T={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const b=_.sender.getParameters();yield _.sender.setParameters(Object.assign(b,y))}}})()}applySimulcastEncodings(r,i){var s=this;return M(function*(){if(!Bt()&&r.length===i.length)for(let u=0;u<r.length;u++){const d=i[u];if(d instanceof an&&s.isVP8Simulcast(d)){const h=r[u],f={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,f))}}})()}isVP8Simulcast(r){var i,s,u,d;return!!(r instanceof an&&V("SIMULCAST")&&"vp8"===this.store.codec&&!r._hints.includes(rn.LOW_STREAM)&&null!==(i=r._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(s=r._encoderConfig)||void 0===s?void 0:s.bitrateMax)>200&&null!==(u=r._scalabiltyMode)&&void 0!==u&&u.numSpatialLayers&&(null===(d=r._scalabiltyMode)||void 0===d?void 0:d.numSpatialLayers)>1)}logSDPExchange(r,i,s,u){if(V("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(u,"\n"),r),"offer"===i?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",u)}:void 0}getRemoteSSRC(r){var i=this;return M(function*(){if(!i.remoteSDP)return;const s=i.remoteSDP.getSSRC(r);return s?.[0].ssrcId})()}setConfiguration(r){if(Yt().supportPCSetConfiguration){const i=eT.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}}).prototype,"connect",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"connect"),ft.prototype),q(ft.prototype,"receive",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"receive"),ft.prototype),q(ft.prototype,"batchReceive",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"batchReceive"),ft.prototype),q(ft.prototype,"stopReceiving",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"stopReceiving"),ft.prototype),q(ft.prototype,"muteRemote",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"muteRemote"),ft.prototype),q(ft.prototype,"unmuteRemote",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"unmuteRemote"),ft.prototype),q(ft.prototype,"muteLocal",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"muteLocal"),ft.prototype),q(ft.prototype,"unmuteLocal",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"unmuteLocal"),ft.prototype),q(ft.prototype,"close",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"close"),ft.prototype),q(ft.prototype,"updateEncoderConfig",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"updateEncoderConfig"),ft.prototype),q(ft.prototype,"updateSendParameters",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"updateSendParameters"),ft.prototype),q(ft.prototype,"replaceTrack",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"replaceTrack"),ft.prototype),q(ft.prototype,"getRemoteSSRC",[qo],Object.getOwnPropertyDescriptor(ft.prototype,"getRemoteSSRC"),ft.prototype),ft);function qo(o,r,i){const s=o[r];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=M(function*(){const u=this.mutex,d=yield u.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield s.apply(this,f)}finally{d()}}),i}function Qm(o,r){let i=document.createElement("video"),s=document.createElement("canvas");i.setAttribute("style","display:none"),s.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),s.width=Ys(r.width),s.height=Ys(r.height);const u=Ys(r.framerate||15);document.body.append(i),document.body.append(s);let d=o._mediaStreamTrack;i.srcObject=new MediaStream([d]),i.play();const h=s.getContext("2d");if(!h)throw new L(D.UNEXPECTED_ERROR,"can not get canvas context");const f=Yt(),m=s.captureStream(f.supportRequestFrame?0:u).getVideoTracks()[0],_=KR(()=>(()=>{if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const b=s.width*(i.videoHeight/i.videoWidth);Math.abs(b-s.height)>=2&&(R.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(b)),s.height=b)}h.drawImage(i,0,0,s.width,s.height),m.requestFrame&&m.requestFrame(),d!==o._mediaStreamTrack&&(d=o._mediaStreamTrack,i.srcObject=new MediaStream([d]))})(),u),E=m.stop;return m.stop=()=>{E.call(m),_(),i&&(i.remove(),i=null),s&&(s.width=0,s.remove(),s=null),R.debug("clean low stream renderer")},m}var XA,QA,hS,pS,mi,ZA,bh,LP,eD,kP,xP,Rn;function UP(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function fS(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?UP(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):UP(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class VP extends BR{getUserId(){return this._userId}constructor(r,i,s,u){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(u.clientId,"_").concat(wt(5,""))),S(this,"_userId",void 0),S(this,"_uintId",void 0),S(this,"_isDestroyed",!1),S(this,"store",void 0),S(this,"processor",void 0),S(this,"processorContext",void 0),this._userId=i,this._uintId=s,this.store=u}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let mS=(XA=pe({argsMap:(o,r,i)=>[o.getTrackId(),"string"==typeof r?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),QA=pe({argsMap:o=>[o.getTrackId()]}),hS=pe({argsMap:(o,r)=>[o.getTrackId(),r.name]}),pS=pe({argsMap:o=>[o.getTrackId()]}),q((mi=class extends VP{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==qe.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(o,r,i,s){super(o,r,i,s),S(this,"_videoVisibleTimer",null),S(this,"_previousVideoVisibleStatus",void 0),S(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),S(this,"trackMediaType","video"),S(this,"_videoWidth",void 0),S(this,"_videoHeight",void 0),S(this,"_player",void 0),S(this,"processorDestination",void 0),S(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new tb(this.getTrackId(),"remote"),this.processorDestination=new ge(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return gd(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Bi(this,Ee.GET_STATS)||fS({},Lc)}play(o){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof o){const s=document.getElementById(o);s?o=s:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(o,'" element, use document.body')),o=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(o instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const i=fS(fS({fit:"cover"},r),{},{trackId:this.getTrackId(),element:o});this._player?this._player.updateConfig(i):(this._player=o instanceof HTMLVideoElement?new Dy(i):new Oy(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.emit(xc.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.emit(xc.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Ib(this._originMediaStreamTrack).then(o=>{let[r,i]=o;this._videoHeight=i,this._videoWidth=r}).catch(hm)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var o,r;const i=null==this||null===(o=this._player)||void 0===o?void 0:o.getContainerElement(),s={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:i?.parentElement},{element:u,slot:d}=s;if(this.isPlaying&&u instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=uA.checkOneElementVisible(u),f=Object.assign({},h);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;he.reportApiInvoke(null,{tag:xt.TRACER,name:pn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(f.visible?"Video is visible":"Invisible because of ".concat(f.reason))}return f}return}catch(i){throw new L(D.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(o){if(this.processor===o)return o;if(o._source)throw new L(D.INVALID_OPERATION,"Processor ".concat(o.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=o,this.processor._source=this,o.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),o}unpipe(){if(!this.processor)return;const o=this.processor;this.processor._source=void 0,this.processor=void 0,o.reset()}bindProcessorDestinationEvents(){var o=this;this.processorDestination.on(ur.ON_TRACK,function(){var r=M(function*(i){i?i!==o._mediaStreamTrack&&(o._mediaStreamTrack=i,o._updatePlayerSource()):o._mediaStreamTrack!==o._originMediaStreamTrack&&(o._mediaStreamTrack=o._originMediaStreamTrack,o._updatePlayerSource())});return function(i){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ur.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[XA],Object.getOwnPropertyDescriptor(mi.prototype,"play"),mi.prototype),q(mi.prototype,"stop",[QA],Object.getOwnPropertyDescriptor(mi.prototype,"stop"),mi.prototype),q(mi.prototype,"pipe",[hS],Object.getOwnPropertyDescriptor(mi.prototype,"pipe"),mi.prototype),q(mi.prototype,"unpipe",[pS],Object.getOwnPropertyDescriptor(mi.prototype,"unpipe"),mi.prototype),mi),gS=(ZA=pe({argsMap:(o,r)=>[o.getTrackId(),r],throttleTime:300}),bh=pe({argsMap:(o,r)=>[o.getTrackId(),r]}),LP=pe({argsMap:o=>[o.getTrackId()]}),eD=pe({argsMap:o=>[o.getTrackId()]}),kP=pe({argsMap:(o,r)=>[o.getTrackId(),r.name]}),xP=pe({argsMap:o=>[o.getTrackId()]}),q((Rn=class extends VP{get isPlaying(){return this._useAudioElement?qr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(o,r,i,s){super(o,r,i,s),S(this,"trackMediaType","audio"),S(this,"_source",void 0),S(this,"_useAudioElement",!0),S(this,"_volume",100),S(this,"processorContext",void 0),S(this,"processorDestination",void 0),S(this,"_played",!1),S(this,"_bypassWebAudio",!1),V("DISABLE_WEBAUDIO")?(this._source=new La,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Pv(o,!0),V("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(en.RECEIVE_TRACK_BUFFER,()=>{this.emit(xc.FIRST_FRAME_DECODED)}),this.processorContext=new rb(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new nb(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(en.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(o){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!o)return this._source.removeAllListeners(en.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(en.ON_AUDIO_BUFFER),this._source.on(en.ON_AUDIO_BUFFER,i=>o(i))}setVolume(o){this._volume=o,this._useAudioElement?qr.setVolume(this.getTrackId(),o):this._source.setVolume(o/100)}setPlaybackDevice(o){var r=this;return M(function*(){if(!r._useAudioElement)throw new L(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield qr.setSinkID(r.getTrackId(),o)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return gd(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Bi(this,Ee.GET_STATS)||fS({},Mc)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),qr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?qr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),o&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&qr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(o){if(this._bypassWebAudio)throw new L(D.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===o)return o;if(o._source)throw new L(D.INVALID_OPERATION,"Processor ".concat(o.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=o,this.processor._source=this,o.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),o}unpipe(){var o;if(this._bypassWebAudio)throw new L(D.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;null===(o=this._source.processSourceNode)||void 0===o||o.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var o=this;this.processorDestination.on(ur.ON_TRACK,function(){var r=M(function*(i){i?i!==o._mediaStreamTrack&&(o._mediaStreamTrack=i,o._updatePlayerSource(!1),o._source.processedNode=o._source.createMediaStreamSourceNode(i)):o._mediaStreamTrack!==o._originMediaStreamTrack&&(o._mediaStreamTrack=o._originMediaStreamTrack,o._updatePlayerSource())});return function(i){return r.apply(this,arguments)}}()),this.processorDestination.on(ur.ON_NODE,r=>{this._source.processedNode=r;const i=!r;this._useAudioElement!==i&&(this._played?(this.stop(),this._useAudioElement=i,this.play()):this._useAudioElement=i)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ur.ON_TRACK),this.processorDestination.removeAllListeners(ur.ON_NODE)}}).prototype,"setVolume",[ZA],Object.getOwnPropertyDescriptor(Rn.prototype,"setVolume"),Rn.prototype),q(Rn.prototype,"setPlaybackDevice",[bh],Object.getOwnPropertyDescriptor(Rn.prototype,"setPlaybackDevice"),Rn.prototype),q(Rn.prototype,"play",[LP],Object.getOwnPropertyDescriptor(Rn.prototype,"play"),Rn.prototype),q(Rn.prototype,"stop",[eD],Object.getOwnPropertyDescriptor(Rn.prototype,"stop"),Rn.prototype),q(Rn.prototype,"pipe",[kP],Object.getOwnPropertyDescriptor(Rn.prototype,"pipe"),Rn.prototype),q(Rn.prototype,"unpipe",[xP],Object.getOwnPropertyDescriptor(Rn.prototype,"unpipe"),Rn.prototype),Rn);function tD(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function FP(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?tD(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):tD(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Rk extends Lt{constructor(){super(),S(this,"uplinkStatsUploadInterval",void 0),S(this,"uplinkRelatedStatsUploadInterval",void 0),S(this,"uplinkDenoiserStatsUploadInterval",void 0),S(this,"transportStatsUploadInterval",void 0),S(this,"uplinkExtensionStatsUploadInterval",void 0),S(this,"downlinkExtensionStatsUploadInterval",void 0),S(this,"extensionUsageStatsUploadInterval",void 0),S(this,"downlinkStatsUploadInterval",void 0),S(this,"downlinkRelatedStatsUploadInterval",void 0),S(this,"lastStats",void 0),S(this,"uploadUnplinkStarted",!1),S(this,"uploadDownlinkStarted",!1),S(this,"uploadTransportStarted",!1),S(this,"uploadExtensionUsageStarted",!1),S(this,"requestStats",void 0),S(this,"requestLocalMedia",void 0),S(this,"requestRemoteMedia",void 0),S(this,"requestAllTracks",void 0),S(this,"requestVideoIsReady",void 0),S(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var r;const i=null===(r=this.requestStats)||void 0===r?void 0:r.call(this);i&&this.uploadTransportStats(i)},1e3))}startUploadExtensionUsageStats(){var r=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const i=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(M(function*(){var s,u,d;const h=Date.now(),f={connectionInterval:V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:h};let m=[];const _=(null===(s=r.requestAllTracks)||void 0===s?void 0:s.call(r))||[];for(const b of _)!b.muted&&b.enabled&&(m=m.concat(yield b.getProcessorUsage()));const E=(null===(u=r.requestRemoteMedia)||void 0===u?void 0:u.call(r))||[];for(const[b,w]of E)w.has(be.VIDEO)&&b.videoTrack&&(m=m.concat(yield b.videoTrack.getProcessorUsage())),w.has(be.AUDIO)&&b.audioTrack&&(m=m.concat(yield b.audioTrack.getProcessorUsage()));if(0===m.length)return;f.details=function(b,w){const P={};for(const{id:H,value:ce,level:Re,direction:Z}of b){var k;const Y=null!==(k=w.get(H))&&void 0!==k?k:0,ee=2===ce?Y+V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:Y;var x,B;w.set(H,ee),P[H]?(2===ce&&(P[H].value=ce),Re>P[H].level&&(P[H].level=Re),"remote"===Z&&(P[H].remoteUidCount+=1),P[H].totalTs=null!==(x=w.get(H))&&void 0!==x?x:0):P[H]={value:ce,level:Re,remoteUidCount:"local"===Z?0:1,totalTs:null!==(B=w.get(H))&&void 0!==B?B:0}}return Object.keys(P).map(H=>{const{level:ce,value:Re,totalTs:Z}=P[H];return{id:H,level:ce,value:Re,totalTs:Z}})}(m,i);const y=Date.now();null===(d=r.requestUpload)||void 0===d||d.call(r,Ht.EXTENSION_USAGE_STATS,{usageStats:f,sendTs:y>h?y:h+1})}),V("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var r;const i=null===(r=this.requestStats)||void 0===r?void 0:r.call(this);i&&(this.uploadUplinkStats(i),this.lastStats=i)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var r;const i=null===(r=this.requestStats)||void 0===r?void 0:r.call(this);i&&this.uploadRelatedUplinkStats(i,this.lastStats),this.lastStats=i},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var r;const i=null===(r=this.requestAllTracks)||void 0===r?void 0:r.call(this);i&&this.uploadDenoiserStats(i)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var r;const i=null===(r=this.requestAllTracks)||void 0===r?void 0:r.call(this);i&&this.uploadExtensionStats(i)},2e3))}uploadTransportStats(r){Hi(()=>{var i;null===(i=this.requestUpload)||void 0===i||i.call(this,Ht.TRANSPORT_STATS,function(s){const u={connectionType:100,googRtt:s.rtt};if("relay"===s.selectedCandidatePair.localCandidate.candidateType){const d=s.selectedCandidatePair.localCandidate.relayProtocol;"udp"===d&&(u.connectionType=101),"tcp"===d&&(u.connectionType=103),"tls"===d&&(u.connectionType=104)}return u}(r))})}uploadUplinkStats(r){var i;((null===(i=this.requestLocalMedia)||void 0===i?void 0:i.call(this))||[]).forEach(s=>{let[u,{track:d,ssrcs:h}]=s;switch(u){case de.LocalVideoLowTrack:case de.LocalVideoTrack:{const f=function(E,y,T){var b;const w=y.videoSend.find(k=>k.ssrc===E);if(!w)return null;const P={id:wt(10,""),timestamp:new Date(y.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:w.ssrc.toString()};switch(P.A_vstd=T._originMediaStreamTrack&&!T._originMediaStreamTrack.enabled||T._mediaStreamTrack&&!T._mediaStreamTrack.enabled?"1":"0",w.sentFrame&&(P.A_fhs=w.sentFrame.height.toString(),P.A_frs=w.sentFrame.frameRate.toString(),P.A_fws=w.sentFrame.width.toString()),w.adaptionChangeReason){case"none":P.A_ac="0";break;case"cpu":P.A_ac="1";break;case"bandwidth":P.A_ac="2";break;case"other":P.A_ac="3"}return P.A_lvps=mv[T._player?T._player.videoElementStatus:"uninit"].toString(),P.A_nr=null===(b=w.nacksCount)||void 0===b?void 0:b.toString(),w.avgEncodeMs&&(P.A_aem=w.avgEncodeMs.toFixed(0).toString()),P}(h[0].ssrcId,r,d),m=u===de.LocalVideoTrack?function(E,y,T){var b,w,P,k,x,B,H,ce;const Re=y.videoSend.find(Et=>Et.ssrc===E);if(!Re)return null;const Z={id:wt(10,""),timestamp:new Date(y.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:Re.ssrc.toString()},Y=null!==(b=null!==(w=null===(P=Re.inputFrame)||void 0===P?void 0:P.height)&&void 0!==w?w:T?._videoHeight)&&void 0!==b?b:0,ee=null!==(k=null!==(x=null===(B=Re.inputFrame)||void 0===B?void 0:B.width)&&void 0!==x?x:T?._videoWidth)&&void 0!==k?k:0,oe=null!==(H=null===(ce=Re.inputFrame)||void 0===ce?void 0:ce.frameRate)&&void 0!==H?H:0;return Y&&(Z.A_fhi=Y+""),ee&&(Z.A_fwi=ee+""),oe&&(Z.A_fri=oe+""),Z}(h[0].ssrcId,r,d):null;f&&Hi(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,Ht.PUBLISH_STATS,{stream_type:u===de.LocalVideoLowTrack?"low":"high",stats:FP(FP({},f),m)})});const _=function(E){const y={id:"bweforvideo",timestamp:new Date(E.timestamp).toISOString(),type:"VideoBwe"};return E.bitrate.retransmit&&(y.A_rb=E.bitrate.retransmit.toString()),E.bitrate.targetEncoded&&(y.A_teb=E.bitrate.targetEncoded.toString()),y.A_aeb=E.bitrate.actualEncoded.toString(),y.A_tb=E.bitrate.transmit.toString(),void 0!==E.sendBandwidth&&(y.A_asb=E.sendBandwidth.toString()),y}(r);_&&setTimeout(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,Ht.PUBLISH_STATS,{stream_type:u===de.LocalVideoLowTrack?"low":"high",stats:_})},1e3);break}case de.LocalAudioTrack:{const f=function(m,_,E){const y=_.audioSend.find(b=>b.ssrc===m);if(!y)return null;const T={id:wt(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:y.ssrc.toString()};return T.A_astd=E._originMediaStreamTrack&&!E._originMediaStreamTrack.enabled||E._mediaStreamTrack&&!E._mediaStreamTrack.enabled?"1":"0",T.A_ail=y.inputLevel?Math.round(100*y.inputLevel).toString():Math.round(100*E._source.getAccurateVolumeLevel()).toString(),T.A_apil=Math.round(100*E._source.getAccurateVolumeLevel()).toString(),y.aecReturnLoss&&(T.A_ecrl=Math.round(y.aecReturnLoss).toString()),y.aecReturnLossEnhancement&&(T.A_ecrle=Math.round(y.aecReturnLossEnhancement).toString()),T}(h[0].ssrcId,r,d);f&&Hi(()=>{var m;return null===(m=this.requestUpload)||void 0===m?void 0:m.call(this,Ht.PUBLISH_STATS,{stream_type:"high",stats:f})});break}}})}uploadRelatedUplinkStats(r,i){var s;((null===(s=this.requestLocalMedia)||void 0===s?void 0:s.call(this))||[]).filter(u=>{let[d]=u;return d===de.LocalVideoLowTrack||d===de.LocalVideoTrack}).forEach(u=>{let[d,{ssrcs:h}]=u;const f=function(m,_){const E=_.videoSend.find(y=>y.ssrc===m);return E?{mediaType:"video",isVideoMute:!1,frameRateInput:E.inputFrame&&E.inputFrame.frameRate.toString(),frameRateSent:E.sentFrame&&E.sentFrame.frameRate.toString(),googRtt:E.rttMs.toString(),qpSumPerFrame:Math.floor(E.qpSumPerFrame).toString()}:null}(h[0].ssrcId,r);f&&Hi(()=>{var m;null===(m=this.requestUpload)||void 0===m||m.call(this,Ht.PUBLISH_RELATED_STATS,{stream_type:d===de.LocalVideoLowTrack?"low":"high",stats:f})})})}uploadDenoiserStats(r){for(let d=0;d<r.length;d++){const h=r[d];if(h instanceof ty){var i,s,u;const f=null===(i=(s=h._external).getDenoiserStats)||void 0===i?void 0:i.call(s);return void(f&&(null===(u=this.requestUpload)||void 0===u||u.call(this,Ht.DENOISER_STATS,f)))}}}uploadExtensionStats(r){for(let i=0;i<r.length;i++)r[i].getProcessorStats().forEach(s=>{var u;null===(u=this.requestUpload)||void 0===u||u.call(this,s.type,s.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let r;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let i=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var s;const u=null===(s=this.requestStats)||void 0===s?void 0:s.call(this);u&&(this.uploadDownlinkStats(u,i,r),r=u),i=!i},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var s;const u=null===(s=this.requestStats)||void 0===s?void 0:s.call(this);u&&(this.uploadRelatedDownlinkStats(u,this.lastStats),this.lastStats=u)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var s;const u=null===(s=this.requestRemoteMedia)||void 0===s?void 0:s.call(this);u&&this.uploadDownlinkExtensionStats(u)},2e3)}uploadDownlinkStats(r,i,s){var u;((null===(u=this.requestRemoteMedia)||void 0===u?void 0:u.call(this))||[]).forEach(d=>{let[h,f]=d;if(f.has(be.VIDEO)&&h.videoTrack){const m=h.videoTrack?function(_,E,y,T,b){const w=E.videoRecv.find(B=>B.ssrc===_);if(!w)return null;const P={id:wt(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:w.ssrc.toString()};var k,x;if(P.bytesReceived=w.bytes.toString(),P.packetsLost=w.packetsLost.toString(),P.packetsReceived=w.packets.toString(),w.framesRateFirefox&&(P.A_frr=w.framesRateFirefox.toString()),w.receivedFrame?(P.A_frr=w.receivedFrame.frameRate.toString(),P.A_fhr=w.receivedFrame.height.toString(),P.A_fwr=w.receivedFrame.width.toString()):(P.A_fhr=null===(k=T._videoHeight)||void 0===k?void 0:k.toString(),P.A_fwr=null===(x=T._videoWidth)||void 0===x?void 0:x.toString()),P.A_frd=w.decodeFrameRate.toString(),w.outputFrame&&(P.A_fro=w.outputFrame.frameRate.toString()),void 0!==w.jitterBufferMs&&(P.A_jbm=Math.floor(w.jitterBufferMs).toString()),void 0!==w.currentDelayMs&&(P.A_cdm=Math.floor(w.currentDelayMs).toString()),P.A_fs=w.firsCount.toString(),P.A_ns=w.nacksCount.toString(),P.A_ps=w.plisCount.toString(),T&&(P.A_vrtd=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?"0":"1"),T._player&&T._player.freezeTimeCounterList.length>0&&(P.A_vrft=Math.round(T._player.freezeTimeCounterList.splice(0,1)[0]).toString()),b&&T._player&&"visible"===Es.visibility){const B=Math.min(6e3,T._player.renderFreezeAccTime);P.A_vrrft=Math.round(B).toString(),T._player.renderFreezeAccTime=Math.max(0,T._player.renderFreezeAccTime-B)}if(P.A_rvps=mv[T._player?T._player.videoElementStatus:"uninit"].toString(),y){const B=y.videoRecv.find(H=>H.ssrc===_);if(B&&void 0!==w.totalInterFrameDelay&&void 0!==w.totalSquaredInterFrameDelay&&void 0!==B.totalInterFrameDelay&&void 0!==B.totalSquaredInterFrameDelay){const H=w.totalInterFrameDelay-B.totalInterFrameDelay,Re=w.framesDecodeCount-B.framesDecodeCount,Z=H/Re*1e3,Y=Math.round(1e3*Math.sqrt((w.totalSquaredInterFrameDelay-B.totalSquaredInterFrameDelay-Math.pow(H,2)/Re)/Re));!isNaN(Y)&&Z+Y>Math.max(3*Z,Z+150)&&(P.A_ifdsd=Y.toString())}}return P}(h._videoSSRC,r,s,h.videoTrack,i):void 0;m&&Hi(()=>{var _;return null===(_=this.requestUpload)||void 0===_?void 0:_.call(this,Ht.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}if(f.has(be.AUDIO)&&h.audioTrack){const m=h.audioTrack?function(_,E,y,T){const b=E.audioRecv.find(P=>P.ssrc===_);if(!b)return null;const w={id:wt(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:b.ssrc.toString()};if(w.bytesReceived=b.bytes.toString(),w.packetsLost=b.packetsLost.toString(),w.packetsReceived=b.packets.toString(),w.A_aol=b.outputLevel?Math.round(100*b.outputLevel).toString():Math.round(100*T._source.getAccurateVolumeLevel()).toString(),w.A_apol=Math.round(100*T._source.getAccurateVolumeLevel()).toString(),T&&(w.A_artd=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?"0":"1"),w.A_jr=b.jitterMs.toString(),w.A_jbm=Math.floor(b.jitterBufferMs).toString(),w.A_cdm=Math.floor(b.jitterBufferMs).toString(),w.A_raps=mv[qr.getPlayerState(T.getTrackId())].toString(),y){const P=y.audioRecv.find(k=>k.ssrc===_);if(P){const k=b.concealedSamples-P.concealedSamples;k>0&&(w.A_cs=Math.round(k).toString())}}return w}(h._audioSSRC,r,s,h.audioTrack):void 0;m&&Hi(()=>{var _;return null===(_=this.requestUpload)||void 0===_?void 0:_.call(this,Ht.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}})}uploadRelatedDownlinkStats(r,i){var s;((null===(s=this.requestRemoteMedia)||void 0===s?void 0:s.call(this))||[]).forEach(u=>{let[d,h]=u;if(h.has(be.VIDEO)&&d.videoTrack){var f;const m=!0===(d._videoSSRC&&(null===(f=this.requestVideoIsReady)||void 0===f?void 0:f.call(this,d._videoSSRC))||!1),_=function(E,y,T,b,w,P){const k=T.videoRecv.find(ce=>ce.ssrc===E),x=w?w.videoRecv.find(ce=>ce.ssrc===E):void 0;if(!k)return null;const B=fd.isRemoteVideoFreeze(P,k,x)&&y,H={mediaType:"video",isVideoMute:!1,peerId:b,frameRateReceived:k.receivedFrame&&k.receivedFrame.frameRate.toString(),frameRateDecoded:k.decodedFrame&&k.decodedFrame.frameRate.toString(),isFreeze:B,bytesReceived:k.bytes.toString(),packetsReceived:k.packets.toString(),packetsLost:k.packetsLost.toString(),qpSumPerFrame:Math.floor(k.qpSumPerFrame).toString()};return k.framesRateFirefox&&(H.frameRateDecoded=k.framesRateFirefox.toString(),H.frameRateReceived=k.framesRateFirefox.toString()),H}(d._videoSSRC,m,r,d.uid,i,d.videoTrack);_&&Hi(()=>{var E;null===(E=this.requestUpload)||void 0===E||E.call(this,Ht.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:_})})}if(h.has(be.AUDIO)&&d.audioTrack){const m=function(_,E,y,T){const b=E.audioRecv.find(P=>P.ssrc===_);if(!b)return null;const w=fd.isRemoteAudioFreeze(T);return{mediaType:"audio",isAudioMute:!1,peerId:y,googJitterReceived:b.jitterMs.toString(),isFreeze:w,bytesReceived:b.bytes.toString(),packetsReceived:b.packets.toString(),packetsLost:b.packetsLost.toString(),frameReceived:b.receivedFrames.toString(),frameDropped:b.droppedFrames.toString()}}(d._audioSSRC,r,d.uid,d.audioTrack);m&&Hi(()=>{var _;null===(_=this.requestUpload)||void 0===_||_.call(this,Ht.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:m})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(r){r.forEach(i=>{let[s,u]=i;u.has(be.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)}),u.has(be.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)})})}}function jP(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function BP(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?jP(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):jP(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}const HP="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n";class Fa{get localCapabilities(){return $t(this._localCapabilities)}get rtpCapabilities(){return $t(this._rtpCapabilities)}get candidates(){return $t(this._candidates)}get iceParameters(){return $t(this._iceParameters)}get dtlsParameters(){return $t(this._dtlsParameters)}constructor(r){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),S(this,"firefoxSsrcMidMap",new Map),r=$t(r);const{remoteIceParameters:i,remoteDtlsParameters:s,candidates:u,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:f,cname:m}=r,_=gn.exports.parse(HP);this._rtpCapabilities=d,this._candidates=u,this._iceParameters=i,this._dtlsParameters=s,this._localCapabilities=f,this.setup=h,this.cname=m;const E=this.rtpCapabilities.send;for(const y of _.mediaDescriptions){if(y.attributes.iceUfrag=i.iceUfrag,y.attributes.icePwd=i.icePwd,y.attributes.fingerprints=s.fingerprints,y.attributes.candidates=u,y.attributes.setup=h,"application"===y.media.mediaType&&(y.attributes.sctpPort="5000"),"video"===y.media.mediaType&&(y.media.fmts=E.videoCodecs.map(T=>T.payloadType.toString(10)),y.attributes.payloads=E.videoCodecs,y.attributes.extmaps=E.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:b}=fi([{ssrcId:4e4,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);y.attributes.ssrcs=T,y.attributes.ssrcGroups=b}if("audio"===y.media.mediaType&&(y.media.fmts=E.audioCodecs.map(T=>T.payloadType.toString(10)),y.attributes.payloads=E.audioCodecs,y.attributes.extmaps=E.audioExtensions,Zs(y),V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:b}=fi([{ssrcId:2e4}],this.cname);y.attributes.ssrcs=T,y.attributes.ssrcGroups=b}}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}updateRemoteRTPCapabilities(r){const i=gn.exports.parse(HP);this._rtpCapabilities=r;const s=this.rtpCapabilities.send;for(const u of i.mediaDescriptions){if(u.attributes.iceUfrag=this._iceParameters.iceUfrag,u.attributes.icePwd=this._iceParameters.icePwd,u.attributes.fingerprints=this._dtlsParameters.fingerprints,u.attributes.candidates=this._candidates,u.attributes.setup=this.setup,"application"===u.media.mediaType&&(u.attributes.sctpPort="5000"),"video"===u.media.mediaType&&(u.media.fmts=s.videoCodecs.map(d=>d.payloadType.toString(10)),u.attributes.payloads=s.videoCodecs,u.attributes.extmaps=s.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=fi([{ssrcId:4e4,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);u.attributes.ssrcs=d,u.attributes.ssrcGroups=h}if("audio"===u.media.mediaType&&(u.media.fmts=s.audioCodecs.map(d=>d.payloadType.toString(10)),u.attributes.payloads=s.audioCodecs,u.attributes.extmaps=s.audioExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=fi([{ssrcId:2e4}],this.cname);u.attributes.ssrcs=d,u.attributes.ssrcGroups=h}}this.sessionDesc=i,this.currentMidIndex=i.mediaDescriptions.length-1}preloadRemoteMedia(r){const i=this.candidates,s=this.dtlsParameters,u=this.iceParameters,d=this.rtpCapabilities.send;for(let h=1;h<r;h++){const f=2*h+2e4,m=2*h+4e4,{ssrcs:_,ssrcGroups:E}=fi([{ssrcId:f}],this.cname),{ssrcs:y,ssrcGroups:T}=fi([{ssrcId:m,rtx:V("USE_SUB_RTX")?m+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:u.iceUfrag,icePwd:u.icePwd,unrecognized:[],candidates:i,extmaps:d.videoExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:u.iceUfrag,icePwd:u.icePwd,unrecognized:[],candidates:i,extmaps:d.audioExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return gn.exports.print(this.sessionDesc)}send(r,i,s,u){const{ssrcs:d,ssrcGroups:h}=fi(i,this.cname,V("SYNC_GROUP")?s:void 0),f=this.findPreloadMediaDesc(d);if(f){if(Bt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,f.attributes.mid),u&&(u.twcc||u.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(f,u),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(r,d);let _;return-1===m||or()||vr()||Af()||0===m&&V("USE_SUB_RTX")?(_=this.createOrRecycleSendMedia(r,d,h,"sendonly",u),this.updateBundleMids()):(_=$t(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=d,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,u)),Bt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,_.attributes.mid),{mid:_.attributes.mid,needExchangeSDP:!0}}}batchSend(r){const i=r.map(d=>{let{kind:h,ssrcMsg:f,mslabel:m}=d;return this.send(h,f,m)}),s=[];let u=!1;return i.forEach(d=>{let{mid:h,needExchangeSDP:f}=d;f&&(u=!0),s.push(h)}),{mids:s,needExchangeSDP:u}}stopSending(r){const i=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&-1!==r.indexOf(s.attributes.mid));if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(s=>{"0"===s.attributes.mid||Bt()||or()||vr()?s.attributes.ssrcs=[]:(s.attributes.ssrcs=[],s.attributes.direction="inactive",s.media.port="0")}),this.updateBundleMids()}mute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}muteRemote(r){const i=this.sessionDesc.mediaDescriptions.filter(s=>r.includes(s.attributes.mid||""));if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(r){const i=this.sessionDesc.mediaDescriptions.filter(s=>r.includes(s.attributes.mid||""));if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="recvonly"})}receive(r,i,s,u){r.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",i,s,u[h])}),this.updateBundleMids()}stopReceiving(r){const i=this.sessionDesc.mediaDescriptions.filter(s=>-1!==r.indexOf(s.attributes.mid));if(i.length!==r.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(r){r===ar.TCP?this._candidates.forEach(i=>{-1===this._candidates.findIndex(s=>"tcp"===s.transport&&s.connectionAddress===i.connectionAddress&&s.port===i.port)&&this._candidates.push(BP(BP({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this._candidates=this._candidates.filter(i=>"tcp"!==i.transport);for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(r){r=$t(r),this._iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let s=0;s<r;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}findAvailableMediaIndex(r,i){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const u=s.media.mediaType===r&&"0"!==s.media.port&&("sendonly"===s.attributes.direction||"sendrecv"===s.attributes.direction)&&0===s.attributes.ssrcs.length;if(Bt()){if(u){const d=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(d||"0"!==s.attributes.mid&&"1"!==s.attributes.mid)||!(!d||d!==s.attributes.mid)}return!1}return u})}createOrRecycleRecvMedia(r,i,s,u,d,h){const f=r._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,_=this.localCapabilities.send;let E=[];if(f===be.VIDEO){var y,T;if(V("H264_PROFILE_LEVEL_ID")&&"h264"===u&&(E=m.videoCodecs.filter(x=>{var B,H;return((null===(B=x.rtpMap)||void 0===B?void 0:B.encodingName.toLowerCase())||"").includes(u)&&(null==x||null===(H=x.fmtp)||void 0===H?void 0:H.parameters["profile-level-id"])===V("H264_PROFILE_LEVEL_ID")})),!E||0===(null===(y=E)||void 0===y?void 0:y.length)){const x=_.videoCodecs.filter(B=>{var H;return((null===(H=B.rtpMap)||void 0===H?void 0:H.encodingName.toLowerCase())||"").includes(u)});0!==x.length&&(E=m.videoCodecs.filter(B=>x.some(H=>H.payloadType===B.payloadType)))}if(V("USE_PUB_RTX")){const x=E.map(H=>H.payloadType.toString()),B=m.videoCodecs.filter(H=>{var ce,Re;return"rtx"===(null===(ce=H.rtpMap)||void 0===ce?void 0:ce.encodingName)&&x.includes((null===(Re=H.fmtp)||void 0===Re?void 0:Re.parameters.apt)||"")});E=[...E,...B]}0===E.length&&(R.warning("codec ".concat(u," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(T=m.videoCodecs[0].rtpMap)||void 0===T?void 0:T.encodingName)),E=m.videoCodecs)}else E=m.audioCodecs.filter(x=>{var B;return((null===(B=x.rtpMap)||void 0===B?void 0:B.encodingName.toLowerCase())||"").includes(d)}),0===E.length&&(R.warning("codec ".concat(d," not included in rtpCapabilities, fallback to opus")),E=m.audioCodecs.filter(x=>{var B;return((null===(B=x.rtpMap)||void 0===B?void 0:B.encodingName.toLowerCase())||"").includes("opus")}));const b=f===be.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const w="".concat(this.currentMidIndex);let P={media:{mediaType:f,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:E.map(x=>x.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:b,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:E,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(w)}};P=this.mungRecvMediaDsec(P,r,h);const k=this.findFirstClosedMedia(f);if(k){const x=this.sessionDesc.mediaDescriptions.indexOf(k);this.sessionDesc.mediaDescriptions[x]=P}else this.sessionDesc.mediaDescriptions.push(P);return P}createOrRecycleSendMedia(r,i,s,u,d){const h=this.rtpCapabilities.send,f=r===be.VIDEO?h.videoCodecs:h.audioCodecs,m=r===be.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let E={media:{mediaType:r,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:u,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};E=this.mungSendMediaDesc(E,d);const y=this.findFirstClosedMedia(r);if(y){const T=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[T]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(r=>"0"!==r.media.port).map(r=>r.attributes.mid)}mungRecvMediaDsec(r,i,s){const u=$t(r);return FA(u),vh(u,i),jA(u,i),wP(u),Km(u,s,this.localCapabilities.send),u}mungSendMediaDesc(r,i){const s=$t(r);return Km(s,i,this.localCapabilities.recv),Zs(s),s}updateRecvMedia(r,i){const s=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===r);if(-1!==s){const u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=u}}bumpMid(r){this.currentMidIndex+=r}findFirstClosedMedia(r){return this.sessionDesc.mediaDescriptions.find(i=>Bt()?"0"===i.media.port&&i.media.mediaType===r:"0"===i.media.port)}findPreloadMediaDesc(r){return this.sessionDesc.mediaDescriptions.find(i=>{var s,u;return(null===(s=i.attributes)||void 0===s||null===(u=s.ssrcs[0])||void 0===u?void 0:u.ssrcId)===r[0].ssrcId})}getSSRC(r){var i;return null===(i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r))||void 0===i?void 0:i.attributes.ssrcs}}var ct;function rD(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function zr(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?rD(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):rD(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let _S=(q((ct=class Ew extends Vc{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(r,i,s){super(r,i),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"transportEventReceiver",void 0),S(this,"statsFilter",void 0),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"establishPromise",void 0),S(this,"mutex",new Mn("NVExtentionsConnection-mutex")),S(this,"rtcMedia",void 0),this.store=i,this.peerConnection=s,this.statsFilter=dS(this.peerConnection,void 0,void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(r){var i=this;return M(function*(){try{const s=yield i.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const u=Rs(s.sdp),d=yield BA(!V("USE_PUB_RTX")&&!V("USE_SUB_RTX"),V("FILTER_VIDEO_FEC"),V("FILTER_AUDIO_FEC"));return i.localCapabilities=d,i.initialOffer=s,zr(zr({},u),{},{rtpCapabilities:d,offerSDP:s.sdp})}catch(s){throw new L(D.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}})()}connect(r,i,s,u,d,h){var f=this;return M(function*(){try{if(!f.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");f.remoteSDP=new Fa({remoteIceParameters:r,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:u,remoteSetup:d,localCapabilities:Qs(f.localCapabilities),cname:h});const m=f.remoteSDP.toString(),_=gn.exports.parse(f.initialOffer.sdp),E=_.mediaDescriptions.find(b=>"audio"===b.media.mediaType);E&&Zs(E);const y=gn.exports.print(_),T=f.logSDPExchange(y||"","offer","local","connect");yield f.peerConnection.setLocalDescription({type:"offer",sdp:y}),T?.(m),yield f.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new L(D.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(m.toString()))}})()}updateRemoteConnect(r){var i=this;return M(function*(){var s,u,d;null===(s=i.remoteSDP)||void 0===s||s.updateRemoteRTPCapabilities(r),null===(u=i.remoteSDP)||void 0===u||u.preloadRemoteMedia(2);const h=null===(d=i.remoteSDP)||void 0===d?void 0:d.toString();yield i.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=yield i.peerConnection.createAnswer();yield i.peerConnection.setLocalDescription(f),R.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")})()}send(r,i,s){var u=this;return pi(function*(){const d=yield Ve(u.mutex.lock("From NVExtentionsConnection.send"));try{if(!u.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const h=[];r.forEach(P=>{const k=u.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(k)}),Bt()&&!0===V("SIMULCAST")&&(yield Ve(u.applySimulcastForFirefox(h,r)));const f=yield Ve(u.peerConnection.createOffer()),m=u.remoteSDP.predictReceivingMids(r.length),_=u.mungSendOfferSDP(f.sdp,r,m),E=gn.exports.parse(_),y=m.map(P=>{const k=E.mediaDescriptions.find(x=>x.attributes.mid===P);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return UA(k,V("USE_PUB_RTX"))});let T;try{T=yield y}catch(P){T=[],u.remoteSDP.receive(r,i,s,T);const k=u.remoteSDP.toString();throw yield Ve(u.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Ve(u.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield Ve(u.stopSending(m,!0)),P}u.remoteSDP.receive(r,i,s,T);const b=u.remoteSDP.toString(),w=u.logSDPExchange(_,"offer","local","send");return yield Ve(u.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Ve(u.applySimulcastEncodings(h,r)),yield Ve(u.applySendEncodings(h,r)),w?.(b),yield Ve(u.peerConnection.setRemoteDescription({type:"answer",sdp:b})),h.map((P,k)=>({localSSRC:y[k],id:m[k],transceiver:P}))}catch(h){throw h instanceof L?h:new L(D.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(h.toString()))}finally{d()}})()}stopSending(r,i){var s=this;return M(function*(){const u=i?void 0:yield s.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const d=s.peerConnection.getTransceivers().filter(_=>-1!==r.indexOf(_.mid));if(d.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");d.map(_=>{var E;_.direction="inactive",null===(E=_.stop)||void 0===E||E.call(_)});const h=yield s.peerConnection.createOffer(),f=s.logSDPExchange(h.sdp||"","offer","local","stopSending");yield s.peerConnection.setLocalDescription(h),s.remoteSDP.stopReceiving(r);const m=s.remoteSDP.toString();f?.(m),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new L(D.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(d.toString()))}finally{u&&u()}})()}receive(r,i,s,u){var d=this;return M(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(r," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=d.remoteSDP.send(r,i,s,u);if(f){const _=d.remoteSDP.toString(),E=d.logSDPExchange(_,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=yield d.peerConnection.createAnswer(),T=d.mungReceiveAnswerSDP(y.sdp,h,r);E?.(T||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:T}),R.debug("[NVExtentionsConnection] receive ".concat(r," by exchanging SDP."))}else R.debug("[NVExtentionsConnection] receive ".concat(r," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h}}catch(h){throw new L(D.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:u}=i.remoteSDP.batchSend(r);if(u){const d=i.remoteSDP.toString(),h=i.logSDPExchange(d,"offer","remote","receive");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:d});const f=yield i.peerConnection.createAnswer();h?.(f.sdp||""),yield i.peerConnection.setLocalDescription(f),R.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else R.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return s.map(d=>{const h=i.peerConnection.getTransceivers().find(f=>f.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d}})}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(s.toString()))}})()}stopReceiving(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");i.remoteSDP.stopSending(r);const s=i.remoteSDP.toString(),u=i.logSDPExchange(s,"offer","remote","stopReceiving");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();u?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(r," before remote SDP created."));i.remoteSDP.mute(r);const s=i.remoteSDP.toString(),u=i.logSDPExchange(s,"offer","remote","muteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();u?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(s.toString()))}})()}unmuteRemote(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(r," before remote SDP created."));i.remoteSDP.unmute(r);const s=i.remoteSDP.toString(),u=i.logSDPExchange(s,"offer","remote","unmuteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();u?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(s.toString()))}})()}muteLocal(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==r.indexOf(f.mid));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(f=>{f.direction="inactive"});const u=yield i.peerConnection.createOffer(),d=i.logSDPExchange(u.sdp||"","offer","local","muteLocal");yield i.peerConnection.setLocalDescription(u),i.remoteSDP.muteRemote(r);const h=i.remoteSDP.toString();d?.(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(r){var i=this;return M(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==r.indexOf(f.mid));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(function(){var f=M(function*(m,_){m.direction="sendonly"});return function(m,_){return f.apply(this,arguments)}}());const u=yield i.peerConnection.createOffer(),d=i.logSDPExchange(u.sdp||"","offer","local","unmuteLocal");yield i.peerConnection.setLocalDescription(u),i.remoteSDP.unmuteRemote(r);const h=i.remoteSDP.toString();d?.(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new L(D.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(r){var i=this;return pi(function*(){const s=yield Ve(i.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Yt().supportPCSetConfiguration){const _=i.peerConnection.getConfiguration(),E=r===ar.RELAY?"relay":"all";_.iceTransportPolicy!==E&&(R.debug("restartICE change iceTransportPolicy from [".concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,i.peerConnection.setConfiguration(_))}else if(r===ar.RELAY)return;r!==ar.RELAY&&i.remoteSDP.updateCandidates(r);const u=yield Ve(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Rs(u.sdp),{remoteIceParameters:h}=yield d.iceParameters;i.remoteSDP.restartICE(h);const f=i.remoteSDP.toString(),m=i.logSDPExchange(u.sdp||"","offer","local","restartICE");yield Ve(i.peerConnection.setLocalDescription(u)),m?.(f),yield Ve(i.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(u){R.warning("restart ICE failed, abort operation",u)}finally{s()}})()}close(){var r;null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}updateEncoderConfig(r,i){var s=this;return M(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const u=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(u.sdp,[i],[r]);s.remoteSDP.updateRecvMedia(r,i);const h=s.remoteSDP.toString(),f=s.logSDPExchange(d,"offer","local","updateEncoderConfig");yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),f?.(h),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(u){throw new L(D.EXCHANGE_SDP_FAILED,u.toString())}})()}updateSendParameters(r,i){var s=this;return M(function*(){const u=s.peerConnection.getTransceivers().filter(d=>d.mid===r);1===u.length&&(s.isVP8Simulcast(i)?Bt()||(yield s.applySimulcastEncodings(u,[i])):yield s.applySendEncodings(u,[i]))})()}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}replaceTrack(r,i){var s=this;return M(function*(){const u=s.peerConnection.getTransceivers().find(d=>d.mid===i);u&&(yield u.sender.replaceTrack(r._mediaStreamTrack))})()}getP2PConnectionParams(){var r;if(null===(r=this.peerConnection.currentLocalDescription)||void 0===r||!r.sdp||!this.localCapabilities)throw new Error;return zr(zr({},Rs(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;null===(r=this.onICEConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&"off"!==r.turnServer.mode&&(ps(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...Ew.turnServerConfigToIceServers(r.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...Ew.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(um(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!V("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}applySendEncodings(r,i){var s=this;return M(function*(){try{if(!Yt().supportSetRtpSenderParameters||r.length!==i.length)return;for(let E=0;E<r.length;E++){const y=r[E],T=i[E];if(T&&T instanceof an){var u,d;if(s.isVP8Simulcast(T))continue;const b={},w={};switch(T._optimizationMode){case"motion":b.degradationPreference="maintain-framerate";break;case"detail":b.degradationPreference="maintain-resolution";break;default:b.degradationPreference="balanced"}var h,f,m,_;if(null!==(u=T._encoderConfig)&&void 0!==u&&u.bitrateMax&&(w.maxBitrate=1e3*(null===(h=T._encoderConfig)||void 0===h?void 0:h.bitrateMax)),T._hints.includes(rn.LOW_STREAM)&&(null!==(f=T._encoderConfig)&&void 0!==f&&f.frameRate&&(w.maxFramerate=Ys(T._encoderConfig.frameRate)),null!==(m=T._encoderConfig)&&void 0!==m&&m.scaleResolutionDownBy&&(null===(_=T._encoderConfig)||void 0===_?void 0:_.scaleResolutionDownBy)>1&&(w.scaleResolutionDownBy=T._encoderConfig.scaleResolutionDownBy)),V("DSCP_TYPE")&&as()){const x=V("DSCP_TYPE");["very-low","low","medium","high"].includes(x)&&(w.networkPriority=x)}const P=y.sender.getParameters(),k=null===(d=P.encodings)||void 0===d?void 0:d[0];Bt()&&!k&&(b.encodings=[w]),k&&Object.assign(k,w),Object.assign(P,b),yield y.sender.setParameters(P)}}}catch{R.debug("Apply RTPSendEncodings failed.")}})()}mungSendOfferSDP(r,i,s){const u=gn.exports.parse(r);return i.forEach((d,h)=>{const f=s[h],m=u.mediaDescriptions.find(_=>_.attributes.mid===f);m&&(vh(m,d),yh(m,d,this.store.codec))}),gn.exports.print(u)}mungReceiveAnswerSDP(r,i,s){const u=gn.exports.parse(r),d=u.mediaDescriptions.find(h=>h.attributes.mid===i);return d&&s===be.AUDIO&&"audio"===d.media.mediaType&&Zs(d),gn.exports.print(u)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;null===(i=this.onFirstAudioReceived)||void 0===i||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;null===(i=this.onFirstVideoReceived)||void 0===i||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;null===(i=this.onFirstAudioDecoded)||void 0===i||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var u;null===(u=this.onFirstVideoDecoded)||void 0===u||u.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;null===(i=this.onFirstVideoDecodedTimeout)||void 0===i||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(r,i){var s=this;return M(function*(){if(r.length===i.length)for(let m=0;m<r.length;m++){var u,d,h,f;const _=r[m],E=i[m];if(E instanceof an&&!E._hints.includes(rn.LOW_STREAM)&&null!==(u=E._encoderConfig)&&void 0!==u&&u.bitrateMax&&(null===(d=E._encoderConfig)||void 0===d?void 0:d.bitrateMax)>200&&null!==(h=E._scalabiltyMode)&&void 0!==h&&h.numSpatialLayers&&(null===(f=E._scalabiltyMode)||void 0===f?void 0:f.numSpatialLayers)>1&&"vp8"===s.store.codec){const y={},T={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const b=_.sender.getParameters();yield _.sender.setParameters(Object.assign(b,y))}}})()}applySimulcastEncodings(r,i){var s=this;return M(function*(){if(!Bt()&&r.length===i.length)for(let u=0;u<r.length;u++){const d=i[u];if(d instanceof an&&s.isVP8Simulcast(d)){const h=r[u],f={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,f))}}})()}isVP8Simulcast(r){var i,s,u,d;return!!(r instanceof an&&V("SIMULCAST")&&"vp8"===this.store.codec&&!r._hints.includes(rn.LOW_STREAM)&&null!==(i=r._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(s=r._encoderConfig)||void 0===s?void 0:s.bitrateMax)>200&&null!==(u=r._scalabiltyMode)&&void 0!==u&&u.numSpatialLayers&&(null===(d=r._scalabiltyMode)||void 0===d?void 0:d.numSpatialLayers)>1)}logSDPExchange(r,i,s,u){if(V("SDP_LOGGING"))return R.upload("exchanging ".concat(s," ").concat(i," SDP during NVExtentionsConnection.").concat(u,"\n"),r),"offer"===i?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",u)}:void 0}getRemoteSSRC(r){var i=this;return M(function*(){if(!i.remoteSDP)return;const s=i.remoteSDP.getSSRC(r);return s?.[0].ssrcId})()}setConfiguration(r){if(Yt().supportPCSetConfiguration){const i=Ew.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}}).prototype,"connect",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"connect"),ct.prototype),q(ct.prototype,"updateRemoteConnect",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"updateRemoteConnect"),ct.prototype),q(ct.prototype,"receive",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"receive"),ct.prototype),q(ct.prototype,"batchReceive",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"batchReceive"),ct.prototype),q(ct.prototype,"stopReceiving",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"stopReceiving"),ct.prototype),q(ct.prototype,"muteRemote",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"muteRemote"),ct.prototype),q(ct.prototype,"unmuteRemote",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"unmuteRemote"),ct.prototype),q(ct.prototype,"muteLocal",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"muteLocal"),ct.prototype),q(ct.prototype,"unmuteLocal",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"unmuteLocal"),ct.prototype),q(ct.prototype,"close",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"close"),ct.prototype),q(ct.prototype,"updateEncoderConfig",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"updateEncoderConfig"),ct.prototype),q(ct.prototype,"updateSendParameters",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"updateSendParameters"),ct.prototype),q(ct.prototype,"replaceTrack",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"replaceTrack"),ct.prototype),q(ct.prototype,"getRemoteSSRC",[Oo],Object.getOwnPropertyDescriptor(ct.prototype,"getRemoteSSRC"),ct.prototype),ct);function Oo(o,r,i){const s=o[r];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=M(function*(){const u=this.mutex,d=yield u.lock("From NVExtentionsConnection.".concat(r));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield s.apply(this,f)}finally{d()}}),i}var St;function eg(o){var r,i,s,u=2;for(typeof Symbol<"u"&&(i=bP,s=Symbol.iterator);u--;){if(i&&null!=(r=o[i]))return r.call(o);if(s&&null!=(r=o[s]))return new tg(r.call(o));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function tg(o){function r(i){if(Object(i)!==i)return ie.reject(new TypeError(i+" is not an object."));var s=i.done;return ie.resolve(i.value).then(function(u){return{value:u,done:s}})}return(tg=function(i){this.s=i,this.n=i.next}).prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return void 0===s?ie.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return void 0===s?ie.reject(i):r(s.apply(this.s,arguments))}},new tg(o)}let Yr=(q((St=class vw extends Vc{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(r,i){super(r,i),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"cname",void 0),S(this,"mutex",new Mn("DataChannelConnection-mutex")),S(this,"dataChannel",void 0),S(this,"_p2pConnection",void 0),S(this,"establishPromise",void 0),S(this,"_nvMedia",void 0),this.store=i,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(vw.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new _S(r,i,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}establish(){var r=this;return M(function*(){var i;const s=null===(i=r._nvMedia)||void 0===i?void 0:i.getLocalRtpCapabilities();return yield r._p2pConnection.establish(s)})()}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}connect(r,i,s,u,d,h){var f=this;return M(function*(){return f.cname=h,yield f._p2pConnection.connect(r,i,s,u,d,h),yield new ie((m,_)=>{const E=setTimeout(()=>{f.closeSignal(),_(new L(D.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(s))))},2e3);f.dataChannel.onopen=()=>{if("open"===f.dataChannel.readyState)return clearTimeout(E),void m()},f.dataChannel.onerror=y=>{f.closeSignal(),_(y)}}),{transmitter:f.dataChannel,close:f.closeSignal.bind(f)}})()}send(r,i,s){var u=this;return pi(function*(){const d=yield Ve(u.mutex.lock("From DataChannelConnection.send"));try{return yield*Gm(eg(u._p2pConnection.send(r,i,s)),Ve)}finally{d()}})()}stopSending(r,i){var s=this;return M(function*(){return s._p2pConnection.stopSending(r,i)})()}receive(r,i,s,u){var d=this;return M(function*(){return d._nvMedia?(R.debug("[DataChannelConnection] receive ".concat(r," by DataChannel.")),yield d._nvMedia.reveiveByRTCMedia(r,i,d.cname)):(R.debug("[DataChannelConnection] receive ".concat(r," by WebRTC.")),yield d._p2pConnection.receive(r,i,s,u))})()}batchReceive(r){var i=this;return M(function*(){return[...yield i._p2pConnection.batchReceive(r)]})()}stopReceiving(r){var i=this;return M(function*(){return yield i._p2pConnection.stopReceiving(r)})()}muteRemote(r){var i=this;return M(function*(){return yield i._p2pConnection.muteRemote(r)})()}unmuteRemote(r){var i=this;return M(function*(){return yield i._p2pConnection.unmuteRemote(r)})()}muteLocal(r){var i=this;return M(function*(){return yield i._p2pConnection.muteLocal(r)})()}unmuteLocal(r){var i=this;return M(function*(){return yield i._p2pConnection.unmuteLocal(r)})()}restartICE(r){var i=this;return pi(function*(){return yield*Gm(eg(i._p2pConnection.restartICE(r)),Ve)})()}close(){var r;null===(r=this._nvMedia)||void 0===r||r.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(r){return this._p2pConnection.getRemoteVideoIsReady(r)}updateRemoteConnect(r){var i;null===(i=this._nvMedia)||void 0===i||i.setRemoteRtpCapabilities(r),this._p2pConnection.updateRemoteConnect(r)}updateEncoderConfig(r,i){var s=this;return M(function*(){return yield s._p2pConnection.updateEncoderConfig(r,i)})()}updateSendParameters(r,i){var s=this;return M(function*(){return yield s._p2pConnection.updateSendParameters(r,i)})()}setStatsRemoteVideoIsReady(r,i){this._p2pConnection.setStatsRemoteVideoIsReady(r,i)}replaceTrack(r,i){var s=this;return M(function*(){return yield s._p2pConnection.replaceTrack(r,i)})()}getRemoteSSRC(r){var i=this;return M(function*(){return i._p2pConnection.getRemoteSSRC(r)})()}logSDPExchange(r,i,s,u){if(V("SDP_LOGGING"))return R.upload("exchanging ".concat(s," ").concat(i," SDP during DataChannelConnection.").concat(u,"\n"),r),"offer"===i?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",u)}:void 0}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&"off"!==r.turnServer.mode&&(ps(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...vw.turnServerConfigToIceServers(r.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...vw.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(um(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!V("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=r=>{var i;return null===(i=this.onICEConnectionStateChange)||void 0===i?void 0:i.call(this,r)},this._p2pConnection.onConnectionStateChange=r=>{var i;return null===(i=this.onConnectionStateChange)||void 0===i?void 0:i.call(this,r)},this._p2pConnection.onDTLSTransportStateChange=r=>{var i;return null===(i=this.onDTLSTransportStateChange)||void 0===i?void 0:i.call(this,r)},this._p2pConnection.onDTLSTransportError=r=>{var i;return null===(i=this.onDTLSTransportError)||void 0===i?void 0:i.call(this,r)},this._p2pConnection.onICETransportStateChange=r=>{var i;return null===(i=this.onICETransportStateChange)||void 0===i?void 0:i.call(this,r)},this._p2pConnection.onFirstAudioReceived=r=>{var i;return null===(i=this.onFirstAudioReceived)||void 0===i?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoReceived=r=>{var i;return null===(i=this.onFirstVideoReceived)||void 0===i?void 0:i.call(this,r)},this._p2pConnection.onFirstAudioDecoded=r=>{var i;return null===(i=this.onFirstAudioDecoded)||void 0===i?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoDecoded=(r,i,s)=>{var u;return null===(u=this.onFirstVideoDecoded)||void 0===u?void 0:u.call(this,r,i,s)},this._p2pConnection.onFirstVideoDecodedTimeout=r=>{var i;return null===(i=this.onFirstVideoDecodedTimeout)||void 0===i?void 0:i.call(this,r)},this._p2pConnection.onSelectedLocalCandidateChanged=(r,i)=>{var s;return null===(s=this.onSelectedLocalCandidateChanged)||void 0===s?void 0:s.call(this,r,i)},this._p2pConnection.onSelectedRemoteCandidateChanged=(r,i)=>{var s;return null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s?void 0:s.call(this,r,i)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0}setConfiguration(r){this._p2pConnection.setConfiguration(r)}}).prototype,"connect",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"connect"),St.prototype),q(St.prototype,"receive",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"receive"),St.prototype),q(St.prototype,"stopReceiving",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"stopReceiving"),St.prototype),q(St.prototype,"muteRemote",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"muteRemote"),St.prototype),q(St.prototype,"unmuteRemote",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"unmuteRemote"),St.prototype),q(St.prototype,"muteLocal",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"muteLocal"),St.prototype),q(St.prototype,"unmuteLocal",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"unmuteLocal"),St.prototype),q(St.prototype,"close",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"close"),St.prototype),q(St.prototype,"updateEncoderConfig",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"updateEncoderConfig"),St.prototype),q(St.prototype,"updateSendParameters",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"updateSendParameters"),St.prototype),q(St.prototype,"replaceTrack",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"replaceTrack"),St.prototype),q(St.prototype,"getRemoteSSRC",[Ar],Object.getOwnPropertyDescriptor(St.prototype,"getRemoteSSRC"),St.prototype),St);function Ar(o,r,i){const s=o[r];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=M(function*(){const u=this.mutex,d=yield u.lock("From DataChannelConnection.".concat(r));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield s.apply(this,f)}finally{d()}}),i}var Xe;function ES(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function ja(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ES(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):ES(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function ng(o){var r,i,s,u=2;for(typeof Symbol<"u"&&(i=bP,s=Symbol.iterator);u--;){if(i&&null!=(r=o[i]))return r.call(o);if(s&&null!=(r=o[s]))return new vS(r.call(o));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function vS(o){function r(i){if(Object(i)!==i)return ie.reject(new TypeError(i+" is not an object."));var s=i.done;return ie.resolve(i.value).then(function(u){return{value:u,done:s}})}return(vS=function(i){this.s=i,this.n=i.next}).prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return void 0===s?ie.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return void 0===s?ie.reject(i):r(s.apply(this.s,arguments))}},new vS(o)}let GP=(q((Xe=class extends Lt{get state(){return this._state}set state(o){const r=this._state;this._state=o,this.emit(Ge.StateChange,r,this._state)}constructor(o,r){var i;super(),i=this,S(this,"store",void 0),S(this,"statsUploader",void 0),S(this,"connection",void 0),S(this,"localTrackMap",new Map),S(this,"remoteUserMap",new Map),S(this,"pendingLocalTracks",[]),S(this,"pendingRemoteTracks",[]),S(this,"statsCollector",void 0),S(this,"isPlanB",!1),S(this,"shouldForwardP2PCreation",void 0),S(this,"iceFailedCount",0),S(this,"dtlsFailedCount",0),S(this,"mutex",new Mn("P2PChannel-mutex")),S(this,"_state",on.Disconnected),S(this,"_pcStatsUploadType",V("NEW_ICE_RESTART")?ki.FIRST_CONNECTION:ki.OLD_FIRST_CONNECTION),S(this,"_isInRestartIce",!1),S(this,"_isStartRestartIce",!1),S(this,"_restartStates",["disconnected","failed"]),S(this,"_restartTimer",void 0),S(this,"_isFirstConnected",!0),S(this,"handleMuteLocalTrack",function(){var s=M(function*(u,d,h){const f=yield i.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!i.connection||i.state!==on.Connected)return void h(new L(D.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const m=i.filterTobeMutedTracks(u);if(0===m.length)return void d();const _=m.find(y=>"videoLowTrack"===y[0]);_&&_[1].track._originMediaStreamTrack.stop(),yield i.connection.muteLocal(m.map(y=>{let[,{id:T}]=y;return T}));const E=i.createMuteMessage(m);yield Wt(i,Ge.RequestMuteLocal,E),d()}catch(m){h(m)}finally{f()}});return function(u,d,h){return s.apply(this,arguments)}}()),S(this,"handleUnmuteLocalTrack",function(){var s=M(function*(u,d,h){const f=yield i.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!i.connection||i.state!==on.Connected)return void h(new L(D.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const m=i.filterTobeUnmutedTracks(u);if(0===m.length)return void d();const _=m.find(y=>"videoLowTrack"===y[0]);if(_){const y=_[1];if(y.track._originMediaStreamTrack.stop(),Yt().supportDualStreamEncoding){const T=u._mediaStreamTrack.clone();y.track._mediaStreamTrack=T,y.track._originMediaStreamTrack=T}else{const T=Qm(u,xa(i,Ge.RequestLowStreamParameter));y.track._mediaStreamTrack=T,y.track._originMediaStreamTrack=T}yield new ie((T,b)=>{i.handleReplaceTrack(y.track,T,b,!0)})}yield i.connection.unmuteLocal(m.map(y=>{let[,{id:T}]=y;return T}));const E=i.createUnmuteMessage(m);yield Wt(i,Ge.RequestUnmuteLocal,E),d()}catch(m){h(m)}finally{f()}});return function(u,d,h){return s.apply(this,arguments)}}()),S(this,"handleUpdateVideoEncoder",function(){var s=M(function*(u,d,h){const f=yield i.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const m=i.localTrackMap.get(de.LocalVideoTrack);if(!i.connection||!m||m.track!==u||i.state!==on.Connected)return void d();const{id:_,track:E}=m;yield i.connection.updateSendParameters(_,E),yield i.connection.updateEncoderConfig(_,E),i.emit(Ge.UpdateVideoEncoder,E),d()}catch(m){h(m)}finally{f()}});return function(u,d,h){return s.apply(this,arguments)}}()),S(this,"handleSetOptimizationMode",function(){var s=M(function*(u,d,h){const f=yield i.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const m=i.localTrackMap.get(de.LocalVideoTrack);if(!i.connection||!m||m.track!==u||i.state!==on.Connected)return;const{id:_,track:E}=m;yield i.connection.updateSendParameters(_,E),d()}catch(m){h(m)}finally{f()}});return function(u,d,h){return s.apply(this,arguments)}}()),S(this,"handleReplaceTrack",function(){var s=M(function*(u,d,h,f){let m;R.debug("[".concat(i.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(u.getTrackId(),"]")),"boolean"==typeof f&&f||(m=yield i.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var _;const y=Array.from(i.localTrackMap.entries()).find(T=>{let[,{track:b}]=T;return u===b});if(!i.connection||!y||i.state!==on.Connected)return void d();if(yield null===(_=i.connection)||void 0===_?void 0:_.replaceTrack(u,y[1].id),i.isPlanB){const T=y[1];T.id=u._mediaStreamTrack.id,i.localTrackMap.set(y[0],T)}if(y[0]===de.LocalVideoTrack&&Yt().supportDualStreamEncoding){const T=i.localTrackMap.get(de.LocalVideoLowTrack);if(T){const b=u._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=b,T.track._originMediaStreamTrack=b,yield new ie((w,P)=>{i.handleReplaceTrack(T.track,w,P,!0)})}}d()}catch(y){h(y)}finally{var E;null===(E=m)||void 0===E||E()}});return function(u,d,h,f){return s.apply(this,arguments)}}()),S(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),S(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),S(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),S(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=o,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new Rk,this.bindStatsUploaderEvents(),this.isPlanB=!Yt().supportUnifiedPlan||V("CHROME_FORCE_PLAN_B")&&as(),this.shouldForwardP2PCreation=V("FORWARD_P2P_CREATION")&&Yt().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Yr({},this.store):this.isPlanB?new Ih({},this.store):new bs({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(o,r){var i=this;return M(function*(){var s;i.state=on.New;const u=i.shouldForwardP2PCreation&&"closed"===(null===(s=i.connection)||void 0===s?void 0:s.peerConnectionState);if(i.shouldForwardP2PCreation&&!u||(u&&i.connection&&(R.warning("[".concat(i.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),i.connection.close(),i.unbindConnectionEvents(i.connection)),i.connection=i.store.useDataChannel?new Yr(o,i.store):i.isPlanB?new Ih(o,i.store):new bs(o,i.store),i.bindConnectionEvents(i.connection)),!i.connection)throw new L(D.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return i._pcStatsUploadType=V("NEW_ICE_RESTART")?ki.FIRST_CONNECTION:ki.OLD_FIRST_CONNECTION,i._isFirstConnected=!0,i._isInRestartIce=!1,i._isStartRestartIce=!1,i.connection.setConfiguration(o),i.connection.establishPromise})()}connect(o,r,i,s,u,d){var h=this;return M(function*(){if(!h.connection)throw new L(D.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");h.connection instanceof Yr?h.connection.updateRemoteConnect(s):(h.store.peerConnectionStart(),yield h.connection.connect(o,r,i,s,u,d),h.statsUploader.startUploadTransportStats(),h.statsUploader.startUploadExtensionUsageStats(),h.state=on.Connected)})()}preConnect(o,r,i,s,u,d){var h=this;return M(function*(){if(!h.connection)throw new L(D.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");h.store.peerConnectionStart();const f=yield h.connection.connect(o,r,i,s,u,d);return h.statsUploader.startUploadTransportStats(),h.statsUploader.startUploadExtensionUsageStats(),h.state=on.Connected,f})()}getEstablishParams(){if(this.connection instanceof Yr)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(o,r,i){var s=this;return pi(function*(){const u=yield Ve(s.mutex.lock("From P2PChannel.publish"));try{if(!s.connection||s.state!==on.Connected){if(s.state===on.Disconnected)throw new L(D.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(o);const h=o.filter(f=>-1===s.pendingLocalTracks.indexOf(f));return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(h))}s.store.pubId=s.store.pubId+1,xr.markPublishStart(s.store.clientId,s.store.pubId);const d=s.filterTobePublishedTracks(o,r,i);if(0===d.length)return void(yield Ve(s.tryToUnmuteAudio(o)));yield*Gm(ng(s.doPublish(s.connection,d)),Ve)}finally{u()}})()}doPublish(o,r){var i=this;return pi(function*(){r.forEach(_=>{let{track:E,type:y}=_;const T=Date.now();i.store.publish(E.getTrackId(),y===de.LocalAudioTrack?"audio":"video",T)}),i.bindLocalTrackEvents(r);const s=yield Ve(o.send(r.map(_=>{let{track:E}=_;return E}),i.store.codec,i.store.audioCodec)),u=(yield Ve(s.next())).value,d=i.createGatewayPublishMessage(r,u);let h;try{h=yield d}catch(_){throw s.throw(_),_?.code===D.WS_ABORT&&r.forEach(E=>{let{track:y}=E;-1===i.pendingLocalTracks.indexOf(y)&&i.pendingLocalTracks.push(y)}),i.unbindLocalTrackEvents(r),_}const f=i.mapPubResToRemoteConfig(d,h),m=(yield Ve(s.next(f))).value;r.forEach(_=>{let{type:E}=_;i.statsCollector.addLocalStats(E)}),i.assignLocalTracks(r,m),i.statsUploader.startUploadUplinkStats(),r.forEach(_=>{let{track:E,type:y}=_;const T=Date.now();i.store.publish(E.getTrackId(),y===de.LocalAudioTrack?"audio":"video",void 0,T)})})()}publishLowStream(o){var r=this;return pi(function*(){if(!r.connection||r.state!==on.Connected)return;const i=yield Ve(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const u=r.localTrackMap.get(de.LocalVideoTrack);if(!u)throw new L(D.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(de.LocalVideoLowTrack))throw new L(D.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:r.getLowVideoTrack(u.track,o),type:de.LocalVideoLowTrack}];if(yield*Gm(ng(r.doPublish(r.connection,d)),Ve),u.track.muted||!u.track.enabled){var s;const h=null===(s=r.localTrackMap.get(de.LocalVideoLowTrack))||void 0===s?void 0:s.id;void 0!==h&&(yield Ve(r.connection.muteLocal([h])))}}finally{i()}})()}republish(){var o=this;return M(function*(){o.pendingLocalTracks.length>0&&(R.debug("[".concat(o.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield zn(o,Ge.RequestRePublish,o.pendingLocalTracks),o.emit(Ge.MediaReconnectEnd,o.store.uid),o.pendingLocalTracks=[])})()}reSubscribe(o){var r=this;return M(function*(){for(let i=r.pendingRemoteTracks.length-1;i>=0;i--){const{user:s,kind:u}=r.pendingRemoteTracks[i];(u!==be.AUDIO||s._audio_added_&&s._audioSSRC)&&(u!==be.VIDEO||s._video_added_&&s._videoSSRC)||r.pendingRemoteTracks.splice(i,1)}if(o)yield zn(r,Ge.RequestReSubscribe,r.pendingRemoteTracks);else for(const{user:i,kind:s}of r.pendingRemoteTracks)yield r.subscribe(i,s,s===be.VIDEO?i._videoSSRC:i._audioSSRC);r.pendingRemoteTracks.forEach(i=>{let{user:s}=i;r.emit(Ge.MediaReconnectEnd,s.uid)}),r.pendingRemoteTracks=[]})()}unpublish(o){var r=this;return M(function*(){if(!r.connection||r.state!==on.Connected)return void o.forEach(u=>{const d=r.pendingLocalTracks.indexOf(u);-1!==d&&r.pendingLocalTracks.splice(d,1)});const i=r.filterTobeUnpublishedTracks(o);if(0===i.length)return;const s=i.find(u=>"videoLowTrack"===u[0]);return s&&s[1].track.close(),r.doUnpublish(r.connection,i)})()}unpublishLowStream(){var o=this;return M(function*(){if(!o.connection||o.state!==on.Connected)return;const r=o.localTrackMap.get(de.LocalVideoLowTrack);return r?(r.track.close(),o.doUnpublish(o.connection,[[de.LocalVideoLowTrack,r]])):void 0})()}doUnpublish(o,r){var i=this;return M(function*(){const s=i.createGatewayUnpublishMessage(r);return yield o.stopSending(r.map(u=>{let[,{id:d}]=u;return d})),i.withdrawLocalTracks(r),i.unbindLocalTrackEvents(r.map(u=>{let[d,{track:h}]=u;return{type:d,track:h}})),r.forEach(u=>{let[d]=u;i.statsCollector.removeLocalStats(d)}),0===i.localTrackMap.size&&i.statsUploader.stopUploadUplinkStats(),s})()}subscribe(o,r,i,s,u){var d=this;return M(function*(){var h;if(!d.connection||d.state!==on.Connected)throw new L(D.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(h=d.remoteUserMap.get(o))&&void 0!==h&&h.has(r))return;let f,m,_;if(u){const T=u.find(w=>{let{stream_type:P}=w;return P===r});if(!T)throw new L(D.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(o.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const b=yield d.connection.receive(r,T.ssrcs,String(o._uintid),T.attributes);d.connection instanceof bs&&(_=b.transceiver),f=b.track,m=b.id}else{const T=yield d.connection.receive(r,[{ssrcId:i,rtx:s}],String(o._uintid),void 0);d.connection instanceof bs&&(_=T.transceiver),f=T.track,m=T.id}r===be.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(f):(o._audioTrack=new gS(f,o.uid,o._uintid,d.store),R.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),_&&o._audioTrack._updateRtpTransceiver(_),d.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(f):(o._videoTrack=new mS(f,o.uid,o._uintid,d.store),R.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),_&&o._videoTrack._updateRtpTransceiver(_),d.bindRemoteTrackEvents(o,o._videoTrack));const E=d.remoteUserMap.get(o);E?E.set(r,m):d.remoteUserMap.set(o,new Map([[r,m]])),d.statsCollector.addRemoteStats(o.uid),d.statsUploader.startUploadDownlinkStats();const y=d.pendingRemoteTracks.findIndex(T=>{let{user:b,kind:w}=T;return b.uid===o.uid&&r===w});-1!==y&&(d.pendingRemoteTracks.splice(y,1),d.emit(Ge.MediaReconnectEnd,o.uid))})()}massSubscribe(o){var r=this;return M(function*(){return r.massSubscribeNoLock(o)})()}massSubscribeNoLock(o){var r=this;return M(function*(){if(!r.connection||r.state!==on.Connected)throw new L(D.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");o=o.filter(s=>{var u;let{user:d,mediaType:h}=s;return!(null!==(u=r.remoteUserMap.get(d))&&void 0!==u&&u.has(h))});const i=yield r.connection.batchReceive(o.map(s=>{let{user:u,mediaType:d,ssrcId:h,rtxSsrcId:f}=s;return{kind:d,ssrcMsg:[{ssrcId:h,rtx:f}],mslabel:String(u._uintid)}}));o.forEach((s,u)=>{let{user:d,mediaType:h}=s;const{track:f,id:m,transceiver:_}=i[u];h===be.AUDIO?(d._audioTrack?d._audioTrack._updateOriginMediaStreamTrack(f):(d._audioTrack=new gS(f,d.uid,d._uintid,r.store),R.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote audio track: ").concat(d._audioTrack.getTrackId()))),_&&d._audioTrack._updateRtpTransceiver(_),r.bindRemoteTrackEvents(d,d._audioTrack)):(d._videoTrack?d._videoTrack._updateOriginMediaStreamTrack(f):(d._videoTrack=new mS(f,d.uid,d._uintid,r.store),R.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote video track: ").concat(d._videoTrack.getTrackId()))),_&&d._videoTrack._updateRtpTransceiver(_),r.bindRemoteTrackEvents(d,d._videoTrack));const E=r.remoteUserMap.get(d);E?E.set(h,m):r.remoteUserMap.set(d,new Map([[h,m]])),r.statsCollector.addRemoteStats(d.uid),r.statsUploader.startUploadDownlinkStats();const y=r.pendingRemoteTracks.findIndex(T=>{let{user:b,kind:w}=T;return b.uid===d.uid&&h===w});-1!==y&&(r.pendingRemoteTracks.splice(y,1),r.emit(Ge.MediaReconnectEnd,d.uid))})})()}unsubscribe(o,r,i){var s=this;return M(function*(){const u=s.pendingRemoteTracks.filter(f=>{let{user:m,kind:_}=f;return void 0!==r?m.uid===o.uid&&r===_:m.uid===o.uid});if(u.forEach(f=>{const m=s.pendingRemoteTracks.indexOf(f);s.pendingRemoteTracks.splice(m,1)}),s.connection&&s.state===on.Connected||i||u.forEach(f=>{let{kind:m}=f;var _;if(m===be.AUDIO)null===(_=o._audioTrack)||void 0===_||_._destroy(),o._audioTrack=void 0;else if(m===be.VIDEO){var E;null===(E=o._videoTrack)||void 0===E||E._destroy(),o._videoTrack=void 0}}),!s.connection||s.state!==on.Connected)return;const d=s.filterTobeUnSubscribedTracks(o,r);if(0===d.length)return;yield s.connection.stopReceiving(d.map(f=>{let[,{id:m}]=f;return m}));const h=s.createUnsubscribeMessage(d);return s.withdrawRemoteTracks(d),0===s.remoteUserMap.size&&s.statsUploader.stopUploadDownlinkStats(),d.forEach(f=>{let[m,{kind:_}]=f;var E,y;if(_===be.VIDEO&&m._videoSSRC&&(null===(E=s.connection)||void 0===E||E.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===be.VIDEO)s.unbindRemoteTrackEvents(m._videoTrack),i||(null===(y=m._videoTrack)||void 0===y||y._destroy(),m._videoTrack=void 0);else if(_===be.AUDIO){var T;s.unbindRemoteTrackEvents(m._audioTrack),!i&&(null===(T=m._audioTrack)||void 0===T||T._destroy(),m._audioTrack=void 0)}}),h})()}massUnsubscribe(o){var r=this;return M(function*(){return r.massUnsubscribeNoLock(o)})()}massUnsubscribeNoLock(o){var r=this;return M(function*(){let i=[];for(const{user:d,mediaType:h}of o){const f=r.pendingRemoteTracks.filter(m=>{let{user:_,kind:E}=m;return void 0!==h?_.uid===d.uid&&h===E:_.uid===d.uid});f.forEach(m=>{const _=r.pendingRemoteTracks.indexOf(m);r.pendingRemoteTracks.splice(_,1)}),i=i.concat(f)}if(!r.connection||r.state!==on.Connected)return void i.forEach(d=>{let{user:h,kind:f}=d;var m;if(f===be.AUDIO)null===(m=h._audioTrack)||void 0===m||m._destroy(),h._audioTrack=void 0;else if(f===be.VIDEO){var _;null===(_=h._videoTrack)||void 0===_||_._destroy(),h._videoTrack=void 0}});const s=ti(o).call(o,(d,h)=>{let{user:f,mediaType:m}=h;const _=r.filterTobeUnSubscribedTracks(f,m);return d.concat(_)},[]);if(0===s.length)return;yield r.connection.stopReceiving(s.map(d=>{let[,{id:h}]=d;return h}));const u=r.createUnsubscribeAllMessage(s);return r.withdrawRemoteTracks(s),0===r.remoteUserMap.size&&r.statsUploader.stopUploadDownlinkStats(),s.forEach(d=>{let[h,{kind:f}]=d;var m,_;if(f===be.VIDEO&&h._videoSSRC&&(null===(m=r.connection)||void 0===m||m.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),f===be.VIDEO)r.unbindRemoteTrackEvents(h._videoTrack),null===(_=h._videoTrack)||void 0===_||_._destroy(),h._videoTrack=void 0;else if(f===be.AUDIO){var E;r.unbindRemoteTrackEvents(h._audioTrack),null===(E=h._audioTrack)||void 0===E||E._destroy(),h._audioTrack=void 0}}),u})()}muteRemote(o,r){var i=this;return M(function*(){if(!i.connection)return;const s=i.remoteUserMap.get(o);if(!s)return void R.warning("[".concat(i.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(o.uid,"."));if(!s.get(r))return void R.warning("[".concat(i.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(o.uid," media type ").concat(r,"."));const u=r===be.VIDEO?o._videoSSRC:o._audioSSRC;void 0!==u&&i.connection.setStatsRemoteVideoIsReady(u,!1)})()}unmuteRemote(o,r){var i=this;return M(function*(){return i.unmuteRemoteNoLock(o,r)})()}unmuteRemoteNoLock(o,r){var i=this;return M(function*(){if(!i.connection)return;const s=i.remoteUserMap.get(o);s?s.get(r)||R.warning("[".concat(i.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(o.uid," media type ").concat(r,".")):R.warning("[".concat(i.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(o.uid,"."))})()}getAllTracks(o){const r=this.localTrackMap.get(de.LocalAudioTrack);if(r?.track instanceof kr){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[u]=s;return u!==de.LocalAudioTrack}).filter(s=>{let[u]=s;return!(o&&u===de.LocalVideoLowTrack)}).map(s=>{let[,{track:u}]=s;return u}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(o&&s===de.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}reportPublishEvent(o,r,i,s,u){if(o){const h=this.localTrackMap.get(de.LocalAudioTrack),f=this.localTrackMap.get(s?de.LocalVideoLowTrack:de.LocalVideoTrack);he.publish(this.store.sessionId,{eventElapse:xr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:o,ec:r,audioName:h?.track.getTrackLabel(),videoName:f?.track.getTrackLabel(),screenshare:-1!==f?.track._hints.indexOf(rn.SCREEN_TRACK),audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:u})}else{var d;i||(i=[]);const h=i.find(m=>m instanceof lr),f=s?null===(d=this.localTrackMap.get(de.LocalVideoTrack))||void 0===d?void 0:d.track:i.find(m=>m instanceof an);he.publish(this.store.sessionId,{eventElapse:xr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:o,ec:r,audioName:h?.getTrackLabel(),videoName:f?.getTrackLabel(),screenshare:-1!==f?._hints.indexOf(rn.SCREEN_TRACK),audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:u})}}reportSubscribeEvent(o,r,i,s){const u=s===be.VIDEO?i._videoSSRC:i._audioSSRC;u&&he.subscribe(this.store.sessionId,{succ:o,ec:r,video:s===be.VIDEO,audio:s===be.AUDIO,peerid:i.uid,subscribeRequestid:s===be.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:xr.measureFromSubscribeStart(this.store.clientId,u)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Mn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Yr({},this.store):this.isPlanB?new Ih({},this.store):new bs({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const o=this.localTrackMap.get(de.LocalAudioTrack);if(o?.track instanceof kr){if(o.track.trackList.length>0){const r=o.track;o.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}o.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=on.Disconnected}getStats(){var o;return null===(o=this.connection)||void 0===o?void 0:o.getStats()}getRemoteVideoIsReady(o){var r;return(null===(r=this.connection)||void 0===r?void 0:r.getRemoteVideoIsReady(o))||!1}getLocalAudioVolume(){const o=this.localTrackMap.get(de.LocalAudioTrack);if(o)return o.track.getVolumeLevel()}getLocalVideoSize(){const o=this.localTrackMap.get(de.LocalVideoTrack);if(o)return{width:o.track._videoWidth||0,height:o.track._videoHeight||0}}getEncoderConfig(o){const r=this.localTrackMap.get(o);return r&&r.track instanceof an||r&&r.track instanceof lr?r.track._encoderConfig:void 0}getLocalMedia(o){return this.localTrackMap.get(o)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(o,r){if(!o)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(o);return!!i&&(!r||i.has(r))}hasRemoteMediaWithLock(o,r){var i=this;return M(function*(){if(!o)return i.remoteUserMap.size>0;const s=i.remoteUserMap.get(o);return!!s&&(!r||s.has(r))})()}getRemoteMedia(o){var r;const i=Array.from(Ma(r=this.remoteUserMap).call(r)).find(s=>s.uid===o);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let o=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(de.LocalAudioTrack);return r&&o.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),o=Wf(o).call(o,(i,s)=>i.level-s.level),o}disconnectForReconnect(){var o=this;return M(function*(){o.connection&&(R.debug("[".concat(o.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),o.state=on.Reconnecting,V("KEEP_LAST_FRAME")&&0!==o.remoteUserMap.size&&Array.from(o.remoteUserMap.entries()).forEach(r=>{let[i]=r;var s;i._videoTrack&&i._videoTrack._player&&(null===(s=i._videoTrack._player.getVideoElement())||void 0===s||s.pause(),i._videoTrack._player.isKeepLastFrame=!0,i._videoTrack._originMediaStreamTrack.stop())}),o.connection.close(),o.unbindConnectionEvents(o.connection),o.connection=void 0,o.shouldForwardP2PCreation&&(o.connection=o.store.useDataChannel?new Yr({},o.store):o.isPlanB?new Ih({},o.store):new bs({},o.store),o.bindConnectionEvents(o.connection)),0!==o.localTrackMap.size&&(Array.from(o.localTrackMap.entries()).forEach(r=>{let[i,{track:s}]=r;switch(i){case de.LocalVideoTrack:s._hints.includes(rn.LOW_STREAM)?s.close():o.pendingLocalTracks.push(s);break;case de.LocalAudioTrack:s instanceof kr?o.pendingLocalTracks=o.pendingLocalTracks.concat(s.trackList):o.pendingLocalTracks.push(s)}}),o.emit(Ge.MediaReconnectStart,o.store.uid)),o.unbindLocalTrackEvents(),o.localTrackMap.clear(),0!==o.remoteUserMap.size&&Array.from(o.remoteUserMap.entries()).forEach(r=>{let[i,s]=r;Array.from(Ma(s).call(s)).forEach(u=>{o.setPendingRemoteMedia(i,u)}),o.emit(Ge.MediaReconnectStart,i.uid)}),o.unbindAllRemoteTrackEvents(),o.remoteUserMap.clear(),o.statsUploader.stopUploadUplinkStats(),o.statsUploader.stopUploadDownlinkStats(),o.statsUploader.stopUploadTransportStats(),R.debug("[".concat(o.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(o,r){for(const i of this.pendingRemoteTracks){const{user:s,kind:u}=i;if((o instanceof ch?o.uid:o)===s.uid&&r===u)return!0}return!1}setPendingRemoteMedia(o,r){this.hasPendingRemoteMedia(o,r)||this.pendingRemoteTracks.push({user:o,kind:r})}restartICE(o){var r=this;return pi(function*(){if(!r.connection||r.state!==on.Connected||r.connection instanceof Yr)return;const i=yield Ve(r.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield Ve(r.connection.restartICE(o));const d=yield Ve(s.next());if(d.done)return;const h=d.value,f=yield h;switch(r.reportPCDisconnectedOrFailed(o),o){case ar.TCP:r._pcStatsUploadType=ki.TCP_RESTART;break;case ar.RELAY:r._pcStatsUploadType=ki.RELAY_RESTART;break;default:r._pcStatsUploadType=ki.OLD_RESTART}r._isInRestartIce=!0,s.next(f)}catch(d){var u;null===(u=s)||void 0===u||u.throw(d)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const o=this.connection.getStats(),r=this.localTrackMap.get(de.LocalVideoTrack),i=this.localTrackMap.get(de.LocalAudioTrack),s=o.videoSend.find(b=>b.ssrc===r?.ssrcs[0].ssrcId),u=o.audioSend.find(b=>b.ssrc===i?.ssrcs[0].ssrcId);if(!s||!u)return 1;const d=Bi(this,Ge.NeedSignalRTT),h=s?s.rttMs:void 0,f=u?u.rttMs:void 0,m=h&&f?(h+f)/2:h||f,E=100*o.sendPacketLossRate*.7/50+.3*((m&&d?(m+d)/2:m||d)||0)/1500,y=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,T=r?.track;if(T&&T._encoderConfig&&-1===T._hints.indexOf(rn.SCREEN_TRACK)){const b=T._encoderConfig.bitrateMax,w=o.bitrate.actualEncoded;if(b&&w){const P=(1e3*b-w)/(1e3*b);return JN[P<.15?0:P<.3?1:P<.45?2:P<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.connection)return 0;const o=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const u=s._audioSSRC,d=s._videoSSRC,h=o.audioRecv.find(w=>w.ssrc===u),f=o.videoRecv.find(w=>w.ssrc===d);if(!h&&!f)return void(r+=1);const m=Bi(this,Ge.NeedSignalRTT),_=o.rtt,E=(_&&m?(_+m)/2:_||m)||0,y=h?h.jitterMs:void 0,T=o.recvPacketLossRate;let b=.7*T*100/50+.3*E/1500;y&&(b=.6*T*100/50+.2*E/1500+.2*y/400),r+=b<.1?1:b<.17?2:b<.36?3:b<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(o){var r=this;return M(function*(){return new ie((i,s)=>{r.handleMuteLocalTrack(o,i,s)})})()}filterTobePublishedTracks(o,r,i){const s=[],u=Yt(),d=this.getAllTracks();o=Rb(o=o.filter(m=>-1===d.indexOf(m)));let h=!1,f=!1;for(const m of o){if(m instanceof an&&(this.localTrackMap.has(de.LocalVideoTrack)||h?new L(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:m,type:de.LocalVideoTrack}),h=!0),r)){const _=this.getLowVideoTrack(m,i);s.push({track:_,type:de.LocalVideoLowTrack})}if(m instanceof lr){const _=this.localTrackMap.get(de.LocalAudioTrack);if(_){if(!(_.track instanceof kr))throw new L(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new L(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(f){const E=s.find(y=>{let{type:T}=y;return T===de.LocalAudioTrack});if(!(E.track instanceof kr))throw new L(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new L(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(m)}else{if(!u.webAudioMediaStreamDest||m instanceof kr||m._bypassWebAudio)s.push({track:m,type:de.LocalAudioTrack});else{const E=new kr;E.addAudioTrack(m),s.push({track:E,type:de.LocalAudioTrack})}f=!0}}}return s}filterTobeUnpublishedTracks(o){const r=[],i=this.getAllTracks();o=Rb(o=o.filter(s=>-1!==i.indexOf(s)));for(const s of o){if(s instanceof lr){const u=this.localTrackMap.get(de.LocalAudioTrack);if(!u)continue;u.track instanceof kr?(u.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),0===u.track.trackList.length&&(r.push([de.LocalAudioTrack,u]),u.track.close())):r.push([de.LocalAudioTrack,u])}if(s instanceof an){const u=this.localTrackMap.get(de.LocalVideoTrack);if(!u)continue;r.push([de.LocalVideoTrack,u]);const d=this.localTrackMap.get(de.LocalVideoLowTrack);d&&r.push([de.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(o){o.forEach(r=>{let{track:i,type:s}=r;switch(s){case de.LocalVideoTrack:i.addListener(Ee.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Ee.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ee.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ee.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Ee.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(Ee.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Ee.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ee.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case de.LocalAudioTrack:this.bindLocalAudioTrackEvents(i)}})}bindLocalAudioTrackEvents(o,r){o instanceof kr?o.trackList.forEach(i=>{i.addListener(Ee.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ee.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ee.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Ee.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ee.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(o.addListener(Ee.GET_STATS,this.handleGetLocalAudioStats),o.addListener(Ee.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(Ee.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(Ee.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(Ee.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||o.addListener(Ee.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(o){o||(o=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:s}]=r;return{track:s,type:i}})),o.forEach(r=>{let{track:i,type:s}=r;switch(s){case de.LocalVideoTrack:i.off(Ee.GET_STATS,this.handleGetLocalVideoStats),i.off(Ee.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Ee.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Ee.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Ee.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.off(Ee.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Ee.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Ee.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case de.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i)}})}unbindLocalAudioTrackEvents(o){o instanceof kr?o.trackList.forEach(r=>{r.off(Ee.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Ee.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Ee.GET_STATS,this.handleGetLocalAudioStats),r.off(Ee.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Ee.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(o.off(Ee.GET_STATS,this.handleGetLocalAudioStats),o.off(Ee.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(Ee.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(Ee.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.off(Ee.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(Ee.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(o,r){r instanceof mS&&r.addListener(Ee.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(o))}),r instanceof gS&&r.addListener(Ee.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(o))})}unbindRemoteTrackEvents(o){o&&o.removeAllListeners(Ee.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(o=>{let[r,i]=o;i.has(be.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(be.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(o,r){return o.map((i,s)=>{let u,d,{track:h,type:f}=i;switch(f){case de.LocalAudioTrack:u=fn.Audio,d={dtx:h instanceof ty&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case de.LocalVideoTrack:u=h._hints.includes(rn.SCREEN_TRACK)?fn.Screen:fn.High,d=ja(ja({},ny(h)),{},{codec:this.store.codec});break;case de.LocalVideoLowTrack:u=fn.Low,d=ja(ja({},ny(h)),{},{codec:this.store.codec})}return{stream_type:u,attributes:d,ssrcs:r[s]}})}createGatewayUnpublishMessage(o){return o.map(r=>{let i,[s,{track:u,ssrcs:d,id:h}]=r;switch(s){case de.LocalVideoTrack:i=u._hints.includes(rn.SCREEN_TRACK)?fn.Screen:fn.High;break;case de.LocalAudioTrack:i=fn.Audio;break;case de.LocalVideoLowTrack:i=fn.Low}return{stream_type:i,ssrcs:d,mid:h}})}assignLocalTracks(o,r){o.forEach((i,s)=>{let{track:u,type:d}=i;this.localTrackMap.set(d,{track:u,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(o){o.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(o){var r=this;o.onConnectionStateChange=function(){var i=M(function*(s){if(R.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(s,")")),r.emit(Ge.PeerConnectionStateChange,s),"connected"!==s||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),"connected"===s&&(r._restartTimer&&(clearTimeout(r._restartTimer),r._restartTimer=void 0),(r._isFirstConnected||r._isInRestartIce)&&r.reportPCStats(Date.now(),!0,r._pcStatsUploadType),r._isInRestartIce=!1,r._isFirstConnected=!1,r._isStartRestartIce=!1),V("NEW_ICE_RESTART")){if(r._restartStates.includes(s)){if(r._isStartRestartIce)return;r._isStartRestartIce=!0;const u=f=>{("disconnected"===o.iceConnectionState||"checking"===o.iceConnectionState||"failed"===o.iceConnectionState)&&(R.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(f)),"CONNECTED"===Bi(r,Ge.QueryClientConnectionState)&&r.emit(Ge.RequestRestartICE,f))},d=()=>{"disconnected"!==o.iceConnectionState&&"checking"!==o.iceConnectionState&&"failed"!==o.iceConnectionState||(r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),R.debug("[".concat(r.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>r.emit(Ge.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},h=V("ICE_RESTART_INTERVAL");return void(r._restartTimer=window.setTimeout(()=>{if(V("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Yt().supportPCSetConfiguration)u(ar.RELAY),r._restartTimer=window.setTimeout(d,h);else if(Bt())u(ar.UDP),r._restartTimer=window.setTimeout(d,4e3);else{if(u(ar.TCP),Yt().supportPCSetConfiguration)return void(r._restartTimer=window.setTimeout(()=>{u(ar.RELAY),r._restartTimer=window.setTimeout(d,h)},h));r._restartTimer=window.setTimeout(d,h)}},800))}}else{if("disconnected"===s&&"disconnected"===o.iceConnectionState)return setTimeout(()=>{"disconnected"===o.iceConnectionState&&V("ICE_RESTART")&&"CONNECTED"===Bi(r,Ge.QueryClientConnectionState)&&r.emit(Ge.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===o.peerConnectionState&&(R.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),r._isInRestartIce=!1,setTimeout(()=>r.emit(Ge.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},4e3);"failed"===s&&(R.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection state failed, force reconnect")),r.reportPCDisconnectedOrFailed(),setTimeout(()=>r.emit(Ge.P2PLost),0),r.iceFailedCount+=1,yield r.requestReconnect())}});return function(s){return i.apply(this,arguments)}}(),o.onICEConnectionStateChange=i=>{"connected"!==i||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(i,")")),he.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:i,tag:xt.TRACER}).onSuccess(),this.emit(Ge.IceConnectionStateChange,i)},o.onICETransportStateChange=i=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(i,")"))},o.onDTLSTransportStateChange=i=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(i,")"))},o.onDTLSTransportError=i=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(i,")"))},o.onFirstAudioDecoded=i=>{var s;const u=Array.from(Ma(s=this.remoteUserMap).call(s)).find(h=>h._audioSSRC===i);var d;u&&(this.store.subscribe(u.uid,"audio",void 0,void 0,void 0,Date.now()),null===(d=u.audioTrack)||void 0===d||d.emit(xc.FIRST_FRAME_DECODED),he.firstRemoteFrame(this.store.sessionId,Kn.FIRST_AUDIO_DECODE,kt.FIRST_AUDIO_DECODE,{peer:u._uintid,subscribeElapse:xr.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId}))},o.onFirstAudioReceived=i=>{var s;const u=Array.from(Ma(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===i);u&&he.firstRemoteFrame(this.store.sessionId,Kn.FIRST_AUDIO_RECEIVED,kt.FIRST_AUDIO_RECEIVED,{peer:u._uintid,subscribeElapse:xr.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},o.onFirstVideoDecoded=(i,s,u)=>{this.reportVideoFirstFrameDecoded(i,s,u)},o.onFirstVideoReceived=i=>{var s;const u=Array.from(Ma(s=this.remoteUserMap).call(s)).find(d=>d._videoSSRC===i);u&&he.firstRemoteFrame(this.store.sessionId,Kn.FIRST_VIDEO_RECEIVED,kt.FIRST_VIDEO_RECEIVED,{peer:u._uintid,subscribeElapse:xr.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},o.onSelectedLocalCandidateChanged=(i,s)=>{const u="relay"===i.candidateType;"unknown"!==s.candidateType&&u===("relay"===s.candidateType)||this.emit(Ge.ConnectionTypeChange,u),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(lm(s))," -> ").concat(JSON.stringify(lm(i)),")"))},o.onSelectedRemoteCandidateChanged=(i,s)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(lm(s))," -> ").concat(JSON.stringify(lm(i)),")"))},o.onFirstVideoDecodedTimeout=i=>{this.reportVideoFirstFrameDecoded(i,void 0,void 0,!0)}}unbindConnectionEvents(o){o.onConnectionStateChange=void 0,o.onICEConnectionStateChange=void 0,o.onICETransportStateChange=void 0,o.onDTLSTransportStateChange=void 0,o.onDTLSTransportError=void 0,o.onFirstAudioDecoded=void 0,o.onFirstAudioReceived=void 0,o.onFirstVideoDecoded=void 0,o.onFirstVideoReceived=void 0,o.onSelectedLocalCandidateChanged=void 0,o.onSelectedRemoteCandidateChanged=void 0,o.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(o){const r=[];if(-1===this.getAllTracks().indexOf(o))return r;const i=this.localTrackMap.get(de.LocalAudioTrack);if(o instanceof lr&&i?.track instanceof kr)return i.track.isActive||r.push([de.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:d}]=u;return o===d});if(s&&(r.push(s),s[0]===de.LocalVideoTrack)){const u=this.localTrackMap.get(de.LocalVideoLowTrack);u&&r.push([de.LocalVideoLowTrack,u])}return r}filterTobeUnmutedTracks(o){const r=[],i=this.localTrackMap.get(de.LocalAudioTrack);if(o instanceof lr&&i?.track instanceof kr)return i.track.isActive&&r.push([de.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:d}]=u;return o===d});if(s)if(s[0]===de.LocalVideoTrack){r.push(s);const u=this.localTrackMap.get(de.LocalVideoLowTrack);u&&r.push([de.LocalVideoLowTrack,u])}else r.push(s);return r}createMuteMessage(o){return o.map(r=>{let i,[s,{track:u,ssrcs:d,id:h}]=r;switch(s){case de.LocalAudioTrack:i=fn.Audio;break;case de.LocalVideoTrack:i=u._hints.includes(rn.SCREEN_TRACK)?fn.Screen:fn.High;break;case de.LocalVideoLowTrack:i=fn.Low}return{stream_type:i,ssrcs:d,mid:h}})}createUnmuteMessage(o){return o.map(r=>{let i,[s,{track:u,ssrcs:d,id:h}]=r;switch(s){case de.LocalAudioTrack:i=fn.Audio;break;case de.LocalVideoTrack:i=u._hints.includes(rn.SCREEN_TRACK)?fn.Screen:fn.High;break;case de.LocalVideoLowTrack:i=fn.Low}return{stream_type:i,ssrcs:d,mid:h}})}filterTobeUnSubscribedTracks(o,r){const i=[],s=this.remoteUserMap.get(o);if(!s)return i;if(r){const u=s.get(r);if(!u)return i;i.push([o,{kind:r,id:u}])}else Array.from(s.entries()).forEach(u=>{let[d,h]=u;i.push([o,{kind:d,id:h}])});return i}createUnsubscribeMessage(o){const r=[];return o.forEach(i=>{let[s,{kind:u}]=i;switch(u){case be.VIDEO:return void(s._videoSSRC&&r.push({stream_type:be.VIDEO,ssrcId:s._videoSSRC}));case be.AUDIO:return void(s._audioSSRC&&r.push({stream_type:be.AUDIO,ssrcId:s._audioSSRC}))}}),r}createUnsubscribeAllMessage(o){const r=new Map;return o.forEach(i=>{let[s,{kind:u}]=i;if(r.has(s)){let d=r.get(s);d|=u===be.VIDEO?nn.Video:nn.Audio,r.set(s,d)}else r.set(s,u===be.VIDEO?nn.Video:nn.Audio)}),{users:Array.from(r.entries()).map(i=>{let[s,u]=i;return{stream_id:s.uid,stream_type:u}})}}withdrawRemoteTracks(o){o.forEach(r=>{let[i,{kind:s}]=r;const u=this.remoteUserMap.get(i);u&&(u.delete(s),0===Array.from(u.entries()).length&&this.remoteUserMap.delete(i))})}updateBitrateLimit(o){var r=this;return M(function*(){const i=r.localTrackMap.get(de.LocalVideoTrack),s=r.localTrackMap.get(de.LocalVideoLowTrack);i&&(yield i.track.setBitrateLimit(o.uplink)),s&&o.low_stream_uplink&&(yield s.track.setBitrateLimit({max_bitrate:o.low_stream_uplink.bitrate,min_bitrate:o.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(o,r){return o.map((i,s)=>{var u;let{stream_type:d}=i;return null===(u=r.find(h=>{let{stream_type:f}=h;return d===f}))||void 0===u?void 0:u.attributes})}tryToUnmuteAudio(o){var r=this;return M(function*(){for(let s=0;s<o.length;s++)if(o[s]instanceof lr){var i;const u=r.filterTobeUnmutedTracks(o[s]);if(0===u.length)continue;yield null===(i=r.connection)||void 0===i?void 0:i.unmuteLocal(u.map(h=>{let[,{id:f}]=h;return f}));const d=r.createUnmuteMessage(u);return void(yield Wt(r,Ge.RequestUnmuteLocal,d))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=o=>{var r;return!(null===(r=this.connection)||void 0===r||!r.getRemoteVideoIsReady(o))},this.statsUploader.requestUpload=(o,r)=>this.emit(Ge.RequestUploadStats,o,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var o=this;return M(function*(){o.dtlsFailedCount+=1,yield hr(Ju(o.dtlsFailedCount,vn)),o.emit(Ge.RequestReconnect)})()}reconnectP2P(){var o=this;return M(function*(){const r=Array.from(o.localTrackMap.entries()),i=o.createGatewayUnpublishMessage(r);Array.from(o.remoteUserMap.entries()),i.length>0&&(yield zn(o,Ge.RequestUnpublishForReconnectPC,i)),o.disconnectForReconnect(),o.emit(Ge.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(de.LocalVideoTrack)||this.pendingLocalTracks.some(o=>o instanceof an)}throwIfTrackTypeNotMatch(o){if(o.filter(r=>r instanceof an).length>1)throw new L(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(o.filter(r=>r instanceof lr).length>1&&(o.some(r=>r instanceof lr&&r._bypassWebAudio)||!Yt().webAudioMediaStreamDest))throw new L(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of o){if(r instanceof an&&this.pendingLocalTracks.some(i=>i instanceof an))throw new L(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof lr&&this.pendingLocalTracks.some(i=>i instanceof lr)&&(!Yt().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof lr&&i._bypassWebAudio)))throw new L(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(o,r){const i=Yt().supportDualStreamEncoding,s=ja(ja({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=i?o._mediaStreamTrack.clone():Qm(o,s);const d=wt(8,"track-low-"),h=new an(u,ja(ja({},i&&{scaleResolutionDownBy:sy(s,o)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,d);return h.on(ad.TRANSCEIVER_UPDATED,f=>{o._updateRtpTransceiver(f,fs.LOW_STREAM)}),h._hints.push(rn.LOW_STREAM),o.addListener(Ee.NEED_CLOSE,()=>{h.close()}),h}globalLock(){var o=this;return M(function*(){return o.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(o,r,i){var s=arguments,u=this;return M(function*(){let d=s.length>3&&void 0!==s[3]?s[3]:null;if(u.connection&&u.connection instanceof bs){var h,f,m,_;const E=u.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:T,peerConnectionState:b}=u.connection,{local:w,remote:P}=yield u.connection.getSelectedCandidatePair();he.pcStats(u.store.sessionId,{startTime:E,eventElapse:o-E||0,iceconnectionsate:y,dtlsstate:T,connectionstate:b,intSucc:r?1:2,error:d,selectedLocalCandidateProtocol:null!==(h=w?.protocol)&&void 0!==h?h:"",selectedLocalCandidateType:null!==(f=w.candidateType)&&void 0!==f?f:"",selectedLocalCandidateAddress:"".concat(w.address,":").concat(w.port),selectedRemoteCandidateProtocol:null!==(m=P.protocol)&&void 0!==m?m:"",selectedRemoteCandidateType:null!==(_=P.candidateType)&&void 0!==_?_:"",selectedRemoteCandidateAddress:"".concat(P.address,":").concat(P.port),restartCnt:i})}})()}reportVideoFirstFrameDecoded(o,r,i,s){var u;const d=Array.from(Ma(u=this.remoteUserMap).call(u)).find(h=>h._videoSSRC===o);if(d){s||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find(m=>m.userId===d.uid&&"video"===m.type);he.firstRemoteVideoDecode(this.store.sessionId,Kn.FIRST_VIDEO_DECODE,kt.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:i,subscribeElapse:xr.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:f?.subscribeEnd||0,subscriberStart:f?.subscribeStart||0,videoAddNotify:f?.streamAdded||0,state:s?1:0})}}remoteMediaSsrcChanged(o,r,i){var s=this;return M(function*(){if(!s.connection)return!1;const u=s.remoteUserMap.get(o);if(!u)return!1;const d=u.get(r);if(!d)return!1;const h=yield s.connection.getRemoteSSRC(d);return void 0!==h&&h!==i})()}resetConnection(o){R.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(o)),this.state===on.Connected?(R.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=o===Yf.datachannel?new Yr({},this.store):this.isPlanB?new Ih({},this.store):new bs({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(o=>{let[r,{track:i}]=o;r===de.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,fs.LOW_STREAM):i._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(o){this.connection&&this.connection instanceof bs&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===ki.TCP_RESTART&&o===ar.RELAY?this._pcStatsUploadType:ki.DISCONNECTED_OR_FAILED)))}}).prototype,"startP2PConnection",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"startP2PConnection"),Xe.prototype),q(Xe.prototype,"connect",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"connect"),Xe.prototype),q(Xe.prototype,"preConnect",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"preConnect"),Xe.prototype),q(Xe.prototype,"unpublish",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"unpublish"),Xe.prototype),q(Xe.prototype,"unpublishLowStream",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"unpublishLowStream"),Xe.prototype),q(Xe.prototype,"subscribe",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"subscribe"),Xe.prototype),q(Xe.prototype,"massSubscribe",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"massSubscribe"),Xe.prototype),q(Xe.prototype,"unsubscribe",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"unsubscribe"),Xe.prototype),q(Xe.prototype,"massUnsubscribe",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"massUnsubscribe"),Xe.prototype),q(Xe.prototype,"muteRemote",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"muteRemote"),Xe.prototype),q(Xe.prototype,"unmuteRemote",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"unmuteRemote"),Xe.prototype),q(Xe.prototype,"hasRemoteMediaWithLock",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"hasRemoteMediaWithLock"),Xe.prototype),q(Xe.prototype,"disconnectForReconnect",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"disconnectForReconnect"),Xe.prototype),q(Xe.prototype,"updateBitrateLimit",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"updateBitrateLimit"),Xe.prototype),q(Xe.prototype,"remoteMediaSsrcChanged",[Jr],Object.getOwnPropertyDescriptor(Xe.prototype,"remoteMediaSsrcChanged"),Xe.prototype),Xe);function Jr(o,r,i){const s=o[r];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=M(function*(){const u=this.mutex,d=yield u.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield s.apply(this,f)}finally{d()}}),i}function oD(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function le(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?oD(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):oD(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}var Ie;!function(o){o.SET_SESSION_ID="SET_SESSION_ID",o.SET_P2P_ID="SET_P2P_id",o.SET_DC_ID="SET_DC_id",o.SET_UID="SET_UID",o.SET_PUB_ID="SET_PUB_ID",o.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",o.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",o.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",o.AVOID_JOIN_START="AVOID_JOIN_START",o.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",o.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",o.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",o.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",o.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",o.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",o.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",o.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",o.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",o.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",o.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",o.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",o.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",o.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",o.RESET_KEY_METRICS="RESET_KEY_METRICS",o.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"}(Ie||(Ie={}));class pr{constructor(r,i,s,u){S(this,"state",void 0),this.state={codec:r,audioCodec:i,mode:s,clientId:u,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(r){this.state=function(i,s){switch(s.type){case Ie.SET_SESSION_ID:return le(le({},i),{},{sessionId:s.sessionId});case Ie.SET_P2P_ID:return le(le({},i),{},{p2pId:s.p2pId});case Ie.SET_UID:return le(le({},i),{},{uid:s.uid});case Ie.SET_PUB_ID:return le(le({},i),{},{pubId:s.pubId});case Ie.KEY_METRIC_CLIENT_CREATED:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{clientCreated:s.metric})});case Ie.KEY_METRIC_JOIN_START:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{joinStart:s.metric})});case Ie.AVOID_JOIN_START:return le(le({},i),{},{avoidJoinStart:s.avoidJoinStart});case Ie.KEY_METRIC_JOIN_END:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{joinEnd:s.metric})});case Ie.KEY_METRIC_REQUEST_AP_START:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{requestAPStart:s.metric})});case Ie.KEY_METRIC_REQUEST_AP_END:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{requestAPEnd:s.metric})});case Ie.KEY_METRIC_JOIN_GATEWAY_START:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{joinGatewayStart:s.metric})});case Ie.KEY_METRIC_JOIN_GATEWAY_END:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{joinGatewayEnd:s.metric})});case Ie.KEY_METRIC_PEER_CONNECTION_START:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{peerConnectionStart:s.metric})});case Ie.KEY_METRIC_PEER_CONNECTION_END:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{peerConnectionEnd:s.metric})});case Ie.KEY_METRIC_DESCRIPTION_START:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{descriptionStart:s.metric})});case Ie.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{signalChannelOpen:s.metric})});case Ie.KEY_METRIC_ICE_CONNECTION_END:return le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{iceConnectionEnd:s.metric})});case Ie.KEY_METRIC_PUBLISH:{const u=i.keyMetrics.publish,d=u.findIndex(h=>h.trackId===s.metric.trackId);return-1!==d?(u[d]=le(le({},u[d]),s.metric),le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{publish:[...u]})})):le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{publish:[...i.keyMetrics.publish,s.metric]})})}case Ie.KEY_METRIC_SUBSCRIBE:{const u=i.keyMetrics.subscribe,d=u.findIndex(h=>h.userId===s.metric.userId&&h.type===s.metric.type);return-1!==d?(u[d]=le(le({},u[d]),s.metric),le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{subscribe:[...u]})})):le(le({},i),{},{keyMetrics:le(le({},i.keyMetrics),{},{subscribe:[...i.keyMetrics.subscribe,s.metric]})})}case Ie.SET_CLOUD_PROXY_SERVER_MODE:return i.cloudProxyServerMode=s.mode,i;case Ie.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof s.index?i.joinChannelServiceRecords=[...i.joinChannelServiceRecords,s.record]:(i.joinChannelServiceRecords[s.index]=le(le({},i.joinChannelServiceRecords[s.index]),s.record),i.joinChannelServiceRecords=[...i.joinChannelServiceRecords]),i;case Ie.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return i.joinChannelServiceRecords=[],i;case Ie.RESET_KEY_METRICS:return i.keyMetrics={publish:[],subscribe:[]},i;case Ie.SET_USE_DATACHANNEL:return le(le({},i),{},{useDataChannel:s.val});default:return i}}(this.state,r)}set sessionId(r){this.dispatch({type:Ie.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:Ie.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:Ie.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:Ie.SET_UID,uid:r})}get uid(){return this.state.uid}set pubId(r){this.dispatch({type:Ie.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:Ie.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(r){this.dispatch({type:Ie.SET_USE_DATACHANNEL,val:r})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:Ie.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ie.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Ie.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ie.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ie.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ie.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ie.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ie.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ie.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Ie.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ie.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ie.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,i,s,u){this.dispatch({type:Ie.KEY_METRIC_PUBLISH,metric:le(le({trackId:r,type:i},s&&{publishStart:s}),u&&{publishEnd:u})})}subscribe(r,i,s,u,d,h,f){this.dispatch({type:Ie.KEY_METRIC_SUBSCRIBE,metric:le(le(le(le(le({userId:r,type:i},s&&{subscribeStart:s}),u&&{subscribeEnd:u}),d&&{firstFrame:d}),h&&{streamAdded:h}),f&&{firstDecoded:f})})}massSubscribe(r,i,s,u){r.forEach(d=>{this.dispatch({type:Ie.KEY_METRIC_SUBSCRIBE,metric:le(le(le({userId:d.userId,type:d.type},i&&{subscribeStart:i}),s&&{subscribeEnd:s}),u&&{firstFrame:u})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,i){"gateway"===r.service&&Array.isArray(r.urls)&&(r.urls=r.urls.map(s=>s.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof i?(this.dispatch({type:Ie.RECORD_JOIN_CHANNEL_SERVICE,record:le(le({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(i<0||i>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ie.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:i}),i)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ie.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ie.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(r){this.dispatch({type:Ie.AVOID_JOIN_START,avoidJoinStart:r})}}let bn;const An=()=>void 0!==window.isSecureContext;function WP(o){let r={};e:for(;!zP(o);){let i=_i(o);switch(i>>>3){case 0:break e;case 1:r.requestId=cD(o,_i(o));break;case 2:r.requestType=_i(o)>>>0;break;case 3:r.scorePorn=hD(o);break;case 4:r.scoreSexy=hD(o);break;case 5:r.scoreNeutral=hD(o);break;case 6:r.requestScene=_i(o)>>>0;break;case 7:r.scene=_i(o)>>>0;break;default:iD(o,7&i)}}return r}function KP(o,r){let i=o.service;void 0!==i&&(nt(r,8),nt(r,i));let s=o.vendor;void 0!==s&&(nt(r,16),nt(r,s));let u=o.token;void 0!==u&&(nt(r,26),As(r,u));let d=o.callbackUrl;void 0!==d&&(nt(r,34),As(r,d))}function qP(o){let r=_i(o),i=o.limit;return o.limit=o.offset+r,i}function iD(o,r){switch(r){case 0:for(;128&dD(o););break;case 2:Oh(o,_i(o));break;case 5:Oh(o,4);break;case 1:Oh(o,8);break;default:throw new Error("Unimplemented type: "+r)}}let $P=new Float32Array(1);new Uint8Array($P.buffer);let sD=new Float64Array(1),uo=new Uint8Array(sD.buffer);function ea(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}let Dh=[];function wh(){const o=Dh.pop();return o?(o.offset=o.limit=0,o):{bytes:new Uint8Array(64),offset:0,limit:0}}function gi(o){Dh.push(o)}function Oh(o,r){if(o.offset+r>o.limit)throw new Error("Skip past limit");o.offset+=r}function zP(o){return o.offset>=o.limit}function Nh(o,r){let i=o.bytes,s=o.offset,u=o.limit,d=s+r;if(d>i.length){let h=new Uint8Array(2*d);h.set(i),o.bytes=h}return o.offset=d,d>u&&(o.limit=d),s}function aD(o,r){let i=o.offset;if(i+r>o.limit)throw new Error("Read past limit");return o.offset+=r,i}function cD(o,r){let i=aD(o,r),s=String.fromCharCode,u=o.bytes,d="\ufffd",h="";for(let f=0;f<r;f++){let m,_,E,y,T=u[f+i];128&T?192==(224&T)?f+1>=r?h+=d:(m=u[f+i+1],128!=(192&m)?h+=d:(y=(31&T)<<6|63&m,y<128?h+=d:(h+=s(y),f++))):224==(240&T)?f+2>=r?h+=d:(m=u[f+i+1],_=u[f+i+2],32896!=(49344&(m|_<<8))?h+=d:(y=(15&T)<<12|(63&m)<<6|63&_,y<2048||y>=55296&&y<=57343?h+=d:(h+=s(y),f+=2))):240==(248&T)?f+3>=r?h+=d:(m=u[f+i+1],_=u[f+i+2],E=u[f+i+3],8421504!=(12632256&(m|_<<8|E<<16))?h+=d:(y=(7&T)<<18|(63&m)<<12|(63&_)<<6|63&E,y<65536||y>1114111?h+=d:(y-=65536,h+=s(55296+(y>>10),56320+(1023&y)),f+=3))):h+=d:h+=s(T)}return h}function As(o,r){let i=r.length,s=0;for(let h=0;h<i;h++){let f=r.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+r.charCodeAt(++h)-56613888),s+=f<128?1:f<2048?2:f<65536?3:4}nt(o,s);let u=Nh(o,s),d=o.bytes;for(let h=0;h<i;h++){let f=r.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+r.charCodeAt(++h)-56613888),f<128?d[u++]=f:(f<2048?d[u++]=f>>6&31|192:(f<65536?d[u++]=f>>12&15|224:(d[u++]=f>>18&7|240,d[u++]=f>>12&63|128),d[u++]=f>>6&63|128),d[u++]=63&f|128)}}function uD(o,r){let i=Nh(o,r.limit),s=o.bytes,u=r.bytes;for(let d=0,h=r.limit;d<h;d++)s[d+i]=u[d]}function dD(o){return o.bytes[aD(o,1)]}function lD(o,r){let i=Nh(o,1);o.bytes[i]=r}function hD(o){let r=aD(o,8),i=o.bytes;return uo[0]=i[r++],uo[1]=i[r++],uo[2]=i[r++],uo[3]=i[r++],uo[4]=i[r++],uo[5]=i[r++],uo[6]=i[r++],uo[7]=i[r++],sD[0]}function No(o,r){let i=Nh(o,8),s=o.bytes;sD[0]=r,s[i++]=uo[0],s[i++]=uo[1],s[i++]=uo[2],s[i++]=uo[3],s[i++]=uo[4],s[i++]=uo[5],s[i++]=uo[6],s[i++]=uo[7]}function _i(o){let r,i=0,s=0;do{r=dD(o),i<32&&(s|=(127&r)<<i),i+=7}while(128&r);return s}function nt(o,r){for(r>>>=0;r>=128;)lD(o,127&r|128),r>>>=7;lD(o,r)}function Ba(o,r){let i=r.low>>>0,s=(r.low>>>28|r.high<<4)>>>0,u=r.high>>>24,d=0===u?0===s?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:u<128?9:10,h=Nh(o,d),f=o.bytes;switch(d){case 10:f[h+9]=u>>>7&1;case 9:f[h+8]=9!==d?128|u:127&u;case 8:f[h+7]=8!==d?s>>>21|128:s>>>21&127;case 7:f[h+6]=7!==d?s>>>14|128:s>>>14&127;case 6:f[h+5]=6!==d?s>>>7|128:s>>>7&127;case 5:f[h+4]=5!==d?128|s:127&s;case 4:f[h+3]=4!==d?i>>>21|128:i>>>21&127;case 3:f[h+2]=3!==d?i>>>14|128:i>>>14&127;case 2:f[h+1]=2!==d?i>>>7|128:i>>>7&127;case 1:f[h]=1!==d?128|i:127&i}}const YP=function(){var o=M(function*(r,i,s){const u=function(f){const m=[];for(let _=0;_<f.length;_+=2)m.push(parseInt(f.slice(_,_+2),16));return Uint8Array.from(m)}(function(f){const m="0123456789abcdef";function _(Et){let Oe,ht="";for(Oe=0;Oe<=3;Oe++)ht+=m.charAt(Et>>8*Oe+4&15)+m.charAt(Et>>8*Oe&15);return ht}function E(Et,Oe){const ht=(65535&Et)+(65535&Oe);return(Et>>16)+(Oe>>16)+(ht>>16)<<16|65535&ht}function y(Et,Oe,ht,vt,Jn,Jt){return E((Sn=E(E(Oe,Et),E(vt,Jt)))<<(G=Jn)|Sn>>>32-G,ht);var Sn,G}function T(Et,Oe,ht,vt,Jn,Jt,Sn){return y(Oe&ht|~Oe&vt,Et,Oe,Jn,Jt,Sn)}function b(Et,Oe,ht,vt,Jn,Jt,Sn){return y(Oe&vt|ht&~vt,Et,Oe,Jn,Jt,Sn)}function w(Et,Oe,ht,vt,Jn,Jt,Sn){return y(Oe^ht^vt,Et,Oe,Jn,Jt,Sn)}function P(Et,Oe,ht,vt,Jn,Jt,Sn){return y(ht^(Oe|~vt),Et,Oe,Jn,Jt,Sn)}const k=function(Et){let Oe;const ht=1+(Et.length+8>>6),vt=new Array(16*ht);for(Oe=0;Oe<16*ht;Oe++)vt[Oe]=0;for(Oe=0;Oe<Et.length;Oe++)vt[Oe>>2]|=Et.charCodeAt(Oe)<<Oe%4*8;return vt[Oe>>2]|=128<<Oe%4*8,vt[16*ht-2]=8*Et.length,vt}(f);let x,B,H,ce,Re,Z=1732584193,Y=-271733879,ee=-1732584194,oe=271733878;for(x=0;x<k.length;x+=16)B=Z,H=Y,ce=ee,Re=oe,Z=T(Z,Y,ee,oe,k[x+0],7,-680876936),oe=T(oe,Z,Y,ee,k[x+1],12,-389564586),ee=T(ee,oe,Z,Y,k[x+2],17,606105819),Y=T(Y,ee,oe,Z,k[x+3],22,-1044525330),Z=T(Z,Y,ee,oe,k[x+4],7,-176418897),oe=T(oe,Z,Y,ee,k[x+5],12,1200080426),ee=T(ee,oe,Z,Y,k[x+6],17,-1473231341),Y=T(Y,ee,oe,Z,k[x+7],22,-45705983),Z=T(Z,Y,ee,oe,k[x+8],7,1770035416),oe=T(oe,Z,Y,ee,k[x+9],12,-1958414417),ee=T(ee,oe,Z,Y,k[x+10],17,-42063),Y=T(Y,ee,oe,Z,k[x+11],22,-1990404162),Z=T(Z,Y,ee,oe,k[x+12],7,1804603682),oe=T(oe,Z,Y,ee,k[x+13],12,-40341101),ee=T(ee,oe,Z,Y,k[x+14],17,-1502002290),Y=T(Y,ee,oe,Z,k[x+15],22,1236535329),Z=b(Z,Y,ee,oe,k[x+1],5,-165796510),oe=b(oe,Z,Y,ee,k[x+6],9,-1069501632),ee=b(ee,oe,Z,Y,k[x+11],14,643717713),Y=b(Y,ee,oe,Z,k[x+0],20,-373897302),Z=b(Z,Y,ee,oe,k[x+5],5,-701558691),oe=b(oe,Z,Y,ee,k[x+10],9,38016083),ee=b(ee,oe,Z,Y,k[x+15],14,-660478335),Y=b(Y,ee,oe,Z,k[x+4],20,-405537848),Z=b(Z,Y,ee,oe,k[x+9],5,568446438),oe=b(oe,Z,Y,ee,k[x+14],9,-1019803690),ee=b(ee,oe,Z,Y,k[x+3],14,-187363961),Y=b(Y,ee,oe,Z,k[x+8],20,1163531501),Z=b(Z,Y,ee,oe,k[x+13],5,-1444681467),oe=b(oe,Z,Y,ee,k[x+2],9,-51403784),ee=b(ee,oe,Z,Y,k[x+7],14,1735328473),Y=b(Y,ee,oe,Z,k[x+12],20,-1926607734),Z=w(Z,Y,ee,oe,k[x+5],4,-378558),oe=w(oe,Z,Y,ee,k[x+8],11,-2022574463),ee=w(ee,oe,Z,Y,k[x+11],16,1839030562),Y=w(Y,ee,oe,Z,k[x+14],23,-35309556),Z=w(Z,Y,ee,oe,k[x+1],4,-1530992060),oe=w(oe,Z,Y,ee,k[x+4],11,1272893353),ee=w(ee,oe,Z,Y,k[x+7],16,-155497632),Y=w(Y,ee,oe,Z,k[x+10],23,-1094730640),Z=w(Z,Y,ee,oe,k[x+13],4,681279174),oe=w(oe,Z,Y,ee,k[x+0],11,-358537222),ee=w(ee,oe,Z,Y,k[x+3],16,-722521979),Y=w(Y,ee,oe,Z,k[x+6],23,76029189),Z=w(Z,Y,ee,oe,k[x+9],4,-640364487),oe=w(oe,Z,Y,ee,k[x+12],11,-421815835),ee=w(ee,oe,Z,Y,k[x+15],16,530742520),Y=w(Y,ee,oe,Z,k[x+2],23,-995338651),Z=P(Z,Y,ee,oe,k[x+0],6,-198630844),oe=P(oe,Z,Y,ee,k[x+7],10,1126891415),ee=P(ee,oe,Z,Y,k[x+14],15,-1416354905),Y=P(Y,ee,oe,Z,k[x+5],21,-57434055),Z=P(Z,Y,ee,oe,k[x+12],6,1700485571),oe=P(oe,Z,Y,ee,k[x+3],10,-1894986606),ee=P(ee,oe,Z,Y,k[x+10],15,-1051523),Y=P(Y,ee,oe,Z,k[x+1],21,-2054922799),Z=P(Z,Y,ee,oe,k[x+8],6,1873313359),oe=P(oe,Z,Y,ee,k[x+15],10,-30611744),ee=P(ee,oe,Z,Y,k[x+6],15,-1560198380),Y=P(Y,ee,oe,Z,k[x+13],21,1309151649),Z=P(Z,Y,ee,oe,k[x+4],6,-145523070),oe=P(oe,Z,Y,ee,k[x+11],10,-1120210379),ee=P(ee,oe,Z,Y,k[x+2],15,718787259),Y=P(Y,ee,oe,Z,k[x+9],21,-343485551),Z=E(Z,B),Y=E(Y,H),ee=E(ee,ce),oe=E(oe,Re);return _(Z)+_(Y)+_(ee)+_(oe)}(""+i+s)).slice(0,16),d=u.slice(0,12),h=yield window.crypto.subtle.importKey("raw",u,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},h,r))});return function(i,s,u){return o.apply(this,arguments)}}();function pD(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}const Ph=new Map([["moderation",1],["supervise",2]]);class rg extends Lt{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(mn.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=ti(i=r.map(s=>Ph.get(s)||0)).call(i,(s,u)=>s+u),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),S(this,"name","AgoraRTCVideoContentInspect"),S(this,"_connectionState",oo.CONNECTING),S(this,"_innerConnectionState",void 0),S(this,"sequence",0),S(this,"inspectStartTime",void 0),S(this,"workerManagerConnection",void 0),S(this,"workerConnection",void 0),S(this,"workerMessageLengthLimit",void 0),S(this,"inspectIntervalMinimum",void 0),S(this,"qualityRatio",void 0),S(this,"_connectInfo",void 0),S(this,"_cancelTokenSource",Ni.CancelToken.source()),S(this,"_retryConfig",void 0),S(this,"wmSequence",0),S(this,"inspectInterval",void 0),S(this,"inspectTimer",null),S(this,"ossFilePrefix",void 0),S(this,"extraInfo",void 0),S(this,"_inspectType",void 0),S(this,"_inspectMode",void 0),S(this,"_quality",1),S(this,"qualityTimer",null),S(this,"_inspectId",void 0),S(this,"_needWorkUrlOnly",!1),S(this,"inspectImage",()=>{if(this.connectionState!==oo.CONNECTED)throw new L(D.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===oo.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=wt(5,"inspect-"),this.workerMessageLengthLimit=V("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=V("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=V("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ua("worker-manager-"+this._inspectId,vn),this.on(mn.STATE_CHANGE,(i,s)=>{this._innerConnectionState=i,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(io[i]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ua("worker-"+this._inspectId,vn),this.handleWorkerEvents()}init(r,i){var s=this;return M(function*(){s.emit(mn.STATE_CHANGE,io.CONNECT_AP),s._connectInfo=r;const u=s._cancelTokenSource.token;return s._retryConfig=i,new ie((d,h)=>{s.on(mn.CONNECTION_STATE_CHANGE,(f,m)=>{m===oo.CONNECTED&&d()}),s.requestAP(r,u,i).then(f=>{s.connectWorkerManager(f)}).catch(f=>{h(f)})})})()}requestAP(r,i,s){var u=this;return M(function*(){const d=V("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),h=yield function(m,_,E,y){let{appId:T,areaCode:b,cname:w,sid:P,token:k,uid:x}=_;Sm++;const B="image_moderation_api",H={service_name:B,json_body:JSON.stringify({appId:T,areaCode:b,cname:w,command:"allocateEdge",requestId:Sm,seq:Sm,sid:P,token:k,ts:Date.now(),uid:x+""})};let ce,Re,Z=m[0];return to(M(function*(){ce=Date.now();const Y=yield Vi(Z,{data:H,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Re=Date.now()-ce,0!==Y.code){const Oe=new L(D.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Y.code,{retry:!0,responseTime:Re});throw R.error(Oe.toString()),Oe}const ee=JSON.parse(Y.json_body);if(200!==ee.code){const Oe=new L(D.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ee.code,", reason: ").concat(ee.reason),{code:ee.code,responseTime:Re});throw R.error(Oe.toString()),Oe}if(!ee.servers||!Array.isArray(ee.servers)||0===ee.servers.length){const Oe=new L(D.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ee.code,responseTime:Re});throw R.error(Oe.toString()),Oe}const oe=V("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Et=V("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ee.servers.map(Oe=>{let{address:ht,wss:vt}=Oe;if(ht&&vt)return"wss://".concat(ht.replace(/\./g,"-"),".").concat(oe,":").concat(Et||vt)}).filter(Oe=>!!Oe),workerToken:ee.workerToken,vid:ee.vid,responseTime:Re}}),(Y,ee)=>(he.apworkerEvent(P,{success:!0,sc:200,serviceName:B,responseDetail:JSON.stringify(Y.addressList),firstSuccess:0===ee,responseTime:Re,serverIp:m[ee%m.length]}),!1),(Y,ee)=>(he.apworkerEvent(P,{success:!1,sc:Y.data&&Y.data.code||200,serviceName:B,responseTime:Re,serverIp:m[ee%m.length]}),!!(Y.code!==D.OPERATION_ABORTED&&Y.code!==D.UNEXPECTED_RESPONSE||Y.data&&Y.data.retry)&&(Z=m[(ee+1)%m.length],!0)),y)}(d,r,i,s);u.emit(mn.STATE_CHANGE,io.AP_CONNECTED);const{addressList:f}=h;return u.wmSequence++,f})()}connectWorkerManager(r){var i=arguments,s=this;return M(function*(){s._needWorkUrlOnly=i.length>1&&void 0!==i[1]&&i[1],s.emit(mn.STATE_CHANGE,io.CONNECT_WORKER_MANAGER),yield s.workerManagerConnection.init(r,1e4)})()}connectWorker(r){var i=this;return M(function*(){yield i.workerConnection.init([r])})()}handleWorkerManagerEvents(){var r=this;this.workerManagerConnection.on(we.CONNECTED,M(function*(){r.emit(mn.STATE_CHANGE,io.WORKER_MANAGER_CONNECTED,r.workerManagerConnection.url),r.workerManagerConnection.sendMessage({appId:r._connectInfo.appId,cname:r._connectInfo.cname,uid:r._connectInfo.uid+"",sdkVersion:"4.18.0",sid:r._connectInfo.sid,seq:r.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(we.CLOSED,()=>{this._innerConnectionState<io.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(we.FAILED,()=>{this._innerConnectionState<io.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(we.RECONNECTING,()=>{this._innerConnectionState<io.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(we.ON_MESSAGE,function(){var i=M(function*(s){r.emit(mn.STATE_CHANGE,io.GET_WORKER_MANAGER_RESPONSE);const u=r.workerManagerConnection.url;r.workerManagerConnection.close();const d=JSON.parse(s.data);if(200!==d.code)throw R.error("[".concat(r._inspectId,"] Unexpected code ").concat(d.code," from worker manager")),new L(D.UNEXPECTED_RESPONSE,"response code of worker is unexpected",d);if(!(d.serverResponse&&d.serverResponse.portWss&&u))throw R.error("[".concat(r._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(d))),new L(D.UNEXPECTED_RESPONSE,"response content of worker is unexpected",d);{const h=V("VIDEO_INSPECT_WORKER_PORT")||d.serverResponse.portWss,f=u.replace(/:\d+\/?$/,":".concat(h));r.emit(mn.STATE_CHANGE,io.CONNECT_WORKER,f),r._needWorkUrlOnly?r.emit(mn.REQUEST_NEW_WORKER_URL,f):yield r.connectWorker(f)}});return function(s){return i.apply(this,arguments)}}()),this.workerManagerConnection.on(we.WILL_RECONNECT,(i,s)=>{s(i)}),this.workerManagerConnection.on(we.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}handleWorkerEvents(){var r=this;this.workerConnection.on(we.CONNECTED,M(function*(){r.emit(mn.STATE_CHANGE,io.WORKER_CONNECTED,r.workerConnection.url),r.connectionState=oo.CONNECTED})),this.workerConnection.on(we.ON_MESSAGE,function(){var i=M(function*(s){if(s.data instanceof ArrayBuffer){const d=function bk(o){return function(i){let s={};e:for(;!zP(i);){let u=_i(i);switch(u>>>3){case 0:break e;case 1:s.code=_i(i);break;case 2:s.msg=cD(i,_i(i));break;case 3:{let d=qP(i);s.data=WP(i),i.limit=d;break}default:iD(i,7&u)}}return s}({bytes:r=o,offset:0,limit:r.length});var r}(new Uint8Array(s.data));if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(r._inspectId,"] Response message for worker of inspect content "),JSON.stringify(d)),200===d.code){if(Array.isArray(r.inspectType)&&1===r.inspectType.length&&"supervise"===r.inspectType[0])return void r.emit(mn.INSPECT_RESULT,void 0,void 0);if(d.data&&d.data.scorePorn&&d.data.scoreSexy&&d.data.scoreNeutral){var u;const h={porn:d.data.scorePorn,sexy:d.data.scoreSexy,neutral:d.data.scoreNeutral},f=ti(u=Object.keys(h)).call(u,(_,E)=>h[_]>h[E]?_:E,"porn"),m=Object.keys(h).find(_=>_===f);r.emit(mn.INSPECT_RESULT,m)}else r.emit(mn.INSPECT_RESULT,void 0,new L(D.UNEXPECTED_RESPONSE,d.code+"","There is an unexpected data on message"))}else r.emit(mn.INSPECT_RESULT,void 0,new L(D.UNEXPECTED_RESPONSE,d.code+"",d.msg))}else R.error("[".concat(r._inspectId,"] Unexpected message type from worker")),r.emit(mn.INSPECT_RESULT,void 0,new L(D.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(s){return i.apply(this,arguments)}}()),this.workerConnection.on(we.CLOSED,()=>{this.connectionState=oo.CLOSED}),this.workerConnection.on(we.FAILED,()=>{this.connectionState=oo.CLOSED}),this.workerConnection.on(we.RECONNECTING,()=>{this.connectionState=this.connectionState===oo.CONNECTED?oo.RECONNECTING:oo.CONNECTING}),this.workerConnection.on(we.WILL_RECONNECT,(i,s)=>{"recover"===i&&s(i),s("tryNext")}),this.workerConnection.on(we.REQUEST_NEW_URLS,(i,s)=>{this.workerManagerConnection.close(),this.once(mn.REQUEST_NEW_WORKER_URL,u=>{i([u])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(u=>{this.connectWorkerManager(u,!0)}).catch(u=>{s(u)})})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}requestToInspectImage(){var r=this;return M(function*(){r.sequence++;const i=Bi(r,mn.CLIENT_LOCAL_VIDEO_TRACK),s={appId:r._connectInfo.appId,cname:r._connectInfo.cname,cid:r._connectInfo.cid,sid:r._connectInfo.sid,uid:r._connectInfo.uid,vid:r._connectInfo.vid};if(i){if(!i.isPlaying)return void r.emit(mn.INSPECT_RESULT,void 0,new L(D.INVALID_OPERATION,"Only the track being played can be inspected"));const u=yield r.generateRequestData(i,s);r.workerConnection.sendMessage(u,!0,!0)}else r.emit(mn.INSPECT_RESULT,void 0,new L(D.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(r,i){var s=this;return M(function*(){let{appId:u,cname:d,cid:h,vid:f,sid:m,uid:_}=i;const E=Date.now(),y=yield r.getCurrentFrameImage("image/jpeg",s.quality),T=yield(k=M(function*(x,B,H){return yield YP(x.buffer,B,H)}),function(x,B,H){return k.apply(this,arguments)})(y,u,d),b=s.sequence+"-"+h+"-"+_+"-"+E+"-"+wt(12,""),w={appId:u,cid:h,cname:d,deviceId:"",elapse:rg.intToLong(Number(E-s.inspectStartTime)),fileSize:T.byteLength,jpgEncryption:2,height:y.height,width:y.width,jpg:T,networkType:6,osType:7,requestId:b,sdkVersion:"4.18.0",sequence:s.sequence,sid:m,timestamp:rg.intToLong(E),uid:_,vid:f,service:s._inspectMode,callbackData:s.extraInfo,ossFilePrefix:s.ossFilePrefix};var k;void 0===s.extraInfo&&delete w.callbackData,void 0===s.ossFilePrefix&&delete w.ossFilePrefix;const P=function Fe(o){let r=wh();return function(i,s){let u=i.appId;void 0!==u&&(nt(s,10),As(s,u));let d=i.cid;void 0!==d&&(nt(s,16),nt(s,d));let h=i.cname;void 0!==h&&(nt(s,26),As(s,h));let f=i.deviceId;void 0!==f&&(nt(s,34),As(s,f));let m=i.elapse;void 0!==m&&(nt(s,40),Ba(s,m));let _=i.fileSize;void 0!==_&&(nt(s,48),Ba(s,ea(_)));let E=i.height;void 0!==E&&(nt(s,56),Ba(s,ea(E)));let y=i.jpg;void 0!==y&&(nt(s,66),nt(s,y.length),function(Sn,G){let z=Nh(Sn,G.length);Sn.bytes.set(G,z)}(s,y));let T=i.networkType;void 0!==T&&(nt(s,72),Ba(s,ea(T)));let b=i.osType;void 0!==b&&(nt(s,80),Ba(s,ea(b)));let w=i.requestId;void 0!==w&&(nt(s,90),As(s,w));let P=i.sdkVersion;void 0!==P&&(nt(s,98),As(s,P));let k=i.sequence;void 0!==k&&(nt(s,104),Ba(s,ea(k)));let x=i.sid;void 0!==x&&(nt(s,114),As(s,x));let B=i.timestamp;void 0!==B&&(nt(s,120),Ba(s,B));let H=i.uid;void 0!==H&&(nt(s,128),nt(s,H));let ce=i.vid;void 0!==ce&&(nt(s,136),nt(s,ce));let Re=i.width;void 0!==Re&&(nt(s,144),Ba(s,ea(Re)));let Z=i.service;void 0!==Z&&(nt(s,152),nt(s,Z));let Y=i.callbackData;void 0!==Y&&(nt(s,162),As(s,Y));let ee=i.jpgEncryption;void 0!==ee&&(nt(s,168),nt(s,ee));let oe=i.requestType;void 0!==oe&&(nt(s,176),nt(s,oe));let Et=i.scorePorn;void 0!==Et&&(nt(s,185),No(s,Et));let Oe=i.scoreSexy;void 0!==Oe&&(nt(s,193),No(s,Oe));let ht=i.scoreNeutral;void 0!==ht&&(nt(s,201),No(s,ht));let vt=i.scene;void 0!==vt&&(nt(s,208),nt(s,vt));let Jn=i.ossFilePrefix;void 0!==Jn&&(nt(s,218),As(s,Jn));let Jt=i.serviceVendor;if(void 0!==Jt)for(let Sn of Jt){nt(s,226);let G=wh();KP(Sn,G),nt(s,G.limit),uD(s,G),gi(G)}}(o,r),function(i){let s=i.bytes,u=i.limit;return s.length===u?s:s.subarray(0,u)}(r)}(w);if(P.byteLength<s.workerMessageLengthLimit){if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const k=function(x){for(var B=1;B<arguments.length;B++){var H=null!=arguments[B]?arguments[B]:{};B%2?pD(Object(H),!0).forEach(function(ce){S(x,ce,H[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(H)):pD(Object(H)).forEach(function(ce){Object.defineProperty(x,ce,Object.getOwnPropertyDescriptor(H,ce))})}return x}({},w);delete k.jpg,R.debug("[".concat(s._inspectId,"] Request message for worker of inspect content "),JSON.stringify(k))}return P}return s.quality=s.quality*s.qualityRatio,yield s.generateRequestData(r,{appId:u,cname:d,cid:h,vid:f,sid:m,uid:_})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ni.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=oo.CLOSED,this.emit(mn.STATE_CHANGE,io.CLOSED)}}var fr,Be,dt,fD,Mh,Ds,Lh,Ei,mD,Yn,gD,cn,_D,kh,ED,xh,vD,yS,og,Uh,ig,yD,SS,SD,TD,CD,ID,TS,RD,CS,Vh,wd,bD,AD,sg,IS,DD,ag,te;function wD(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function Fh(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?wD(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):wD(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let RS=(fr=pe(),Be=pe({argsMap:(o,r)=>(Array.isArray(r)||(r=[r]),r.map(i=>i?Object(i).toString():"null"))}),dt=pe({argsMap:(o,r)=>(r||(r=[]),Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId()))}),fD=pe({argsMap:(o,r,i)=>[r.uid,i]}),Mh=pe({argsMap:(o,r)=>r.map(i=>{let{user:s,mediaType:u}=i;return[s?.uid,u]})}),Ds=pe({argsMap:(o,r,i)=>[r.uid,i]}),Lh=pe({argsMap:(o,r)=>r.map(i=>{let{user:s,mediaType:u}=i;return{uid:s?.uid,mediaType:u}})}),Ei=pe(),mD=pe(),Yn=pe(),gD=pe(),cn=pe(),_D=pe(),kh=pe(),ED=pe(),xh=pe(),vD=pe(),yS=pe(),og=pe(),Uh=pe(),ig=pe(),yD=pe({argsMap:(o,r)=>[r]}),SS=pe(),SD=pe(),TD=pe(),CD=pe(),ID=pe(),TS=pe(),RD=pe(),CS=pe(),Vh=pe(),wd=pe(),bD=pe({argsMap:(o,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),AD=pe(),sg=pe(),IS=pe(),DD=pe({reportResult:!0}),ag=pe(),q((te=class extends Lt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(o){var r;let i;if(super(),r=this,S(this,"store",void 0),S(this,"_uid",void 0),S(this,"_channelName",void 0),S(this,"_uintUid",void 0),S(this,"_users",[]),S(this,"_codec",void 0),S(this,"_mode",void 0),S(this,"_config",void 0),S(this,"_clientId",void 0),S(this,"_appId",void 0),S(this,"_sessionId",null),S(this,"_key",void 0),S(this,"_joinInfo",void 0),S(this,"_gateway",void 0),S(this,"_statsCollector",void 0),S(this,"_configDistribute",void 0),S(this,"_leaveMutex",new Mn("client-leave")),S(this,"_publishMutex",new Mn("client-publish")),S(this,"_renewTokenMutex",new Mn("client-renewtoken")),S(this,"_subscribeMutex",new Mn("client-subscribe")),S(this,"_encryptionMode","none"),S(this,"_encryptionSecret",null),S(this,"_encryptionSalt",null),S(this,"_proxyServer",void 0),S(this,"_turnServer",{servers:[],mode:"auto"}),S(this,"_cloudProxyServerMode","disabled"),S(this,"_isDualStreamEnabled",!1),S(this,"_defaultStreamFallbackType",void 0),S(this,"_lowStreamParameter",void 0),S(this,"_streamFallbackTypeCacheMap",new Map),S(this,"_remoteStreamTypeCacheMap",new Map),S(this,"_axiosCancelSource",Ni.CancelToken.source()),S(this,"_audioVolumeIndicationInterval",void 0),S(this,"_networkQualityInterval",void 0),S(this,"_userOfflineTimeout",void 0),S(this,"_streamRemovedTimeout",void 0),S(this,"_injectStreamingClient",void 0),S(this,"_liveTranscodeStreamingClient",void 0),S(this,"_liveRawStreamingClient",void 0),S(this,"_channelMediaRelayClient",void 0),S(this,"_networkQualitySensitivity","normal"),S(this,"_p2pChannel",void 0),S(this,"_useLocalAccessPoint",!1),S(this,"_setLocalAPVersion",void 0),S(this,"_joinAndNotLeaveYet",!1),S(this,"_numberOfJoinCount",0),S(this,"_remoteDefaultVideoStreamType",void 0),S(this,"_inspect",void 0),S(this,"_license",void 0),S(this,"_handleLocalTrackEnable",(s,u,d)=>{this.publish(s,!1).then(u).catch(d)}),S(this,"_handleLocalTrackDisable",(s,u,d)=>{this.unpublish(s).then(u).catch(d)}),S(this,"_handleUserOnline",s=>{if(V("BLOCK_LOCAL_CLIENT")&&wc(s.uid,this.channelName))return void R.debug("[".concat(s.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof s.uid&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(d=>d.uid===s.uid);if(u)u._trust_in_room_=!0;else{const d=new ch(s.uid,s.uint_id||s.uid);this._users.push(d),R.debug("[".concat(this._clientId,"] user online"),s.uid),this.emit(Ue.USER_JOINED,d)}}),S(this,"_handleUserOffline",s=>{if(V("BLOCK_LOCAL_CLIENT")&&wc(s.uid,this.channelName))return;const u=this._users.find(d=>d.uid===s.uid);u&&(this._handleRemoveStream(s),uy(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),R.debug("[".concat(this._clientId,"] user offline"),s.uid,"reason:",s.reason),this.emit(Ue.USER_LEAVED,u,s.reason))}),S(this,"_handleAddAudioOrVideoStream",(s,u,d,h,f,m,_)=>{if(V("BLOCK_LOCAL_CLIENT")&&wc(u,this.channelName))return;const E=this._users.find(T=>T.uid===u);if(!E)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(s)),this.store.subscribe(E.uid,s,void 0,void 0,void 0,Date.now());const y="audio"===s?E.hasAudio:E.hasVideo;E._uintid||(E._uintid=f||u),"audio"===s?E._trust_audio_stream_added_state_=!0:E._trust_video_stream_added_state_=!0,"audio"===s?(E._audio_added_=!0,void 0!==d&&(E._audioSSRC=d),void 0!==h&&(E._cname=h),m&&(E._audioOrtc=m)):(E._video_added_=!0,void 0!==d&&(E._videoSSRC=d),void 0!==h&&(E._cname=h),void 0!==_&&(E._rtxSsrcId=_),m&&(E._videoOrtc=m)),("audio"===s?E.hasAudio:E.hasVideo)&&!y&&(R.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published ").concat(s)),this.emit(Ue.USER_PUBLISHED,E,s)),"video"===s?he.onGatewayStream(this._sessionId,Kn.ON_ADD_VIDEO_STREAM,kt.ON_ADD_VIDEO_STREAM,{peer:f||u}):he.onGatewayStream(this._sessionId,Kn.ON_ADD_AUDIO_STREAM,kt.ON_ADD_AUDIO_STREAM,{peer:f||u}),this._p2pChannel.remoteMediaSsrcChanged(E,s,d).then(T=>{if(T)return R.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(E.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(E,s,!0).then(()=>this._subscribe(E,s,!0).catch(b=>{R.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(E,s)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(E.uid," after reconnect.")),this._subscribe(E,s,!0).catch(T=>{R.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),S(this,"_handleRemoveStream",s=>{if(V("BLOCK_LOCAL_CLIENT")&&wc(s.uid,this.channelName))return;const u=this._users.find(h=>h.uid===s.uid);if(!u)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(s.uid));let d=()=>{};u.hasAudio&&u.hasVideo?d=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.emit(Ue.USER_UNPUBLISHED,u,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.emit(Ue.USER_UNPUBLISHED,u,"video")}:u.hasVideo?d=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.emit(Ue.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(d=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.emit(Ue.USER_UNPUBLISHED,u,"audio")}),u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel.unsubscribe(u).then(h=>{if(h)return this._gateway.unsubscribe(h,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0,he.onGatewayStream(this._sessionId,Kn.ON_REMOVE_STREAM,kt.ON_REMOVE_STREAM,{peer:s.uint_id||s.uid}),d()}),S(this,"_handleSetStreamLocalEnable",(s,u,d)=>{if(V("BLOCK_LOCAL_CLIENT")&&wc(u,this.channelName))return;const h=this._users.find(_=>_.uid===u);if(!h)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(s," ").concat(d?"enabled":"disabled"," with uid ").concat(u));const f="audio"===s?h.hasAudio:h.hasVideo;if("audio"===s){h._trust_audio_enabled_state_=!0;const _=h._audio_enabled_;if(h._audio_enabled_=d,h._audio_enabled_===_)return;{const E=h._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(E)),this.emit(Ue.USER_INFO_UPDATED,u,E)}}else{h._trust_video_enabled_state_=!0;const _=h._video_enabled_;if(h._video_enabled_=d,h._video_enabled_===_)return;{const E=h._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(E)),this.emit(Ue.USER_INFO_UPDATED,u,E)}}const m="audio"===s?h.hasAudio:h.hasVideo;return f!==m?!f&&m?(R.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(s)),void this.emit(Ue.USER_PUBLISHED,h,s)):("video"===s&&h._videoTrack&&h._videoTrack._destroy(),this._p2pChannel.muteRemote(h,s),R.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(s)),void this.emit(Ue.USER_UNPUBLISHED,h,s)):void 0}),S(this,"_handleMuteStream",(s,u,d)=>{if(V("BLOCK_LOCAL_CLIENT")&&wc(s,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),s,u,d);const h=this._users.find(_=>_.uid===s);if(!h)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s));const f="audio"===u?h.hasAudio:h.hasVideo;if("audio"===u){h._trust_audio_mute_state_=!0;const _=h._audio_muted_;if(h._audio_muted_=d,h._audio_muted_===_)return;{const E=h._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(E)),this.emit(Ue.USER_INFO_UPDATED,s,E)}}else{h._trust_video_mute_state_=!0;const _=h._video_muted_;if(h._video_muted_=d,h._video_muted_===_)return;{const E=h._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(E)),this.emit(Ue.USER_INFO_UPDATED,s,E)}}const m="audio"===u?h.hasAudio:h.hasVideo;if(f!==m){if(!f&&m)return("audio"===u?h._audioSSRC:h._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(u)),void this.emit(Ue.USER_PUBLISHED,h,u)):void R.warning("[".concat(this._clientId,"] remote user ").concat(s," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));"video"===u&&h._videoTrack&&h._videoTrack._destroy(),this._p2pChannel.muteRemote(h,u),R.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(u)),this.emit(Ue.USER_UNPUBLISHED,h,u)}}),S(this,"_handleP2PLost",function(){var s=M(function*(u){R.debug("[".concat(r._clientId,"] receive p2p lost"),u),parseInt(u.p2pid,10)===r.store.p2pId?yield r._p2pChannel.requestReconnect():R.warning("[".concat(r._clientId,"] P2PLost stream not found"),u)});return function(u){return s.apply(this,arguments)}}()),S(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(Ue.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),S(this,"_handleBeforeUnload",s=>{"beforeunload"===s.type&&void 0!==s.returnValue&&""!==s.returnValue||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),S(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.emit(Ue.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const s={downlinkNetworkQuality:0,uplinkNetworkQuality:0};s.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),s.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.emit(Ue.NETWORK_QUALITY,s)}),this._codec=o.codec,this._mode=o.mode,this._clientId=wt(5,"client-"),this.store=new pr(o.codec,o.audioCodec,o.mode,this._clientId),this.store.clientCreated(),o.proxyServer&&this.setProxyServer(o.proxyServer,!0),o.turnServer&&this.setTurnServer(o.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(no," build: ").concat(jf,", mode: ").concat(this._mode,", codec: ").concat(this._codec)),o.clientRoleOptions)try{Pc(o.clientRoleOptions),i=Object.assign({},o.clientRoleOptions)}catch(s){R.warning("[".concat(this._clientId,"] ").concat(s.toString()))}this._statsCollector=new fd(this.store),this._statsCollector.onStatsException=(s,u,d)=>{R.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(s,", msg: ").concat(u,", uid: ").concat(d)),this.emit(Ue.EXCEPTION,{code:s,msg:u,uid:d})},this._statsCollector.onUploadPublishDuration=(s,u,d,h)=>{const f=this._users.find(m=>m.uid===s);f&&he.peerPublishStatus(this._sessionId,{subscribeElapse:h,audioPublishDuration:u,videoPublishDuration:d,peer:f._uintid})},this.store.useDataChannel=Yt().supportDataChannel&&V("SIGNAL_CHANNEL"),this._gateway=new X0(this.store,{clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:o.websocketRetryConfig||vn,httpRetryConfig:o.httpRetryConfig||vn,forceWaitGatewayResponse:void 0===o.forceWaitGatewayResponse||o.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:o.role,clientRoleOptions:i}),this._config=o,this._configDistribute=new iP,this._p2pChannel=new GP(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}join(o,r,i,s,u){var d=this;return M(function*(){const h=++d._numberOfJoinCount;d.store.joinStart(),s&&(d.store.uid=s);const f="HTTPS"===(bn||bn||(bn=(window.location.protocol.split(":")[0]||"").toUpperCase(),bn)),m=An()?window.isSecureContext:"Browser Not Support";(An()||f)&&window.isSecureContext||R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");const _=cy();"DISCONNECTED"===d.connectionState&&(d.store.avoidJoinStart=Math.round(Date.now()),R.debug("[".concat(d._clientId,"] set avoidJoinStart to ").concat(d.store.avoidJoinStart)));const E=he.reportApiInvoke(_,{name:pn.JOIN,options:[o,r,i,s],states:{isHttps:f,isSecureContext:m},tag:xt.TRACER});he.setAppId(o);try{if(!i&&null!==i)throw new L(D.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&sr(i,"token",1,2047),sr(o,"appid",1,2047),hv(r),s&&pv(s),u&&sr(u,"optionalInfo",1,2047)}catch(w){throw E.onError(w),w}if(R.info("[".concat(d._clientId,"] start join channel ").concat(r,", join number: ").concat(h)),d._leaveMutex.isLocked&&(R.debug("[".concat(d._clientId,"] join: waiting leave operation")),(yield d._leaveMutex.lock())(),R.debug("[".concat(d._clientId,"] join: continue"))),d._joinAndNotLeaveYet=!0,"DISCONNECTED"!==d.connectionState){const w=new L(D.INVALID_OPERATION,"[".concat(d._clientId,"] Client already in connecting/connected state"));throw E.onError(w),w}d._sessionId||(d._sessionId=_,d.store.sessionId=d._sessionId),d._gateway.state="CONNECTING";const y=Fh({clientId:d._clientId,appId:o,sid:d._sessionId,cname:r,uid:"string"!=typeof s?s:null,turnServer:d._turnServer,proxyServer:d._proxyServer,token:i||o,cloudProxyServer:d._cloudProxyServerMode,optionalInfo:u,license:d._license,useLocalAccessPoint:d._useLocalAccessPoint},void 0!==d._remoteDefaultVideoStreamType&&{defaultVideoStream:d._remoteDefaultVideoStreamType});if(d._useLocalAccessPoint&&(y.setLocalAPVersion=d._setLocalAPVersion),"string"==typeof s&&(y.stringUid=s,d._uintUid?(y.uid=d._uintUid,d._uintUid=void 0):y.uid=0),"none"!==d._encryptionMode&&d._encryptionSecret){if(y.aesmode=d._encryptionMode,y.aespassword=yield(w=M(function*(P){const k=Ql("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),x=yield window.crypto.subtle.importKey("spki",k,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),B=rm(P),H=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},x,B);return fm(new Uint8Array(H))}),function(P){return w.apply(this,arguments)})(d._encryptionSecret),!d._joinAndNotLeaveYet)throw new L(D.INVALID_OPERATION,"[".concat(d._clientId,"] Client already left"));d._encryptionSalt&&(y.aessalt=d._encryptionSalt)}var w;d._startSession(d._sessionId,{channel:r,appId:o});const T=d._sessionId;setTimeout(()=>{"CONNECTING"===d.connectionState&&T===d._sessionId&&he.joinChannelTimeout(d._sessionId,5)},5e3);try{let w;if(["proxy3","proxy4","proxy5"].includes(y.cloudProxyServer)){const H=V("PROXY_SERVER_TYPE3");y.proxyServer=Array.isArray(H)?H[0]:H}if(he.setProxyServer(y.proxyServer),R.setProxyServer(y.proxyServer),d.store.requestAPStart(),y.stringUid&&!y.uid){const H=yield nP(y.stringUid,y,d._axiosCancelSource.token,d._config.httpRetryConfig||vn,d.store);R.debug("[".concat(d._clientId,"] getUserAccount Success ").concat(y.stringUid," => ").concat(H)),y.uid=H,w=yield Fb(y,d._axiosCancelSource.token,d._config.httpRetryConfig||vn,!0,d.store)}else w=yield Fb(y,d._axiosCancelSource.token,d._config.httpRetryConfig||vn,!0,d.store);if(!d._joinAndNotLeaveYet)throw new L(D.INVALID_OPERATION,"[".concat(d._clientId,"] Client already left"));d.store.requestAPEnd(),setTimeout(()=>{d._configDistribute.startGetConfigDistribute(y,d._axiosCancelSource.token),d._configDistribute.on(Uc.UPDATE_BITRATE_LIMIT,H=>{d._p2pChannel.updateBitrateLimit(H)})},0),d._key=i||o;const k=w.gatewayInfo;d._joinInfo=Fh(Fh({},y),{},{cid:k.cid,uid:y.uid?y.uid:k.uid,vid:k.vid,apResponse:k.res,uni_lbs_ip:k.uni_lbs_ip,gatewayAddrs:k.gatewayAddrs});const x=yield d._joinGateway();if(!d._joinAndNotLeaveYet)throw new L(D.INVALID_OPERATION,"[".concat(d._clientId,"] Client already left"));E.onSuccess(x),d._appId=o,d._channelName=y.cname,d._uid=x,d.store.uid=x,setTimeout(()=>{d._networkQualityInterval&&window.clearInterval(d._networkQualityInterval),d._networkQualityInterval=window.setInterval(d._handleUpdateNetworkQuality,2e3),window.addEventListener(or()?"beforeunload":"pagehide",d._handleBeforeUnload)},0);const B=y.stringUid?"string uid: ".concat(y.stringUid,",uid: ").concat(y.uid):"uid: ".concat(d._uid);return R.info("[".concat(d._clientId,"] Joining channel success: channel: ").concat(r,",").concat(B)),setTimeout(()=>{R.startUpload()},5e3),d.store.joinEnd(),Dc.includes(b=d)||Dc.push(b),x}catch(w){const P=Array.isArray(w)?w[0]:w;throw R.error("[".concat(d._clientId,"] join number: ").concat(h,", Joining channel failed, rollback"),P),P.code!==D.OPERATION_ABORTED&&d._numberOfJoinCount===h&&(d._gateway.state="DISCONNECTED",d._reset()),E.onError(P),P}var b})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new L(D.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!V("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(o=>o).catch(o=>{if(o.code===D.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,st.FALLBACK),o;if(o.code===D.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,st.FALLBACK),o;throw o}).then(o=>{if(o instanceof L){if(o.code===D.INIT_WEBSOCKET_TIMEOUT){if(R.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new L(D.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const r=V("PROXY_SERVER_TYPE3");if(Array.isArray(r))if(this._joinInfo.apUrl){const s=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),u=s.slice(s.length-2).join(".");r.forEach(d=>{this._joinInfo&&d.includes(u)&&(this._joinInfo.proxyServer=d)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=r[0])}else this._joinInfo.proxyServer=r[0];else this._joinInfo.proxyServer=r;const i=V("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return i&&i[1]&&"443"!==i[1]&&R.setProxyServer(this._joinInfo.proxyServer),"443"!==V("STATS_COLLECTOR_PORT").toString()&&he.setProxyServer(this._joinInfo.proxyServer),he.reportApiInvoke(this._sessionId,{name:pn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:xt.TRACER}).onSuccess(),this.emit(Ue.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),V("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(s=>{"forceturn"in s&&(s.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(R.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new L(D.INVALID_OPERATION);return he.reportApiInvoke(this._sessionId,{name:pn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:xt.TRACER}).onSuccess(),this._joinGateway()}return o}).then(o=>o)}leave(){var o=this;return M(function*(){R.info("[".concat(o._clientId,"] Leaving channel")),window.removeEventListener(or()?"beforeunload":"pagehide",o._handleBeforeUnload),o._reset(),function(i){const s=Dc.indexOf(i);-1!==s&&Dc.splice(s,1)}(o);const r=yield o._leaveMutex.lock();if("DISCONNECTED"===o.connectionState)return R.info("[".concat(o._clientId,"] Leaving channel repeated, success")),void r();yield o._gateway.leave("CONNECTED"!==o.connectionState),R.info("[".concat(o._clientId,"] Leaving channel success")),o._joinAndNotLeaveYet=!1,o.store.resetJoinChannelServiceRecords(),r()})()}publish(o){var r=arguments,i=this;return M(function*(){let s=!(r.length>1&&void 0!==r[1])||r[1];if(Array.isArray(o)||(o=[o]),0===o.length)throw new L(D.INVALID_PARAMS,"track list is empty");if("audience"===i._gateway.role)throw new L(D.INVALID_OPERATION,"audience can not publish stream");for(const d of o){if(!(d instanceof im))throw new L(D.INVALID_PARAMS,"parameter is not local track");if(!d._enabled&&s)throw new L(D.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(d.getTrackId()))}R.info("[".concat(i._clientId,"] Publishing tracks, id ").concat(o.map(d=>"".concat(d.getTrackId()," ")))),yield i._configDistribute.awaitConfigDistributeComplete(),s&&o.forEach(d=>{const h=i._configDistribute.getBitrateLimit();d instanceof an&&h&&d.setBitrateLimit(h.uplink)});const u=yield i._publishMutex.lock();try{yield i._publishHighStream(o),R.info("[".concat(i._clientId,"] Publish success, id ").concat(o.map(d=>"".concat(d.getTrackId()," "))))}catch(d){throw R.error("[".concat(i._clientId,"] publish error"),d.toString()),d}finally{u()}})()}unpublish(o){var r=this;return M(function*(){if(!r._joinInfo||void 0===r._uid)throw new L(D.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");o?Array.isArray(o)||(o=[o]):o=r._p2pChannel.getAllTracks(!0),R.info("[".concat(r._clientId,"] Unpublish tracks, tracks ").concat(o.map(s=>"".concat(s.getTrackId()," "))," "));const i=yield r._publishMutex.lock();try{const s=yield r._p2pChannel.unpublish(o);s&&(yield r._gateway.unpublish(s,r._uid)),R.info("[".concat(r._clientId,"] Unpublish success,tracks ").concat(o.map(u=>"".concat(u.getTrackId()))))}catch(s){throw R.error("[".concat(r._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}})()}subscribe(o,r){var i=this;return M(function*(){return i._subscribe(o,r)})()}_subscribe(o,r,i){var s=this;return M(function*(){if(Nn(r,"mediaType",["audio","video"]),!s._joinInfo)throw new L(D.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==s.connectionState&&"RECONNECTING"!==s.connectionState)throw new L(D.INVALID_OPERATION,"Can't subscribe stream in ".concat(s.connectionState," state"));if(!s._users.find(_=>_===o)){const _=new L(D.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(s._clientId,"] can not subscribe ").concat(o.uid,", this user is not in the channel")),_}if(!o.hasAudio&&!o.hasVideo){const _=new L(D.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(s._clientId,"] can not subscribe ").concat(o.uid,", user is not published")),_}if(!(i||("audio"!==r||o.hasAudio&&void 0!==o._audioSSRC)&&("video"!==r||o.hasVideo&&void 0!==o._videoSSRC))){const _=new L(D.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(s._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(r,", remote track is not published")),_}const u="audio"===r?o._audioSSRC:o._videoSSRC,d="audio"===r?o._audioOrtc:o._videoOrtc,h="video"===r?o._rtxSsrcId:void 0,f={stream_type:"audio"===r?be.AUDIO:be.VIDEO,ssrcId:u},m=yield s._subscribeMutex.lock();R.info("[".concat(s._clientId,"] subscribe user ").concat(o.uid,", mediaType: ").concat(r));try{if(yield s._p2pChannel.hasRemoteMediaWithLock(o,r))yield s._p2pChannel.unmuteRemote(o,r);else try{xr.markSubscribeStart(s.store.clientId,u),s.store.subscribe(o.uid,r,Date.now()),yield s._p2pChannel.subscribe(o,r,u,h,d);try{yield s._gateway.subscribe(o.uid,f,!0)}catch(E){if(E?.code!==D.WS_ABORT)throw yield s._p2pChannel.unsubscribe(o,r),E;yield s._p2pChannel.unsubscribe(o,r,!0),s._p2pChannel.setPendingRemoteMedia(o,r)}s.store.subscribe(o.uid,r,void 0,Date.now()),s._p2pChannel.reportSubscribeEvent(!0,null,o,r)}catch(E){throw s._p2pChannel.reportSubscribeEvent(!1,E?.code,o,r),E}R.info("[".concat(s._clientId,"] subscribe success user ").concat(o.uid,", mediaType: ").concat(r)),s._defaultStreamFallbackType&&s.setStreamFallbackOption(o.uid,s._defaultStreamFallbackType).catch(E=>{R.warning("[".concat(s._clientId,"] auto set fallback failed"),E)});const _="audio"===r?o._audioTrack:o._videoTrack;if(!_)throw new L(D.UNEXPECTED_ERROR,"can not find remote track in user object");return _}catch(_){throw R.error("[".concat(s._clientId,"] subscribe user ").concat(o.uid," error"),_),_}finally{m()}})()}massSubscribe(o){var r=this;return M(function*(){if(Ra(o,"subscribeList"),!r._joinInfo)throw new L(D.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new L(D.INVALID_OPERATION,"Can't subscribe stream in ".concat(r.connectionState," state"));const i=Date.now(),s=new Map,u=yield r._subscribeMutex.lock();R.info("[".concat(r._clientId,"]start massSubscribe user ").concat(o.map(m=>{let{user:_,mediaType:E}=m;return"user: ".concat(_?.uid,", mediaType: ").concat(E)}).join("; ")));const d=(o=[...o]).map(m=>{let{user:_,mediaType:E}=m;return{user:_,mediaType:E}}),h=yield r._p2pChannel.globalLock();try{var f;for(let _=o.length-1;_>=0;_--){const E=o[_],{user:y,mediaType:T}=E;if(Nn(T,"mediaType",["audio","video"]),!y){const P=new L(D.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(r._clientId,"] user property does not exist in subscribeList item")),P}if(!r._users.find(P=>P===y)){const P=new L(D.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(r._clientId,"] can not massSubscribe ").concat(y.uid,", this user is not in the channel")),d[_].error=P,o.splice(_,1);continue}if("audio"===T&&(!y.hasAudio||void 0===y._audioSSRC)||"video"===T&&(!y.hasVideo||void 0===y._videoSSRC)){const P=new L(D.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(r._clientId,"] can not subscribe ").concat(y.uid," with mediaType ").concat(T,", remote user is not published")),d[_].error=P,o.splice(_,1);continue}const b=nn.Video|nn.LwoVideo,w=s.get(y);if(w){if("video"===T?w&b:w&nn.Audio){o.splice(_,1),R.warning("[".concat(r._clientId,"] repeat massSubscribe user:").concat(y.uid,", mediaType:").concat(T," twice"));continue}s.set(y,w|("video"===T?b:nn.Audio))}else s.set(y,"video"===T?b:nn.Audio)}for(let _=o.length-1;_>=0;_--){const E=o[_],{user:y,mediaType:T}=E,b=nn.Video|nn.LwoVideo;if(r._p2pChannel.hasRemoteMedia(y,T)){yield r._p2pChannel.unmuteRemoteNoLock(y,T);const w=s.get(y);s.set(y,"video"===T?w^b:w^nn.Audio),o.splice(_,1)}}r.store.massSubscribe(o.map(_=>({userId:_.user.uid,type:_.mediaType})),i);const m=ti(f=Array.from(s.entries())).call(f,(_,E)=>{let[y,T]=E;if(0===T)return _;const b={stream_id:y.uid,stream_type:T};return T&nn.Audio&&(b.audio_ssrc=y._audioSSRC),T&nn.Video&&(b.video_ssrc=y._videoSSRC),_.push(b),_},[]);try{o.length>0&&(yield r._p2pChannel.massSubscribeNoLock(o.map(E=>{let{user:y,mediaType:T}=E;return{user:y,mediaType:T,ssrcId:T===be.VIDEO?y._videoSSRC:y._audioSSRC,rtxSsrcId:T===be.VIDEO?y._rtxSsrcId:void 0}})));const _=new Map;if(m.length>0){const E=yield r._gateway.subscribeAll(m,!0);(E?.users||[]).forEach(y=>{let{stream_id:T,video_error_code:b,audio_error_code:w,error_code:P}=y;(b||w||P)&&_.set(T,{video_error_code:b,audio_error_code:w,error_code:P})})}if(Array.from(_.entries()).length>0){const E=Array.from(_.entries()).map(y=>{let T,[b,w]=y;return w.error_code||w.video_error_code&&w.audio_error_code?T=void 0:w.video_error_code?T=be.VIDEO:w.audio_error_code&&(T=be.AUDIO),{user:r.remoteUsers.find(P=>P.uid===b),mediaType:T}});yield r._p2pChannel.massUnsubscribeNoLock(E)}for(const E of d){const y=_.get(E.user.uid);if(y){const T=y.error_code||"audio"===E.mediaType&&y.audio_error_code||"video"===E.mediaType&&y.video_error_code;if(T){const b=gm(T);R.error("user:".concat(E.user.uid," mediaType:").concat(E.mediaType," has massSubscribe error ").concat(b.desc)),E.error=new L(D.SUBSCRIBE_FAILED,"code ".concat(T,": ").concat(b.desc))}}E.error||(E.track="video"===E.mediaType?E.user.videoTrack:E.user.audioTrack)}return r.store.massSubscribe(d.filter(E=>!E.error).map(E=>({userId:E.user.uid,type:E.mediaType})),void 0,Date.now()),d.forEach(E=>{var y;he.subscribe(r.store.sessionId,{succ:!!E.error,ec:(null===(y=E.error)||void 0===y?void 0:y.code)||null,video:E.mediaType===be.VIDEO,audio:E.mediaType===be.AUDIO,peerid:E.user.uid,subscribeRequestid:E.mediaType===be.VIDEO?E.user._videoSSRC:E.user._audioSSRC,p2pid:r.store.p2pId,eventElapse:Math.floor(performance.now()-i)},!0)}),R.info("[".concat(r._clientId,"] massSubscribe success ").concat(o.map(E=>{let{user:y,mediaType:T}=E;return"user: ".concat(y?.uid,", mediaType: ").concat(T)}).join("; "))),d}catch(_){throw yield r._p2pChannel.massUnsubscribeNoLock(o),_}}finally{h(),u()}})()}unsubscribe(o,r){var i=this;return M(function*(){if(r&&Nn(r,"mediaType",["audio","video"]),!i._joinInfo)throw new L(D.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!i._users.find(s=>s===o)){const s=new L(D.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(i._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),s}R.info("[".concat(i._clientId,"] unsubscribe uid: ").concat(o.uid,", mediaType: ").concat(r));try{const s=yield i._p2pChannel.unsubscribe(o,r);s&&(yield i._gateway.unsubscribe(s,o.uid)),R.info("[".concat(i._clientId,"] unsubscribe success uid: ").concat(o.uid,", mediaType: ").concat(r))}catch(s){if(s.code===D.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(i._clientId,"] unsubscribe user ").concat(o.uid," error"),s.toString()),s}})()}massUnsubscribe(o){var r=this;return M(function*(){if(Ra(o,"unsubscribeList"),!r._joinInfo)throw new L(D.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(r._clientId,"] start massUnsubscribe ").concat(o.map(s=>{let{user:u,mediaType:d}=s;return"user: ".concat(u?.uid,", mediaType: ").concat(d,";")}).join())),o=[...o];const i=new Map;for(let s=o.length-1;s>=0;s--){const{user:u,mediaType:d}=o[s];if(!u){const f=new L(D.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(r._clientId,"] user property does not exist in unsubscribeList item")),f}if(Nn(d,"mediaType",["video","audio",void 0]),!r._users.find(f=>f===u)){R.warning("[".concat(r._clientId,"] can not unsubscribe ").concat(u.uid,", user is not in the channel")),o.splice(s,1);continue}const h=nn.Video|nn.LwoVideo;if(i.has(u)){const f=i.get(u);let m;switch(d){case"video":m=f&h;break;case"audio":m=f&nn.Audio;break;default:m=f&(nn.Audio|h)}if(m){R.warning("[".concat(r._clientId,"] repeat massUnsubscribe user:").concat(u.uid,",mediaType:").concat(d," twice.")),o.splice(s,1);continue}d?"audio"===d?i.set(u,f|nn.Audio):"video"===d&&i.set(u,f|h):i.set(u,f|nn.Audio|h)}else d?"audio"===d?i.set(u,nn.Audio):"video"===d&&i.set(u,h):i.set(u,nn.Audio|h)}try{const s=yield r._p2pChannel.massUnsubscribe(o);s&&(yield r._gateway.massUnsubscribe(s)),R.info("[".concat(r._clientId,"] massUnsubscribe success ").concat(o.map(u=>{let{user:d,mediaType:h}=u;return"user: ".concat(d?.uid,", mediaType: ").concat(h,";")}).join()))}catch(s){if(s.code===D.DISCONNECT_P2P)return void R.warning("[".concat(r._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(r._clientId,"] massUnsubscribe error"),s.toString()),s}})()}setLowStreamParameter(o){(function(i){if(!i)throw new L(D.INVALID_PARAMS);Dt(i.width)||Oc(i.width,"streamParameter.width"),Dt(i.height)||Oc(i.height,"streamParameter.height"),Dt(i.framerate)||Oc(i.framerate,"streamParameter.framerate"),Dt(i.bitrate)||Rt(i.bitrate,"streamParameter.bitrate")})(o),(!o.width&&o.height||o.width&&!o.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(o));const r=this._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&o.bitrate&&r.bitrate<o.bitrate&&(o.bitrate=r.bitrate),this._lowStreamParameter=o}enableDualStream(){var o=this;return M(function*(){if(!Yt().supportDualStream)throw he.streamSwitch(o._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new L(D.NOT_SUPPORTED,"Your browser is not support dual stream");if(o._isDualStreamEnabled)throw new L(D.INVALID_OPERATION,"Dual stream is already enabled");if(o._p2pChannel.canPublishLowStream())try{yield o._publishLowStream()}catch(r){throw he.streamSwitch(o._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}o._isDualStreamEnabled=!0,he.streamSwitch(o._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(o._clientId,"] enable dual stream"))})()}disableDualStream(){var o=this;return M(function*(){if(o._isDualStreamEnabled){if(!o._joinInfo)throw new L(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(o._p2pChannel.getLocalMedia(de.LocalVideoLowTrack))try{const r=yield o._p2pChannel.unpublishLowStream();r&&(yield o._gateway.unpublish(r,o._joinInfo.stringUid||o._joinInfo.uid))}catch(r){throw he.streamSwitch(o._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}o._isDualStreamEnabled=!1,he.streamSwitch(o._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(o._clientId,"] disable dual stream"))}})()}setClientRole(o,r){var i=this;return M(function*(){if(Nn(o,"role",["audience","host"]),r&&Pc(r),"rtc"===i._mode)throw R.warning("[".concat(i._clientId,"]rtc mode can not use setClientRole")),new L(D.INVALID_OPERATION,"rtc mode can not use setClientRole");if(r&&r.level&&"host"===o)throw new L(D.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===o&&i._p2pChannel.hasLocalMedia())throw new L(D.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield i._gateway.setClientRole(o,r),R.info("[".concat(i._clientId,"] set client role to ").concat(o,", level: ").concat(r&&r.level))})()}setProxyServer(o,r){if(sr(o,"proxyServer"),!r){if("DISCONNECTED"!==this.connectionState)throw new L(D.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new L(D.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=o,he.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(o,r){if(Array.isArray(o)||(o=[o]),!r){if("DISCONNECTED"!==this.connectionState)throw new L(D.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new L(D.INVALID_OPERATION,"You have already set the proxy")}if(ps(o))return this._turnServer={servers:o,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(o.map(i=>i.urls).join(","),"."));o.forEach(i=>Nc(i)),this._turnServer={servers:o,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(o){if("DISCONNECTED"!==this.connectionState)throw new L(D.INVALID_OPERATION,"you should set license before join channel");if(sr(o,"license",32,32),!/^[A-Za-z\d]+$/.test(o))throw new L(D.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=o,R.info("[".concat(this._clientId,"] set license success"),o)}startProxyServer(o){if("DISCONNECTED"!==this.connectionState)throw new L(D.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new L(D.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let i;switch(void 0===o&&(o=3),o){case 1:case 2:throw new L(D.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new L(D.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new L(D.INVALID_OPERATION,"Stop proxy server after leave channel");he.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(o){if(!o.accessPoints)throw new L(D.INVALID_PARAMS,"accessPoints is required.");Ra(o.accessPoints.serverList,"accessPoints.serverList"),sr(o.accessPoints.domain,"accessPoints.domain");const r=(T,b)=>{Rt(T,b,0,65535,!0)};let i=443;if(o.accessPoints.port&&(r(o.accessPoints.port,"accessPoints.port"),i=o.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new L(D.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");V("CLOSE_AFB_FOR_LOCAL_AP")&&(_t("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),_t("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,u=o.accessPoints.domain,d=o.accessPoints.serverList.map(T=>s.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(u):T),h=d.map(T=>"".concat(T,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,_t("WEBCS_DOMAIN",h),_t("WEBCS_DOMAIN_BACKUP_LIST",h),_t("GATEWAY_DOMAINS",[u]),o.report&&o.report.hostname&&Array.isArray(o.report.hostname)&&o.report.hostname.length?(Ra(o.report.hostname,"report.hostname"),_t("EVENT_REPORT_DOMAIN",o.report.hostname[0]),_t("EVENT_REPORT_BACKUP_DOMAIN",o.report.hostname[1]||o.report.hostname[0])):(_t("EVENT_REPORT_DOMAIN",d[0]),_t("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let f=6443;o.report&&o.report.port&&(r(o.report.port,"report.port"),f=o.report.port),_t("STATS_COLLECTOR_PORT",f),_t("ENABLE_EVENT_REPORT",!!o.report);let m="";o.log&&o.log.hostname&&Array.isArray(o.log.hostname)&&o.log.hostname.length?(Ra(o.log.hostname,"log.hostname"),m=o.log.hostname[0]):m=d[0];let _=6444;o.log&&o.log.port&&(r(o.log.port,"log.port"),_=o.log.port),_t("LOG_UPLOAD_SERVER","".concat(m,":").concat(_));let E=[];o.cds&&o.cds.hostname&&Array.isArray(o.cds.hostname)&&o.cds.hostname.length?(Ra(o.cds.hostname,"cds.hostname"),E=o.cds.hostname):E=d;let y=443;o.cds&&o.cds.port&&(r(o.cds.port,"cds.port"),y=o.cds.port),_t("CDS_AP",E.map(T=>"".concat(T,":").concat(y))),_t("ENABLE_CONFIG_DISTRIBUTE",!!o.cds),R.info("set local access point v2 success")}setLocalAccessPoints(o,r){if(Ra(o,"serverList"),sr(r,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new L(D.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;o=o.map(s=>i.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(r):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,_t("WEBCS_DOMAIN",o),_t("WEBCS_DOMAIN_BACKUP_LIST",o),_t("GATEWAY_DOMAINS",[r]),_t("EVENT_REPORT_DOMAIN",o[0]),_t("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]),_t("LOG_UPLOAD_SERVER","".concat(o[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(o){var r=this;return M(function*(){if(Nn(o,"streamType",[0,1]),r._remoteDefaultVideoStreamType=o,r._joinInfo)try{yield r._gateway.setDefaultRemoteVideoStreamType(o),r._joinInfo.defaultVideoStream=r._remoteDefaultVideoStreamType}catch(i){throw R.error("[".concat(r._clientId,"] set default remote video stream type error"),i.toString()),i}else R.debug("[".concat(r._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(o))})()}setRemoteVideoStreamType(o,r){var i=this;return M(function*(){Nn(r,"streamType",[0,1]);try{yield i._gateway.setRemoteVideoStreamType(o,r),setTimeout(()=>{const s=i._users.find(u=>u.uid===o);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw R.error("[".concat(i._clientId,"] set remote video stream type error"),s.toString()),s}R.info("[".concat(i._clientId,"] set remote ").concat(o," video stream type to ").concat(r)),i._remoteStreamTypeCacheMap.set(o,r)})()}setStreamFallbackOption(o,r){var i=this;return M(function*(){Nn(r,"fallbackType",[0,1,2]);try{yield i._gateway.setStreamFallbackOption(o,r)}catch(s){throw R.error("[".concat(i._clientId,"] set stream fallback option"),s.toString()),s}R.info("[".concat(i._clientId,"] set remote ").concat(o," stream fallback type to ").concat(r)),i._streamFallbackTypeCacheMap.set(o,r)})()}setEncryptionConfig(o,r,i){if(Nn(o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),sr(r,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(o)){if(!i||!(i instanceof Uint8Array&&32===i.length))throw new L(D.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new L(D.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(r)||R.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=o,this._encryptionSecret=r,i&&(this._encryptionSalt=fm(i))}renewToken(o){var r=this;return M(function*(){if(sr(o,"token",1,2047),!r._key||!r._joinInfo)throw new L(D.INVALID_OPERATION,"renewToken should not be called before user join");const i=r._key;r._key=o,r._joinInfo&&(r._joinInfo.token=o);const s=yield r._renewTokenMutex.lock();try{if(V("USE_NEW_TOKEN")){R.debug("[".concat(r._clientId,"] start renew token with ticket from unilbs"));const u=yield function oP(o,r,i){return rh.apply(this,arguments)}(r._joinInfo,r._axiosCancelSource.token,r._config.httpRetryConfig||vn);R.debug("[".concat(r._clientId,"] get ticket from unilbs success")),yield r._gateway.renewToken({token:o,ticket:u})}else R.debug("[".concat(r._clientId,"] start renew token without ticket")),yield r._gateway.renewToken({token:o});R.debug("[".concat(r._clientId,"] renewToken success"))}catch(u){throw r._key=i,r._joinInfo.token=i,R.error("[".concat(r._clientId,"] renewToken failed"),u.toString()),u}finally{s()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const o=this._p2pChannel.getAudioLevels();this.emit(Ue.VOLUME_INDICATOR,o)},V("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const o=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return o.Duration=Math.round(r.duration/1e3),o}startLiveStreaming(o,r){var i=this;return M(function*(){if(!r){if("h264"!==i._codec)throw new L(D.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!i._p2pChannel.hasLocalMedia())throw new L(D.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(i._liveRawStreamingClient&&i._liveRawStreamingClient.hasUrl(o)||i._liveTranscodeStreamingClient&&i._liveTranscodeStreamingClient.hasUrl(o))throw new L(D.LIVE_STREAMING_TASK_CONFLICT);const s=r?tn.TRANSCODE:tn.RAW;return i._createLiveStreamingClient(s).startLiveStreamingTask(o,s)})()}setLiveTranscoding(o){return this._createLiveStreamingClient(tn.TRANSCODE).setTranscodingConfig(o)}stopLiveStreaming(o){var r=this;return M(function*(){const i=[r._liveRawStreamingClient,r._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(o));if(!i.length)throw new L(D.INVALID_PARAMS,"can not find live streaming url to stop");yield ie.all(i.map(s=>s&&s.stopLiveStreamingTask(o)))})()}addInjectStreamUrl(o,r){var i=this;return M(function*(){if(!i._joinInfo)throw new L(D.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const s=i._createLiveStreamingClient(tn.INJECT);s.setInjectStreamConfig(r,0),yield s.startLiveStreamingTask(o,tn.INJECT)})()}removeInjectStreamUrl(){var o=this;return M(function*(){var r;const i=o._createLiveStreamingClient(tn.INJECT),s=Array.from(Fi(r=i.streamingTasks).call(r)).find(u=>u.mode===tn.INJECT);if(!o._joinInfo||!s)throw new L(D.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");yield i.stopLiveStreamingTask(s.url)})()}startChannelMediaRelay(o){var r=this;return M(function*(){qb(o),yield r._createChannelMediaRelayClient().startChannelMediaRelay(o)})()}updateChannelMediaRelay(o){var r=this;return M(function*(){qb(o),yield r._createChannelMediaRelayClient().updateChannelMediaRelay(o)})()}stopChannelMediaRelay(){var o=this;return M(function*(){yield o._createChannelMediaRelayClient().stopChannelMediaRelay(),o._statsCollector.onStatsChanged&&(o._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(o){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"can not send data stream, not joined");if("string"==typeof o&&(o=(new TextEncoder).encode(o)),new Blob([o]).size>1024)throw new L(D.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(me.DATA_STREAM,{payload:fm(o)},!r)}sendMetadata(o){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([o]).size>1024)throw new L(D.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(me.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:fm(o)})}sendCustomReportMessage(o){var r=this;return M(function*(){if(Array.isArray(o)||(o=[o]),o.forEach(Kf),!r._joinInfo)throw new L(D.INVALID_OPERATION,"can not send custom report, not joined");yield he.sendCustomReportMessage(r._joinInfo.sid,o)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(o,r){var i=this;return M(function*(){Nn(r.spatialLayer,"spatialLayer",[0,1,2,3]),Nn(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield i._gateway.pickSVCLayer(o,r)}catch(s){throw R.error("[".concat(i._clientId,"] pick SVC layer failed"),s.toString()),s}})()}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Ni.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach(o=>{o._audioTrack&&o._audioTrack._destroy(),o._videoTrack&&o._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Mn("client-publish"),this._subscribeMutex=new Mn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}}_startSession(o,r){const i=o||cy();R.debug(o?"[".concat(this._clientId,"] new Session ").concat(i):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i)),this._sessionId=i,this.store.sessionId=i,r?he.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:r.channel,appid:r.appId,mode:this._mode}):this._joinInfo?he.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&he.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}_publishHighStream(o){var r=this;return M(function*(){if(!r._joinInfo||void 0===r._uid)throw new L(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new L(D.INVALID_OPERATION,"can not publish stream in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&V("FORCE_TURN")&&!V("TURN_ENABLE_TCP")&&!V("TURN_ENABLE_UDP"))throw new L(D.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(r._clientId,"] publish high stream"));try{const s=yield r._p2pChannel.publish(o,r._isDualStreamEnabled,r._lowStreamParameter),u=(yield s.next()).value;if(u){var i;let d;try{d=yield r._gateway.publish(r._uid,u,!0)}catch(h){if(h.code!==D.DISCONNECT_P2P)throw s.throw(h),h}yield s.next((null===(i=d)||void 0===i?void 0:i.ortc)||[])}r._p2pChannel.reportPublishEvent(!0,null);for(const d of o)d instanceof an&&d._encoderConfig&&r._gateway.setVideoProfile(d._encoderConfig),!d.muted&&d.enabled||(yield r._p2pChannel.muteLocalTrack(d))}catch(s){if(r._p2pChannel.reportPublishEvent(!1,s?.code,o),s?.code===D.WS_ABORT)return;throw s}})()}_publishLowStream(){var o=this;return M(function*(){if(!o._joinInfo||void 0===o._uid)throw new L(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==o.connectionState&&"RECONNECTING"!==o.connectionState)throw new L(D.INVALID_OPERATION,"can not publish stream in ".concat(o.connectionState," state"));R.debug("[".concat(o._clientId,"] publish low stream"));const r=o._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(o._lowStreamParameter||(o._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),o._lowStreamParameter&&o._lowStreamParameter.bitrate&&r.bitrate<o._lowStreamParameter.bitrate&&(o._lowStreamParameter.bitrate=r.bitrate));try{const s=yield o._p2pChannel.publishLowStream(o._lowStreamParameter),u=(yield s.next()).value;if(u){var i;let d;try{d=yield o._gateway.publish(o._uid,u,!0)}catch(h){if(h.code!==D.DISCONNECT_P2P)throw s.throw(h),h}s.next((null===(i=d)||void 0===i?void 0:i.ortc)||[]),o._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(o._p2pChannel.reportPublishEvent(!1,s?.code,void 0,!0),s?.code===D.WS_ABORT)return;throw s}})()}_createLiveStreamingClient(o){if(!this._joinInfo||!this._appId)return new L(D.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=()=>new Ry(this._joinInfo,this._config.websocketRetryConfig||vn,this._config.httpRetryConfig||vn),i=s=>{s.onLiveStreamError=(u,d)=>{he.reportApiInvoke(this._sessionId,{name:pn.ON_LIVE_STREAM_ERROR,options:[u,d],tag:xt.TRACER}).onSuccess(),this.emit(Ue.LIVE_STREAMING_ERROR,u,d)},s.onLiveStreamWarning=(u,d)=>{he.reportApiInvoke(this._sessionId,{name:pn.ON_LIVE_STREAM_WARNING,options:[u,d],tag:xt.TRACER}).onSuccess(),this.emit(Ue.LIVE_STREAMING_WARNING,u,d)},s.on(wa.REQUEST_WORKER_MANAGER_LIST,(u,d,h)=>{if(!this._joinInfo)return h(new L(D.INVALID_OPERATION,"can not find join info to get worker manager"));Ed(u,this._joinInfo,this._axiosCancelSource.token,vn).then(d).catch(h)})};switch(o){case tn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=r(),i(this._liveRawStreamingClient)),this._liveRawStreamingClient;case tn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=r(),i(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case tn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=r(),this._injectStreamingClient.on(wa.REQUEST_WORKER_MANAGER_LIST,(s,u,d)=>{if(!this._joinInfo)return d(new L(D.INVALID_OPERATION,"can not find join info to get worker manager"));Ed(s,this._joinInfo,this._axiosCancelSource.token,vn).then(u).catch(d)}),this._injectStreamingClient.onInjectStatusChange=(s,u,d)=>{this.emit(Ue.INJECT_STREAM_STATUS,s,u,d)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new L(D.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:o,sendResolutionHeight:r}=this.getLocalVideoStats();this._channelMediaRelayClient=new sP(this._joinInfo,this._clientId,this._config.websocketRetryConfig||vn,this._config.httpRetryConfig||vn,{width:o,height:r}),this._channelMediaRelayClient.on("state",s=>{s===br.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(Ue.CHANNEL_MEDIA_RELAY_STATE,s)}),this._channelMediaRelayClient.on("event",s=>{this.emit(Ue.CHANNEL_MEDIA_RELAY_EVENT,s)}),this._statsCollector.onStatsChanged=(s,u)=>{var d;"resolution"===s&&(null===(d=this._channelMediaRelayClient)||void 0===d||d.setVideoProfile(u))}}return this._channelMediaRelayClient}_handleGatewayEvents(){var o=this;this._gateway.on(Ut.DISCONNECT_P2P,M(function*(){yield o._p2pChannel.disconnectForReconnect()})),this._gateway.on(Ut.CONNECTION_STATE_CHANGE,(r,i,s)=>{var u;if(s===st.FALLBACK)return;const d=()=>{this.emit(Ue.CONNECTION_STATE_CHANGE,r,i,s)};if(he.reportApiInvoke(this._sessionId||(null===(u=this._gateway.joinInfo)||void 0===u?void 0:u.sid)||null,{name:pn.CONNECTION_STATE_CHANGE,options:[r,i,s],tag:xt.TRACER}).onSuccess(JSON.stringify({cur:r,prev:i,reason:s})),R.info("[".concat(this._clientId,"] connection state change: ").concat(i," -> ").concat(r)),"DISCONNECTED"===r)return this._reset(),void d();if("RECONNECTING"===r)this._users.forEach(f=>{f._trust_in_room_=!1,f._trust_audio_enabled_state_=!1,f._trust_video_enabled_state_=!1,f._trust_audio_mute_state_=!1,f._trust_video_mute_state_=!1,f._trust_audio_stream_added_state_=!1,f._trust_video_stream_added_state_=!1,f._audioSSRC=void 0,f._videoSSRC=void 0,f._videoOrtc=void 0,f._audioOrtc=void 0,f._cname=void 0,f._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===r){var h;this._streamFallbackTypeCacheMap.forEach((f,m)=>{this._gateway.setStreamFallbackOption(m,f).catch(_=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((f,m)=>{this._gateway.setRemoteVideoStreamType(m,f).catch(_=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(h=this._joinInfo)||void 0===h?void 0:h.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(f=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(f))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(f=>!f._trust_in_room_).forEach(f=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(f.uid)),this._handleUserOffline({uid:f.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(f=>{f._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,"audio",!1)),f._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,"video",!1)),f._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(f.uid)),this._handleSetStreamLocalEnable("audio",f.uid,!0)),f._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(f.uid)),this._handleSetStreamLocalEnable("video",f.uid,!0)),f._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(f.uid)),this._handleResetAddStream(f,"video")),f._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(f.uid)),this._handleResetAddStream(f,"audio")),f._video_added_||f._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(f.uid)),this._handleRemoveStream({uid:f.uid,uint_id:f._uintid}))}))},1e3)}d()}),this._gateway.on(Ut.REQUEST_NEW_GATEWAY_LIST,(r,i)=>{if(!this._joinInfo)return i(new L(D.UNEXPECTED_ERROR,"can not recover, no join info"));Tm(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||vn,this.store).then(s=>{this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip),r(s.gatewayInfo.gatewayAddrs.map(u=>{if(this._joinInfo&&this._joinInfo.proxyServer){const d=u.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(d[0],"&p=").concat(d[1])}return"wss://".concat(u.address)}))}).catch(i)}),this._gateway.on(Ut.NETWORK_QUALITY,r=>{"normal"===this._networkQualitySensitivity&&this.emit(Ue.NETWORK_QUALITY,r)}),this._gateway.on(Ut.STREAM_TYPE_CHANGE,(r,i)=>{this.emit(Ue.STREAM_TYPE_CHANGED,r,i),he.reportApiInvoke(this._sessionId,{name:pn.STREAM_TYPE_CHANGE,options:[r,i],tag:xt.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:i}))}),this._gateway.on(Ut.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(Ut.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(Ut.REQUEST_P2P_CONNECTION_PARAMS,function(){var r=M(function*(i,s,u){try{s(yield o._p2pChannel.startP2PConnection(i))}catch(d){u(d)}});return function(i,s,u){return r.apply(this,arguments)}}()),this._gateway.on(Ut.JOIN_RESPONSE,(r,i)=>{const{dtlsParameters:s,iceParameters:u,candidates:d,rtpCapabilities:h,setup:f,cname:m}=VA(r.ortc,i);this._p2pChannel.connect(u,s,d,h,f,m)}),this._gateway.on(Ut.REQUEST_DC_CONNECTION_PARAMS,r=>{r(this._p2pChannel.getEstablishParams())}),this._gateway.on(Ut.RESET_SIGNAL,r=>{this._p2pChannel.resetConnection(r),this._handleGatewaySignalEvents()}),this._gateway.on(Ut.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Ut.DATACHANNEL_PRECONNECT,function(){var r=M(function*(i,s,u,d){var h,f,m,_,E,y;yield o._p2pChannel.startP2PConnection({turnServer:null===(h=o._joinInfo)||void 0===h?void 0:h.turnServer},!0);const T=function(b,w){let P;return w&&w.ip&&"number"==typeof w.port?(P=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:w.ip,port:w.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(w.ip,":").concat(w.port)),w.ip6&&(P.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:w.ip6,port:w.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(w.ip6,":").concat(w.port)))):P=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:b.ip,port:b.port.toString(),type:"host",extension:{}}],P}(i,s);return o._p2pChannel.preConnect({iceUfrag:"".concat(null===(f=o._joinInfo)||void 0===f?void 0:f.apResponse.cid,"_").concat(null===(m=o._joinInfo)||void 0===m?void 0:m.apResponse.cert),icePwd:"".concat(null===(_=o._joinInfo)||void 0===_?void 0:_.apResponse.cid,"_").concat(null===(E=o._joinInfo)||void 0===E?void 0:E.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(y=V("FINGERPRINT"))&&void 0!==y?y:i.fingerprint}]},T,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(u).catch(d)});return function(i,s,u,d){return r.apply(this,arguments)}}())}_handleGatewaySignalEvents(){this._gateway.signal.on(De.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(De.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(De.ON_ADD_AUDIO_STREAM,o=>this._handleAddAudioOrVideoStream("audio",o.uid,o.ssrcId,o.cname,o.uint_id,o.ortc)),this._gateway.signal.on(De.ON_ADD_VIDEO_STREAM,o=>this._handleAddAudioOrVideoStream("video",o.uid,o.ssrcId,o.cname,o.uint_id,o.ortc,o.rtxSsrcId)),this._gateway.signal.on(De.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(De.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(De.MUTE_AUDIO,o=>this._handleMuteStream(o.uid,"audio",!0)),this._gateway.signal.on(De.UNMUTE_AUDIO,o=>this._handleMuteStream(o.uid,"audio",!1)),this._gateway.signal.on(De.MUTE_VIDEO,o=>this._handleMuteStream(o.uid,"video",!0)),this._gateway.signal.on(De.UNMUTE_VIDEO,o=>this._handleMuteStream(o.uid,"video",!1)),this._gateway.signal.on(De.RECEIVE_METADATA,o=>{const r=Ql(o.metadata);this.emit(Ue.RECEIVE_METADATA,o.uid,r)}),this._gateway.signal.on(De.ON_DATA_STREAM,o=>{o.seq&&delete o.seq,o.payload=Ql(o.payload),this.emit(Ue.STREAM_MESSAGE,o.uid,o.payload),this.onStreamMessage&&this.onStreamMessage(o)}),this._gateway.signal.on(De.ON_CRYPT_ERROR,()=>{gd(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.emit(Ue.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(De.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(De.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(De.ON_STREAM_FALLBACK_UPDATE,o=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(o.stream_id,", attr: ").concat(o.stream_type)),this.emit(Ue.STREAM_FALLBACK,o.stream_id,1===o.stream_type?"fallback":"recover")}),this._gateway.signal.on(De.ON_PUBLISH_STREAM,o=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:o.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(o))))}),this._gateway.signal.on(De.ENABLE_LOCAL_VIDEO,o=>{this._handleSetStreamLocalEnable("video",o.uid,!0)}),this._gateway.signal.on(De.DISABLE_LOCAL_VIDEO,o=>{this._handleSetStreamLocalEnable("video",o.uid,!1)}),this._gateway.signal.on(ae.REQUEST_TIMEOUT,(o,r)=>{if(this._joinInfo)switch(o){case me.PUBLISH:{if(!r)return;const h=r.ortc;if(h){var i,s,u,d;const f=h.some(E=>{let{stream_type:y}=E;return y===fn.Audio}),m=h.some(E=>{let{stream_type:y}=E;return y!==fn.Audio}),_=h.some(E=>{let{stream_type:y}=E;return y===fn.Screen||y===fn.ScreenLow});"offer"===r.state&&he.publish(this._joinInfo.sid,{eventElapse:xr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:D.TIMEOUT,audio:f,video:m,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:_,audioName:f?null===(i=h.find(E=>{let{stream_type:y}=E;return y===fn.Audio}))||void 0===i||null===(s=i.ssrcs[0])||void 0===s?void 0:s.ssrcId.toString():void 0,videoName:m?null===(u=h.find(E=>{let{stream_type:y}=E;return y!==fn.Audio}))||void 0===u||null===(d=u.ssrcs[0])||void 0===d?void 0:d.ssrcId.toString():void 0})}break}case me.SUBSCRIBE:r&&he.subscribe(this._joinInfo.sid,{succ:!1,ec:D.TIMEOUT,audio:r.stream_type===be.AUDIO,video:r.stream_type===be.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:xr.measureFromSubscribeStart(this.store.clientId,r.ssrcId)})}}),this._gateway.signal.on(De.ON_P2P_OK,o=>{}),this._gateway.signal.on(De.ON_PUBLISHED_USER_LIST,o=>{if(null==o||!o.users)return;V("BLOCK_LOCAL_CLIENT")&&(o.users=o.users.filter(s=>!wc(s.audio_ssrc,this.channelName)));const r=[],i=[];for(const s of o.users){let u=this._users.find(_=>_.uid===s.stream_id);u?u._trust_in_room_=!0:(u=new ch(s.stream_id,s.stream_id),this._users.push(u),0===this.getListeners(Ue.PUBLISHED_USER_LIST).length&&(R.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.emit(Ue.USER_JOINED,u)));const d=nn.Audio&s.stream_type,h=(nn.Video|nn.LwoVideo)&s.stream_type,f=d&&u.hasAudio,m=h&&u.hasVideo;h&&(u._trust_video_stream_added_state_=!0,u._video_added_=!0,u._videoSSRC=s.video_ssrc,u._rtxSsrcId=s.video_rtx),d&&(u._trust_audio_stream_added_state_=!0,u._audio_added_=!0,u._audioSSRC=s.audio_ssrc),d&&!f&&0===this.getListeners(Ue.PUBLISHED_USER_LIST).length&&(R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published audio")),this.emit(Ue.USER_PUBLISHED,u,"audio")),h&&!m&&0===this.getListeners(Ue.PUBLISHED_USER_LIST).length&&(R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published video")),this.emit(Ue.USER_PUBLISHED,u,"video")),(d&&!f||h&&!m)&&r.push(u),h&&this._p2pChannel.hasPendingRemoteMedia(u,"video")&&i.push({user:u,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(u,"audio")&&i.push({user:u,mediaType:"audio"})}i.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(s=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(Ue.PUBLISHED_USER_LIST).length>0?(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(s=>s.uid).join(", "))),this.emit(Ue.PUBLISHED_USER_LIST,r)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(s=>s.uid).join(", ")))})}_handleP2PChannelEvents(){var o=this;this._p2pChannel.on(Ge.RequestMuteLocal,function(){var r=M(function*(i,s,u){if(o._joinInfo)try{yield o._gateway.muteLocal(i,o._joinInfo.stringUid||o._joinInfo.uid),s()}catch(d){d.code===D.DISCONNECT_P2P?s():u(d)}else s()});return function(i,s,u){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ge.RequestUnmuteLocal,function(){var r=M(function*(i,s,u){if(o._joinInfo)try{yield o._gateway.unmuteLocal(i,o._joinInfo.stringUid||o._joinInfo.uid),s()}catch(d){d.code===D.DISCONNECT_P2P?s():u(d)}else s()});return function(i,s,u){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ge.RequestRePublish,(r,i,s)=>{this.publish(r,!1).then(i).catch(s)}),this._p2pChannel.on(Ge.RequestReSubscribe,function(){var r=M(function*(i,s,u){try{for(const{user:d,kind:h}of i)h===be.VIDEO?yield o.subscribe(d,"video"):yield o.subscribe(d,"audio");s()}catch(d){u(d)}});return function(i,s,u){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ge.RequestUploadStats,(r,i)=>{this._gateway.uploadStats(r,i)}),this._p2pChannel.on(Ge.MediaReconnectStart,r=>{this.emit(Ue.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(Ge.MediaReconnectEnd,r=>{this.emit(Ue.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(Ge.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ge.RequestRestartICE,function(){var r=M(function*(i){const s=yield o._p2pChannel.restartICE(i),u=yield s.next();if(u.done)return;const d=u.value;let h;try{h=yield o._gateway.restartICE({iceParameters:d})}catch(m){return void s.throw(m)}const{iceParameters:f}=function(m){const _=m.iceParameters;return{iceParameters:{iceUfrag:_.iceUfrag,icePwd:_.icePwd}}}(h);yield s.next({remoteIceParameters:f})});return function(i){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ge.RequestReconnect,M(function*(){o._gateway.reconnect()})),this._p2pChannel.on(Ge.RequestReconnectPC,M(function*(){var r;const{iceParameters:i,dtlsParameters:s,rtpCapabilities:u}=yield o._p2pChannel.startP2PConnection({turnServer:null===(r=o._joinInfo)||void 0===r?void 0:r.turnServer}),{gatewayEstablishParams:d,gatewayAddress:h}=yield o._gateway.reconnectPC({iceParameters:i,dtlsParameters:s,rtpCapabilities:u}),{dtlsParameters:f,iceParameters:m,candidates:_,rtpCapabilities:E,setup:y,cname:T}=VA(d,h);yield o._p2pChannel.connect(m,f,_,E,y,T),yield o._p2pChannel.republish(),yield o._p2pChannel.reSubscribe()})),this._p2pChannel.on(Ge.RequestUnpublishForReconnectPC,function(){var r=M(function*(i,s,u){o._joinInfo&&void 0!==o._uid?(yield o._gateway.unpublish(i,o._uid),s()):u()});return function(i,s,u){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ge.P2PLost,()=>{this.emit(Ue.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ge.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(Ge.ConnectionTypeChange,r=>{this.emit(Ue.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(Ge.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ge.QueryClientConnectionState,r=>{r(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(o){var r=this;return M(function*(){if("CONNECTED"!==r.connectionState||!r._joinInfo)throw new L(D.INVALID_OPERATION,"[".concat(r._clientId,"] Client did not join channel"));if(r._inspect)throw new L(D.INVALID_OPERATION,"[".concat(r._clientId,"] Inspect content service already in connecting/connected state"));if(!o)throw new L(D.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig is necessary"));if(!o.inspectType||!Array.isArray(o.inspectType))throw new L(D.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const i=[...new Set(o.inspectType)];i.forEach(s=>{if(!["supervise","moderation"].includes(s))throw new L(D.INVALID_PARAMS,"[".concat(r._clientId,"] ").concat(s," is not a valid inspect type."))}),o.inspectType=i}if(o&&o.extraInfo&&o.extraInfo.length>1024)throw new L(D.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const i=new rg(o);r._inspect=i,r.handleVideoInspectEvents(r._inspect),yield i.init({appId:r._joinInfo.appId,areaCode:"",cname:r._joinInfo.cname,sid:r._joinInfo.sid,token:r._joinInfo.token,uid:r._joinInfo.uid,cid:r._joinInfo.cid,vid:r._joinInfo.vid?Number(r._joinInfo.vid):0},vn)}catch(i){throw Array.isArray(i)?i[0]:i}})()}disableContentInspect(){var o=this;return M(function*(){if(!o._inspect)throw new L(D.INVALID_OPERATION,"[".concat(o._clientId,"] inspectVideoContent not started"));try{o._inspect.close(),o._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}})()}handleVideoInspectEvents(o){o.on(mn.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.emit(Ue.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===oo.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.emit(Ue.CONTENT_INSPECT_ERROR,new L(D.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));o.inspectImage()}}),o.on(mn.INSPECT_RESULT,(r,i)=>{var s;if(i?.code===D.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return R.debug("Stop inspect content because that has left channel"),null==this||null===(s=this._inspect)||void 0===s||s.close(),void(this._inspect=void 0);this.emit(Ue.CONTENT_INSPECT_RESULT,r,i)}),o.on(mn.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>"video"===i.trackMediaType)[0])})}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(o){var r=this;return M(function*(){td(o,"enabled"),_t("ENABLE_PUBLISH_AUDIO_FILTER",o),r._joinInfo&&(yield r._gateway.setPublishAudioFilterEnabled(o))})()}_handleResetAddStream(o,r){switch(r){case"audio":o._audio_added_=!1,o._trust_audio_stream_added_state_=!0;break;case"video":o._video_added_=!1,o._trust_video_stream_added_state_=!0}}}).prototype,"leave",[fr],Object.getOwnPropertyDescriptor(te.prototype,"leave"),te.prototype),q(te.prototype,"publish",[Be],Object.getOwnPropertyDescriptor(te.prototype,"publish"),te.prototype),q(te.prototype,"unpublish",[dt],Object.getOwnPropertyDescriptor(te.prototype,"unpublish"),te.prototype),q(te.prototype,"subscribe",[fD],Object.getOwnPropertyDescriptor(te.prototype,"subscribe"),te.prototype),q(te.prototype,"massSubscribe",[Mh],Object.getOwnPropertyDescriptor(te.prototype,"massSubscribe"),te.prototype),q(te.prototype,"unsubscribe",[Ds],Object.getOwnPropertyDescriptor(te.prototype,"unsubscribe"),te.prototype),q(te.prototype,"massUnsubscribe",[Lh],Object.getOwnPropertyDescriptor(te.prototype,"massUnsubscribe"),te.prototype),q(te.prototype,"setLowStreamParameter",[Ei],Object.getOwnPropertyDescriptor(te.prototype,"setLowStreamParameter"),te.prototype),q(te.prototype,"enableDualStream",[mD],Object.getOwnPropertyDescriptor(te.prototype,"enableDualStream"),te.prototype),q(te.prototype,"disableDualStream",[Yn],Object.getOwnPropertyDescriptor(te.prototype,"disableDualStream"),te.prototype),q(te.prototype,"setClientRole",[gD],Object.getOwnPropertyDescriptor(te.prototype,"setClientRole"),te.prototype),q(te.prototype,"setProxyServer",[cn],Object.getOwnPropertyDescriptor(te.prototype,"setProxyServer"),te.prototype),q(te.prototype,"setTurnServer",[_D],Object.getOwnPropertyDescriptor(te.prototype,"setTurnServer"),te.prototype),q(te.prototype,"setLicense",[kh],Object.getOwnPropertyDescriptor(te.prototype,"setLicense"),te.prototype),q(te.prototype,"startProxyServer",[ED],Object.getOwnPropertyDescriptor(te.prototype,"startProxyServer"),te.prototype),q(te.prototype,"stopProxyServer",[xh],Object.getOwnPropertyDescriptor(te.prototype,"stopProxyServer"),te.prototype),q(te.prototype,"setLocalAccessPointsV2",[vD],Object.getOwnPropertyDescriptor(te.prototype,"setLocalAccessPointsV2"),te.prototype),q(te.prototype,"setLocalAccessPoints",[yS],Object.getOwnPropertyDescriptor(te.prototype,"setLocalAccessPoints"),te.prototype),q(te.prototype,"setRemoteDefaultVideoStreamType",[og],Object.getOwnPropertyDescriptor(te.prototype,"setRemoteDefaultVideoStreamType"),te.prototype),q(te.prototype,"setRemoteVideoStreamType",[Uh],Object.getOwnPropertyDescriptor(te.prototype,"setRemoteVideoStreamType"),te.prototype),q(te.prototype,"setStreamFallbackOption",[ig],Object.getOwnPropertyDescriptor(te.prototype,"setStreamFallbackOption"),te.prototype),q(te.prototype,"setEncryptionConfig",[yD],Object.getOwnPropertyDescriptor(te.prototype,"setEncryptionConfig"),te.prototype),q(te.prototype,"renewToken",[SS],Object.getOwnPropertyDescriptor(te.prototype,"renewToken"),te.prototype),q(te.prototype,"enableAudioVolumeIndicator",[SD],Object.getOwnPropertyDescriptor(te.prototype,"enableAudioVolumeIndicator"),te.prototype),q(te.prototype,"startLiveStreaming",[TD],Object.getOwnPropertyDescriptor(te.prototype,"startLiveStreaming"),te.prototype),q(te.prototype,"setLiveTranscoding",[CD],Object.getOwnPropertyDescriptor(te.prototype,"setLiveTranscoding"),te.prototype),q(te.prototype,"stopLiveStreaming",[ID],Object.getOwnPropertyDescriptor(te.prototype,"stopLiveStreaming"),te.prototype),q(te.prototype,"addInjectStreamUrl",[TS],Object.getOwnPropertyDescriptor(te.prototype,"addInjectStreamUrl"),te.prototype),q(te.prototype,"removeInjectStreamUrl",[RD],Object.getOwnPropertyDescriptor(te.prototype,"removeInjectStreamUrl"),te.prototype),q(te.prototype,"startChannelMediaRelay",[CS],Object.getOwnPropertyDescriptor(te.prototype,"startChannelMediaRelay"),te.prototype),q(te.prototype,"updateChannelMediaRelay",[Vh],Object.getOwnPropertyDescriptor(te.prototype,"updateChannelMediaRelay"),te.prototype),q(te.prototype,"stopChannelMediaRelay",[wd],Object.getOwnPropertyDescriptor(te.prototype,"stopChannelMediaRelay"),te.prototype),q(te.prototype,"sendCustomReportMessage",[bD],Object.getOwnPropertyDescriptor(te.prototype,"sendCustomReportMessage"),te.prototype),q(te.prototype,"pickSVCLayer",[AD],Object.getOwnPropertyDescriptor(te.prototype,"pickSVCLayer"),te.prototype),q(te.prototype,"enableContentInspect",[sg],Object.getOwnPropertyDescriptor(te.prototype,"enableContentInspect"),te.prototype),q(te.prototype,"disableContentInspect",[IS],Object.getOwnPropertyDescriptor(te.prototype,"disableContentInspect"),te.prototype),q(te.prototype,"getJoinChannelServiceRecords",[DD],Object.getOwnPropertyDescriptor(te.prototype,"getJoinChannelServiceRecords"),te.prototype),q(te.prototype,"setPublishAudioFilterEnabled",[ag],Object.getOwnPropertyDescriptor(te.prototype,"setPublishAudioFilterEnabled"),te.prototype),te);class JP extends $R{set currentState(r){r!==this._currentState&&(this._currentState=r,this.emit(en.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),S(this,"audioBuffer",void 0),S(this,"sourceNode",void 0),S(this,"startPlayTime",0),S(this,"startPlayOffset",0),S(this,"pausePlayTime",0),S(this,"options",void 0),S(this,"currentLoopCount",0),S(this,"currentPlaybackSpeed",100),S(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(r){"stopped"===this.currentState?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=r,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}setAudioBufferPlaybackSpeed(r){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const OD=new Map;function jh(){return jh=M(function*(o,r){let i=null;if("string"==typeof o){const u=OD.get(o);if(u)return R.debug("use cached audio resource: ",o),u;try{i=(yield to(()=>Ni.get(o,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(d){throw new L(D.FETCH_AUDIO_FILE_FAILED,d.toString())}}else i=yield new ie((d,h)=>{const f=new FileReader;f.onload=m=>{m.target?d(m.target.result):h(new L(D.READ_LOCAL_AUDIO_FILE_ERROR))},f.onerror=()=>{h(new L(D.READ_LOCAL_AUDIO_FILE_ERROR))},f.readAsArrayBuffer(o)});const s=yield function(u){const d=Hc();return new ie((h,f)=>{d.decodeAudioData(u,m=>{h(m)},m=>{f(new L(D.DECODE_AUDIO_FILE_FAILED,m.toString()))})})}(i);return"string"==typeof o&&r&&OD.set(o,s),s}),jh.apply(this,arguments)}function cg(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function Bh(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?cg(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):cg(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function bS(o,r,i,s){i.optimizationMode&&(s&&s.width&&s.height?(i.encoderConfig=Bh(Bh({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),"motion"!==i.optimizationMode&&"detail"!==i.optimizationMode||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?R.debug("[".concat(o,"] set content hint to"),i.optimizationMode):R.debug("[".concat(o,"] set content hint failed")))):R.warning("[".concat(o,"] can not apply optimization mode bitrate config, no encoderConfig")))}const Ak=ut().name;class eu{constructor(r,i){S(this,"id",0),S(this,"element",void 0),S(this,"peerPair",void 0),S(this,"context",void 0),S(this,"audioPlayerElement",void 0),S(this,"audioTrack",void 0),eu.count+=1,this.id=eu.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}switchSdp(){var r=this;return M(function*(){if(!r.peerPair)return;const i=function(){var u=M(function*(d,h){const f="offer"===h?yield d.createOffer():yield d.createAnswer();return yield d.setLocalDescription(f),"complete"===d.iceGatheringState?d.localDescription:new ie(m=>{d.onicegatheringstatechange=()=>{"complete"===d.iceGatheringState&&m(d.localDescription)}})});return function(h,f){return u.apply(this,arguments)}}(),s=function(){var u=M(function*(d,h){return yield d.setRemoteDescription(h)});return function(h,f){return u.apply(this,arguments)}}();try{const u=yield i(r.peerPair[0],"offer");yield s(r.peerPair[1],u);const d=yield i(r.peerPair[1],"answer");yield s(r.peerPair[0],d)}catch(u){throw new L(D.LOCAL_AEC_ERROR,u.toString()).print()}})()}getTracksFromMediaElement(r){var i=this;return M(function*(){if(i.audioTrack)return i.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=i.context.createMediaStreamDestination(),i.context.createMediaElementSource(r).connect(s)}catch(d){throw new L(D.LOCAL_AEC_ERROR,d.toString()).print()}if(!s)throw new L(D.LOCAL_AEC_ERROR,"no dest node when local aec").print();const u=s.stream.getAudioTracks()[0];return i.audioTrack=u,u})()}getElement(){return this.element}startEchoCancellation(){var r=this;return M(function*(){r.context.resume(),r.peerPair&&r.close(),r.initPeers();const i=r.element,s=yield r.getTracksFromMediaElement(i);r.peerPair&&r.peerPair[0].addTrack(s),yield r.switchSdp()})()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var AS,ug;S(eu,"count",0);const QP=window.AudioContext||window.webkitAudioContext,PD=new(AS=pe({report:he}),q((ug=class{constructor(){S(this,"units",[]),S(this,"context",void 0)}processExternalMediaAEC(o){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new QP);let r=this.units.find(i=>i&&i.getElement()===o);return r||(r=new eu(o,this.context),this.units.push(r)),r.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return ut().name!==it.SAFARI}}).prototype,"processExternalMediaAEC",[AS],Object.getOwnPropertyDescriptor(ug.prototype,"processExternalMediaAEC"),ug.prototype),ug);function MD(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);r&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),i.push.apply(i,s)}return i}function LD(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?MD(Object(i),!0).forEach(function(s){S(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):MD(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}const dg=window||document;function ZP(o){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!dg)return;const i=_n._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);const s=u=>{if(!(u&&u.blockedURI&&(_n.onSecurityPolicyViolation||_n.getListeners(xi.SECURITY_POLICY_VIOLATION).length>0)))return;const d=u.blockedURI;V("CSP_DETECTED_HOSTNAME_LIST").some(h=>d.includes(h))&&(_n.onSecurityPolicyViolation&&"function"==typeof _n.onSecurityPolicyViolation&&_n.onSecurityPolicyViolation(u),_n.getListeners(xi.SECURITY_POLICY_VIOLATION).length>0&&_n.emit(xi.SECURITY_POLICY_VIOLATION,u))};i&&dg.removeEventListener("securitypolicyviolation",i),(r||o&&"function"==typeof o||_n.getListeners(xi.SECURITY_POLICY_VIOLATION).length>0)&&dg.addEventListener("securitypolicyviolation",s),_n._cspEventHandlerPointer=s}_t("PROCESS_ID","process-".concat(wt(8,""),"-").concat(wt(4,""),"-").concat(wt(4,""),"-").concat(wt(4,""),"-").concat(wt(12,""))),function(){const o=ut();$n.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),$n.getStreamFromExtension=o.name===it.CHROME&&Number(o.version)>34,$n.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),$n.supportMinBitrate=o.name===it.CHROME||o.name===it.EDGE,$n.supportSetRtpSenderParameters=function(){const r=ut();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!as()||!(!or()&&!Sa())||r.name===it.FIREFOX&&Number(r.version)>=64)}(),o.name===it.SAFARI&&($n.supportDualStream=Number(o.version)>=14),$n.webAudioMediaStreamDest=function(){const r=ut();return!(r.name===it.SAFARI&&Number(r.version)<12)}(),$n.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,$n.supportWebGL=typeof WebGLRenderingContext<"u",$n.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,as()||($n.webAudioWithAEC=!0),$n.supportShareAudio=function(){const r=ut();return(r.os===Gn.WIN_10||r.os===Gn.WIN_81||r.os===Gn.WIN_7||r.os===Gn.LINUX||r.os===Gn.MAC_OS)&&r.name===it.CHROME&&Number(r.version)>=74}(),$n.supportDualStreamEncoding=function(){const r=ut();return!!V("DISABLE_WEBAUDIO")||"Safari"===r.name&&Number(r.version)>=14||!!("Chrome"===r.name&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&V("CHROME_DUAL_STREAM_USE_ENCODING"))}(),$n.supportDataChannel=!!(Rf(76)||function(r){const i=ut();return!(i.name!==it.FIREFOX||!i.osVersion)&&Number(i.version)>=68}()||function(r){const i=ut();return!(i.name!==it.SAFARI||!i.osVersion)&&Number(i.version)>=14}()),$n.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Bt()&&!!r&&r.prototype.setConfiguration instanceof Function}(),$n.supportWebRTCEncodedTransform=function(){const r=ut();return"Chrome"===r.name&&Number(r.version)>=86}(),R.info("browser compatibility",JSON.stringify($n),JSON.stringify(o))}(),function(){let o;try{o=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void R.error("Error loading sdk config",r.message)}if(o)try{const r=JSON.parse(window.atob(o)),i=Date.now();R.debug("Loading global parameters from cache",r),Object.keys(r).forEach(s=>{if(Object.prototype.hasOwnProperty.call(Kr,s)){const{value:u,expires:d}=r[s];if(d&&d<=i)return;Ac[s]=u,Kr[s]=u}})}catch(r){R.error("Error loading mutableParamsCache: ".concat(o),r.message)}}(),Array.isArray(Ac.AREAS)&&Ac.AREAS.length>0&&my(Ac.AREAS,!0);const _n=function(o){const r=new Lt,i=o,s={getListeners:r.getListeners.bind(r),on:(u,d)=>(u===xi.SECURITY_POLICY_VIOLATION&&ZP(d,!0),r.on.bind(r)(u,d)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r)};return LD(LD({},i),s)}({__CLIENT_LIST__:Dc,__TRACK_LIST__:Zu,VERSION:no,BUILD:jf,setParameter:(o,r,i)=>{R.debug("setParameter key:".concat(o,", value:").concat(JSON.stringify(r))),_t(o,r,i)},getParameter:V,getSupportedCodec:function(){var o=M(function*(){let r={audio:[],video:[]};try{let i=new RTCPeerConnection;i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const s=(yield i.createOffer()).sdp;if(!s)return r;i.close(),i=null,r=function(u){const d={video:[],audio:[]};return u.match(/ VP8/i)&&d.video.push("VP8"),u.match(/ VP9/i)&&d.video.push("VP9"),u.match(/ AV1/i)&&d.video.push("AV1"),u.match(/ H264/i)&&d.video.push("H264"),u.match(/ H265/i)&&d.video.push("H265"),u.match(/ opus/i)&&d.audio.push("OPUS"),u.match(/ PCMU/i)&&d.audio.push("PCMU"),u.match(/ PCMA/i)&&d.audio.push("PCMA"),u.match(/ G722/i)&&d.audio.push("G722"),d}(s)}catch(i){throw new L(D.CREATE_OFFER_FAILED,i.toString&&i.toString()).print()}return r});return function(){return o.apply(this,arguments)}}(),checkSystemRequirements:function(){const o=he.reportApiInvoke(null,{name:pn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:xt.TRACER});let r=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,f=window.WebSocket;r=!!(d&&h&&f)}catch(d){return R.error("check system requirement failed: ",d),!1}let i=!1;const s=ut();s.name===it.CHROME&&Number(s.version)>=58&&(!function wI(){return"WebKit"===ss.engine.name}()||function DI(){const o=ut();if(Sa()){if(o.os===Gn.MAC_OS)return!0;if(o.os===Gn.IOS){const r=ss.os.version&&ss.os.version.split(".");if(r&&14===Number(r[0])&&r[1]&&Number(r[1])>=3||r&&Number(r[0])>14)return!0}}return!1}())&&(i=!0),s.name===it.FIREFOX&&Number(s.version)>=56&&(i=!0),s.name===it.OPERA&&Number(s.version)>=45&&(i=!0),s.name===it.SAFARI&&Number(s.version)>=11&&(i=!0),(NI()||ut().name===it.QQ)&&(i=!0),R.debug("checkSystemRequirements, api:",r,"browser",i);const u=r&&i;return o.onSuccess(u),u},getDevices:function(o){return ao.enumerateDevices(!0,!0,o)},getMicrophones:function(o){return ao.getRecordingDevices(o)},getCameras:function(o){return ao.getCamerasDevices(o)},getElectronScreenSources:YR,getPlaybackDevices:function(o){return ao.getSpeakers(o)},createClient:function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r=he.reportApiInvoke(null,{name:pn.CREATE_CLIENT,options:[o],tag:xt.TRACER});try{!function od(o){return Nn(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Nn(o.mode,"config.mode",["rtc","live"]),void 0!==o.audioCodec&&Nn(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==o.proxyServer&&sr(o.proxyServer,"config.proxyServer",1,1e4),void 0!==o.turnServer&&Nc(o.turnServer),void 0!==o.httpRetryConfig&&Mi(o.httpRetryConfig),void 0!==o.websocketRetryConfig&&Mi(o.websocketRetryConfig),!0}(o)}catch(i){throw r.onError(i),i}return void 0===o.audioCodec&&(o.audioCodec="opus"),r.onSuccess(),new RS(Fh(Fh({forceWaitGatewayResponse:!0},o),{},{role:"rtc"===o.mode?"host":o.role}))},createCameraVideoTrack:function(){var o=M(function*(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=he.reportApiInvoke(null,{tag:xt.TRACER,name:pn.CREATE_CAM_VIDEO_TRACK,options:[Bh({},r)]}),s=vd(r),u=wt(8,"track-cam-");let d=null;R.info("start create camera video track with config",JSON.stringify(r),"trackId",u);try{d=(yield Go({video:s},u)).getVideoTracks()[0]||null}catch(f){throw i.onError(f),f}if(!d){const f=new L(D.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(f),f.throw()}r.optimizationMode&&bS(u,d,r,bc(r.encoderConfig));const h=new dA(d,r,s,r.scalabiltyMode?Vl(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,u);return i.onSuccess(h.getTrackId()),R.info("create camera video success, trackId:",u),h});return function(){return o.apply(this,arguments)}}(),createCustomVideoTrack:function(o){const r=he.reportApiInvoke(null,{tag:xt.TRACER,name:pn.CREATE_CUSTOM_VIDEO_TRACK,options:[o]}),i=new an(o.mediaStreamTrack,{width:o.width,height:o.height,frameRate:o.frameRate,bitrateMax:o.bitrateMax,bitrateMin:o.bitrateMin},o.scalabiltyMode?Vl(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,wt(8,"track-cus-"),[rn.CUSTOM_TRACK]);return r.onSuccess(i.getTrackId()),R.info("create custom video track success with config",o,"trackId",i.getTrackId()),i},createScreenVideoTrack:function(){var o=M(function*(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const s=he.reportApiInvoke(null,{tag:xt.TRACER,name:pn.CREATE_SCREEN_VIDEO_TRACK,options:[Bh({},r),i]});r.encoderConfig?"string"==typeof r.encoderConfig||r.encoderConfig.width&&r.encoderConfig.height||(r.encoderConfig.width={max:1920},r.encoderConfig.height={max:1080}):r.encoderConfig="1080p_2";const u=function Yb(o){const r={};o.screenSourceType&&(r.mediaSource=o.screenSourceType),o.extensionId&&If()&&(r.extensionId=o.extensionId);const{displaySurface:i,selfBrowserSurface:s,surfaceSwitching:u,systemAudio:d}=o;(Rf(107)||bf(107)||wN(93))&&(i&&(Nn(i,"displaySurface",["browser","window","monitor"]),r.displaySurface=i),s?(Nn(s,"selfBrowserSurface",["exclude","include"]),r.selfBrowserSurface=s):r.selfBrowserSurface="include",u&&(Nn(u,"surfaceSwitching",["exclude","include"]),r.surfaceSwitching=u)),(Rf(105)||bf(105)||wN(91))&&d&&(Nn(d,"systemAudio",["exclude","include"]),r.systemAudio=d),o.electronScreenSourceId&&(r.sourceId=o.electronScreenSourceId);const h=o.encoderConfig?ZE(o.encoderConfig):null;return r.mandatory={chromeMediaSource:"desktop",maxWidth:h?h.width:void 0,maxHeight:h?h.height:void 0},h&&(h.frameRate&&("number"==typeof h.frameRate?(r.mandatory.maxFrameRate=h.frameRate,r.mandatory.minFrameRate=h.frameRate):(r.mandatory.maxFrameRate=h.frameRate.max||h.frameRate.ideal||h.frameRate.exact||void 0,r.mandatory.minFrameRate=h.frameRate.min||h.frameRate.ideal||h.frameRate.exact||void 0),r.frameRate=h.frameRate),h.width&&(r.width=h.width),h.height&&(r.height=h.height)),r}(r),d=wt(8,"track-scr-v-");let h=null,f=null;const m=Yt();if(!m.supportShareAudio&&"enable"===i){const y=new L(D.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(y),y.throw()}R.info("start create screen video track with config",r,"withAudio",i,"trackId",d);try{const y=yield Go({screen:u,screenAudio:"auto"===i?m.supportShareAudio:"enable"===i},d);h=y.getVideoTracks()[0]||null,f=y.getAudioTracks()[0]||null}catch(y){throw s.onError(y),y}if(!h){const y=new L(D.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(y),y.throw()}if(!f&&"enable"===i){h&&h.stop();const y=new L(D.SHARE_AUDIO_NOT_ALLOWED);return s.onError(y),y.throw()}r.optimizationMode||(r.optimizationMode="detail"),r.optimizationMode&&(bS(d,h,r,r.encoderConfig&&ZE(r.encoderConfig)),r.encoderConfig&&"string"!=typeof r.encoderConfig&&(r.encoderConfig.bitrateMin=r.encoderConfig.bitrateMax));const _=new an(h,r.encoderConfig?ZE(r.encoderConfig):{},r.scalabiltyMode?Vl(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,d,[rn.SCREEN_TRACK]);if(!f)return s.onSuccess(_.getTrackId()),R.info("create screen video track success","video:",_.getTrackId()),_;const E=new lr(f,void 0,wt(8,"track-scr-a-"),!1,!0);return s.onSuccess([_.getTrackId(),E.getTrackId()]),R.info("create screen video track success","video:",_.getTrackId(),"audio:",E.getTrackId()),[_,E]});return function(){return o.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var o=M(function*(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=he.reportApiInvoke(null,{tag:xt.TRACER,name:pn.CREATE_MIC_AND_CAM_TRACKS,options:[r,i]}),u=vd(i),d=Jb(r),h=wt(8,"track-mic-"),f=wt(8,"track-cam-");let m=null,_=null;R.info("start create camera video track(".concat(f,") and microphone audio track(").concat(h,") with config, audio: ").concat(JSON.stringify(r),", video: ").concat(JSON.stringify(i)));try{const T=yield Go({audio:d,video:u},"".concat(h,"-").concat(f));m=T.getAudioTracks()[0],_=T.getVideoTracks()[0]}catch(T){throw s.onError(T),T}if(!m||!_){const T=new L(D.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(T),T.throw()}i.optimizationMode&&bS(f,_,i,bc(i.encoderConfig));const E=new ty(m,r,d,h),y=new dA(_,i,u,i.scalabiltyMode?Vl(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,f);return s.onSuccess([E.getTrackId(),y.getTrackId()]),R.info("create camera video track(".concat(f,") and microphone audio track(").concat(h,") success")),[E,y]});return function(){return o.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var o=M(function*(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=he.reportApiInvoke(null,{tag:xt.TRACER,name:pn.CREATE_MIC_AUDIO_TRACK,options:[r]}),s=Jb(r),u=wt(8,"track-mic-");let d=null;R.info("start create microphone audio track with config",JSON.stringify(r),"trackId",u);try{d=(yield Go({audio:s},u)).getAudioTracks()[0]||null}catch(f){throw i.onError(f),f}if(!d){const f=new L(D.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(f),f.throw()}const h=new ty(d,r,s,u);return i.onSuccess(h.getTrackId()),R.info("create microphone audio track success, trackId:",u),h});return function(){return o.apply(this,arguments)}}(),createCustomAudioTrack:function(o){const r=he.reportApiInvoke(null,{tag:xt.TRACER,name:pn.CREATE_CUSTOM_AUDIO_TRACK,options:[o]}),i=new lr(o.mediaStreamTrack,o.encoderConfig?Bf(o.encoderConfig):{},wt(8,"track-cus-"),!1,!0);return R.info("create custom audio track success with config",o,"trackId",i.getTrackId()),r.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:function(){var o=M(function*(r){const i=he.reportApiInvoke(null,{tag:xt.TRACER,name:pn.CREATE_BUFFER_AUDIO_TRACK,options:[r]});if(V("DISABLE_WEBAUDIO"))throw new L(D.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const s=wt(8,"track-buf-");R.info("start create buffer source audio track with config",JSON.stringify(r),"trackId",s);const u=r.source;if(!(r.source instanceof AudioBuffer))try{r.source=yield function XP(o,r){return jh.apply(this,arguments)}(r.source,r.cacheOnlineFile)}catch(f){return i.onError(f),f.throw()}const d=new JP(r.source),h=new K0(u,d,r.encoderConfig?Bf(r.encoderConfig):{},s);return R.info("create buffer source audio track success, trackId:",s),i.onSuccess(h.getTrackId()),h});return function(i){return o.apply(this,arguments)}}(),setAppType:function(o){if(R.debug("setAppType: ".concat(o)),!(Number.isInteger(o)&&o>=0))throw R.debug("Invalid appType"),new L(D.INVALID_PARAMS,"invalid app type",o);_t("APP_TYPE",Math.floor(o))},setLogLevel:function(o){R.setLogLevel(o)},enableLogUpload:function(){V("USE_NEW_LOG")?_t("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){V("USE_NEW_LOG")?_t("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Kb},checkAudioTrackIsActive:function(){var o=M(function*(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=he.reportApiInvoke(null,{tag:xt.TRACER,name:pn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[i]});if(!(r instanceof lr||r instanceof gS)){const _=new L(D.INVALID_TRACK,"the parameter is not a audio track");return s.onError(_),_.throw()}i&&i<1e3&&(i=1e3);const u=r instanceof lr?r.getTrackLabel():"remote_track",d=r.getVolumeLevel();let h=d,f=d;const m=Date.now();return new ie(_=>{const E=setInterval(()=>{const y=r.getVolumeLevel();h=y>h?y:h,f=y<f?y:f;const T=h-f>1e-4,b=Date.now()-m;if(T||b>i){clearInterval(E);const w=T,P={duration:b,deviceLabel:u,maxVolumeLevel:h,result:w};R.info("[track-".concat(r.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(P))),s.onSuccess(P),_(w)}},200)})});return function(i){return o.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var o=M(function*(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=he.reportApiInvoke(null,{tag:xt.TRACER,name:pn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[i]});if(!(r instanceof an||r instanceof mS)){const b=new L(D.INVALID_TRACK,"the parameter is not a video track");return s.onError(b),b.throw()}i&&i<1e3&&(i=1e3);const d=r instanceof an?r.getTrackLabel():"remote_track",h=r.getMediaStreamTrack(!0),f=document.createElement("video");f.style.width="1px",f.style.height="1px",f.setAttribute("muted",""),f.muted=!0,f.setAttribute("playsinline",""),f.controls=!1,(or()||Sa())&&(f.style.opacity="0.01",f.style.position="fixed",f.style.left="0",f.style.top="0",document.body.appendChild(f)),f.srcObject=new MediaStream([h]),f.play();const m=document.createElement("canvas");m.width=160,m.height=120;let _=0,E=0;try{const b=Date.now();_=yield function ND(o,r,i,s){let u,d=0,h=null;return new ie((f,m)=>{setTimeout(()=>{u&&(u(),f(d))},r),u=KR(()=>{!function(){d>s&&u&&(u(),f(d));const _=i.getContext("2d");if(!_){const T=new L(D.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(T.toString()),void m(T)}_.drawImage(o,0,0,160,120);const E=_.getImageData(0,0,i.width,i.height),y=Math.floor(E.data.length/3);if(h){for(let T=0;T<y;T+=3)if(E.data[T]!==h[T])return d+=1,void(h=E.data);h=E.data}else h=E.data}()},30)})}(f,i,m,4),E=Date.now()-b}catch(b){throw s.onError(b),b}Ak===it.SAFARI&&(f.pause(),f.remove()),f.srcObject=null;const y=_>4,T={duration:E,changedPicNum:_,deviceLabel:d,result:y};return R.info("[track-".concat(r.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(T))),s.onSuccess(T),y});return function(i){return o.apply(this,arguments)}}(),setArea:my,audioElementPlayCenter:qr,processExternalMediaAEC:function(o){PD.processExternalMediaAEC(o)},registerExtensions:function(o){o.forEach(r=>{const i=r;i.__registered__=!0,i.logger.hookLog=R.extLog,i.reporter.hookApiInvoke=he.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(s=>{i.parameters[s]=V(s)})})},ChannelMediaRelayError:kc,ChannelMediaRelayEvent:Li,ChannelMediaRelayState:br,RemoteStreamFallbackType:sd,RemoteStreamType:Gl,ConnectionDisconnectedReason:st,AudienceLatencyLevelType:rd,AREAS:je});return Object.defineProperties(_n,{onAudioAutoplayFailed:{get:()=>bo.onAudioAutoplayFailed,set:o=>{bo.onAudioAutoplayFailed=o}},onAutoplayFailed:{get:()=>bo.onAutoplayFailed,set:o=>{bo.onAutoplayFailed=o}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>_n._onSecurityPolicyViolation,set(o){_n._onSecurityPolicyViolation=o,ZP(o)}}}),ao.on(hs.CAMERA_DEVICE_CHANGED,o=>{R.info("camera device changed",JSON.stringify(o)),_n.onCameraChanged&&_n.onCameraChanged(o),_n.emit(xi.CAMERA_CHANGED,o)}),ao.on(hs.RECORDING_DEVICE_CHANGED,o=>{R.info("microphone device changed",JSON.stringify(o)),_n.onMicrophoneChanged&&_n.onMicrophoneChanged(o),_n.emit(xi.MICROPHONE_CHANGED,o)}),ao.on(hs.PLAYOUT_DEVICE_CHANGED,o=>{R.debug("playout device changed",JSON.stringify(o)),_n.onPlaybackDeviceChanged&&_n.onPlaybackDeviceChanged(o),_n.emit(xi.PLAYBACK_DEVICE_CHANGED,o)}),qr.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),bo.onAudioAutoplayFailed&&bo.onAudioAutoplayFailed()},tt.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),bo.onAudioAutoplayFailed&&bo.onAudioAutoplayFailed(),_n.emit(xi.AUTOPLAY_FAILED)}),window&&(window.__ARTC__=_n),_n}()},156:na=>{function Xh(M,ra,Mo,Qt,Xn,oa,ws){try{var ia=M[oa](ws),Fr=ia.value}catch(su){return void Mo(su)}ia.done?ra(Fr):Promise.resolve(Fr).then(Qt,Xn)}na.exports=function Vd(M){return function(){var ra=this,Mo=arguments;return new Promise(function(Qt,Xn){var oa=M.apply(ra,Mo);function ws(Fr){Xh(oa,Qt,Xn,ws,ia,"next",Fr)}function ia(Fr){Xh(oa,Qt,Xn,ws,ia,"throw",Fr)}ws(void 0)})}},na.exports.__esModule=!0,na.exports.default=na.exports}},na=>{na(na.s=581)}]);